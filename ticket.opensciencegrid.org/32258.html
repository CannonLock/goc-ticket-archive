<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[32258] Hibernate problems in voms-admin</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=32258" method="post">
<div class="page-header">
    <h3><span class="muted">32258</span> / Hibernate problems in voms-admin</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Steve Timm</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Steve Timm</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Resolve</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2017-01-06</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div><div class="assignee" style="width: 60%">Matyas Selmeci <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/32258", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/32258?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/32258?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Hibernate%20problems%20in%20voms-admin%20ISSUE%3D32258%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='32258#1483718723'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-06T16:05:23+00:00">Jan 6, 2017 04:05 PM UTC</time><a class="anchor" name="1483718723">&nbsp;</a></div><pre>I figured out what was wrong.. it was fairly simple when starting to look at the code.
The key was the fact that it was in the taskLogRecord section.
So I looked at the &#34;task&#34; and &#34;task_log_record&#34; tables.
What I found was the following&#58;

in task_log_record

| 3635 | NULL    | 2016-09-29 12&#58;05&#58;29 | CREATED   | NULL                                                                                                            |    2351 |

in task, this&#58;

|    2351 | NULL                | 2016-09-29 12&#58;05&#58;29 | 2016-10-14 12&#58;05&#58;29 | CREATED   |     NULL |            2 |   2786 |

The last column is user_id.  user_id 2786 no longer exists.

So it appears that the system sent out a sign_the_aup request to user # 2786,
and then user 2786 was deleted before the task expired.

Once I deleted the above records out of task_log_record and task respectively,
the voms_admin operations went back to normal.
(and a bunch of users got suspended because it was making up for lost time
since 2016-09-29).

Lesson--we should not delete a user out of voms-admin if there is a pending
sign-the-AUP request out.  If it has already EXPIRED it is OK.

It is OK to close this ticket.  thanks for your help

We still might want to consider some cleanup on the dzero VO particularly after the KCA
service is turned off next month.. there are a lot of digicert, doegrids, and KCA certs in there
that can never be renewed.

Steve Timm

by /DC=org/DC=cilogon/C=US/O=Fermi National Accelerator Laboratory/OU=People/CN=Steven Timm/CN=UID&#58;timm</pre></div><div class='update_description'><i onclick="document.location='32258#1483650821'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-05T21:13:41+00:00">Jan 5, 2017 09:13 PM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1483650821">&nbsp;</a></div><pre>Hi Steve,

Could you increase the logging for voms-admin (should be in /etc/voms-admin/dzero/logback.runtime.xml), especially for org.glite.security.voms.admin and org.hibernate, then restart, wait a bit for errors to be produced, and send me the new voms-admin log? That would help narrow down which part of the code is complaining.

Thanks,
-Mat</pre></div><div class='update_description'><i onclick="document.location='32258#1483630631'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-05T15:37:11+00:00">Jan 5, 2017 03:37 PM UTC</time><a class="anchor" name="1483630631">&nbsp;</a></div><pre><a href='https&#58;//fermi.service-now.com/incident.do?sys_id=1527dc83db4c7600feacf81d0f961996' target='_blank' rel='nofollow'>https&#58;//fermi.service-now.com/incident.do?sys_id=1527dc83db4c7600feacf81d0f961996</a>
INC803675 tracking this at Fermilab as well.

by /DC=org/DC=cilogon/C=US/O=Fermi National Accelerator Laboratory/OU=People/CN=Steven Timm/CN=UID&#58;timm</pre></div><div class='update_description'><i onclick="document.location='32258#1483630047'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-05T15:27:27+00:00">Jan 5, 2017 03:27 PM UTC</time><a class="anchor" name="1483630047">&nbsp;</a></div><pre>Adding Lisa Giacchetti to the CC.

by /DC=org/DC=cilogon/C=US/O=Fermi National Accelerator Laboratory/OU=People/CN=Steven Timm/CN=UID&#58;timm</pre></div><div class='update_description'><i onclick="document.location='32258#1483626911'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-05T14:35:11+00:00">Jan 5, 2017 02:35 PM UTC</time> by <b>Steven Timm</b><a class="anchor" name="1483626911">&nbsp;</a></div><pre>I&#39;ll be glad to send a mysql dump of the DB in question if you want.  Let me know.

Steve Timm</pre></div><div class='update_description'><i onclick="document.location='32258#1483626708'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-05T14:31:48+00:00">Jan 5, 2017 02:31 PM UTC</time> by <b>Tim Cartwright</b><a class="anchor" name="1483626708">&nbsp;</a></div><pre>Mat, could you try to help Steve? It may involve some code-diving to figure out what VOMS Admin is trying to do. Come talk to me about cascading deletes if you want help there. My initial suspicion is that there is something wrong with one of the tables and/or its indexes, such that a periodic SQL statement is failing.</pre></div><div class='update_description'><i onclick="document.location='32258#1483565566'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-04T21:32:46+00:00">Jan 4, 2017 09:32 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1483565566">&nbsp;</a></div><pre>We recently discovered that our voms-admin server for the DZERO VO had been throwing continuous exceptions for the last three months at least, maybe longer.  We run ten VO&#39;s on this voms/voms-admin server and this is the only one thus affected.  (The server is actually a twin server
and both of them have the same exact problem)

[root@voms2 tomcat6]# rpm -qa | grep -i voms
voms-mysql-plugin-3.1.6-1.1.osg33.el6.x86_64
osg-voms-3.3-3.osg33.el6.noarch
voms-2.0.12-3.3.osg33.el6.x86_64
voms-admin-server-2.7.0-1.21.osg33.el6.noarch
voms-server-2.0.12-3.3.osg33.el6.x86_64
voms-admin-client-2.0.17-1.1.osg33.el6.noarch
---------------------------------
The other thing to note is that our DEV server, which is running off an older version of the database for this VO that was synced off
a few months ago, is not having the same problem.  This points the finger at database corruption of some sort.
The question is how to detect and fix it?

I paste below the full thread of the discussion which has happened on osg-software list up until now.

OK, let’s start a GOC (not JIRA) ticket so we can track this. Can you please
include the results from a &#39;rpm -qa | grep -i voms&#39; command?

— Tim

On 4 Jan 2017, at 15&#58;09, Steven C Timm &#60;timm@....&#62; wrote&#58;

The counts of tasks  that I provided are from today, from
midnight to now.
The  TaskStatusUpdater runs (and errors) every 30 seconds, the other
ones less frequently, a few minutes apart each.

It&#39;s starting to smell like an inconsistency in the acl2
/acl2_permissions tables, the question is where and how.
If someone has easy access to the source code in question and could
see the sql queries being made, it would hellp.

Steve
<div id='show_396933455' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_396933455'>
____________________________________________________________________________
From&#58; owner-osg-software@....
&#60;owner-osg-software@....&#62; on behalf of Tim Cartwright
&#60;cat@....&#62;
Sent&#58; Wednesday, January 4, 2017 2&#58;56&#58;59 PM
To&#58; Steven C Timm
Cc&#58; OSG Software
Subject&#58; Re&#58; Strange hibernate errors in voms-admin  
I mean the specific results with counts that you provided. Is that
from 3 months? 3 weeks? 3 days? I’m trying to get a sense of frequency
of occurrence.

— Tim

On 4 Jan 2017, at 14&#58;54, Steven C Timm &#60;timm@....&#62; wrote&#58;

They&#39;ve been going on continuously ever since the voms
server was installed on the current hardware, maybe even
before that.  3 months at least.

Steve Timm

____________________________________________________________________________
From&#58; Tim Cartwright &#60;cat@....&#62;
Sent&#58; Wednesday, January 4, 2017 2&#58;53&#58;29 PM
To&#58; Steven C Timm
Cc&#58; OSG Software
Subject&#58; Re&#58; Strange hibernate errors in voms-admin  
Over what time range are these results?

— Tim

On 4 Jan 2017, at 14&#58;51, Steven C Timm &#60;timm@....&#62; wrote&#58;

By looking at the error messages I figured out what
tasks it is doing&#58;

[root@voms1 tomcat6]# grep ERROR voms-admin-dzero.log |
grep &#39;while executing task&#39;  | awk &#39;{print $15}&#39; | sort |
uniq -c
    178 ExpiredRequestsPurgerTask
     89 MembershipCheckerTask
   1781 TaskStatusUpdater
     30 UpdateCATask
     15 UserStatsTask

Now we just have to figure out what part of the DB might
not be happy to make those tasks fail.

I did not mention it earlier but the VOMS seems to be
functioning just fine otherwise, returning gridmap users,
gums users, signing voms-proxies, and all of that stuff.

Steve
 From&#58; owner-osg-software@.... &#60;owner-osg-software@openscienc
egrid.org&#62; on behalf of Steven C Timm &#60;timm@....&#62;
Sent&#58; Wednesday, January 4, 2017 2&#58;39&#58;12 PM
To&#58; OSG Software
Subject&#58; Strange hibernate errors in voms-admin  
In one of the nine VO&#39;s that we operate a voms server for,
I am currently seeing a very strange Hibernate error
in the voms-admin log

2017-01-04 20&#58;33&#58;34.236Z - ERROR
[DatabaseTransactionTaskWrapper] - An unexpected exception
was caught while executing task ExpiredRequestsPurgerTask
2017-01-04 20&#58;33&#58;34.236Z - ERROR
[DatabaseTransactionTaskWrapper] - A collection with
cascade=&#34;all-delete-orphan&#34; was no longer referenced by
the owning entity instance&#58;
org.glite.security.voms.admin.persistence.model.task.Task.logRecords

This error is happening every 30 seconds.

Interestingly enough it is not happening against my DEV
database for the same VO, indicating that the databases 
have diverged in the last 6 months or so since last we
synced.

Also note that even when voms-admin is restarted the error
doesn&#39;t go away.

The questions are&#58;
1) what update task would voms-admin be doing every 30
seconds or so.  (sometimes there are 2-3 of these errors
on the 30-second interval but usually just one).
2) what is the right way to test for the integrity of the
database?

This appears to be a fairly common error among web
applications that use hibernate such as voms-admin,
but I haven&#39;t found anything specific related to
voms-admin.  In general the error happens when there
is something recognized as a &#34;collection&#34; in hibernate and
then part of it gets deleted.

Any help is appreciated.  If I should file a JIRA ticket
let me know.

Steve Timm

by /DC=org/DC=cilogon/C=US/O=Fermi National Accelerator Laboratory/OU=People/CN=Steven Timm/CN=UID&#58;timm

</div><script type='text/javascript'>
        $('#show_396933455').click(function() {
            $('#detail_396933455').slideDown("normal");
            $('#show_396933455').hide();
            $('#hide_396933455').show();
        });
        $('#hide_396933455').click(function() {
            $('#detail_396933455').slideUp();
            $('#hide_396933455').hide();
            $('#show_396933455').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F32258">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 32258});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
