<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[8961] OSG Storage&#58; Issues with Storage Element at HEP_OU</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=8961" method="post">
<div class="page-header">
    <h3><span class="muted">8961</span> / OSG Storage&#58; Issues with Storage Element at HEP_OU</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">alex sim</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls"></div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2010-07-28</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Neha Sharma <span class="muted"> / OSG Storage Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("https://ticket.opensciencegrid.org/attachment/list?id=8961", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="https://ticket.opensciencegrid.org/\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="https://ticket.opensciencegrid.org/\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/8961?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/8961?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20OSG%20Storage%26%2358%3B%20Issues%20with%20Storage%20Element%20at%20HEP_OU%20ISSUE%3D8961%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='8961#1281451690'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-08-10T14:48:10+00:00">Aug 10, 2010 02:48 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1281451690">&nbsp;</a></div><pre>Alex

He is already on cc list

-neha
On Aug 9, 2010, at 5&#58;27 PM, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1281392828'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-08-09T22:27:08+00:00">Aug 9, 2010 10:27 PM UTC</time> by <b>Alex Sim</b><a class="anchor" name="1281392828">&nbsp;</a></div><pre>**An update was made to this Ticket based on an update made through email to dynamically-linked Ticket #8930 in Project Open Science Grid**

Hi Horst,

Please add jgu@.... to the ticket.
It&#39;s good to hear that it&#39;s working.

-- Alex

On 8/9/10 2&#58;31 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1281366187'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-08-09T15:03:07+00:00">Aug 9, 2010 03:03 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1281366187">&nbsp;</a></div><pre>Done. I have linked 8961 to 8930

-neha
On Aug 8, 2010, at 3&#58;57 PM, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1281301027'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-08-08T20:57:07+00:00">Aug 8, 2010 08:57 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1281301027">&nbsp;</a></div><pre>Hi Neha and all,

could we link this ticket with ticket 8930, which is the one that is linked
with the original GGUS and RT tickets? I posted a comment there yesterday
(see below), but haven&#39;t heard a response yet, so I&#39;m not sure if all
the storage experts are on there.

Thanks,

Horst

----
Hi all,

well, we&#39;re making progress, but we&#39;re not quite there yet.

We couldn&#39;t do the Lustre upgrade last week because the new version isn&#39;t
ready for production yet, hopefully in a week or two. In the mean time,
we&#39;ve worked with the DDN people on tuning our Lustre file system,
and I think we&#39;re making progress. More on that soon.

We&#39;ve also got extended attributes to work with Lustre, so now we can save
the adler32 checksums for each file, therefore we won&#39;t have to calculate
them multiple times. I&#39;ve started a background process to do that for
all files in all space tokens, so that should help improve the situation.

The only problem is that while our script works fine on
the command line -- and by OUR script I mean an adaptation of
Saul&#39;s, Charles&#39;, and Doug&#39;s scripts, so thanks everybody! --
for regular users and root -- i.e., we can set the extended attribute
for a file owned by a user when the script runs as that user or root --
we can&#39;t get it to work with bestman yet, which is presumably because
bestman runs as daemon, and therefore when the script runs, daemon
doesn&#39;t have permission to set the attribute (just like a regular user
who doesn&#39;t own the file doesn&#39;t, so that part is perfectly fine).
<div id='show_104844100' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_104844100'>
When I try running it from bestman and getting/setting the checksum
that way, I&#39;m getting an error&#58;

ERROR&#62;error setting adler32 for /storage/data/tmp/hs/onegiga
2010-08-07T17&#58;29&#58;28.248 CDT OUTPUT&#62;c02d0001

Which is the same error I&#39;m getting when I run it as a user
who doesn&#39;t own the file, so again, that&#39;s not surprising.

I tried playing around with sudo and adding the checksumming scripts
to the list of bestman allowed scripts (Cmnd_Alias SRM_CMD), but that
didn&#39;t seem to help. Or maybe I&#39;m just doing it wrong? I added it like
this&#58;

Cmnd_Alias SRM_CMD = /bin/rm, /bin/mkdir, /bin/rmdir, /bin/mv, /bin/cp, /bin/ls,
/storage/app/gridapp/adler32/adler32.py,
/storage/app/gridapp/adler32/calc_adler32.py
Runas_Alias SRM_USR = ALL, !root
daemon     ALL=(SRM_USR) NOPASSWD&#58; SRM_CMD

Any ideas how to get this working?

I&#39;m including Saul and Doug in this email, since they obviously
did get it working at BU and ANL with GPFS and ext4, respectively.

Did you have to do anything special in the bestman configs
to get this to work? Or do GPFS and ext4 handle these permissions
and/or extended attributes just differently?

Thanks a lot,

Horst

-- by hs@.... at Sat Aug 07 23&#58;22&#58;08 UTC 2010

For complete ticket details, click
<a href='8930' target='_blank' rel='nofollow'>https&#58;//ticket.grid.iu.edu/goc/viewer?id=8930</a>

Assignees&#58; GGUS (Prod), Andrew Baranovski, Elizabeth Chism, Ted Hesselroth, Tanya Levshina, USATLAS (BNL Prod), Neha Sharma, Alex Sim

--
Please submit problems, requests, and questions at&#58;
<a href='https&#58;//ticket.grid.iu.edu/goc/open' target='_blank' rel='nofollow'>https&#58;//ticket.grid.iu.edu/goc/open</a>

OSG Grid Operations Center
goc@...., 317-278-9699
Visit the OSG Support Page&#58;
<a href='http&#58;//www.opensciencegrid.org/ops' target='_blank' rel='nofollow'>http&#58;//www.opensciencegrid.org/ops</a>
RSS&#58; <a href='http&#58;//osggoc.blogspot.com/' target='_blank' rel='nofollow'>http&#58;//osggoc.blogspot.com/</a>
</div><script type='text/javascript'>
        $('#show_104844100').click(function() {
            $('#detail_104844100').slideDown("normal");
            $('#show_104844100').hide();
            $('#hide_104844100').show();
        });
        $('#hide_104844100').click(function() {
            $('#detail_104844100').slideUp();
            $('#hide_104844100').hide();
            $('#show_104844100').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='8961#1281106027'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-08-06T14:47:07+00:00">Aug 6, 2010 02:47 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1281106027">&nbsp;</a></div><pre>based on the discussion, i am going to close this ticket for now. if anyone feels it should be reopened, please let me know

-neha</pre></div><div class='update_description'><i onclick="document.location='8961#1280852288'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-08-03T16:18:08+00:00">Aug 3, 2010 04:18 PM UTC</time> by <b>Alex Sim</b><a class="anchor" name="1280852288">&nbsp;</a></div><pre>Hi Karthik,

As Junmin and Wei mentioned $1 should be ok with the conf value.

One thing that worries me is that this is not a solution but a work-around.
Even if this would resolve the immediate issue, you need to continue
looking into this node performance on the file system, and resolve it.

-- Alex

On 8/2/10 10&#58;09 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1280812688'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-08-03T05:18:08+00:00">Aug 3, 2010 05:18 AM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1280812688">&nbsp;</a></div><pre>I think 200 is enough. You can find out what FTS does by looking at the log&#58;

<a href='http&#58;//www.usatlas.bnl.gov/fts-monitor/ftsmon/index' target='_blank' rel='nofollow'>http&#58;//www.usatlas.bnl.gov/fts-monitor/ftsmon/index</a>
<a href='http&#58;//www.usatlas.bnl.gov/fts-monitor/ftsmon/showJob?jobid=ddb1e327-9ea1-11df-9d63-f0c52a5177e3' target='_blank' rel='nofollow'>http&#58;//www.usatlas.bnl.gov/fts-monitor/ftsmon/showJob?jobid=ddb1e327-9ea1-11df-9d63-f0c52a5177e3</a>

The script pointed by hexChecksumCommand should take a parameter ($1) as the file path.

regards,
Wei Yang  |  yangw@....  |  650-926-3338(O)

On Aug 2, 2010, at 10&#58;09 PM, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1280812147'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-08-03T05:09:07+00:00">Aug 3, 2010 05:09 AM UTC</time> by <b>Karthik Arunachalam</b><a class="anchor" name="1280812147">&nbsp;</a></div><pre>Hi Alex,

<font color='#7F7E6F'>&#62; you could server up to about 200 concurrent checksum calculation</font>
<font color='#7F7E6F'>&#62; requests, and anything beyond that number, some requests will time-out.</font>

That might be true. But I hope still that would give much better
performance than before. This is the reason I would like to know how many
simultaneous srm-ls requests are generated by the FTS requests. Hiro, do
you know?

Let me test this out to see what the limit is. I shall
start with the srm-ls load test from the client and see how it behaves. I
will get back with the statistics. If that goes fine, then we could
proceed with the srm-ls requests from the FTS clients and see how it goes.
It might be Wednesday, since our cluster will be down for most part
tomorrow.

<font color='#7F7E6F'>&#62; To replace your script with the commad&#58;</font>
<font color='#7F7E6F'>&#62; hexChecksumCommand=/path/to/your/script/command</font>

Sounds good.

<font color='#7F7E6F'>&#62; Bestman will pick up the script path, and add the file path for the</font>
<font color='#7F7E6F'>&#62; calculation and execute. Have your script pick up the command argument,</font>
<font color='#7F7E6F'>&#62; e.g. handle $*</font>

My script will only handle $1. Assuming it is the file path, it will work
as expected.

-Karthik

On Tue, 3 Aug 2010, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1280811068'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-08-03T04:51:08+00:00">Aug 3, 2010 04:51 AM UTC</time> by <b>jgu@....</b><a class="anchor" name="1280811068">&nbsp;</a></div><pre>Karthik.

the usage of the hexChecksumCommand is
that bestman will invoke &#34;valueOfHexChecksumCommand  filepath&#34;
when the file checksum needs to be invoked.

So, from your description, it seems if supply your executable script as
value of hexChecksumCommand
bestman should be able to calculate the checksum for you..

would you try it out with one file?
- Junmin

On 8/2/2010 7&#58;30 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1280802607'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-08-03T02:30:07+00:00">Aug 3, 2010 02:30 AM UTC</time> by <b>Alex Sim</b><a class="anchor" name="1280802607">&nbsp;</a></div><pre>Hi Karthik,

It seems that what you have corresponds to the previous measurements,
and the previous performance that you have seen is per-node rate. It
seems to be related to the file system configuration, rather than the
storage hardware as a whole. That was my question before.
With this cluster calculation, you could server up to about 200
concurrent checksum calculation requests, and anything beyond that
number, some requests will time-out.

To replace your script with the commad&#58;

hexChecksumCommand=/path/to/your/script/command

Bestman will pick up the script path, and add the file path for the calculation and execute.
Have your script pick up the command argument, e.g. handle $*

(Junmin, pls confirm the usage.)

This should work around the issue for now.

-- Alex

On 8/2/10 7&#58;12 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1280801527'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-08-03T02:12:07+00:00">Aug 3, 2010 02:12 AM UTC</time> by <b>Karthik Arunachalam</b><a class="anchor" name="1280801527">&nbsp;</a></div><pre>Hi Alex,

I did a round robin request of the checksums and as expected the time
to compute the checksum per file (for 56 parallel requests one per compute
node on 54 nodes) was around 4 seconds. I increased it to 280 parallel
requests (with arond 5 checksum requests per node on 5 different files)
and the maximum time was only around 3 minutes (as opposed to an average
of 25 minutes per file on the srm server). So this is a substantial
improvement in performance.

I have the framework of the script to distribute the checksum requests
an appropriate compute node automatically on a round robin fashion. The
next step should be to try to integrate this script with bestman. What is
the best way to go about doing this?

I know the bestman.rc file has
hexChecksumCommand=/data/osg/adler32/xrdadler32

My script would need the file with the absolute path as an argument. So
how do I replace the above command with my script + a file argument i.e.
where do I get the absolute path to the file from? Once I could figure
this out, we could run more load tests and see how it goes.

<font color='#7F7E6F'>&#62; completion under a minute) is performance per node  or for the whole</font>
<font color='#7F7E6F'>&#62; file system/storage.</font>

I am not very clear on what you are saying here. Could you please
clarify? Does my above test help with answering this question?

Thanks,
Karthik

On Fri, 30 Jul 2010, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1280509567'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-30T17:06:07+00:00">Jul 30, 2010 05:06 PM UTC</time> by <b>Alex Sim</b><a class="anchor" name="1280509567">&nbsp;</a></div><pre><font color='#7F7E6F'>&#62;&#62; Oh, wait are we saying that the srm server would be flooded with these</font>
<font color='#7F7E6F'>&#62;&#62; requests continuously, even spawning one request to a compute node at</font>
<font color='#7F7E6F'>&#62;&#62; a time means each compute node will be getting continuous requests keeping</font>
<font color='#7F7E6F'>&#62;&#62; them busy to the point they can&#39;t do much else?</font>

Yes, it depends on how many nodes you have and how many requests there are.
If you have 20 nodes, and there are 100 requests at a certain time, each
could have 5 provided that requests are distributed in round-robin or in
a smart algorithm.

Before you do this, it would be good to find out if your rate (4
completion under a minute) is performance per node  or for the whole
file system/storage.

best regards,

-- Alex

On 7/29/10 2&#58;42 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1280439727'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-29T21:42:07+00:00">Jul 29, 2010 09:42 PM UTC</time> by <b>Karthik Arunachalam</b><a class="anchor" name="1280439727">&nbsp;</a></div><pre>Hi Alex,

<font color='#7F7E6F'>&#62; Good point.</font>
<font color='#7F7E6F'>&#62; You can have xrdadler32 in conf file replaced with a proper spawning</font>
<font color='#7F7E6F'>&#62; script to other compute nodes. The questionable part in the script, I</font>
<font color='#7F7E6F'>&#62; think, would be how to find out idling compute node and submit it to the</font>
<font color='#7F7E6F'>&#62; particular node.</font>

We could distribute several checksum requests all across the
cluster with one request to one compute node. Assuming we could do
this, the overhead on the compute node to do this calculation
should be negligible enough for us to worry about if it is idling or not.

Oh, wait are we saying that the srm server would be flooded with these
requests continuously, even spawning one request to a compute node at
a time means each compute node will be getting continuous requests keeping
them busy to the point they can&#39;t do much else?

OK, I think we could work out an algorithm to (or use one if I can re-use
something that already exists) spread out the requests to the compute
nodes over time (may be round robin or some other scheduling) that the
effect on a single compute node is really negligible. That could work out
for our benefit. What do you think? Other ideas?

It would be helpful to know how many simultaneous FTS/srm-ls requests
come to the server, on an average. Hiro, do you know?

Thanks,
Karthik

On Thu, 29 Jul 2010, Karthik Arunachalam wrote&#58;

<font color='#7F7E6F'>&#62; Hi,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Just to update. We have opened a case with DDN to look into this issue and</font>
<div id='show_98502101' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_98502101'><font color='#7F7E6F'>&#62; they are working on it. But they wanted to know if it is possible to</font>
<font color='#7F7E6F'>&#62; distribute the request (at least the checksum calculation) to several clients</font>
<font color='#7F7E6F'>&#62; (since the lustre file system is accessible on all head and compute nodes),</font>
<font color='#7F7E6F'>&#62; so that a single machine (the SRM server) isn&#39;t over loaded.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; This should be possible to do. It could be as simple as spawning the checksum</font>
<font color='#7F7E6F'>&#62; result to a compute node and getting back the result. All this would need is</font>
<font color='#7F7E6F'>&#62; to have the adler32 computing program on the compute nodes and having</font>
<font color='#7F7E6F'>&#62; password-less access to the compute nodes (currently that is how access to</font>
<font color='#7F7E6F'>&#62; compute nodes have been setup). Of course this is just a draft idea. It could</font>
<font color='#7F7E6F'>&#62; be refined and implemented. Other suggestions are welcome. But there is</font>
<font color='#7F7E6F'>&#62; really no reason to overload just the SRM server with this responsibility!</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; -Karthik</font>
</div><script type='text/javascript'>
        $('#show_98502101').click(function() {
            $('#detail_98502101').slideDown("normal");
            $('#show_98502101').hide();
            $('#hide_98502101').show();
        });
        $('#hide_98502101').click(function() {
            $('#detail_98502101').slideUp();
            $('#hide_98502101').hide();
            $('#show_98502101').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='8961#1280434575'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-29T20:16:15+00:00">Jul 29, 2010 08:16 PM UTC</time> by <b>echism</b><a class="anchor" name="1280434575">&nbsp;</a></div><pre>I am adding Karthik to this ticket.

Thank you,
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='8961#1280430728'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-29T19:12:08+00:00">Jul 29, 2010 07:12 PM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1280430728">&nbsp;</a></div><pre>Using interactive batch like lsrun?

regards,
Wei Yang  |  yangw@....  |  650-926-3338(O)

On Jul 29, 2010, at 12&#58;03 PM, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1280430187'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-29T19:03:07+00:00">Jul 29, 2010 07:03 PM UTC</time> by <b>Alex Sim</b><a class="anchor" name="1280430187">&nbsp;</a></div><pre>Karthik,

Good point.
You can have xrdadler32 in conf file replaced with a proper spawning
script to other compute nodes. The questionable part in the script, I
think, would be how to find out idling compute node and submit it to the
particular node.

-- Alex

On 7/29/10 11&#58;54 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1280429648'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-29T18:54:08+00:00">Jul 29, 2010 06:54 PM UTC</time> by <b>Karthik Arunachalam</b><a class="anchor" name="1280429648">&nbsp;</a></div><pre>Hi,

Just to update. We have opened a case with DDN to look into this issue and
they are working on it. But they wanted to know if it is possible to
distribute the request (at least the checksum calculation) to several
clients (since the lustre file system is accessible on all head and
compute nodes), so that a single machine (the SRM server) isn&#39;t over
loaded.

This should be possible to do. It could be as simple as spawning
the checksum result to a compute node and getting back the result. All
this would need is to have the adler32 computing program on the compute
nodes and having password-less access to the compute nodes (currently that
is how access to compute nodes have been setup). Of course this is just a
draft idea. It could be refined and implemented. Other suggestions are
welcome. But there is really no reason to overload just the SRM
server with this responsibility!

-Karthik

On Thu, 29 Jul 2010, Karthik Arunachalam wrote&#58;

<font color='#7F7E6F'>&#62; Hi Junmin,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On Wed, 28 Jul 2010, Junmin wrote&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62;  Karthik,</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;  Not sure whether you will need it, but</font>
<font color='#7F7E6F'>&#62;&#62;  here is the way configure different gsiftp servers&#58;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;  supportedProtocolList=<a href='gsiftp&#58;//dmx09.lbl.gov&#58;2811///' target='_blank' rel='nofollow'>gsiftp&#58;//dmx09.lbl.gov&#58;2811///</a>;<a href='gsiftp&#58;//hello.lbl.gov&#58;2813' target='_blank' rel='nofollow'>gsiftp&#58;//hello.lbl.gov&#58;2813</a></font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; I checked our bestman.rc file and I already see that we have all of our</font>
<font color='#7F7E6F'>&#62; servers in the list (guess that is how Horst configured it to start with), as</font>
<div id='show_1583923516' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1583923516'><font color='#7F7E6F'>&#62; shown below.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; supportedProtocolList=<a href='gsiftp&#58;//tier2-02.ochep.ou.edu' target='_blank' rel='nofollow'>gsiftp&#58;//tier2-02.ochep.ou.edu</a>;<a href='gsiftp&#58;//tier2-03.ochep.ou.edu' target='_blank' rel='nofollow'>gsiftp&#58;//tier2-03.ochep.ou.edu</a>;<a href='gsiftp&#58;//tier2-04.ochep.ou.edu' target='_blank' rel='nofollow'>gsiftp&#58;//tier2-04.ochep.ou.edu</a></font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; So this is already taken care of.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62;  As we mentioned in the meeting, I will add concurrency limit on ls and</font>
<font color='#7F7E6F'>&#62;&#62;  send updated binary to you.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;  At the mean time, would you see what is a good concurrency number your</font>
<font color='#7F7E6F'>&#62;&#62;  system can handle?</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Here is the statistics on how long it takes on an average for computing the</font>
<font color='#7F7E6F'>&#62; checksum for one file, given the # of concurrent processes&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; # of concurrent process &#58; minutes, seconds</font>
<font color='#7F7E6F'>&#62; 1 &#58; 0m, 40s</font>
<font color='#7F7E6F'>&#62; 2 &#58; 0m, 34s</font>
<font color='#7F7E6F'>&#62; 3 &#58; 0.33m, 45s</font>
<font color='#7F7E6F'>&#62; 4 &#58; 0.25m, 43s</font>
<font color='#7F7E6F'>&#62; 5 &#58; 1.80m, 36s</font>
<font color='#7F7E6F'>&#62; 6 &#58; 4.33m, 19s</font>
<font color='#7F7E6F'>&#62; 7 &#58; 4.57m, 15s</font>
<font color='#7F7E6F'>&#62; 8 &#58; 4.75m, 28s</font>
<font color='#7F7E6F'>&#62; 9 &#58; 6.00m, 31s</font>
<font color='#7F7E6F'>&#62; 10 &#58; 8.50m, 32s</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; I don&#39;t know what is the timeout limit for the FTS process. Hiro, what is the</font>
<font color='#7F7E6F'>&#62; FTS timeout value? Also what is the relationship between the # of FTS</font>
<font color='#7F7E6F'>&#62; requests and the number of simultaneous srm-ls requests? What are the other</font>
<font color='#7F7E6F'>&#62; factors involved in determining the # of concurrent srm-ls requests?</font>
<font color='#7F7E6F'>&#62; A &#34;good&#34; concurrency # might depend on these details.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Thanks,</font>
<font color='#7F7E6F'>&#62; Karthik</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62;  On 7/28/2010 9&#58;35 AM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   Hi Alex,</font>
<font color='#7F7E6F'>&#62;&#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   I ran xrdadler32 on the same files stored on a different machine with</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   the</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   all the files stored on the local hard drive (no DDN or lustre involved</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   here). This is a dual quad core machine with 24 GB of RAM.</font>
<font color='#7F7E6F'>&#62;&#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   Surprisingly the result was that it took on an average 21 minutes per</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   file, which is comparable to what it took on our SRM server with files</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   stored on the lustre mounted DDN disks. So I am not sure if it is</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   obvious</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   here that the file system (DDN) is the issue.</font>
<font color='#7F7E6F'>&#62;&#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   May be this is an inherent performance issue with the xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   program</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   itself. It reads the file 64K blocks at a time (would take &#62; 30000</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   reads</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   for a 2GB file) and given 50 xrdadler32 processes reading 50 different</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   files, one can imagine how long it might take.</font>
<font color='#7F7E6F'>&#62;&#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   -Karthik</font>
<font color='#7F7E6F'>&#62;&#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;   On Tue, 27 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   Hi Karthik,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   I suspect it&#39;s not xrdadler32 only. It could be either DDN</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   configuration</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   or the file system configuration. Bottom line is that reading on many</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   files concurrently slows down the storage performance significantly.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   My</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   previous experience with DDN configuration with PVFS was that it was</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   significantly slow with many inode access and often hung</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   indefinitely.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   We mount the partitions on DDN as local to the hosts rather than</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   using</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   PVFS to resolve the issue. (People use PVFS successfully, but for</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   some</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   reason, we didn&#39;t have such opportunity.)  So, if you have any Lustre</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   mounting points not from the DDN, you can test how it&#39;s different</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   from</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   DDN, just to eliminate the possibility of the file system issues.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   -- Alex</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;   On 7/27/10 1&#58;30 PM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   Hi,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   I ran xrdadler32 on 56 different files at the same time (I only did</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   this once, rather than in a sequence like 1,5,10...).  The good (or</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   bad?) news is that the average time it took for one file (of size ~</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   2</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   GB) was 31 minutes &#58;(. So Alex, you put it right. The last time</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   file</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   caching was helping, but this time it didn&#39;t since every file was</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   different.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   The question is, why xrdadler32 takes such a long time. I was</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   talking</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   to Hiro during the throughput phone call today and he mentioned</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   that</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   there are some issues with the underlying DDN hardware and it</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   chokes</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   when more than 50 clients run (in this case calculating the</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   checksum). On a strace of the process I could see output like&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   read(4,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   &#34;&#92;311&#92;300&#92;245&#92;262&#92;317D&#92;370&#92;356&j&#92;17&#92;225&#92;250k&#92;34&#92;21Z&#92;271&#92;256xe&#92;365&#92;240&#92;317&#92;32&#92;251&#92;265&#92;257ox&#92;264&#92;306&#34;...,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   65536) = 65536 &#60;3.421719&#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   read(4,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   &#34;T&#92;363&#92;312k&#92;353&#92;2&#92;271&#92;205V&#92;177t&#92;323&#92;276v&#92;205}&#92;252&#92;33&#92;7&#92;232$r~u&#92;355&#92;304&#92;20H&#92;352@&#92;202&#92;341&#34;...,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   65536) = 65536 &#60;0.054670&#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   ....</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   xrdadler32 is reading 64K blocks at a time and working on the file.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   You could see the time it takes for this one operation at the end</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   of</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   the output above.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   We know what the symptom is (xrdadler32 taking a long time). But we</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   need to find the root cause and get this fixed. May be DDN is the</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   issue or may be it is something else. Hiro, let us know what you</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   find</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   from DDN. Then we could also open a ticket with DDN. But it would</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   also</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   be beneficial if we try alternative approaches to solve this issue.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   Ideas? Wei, should I implement your suggestion (below) and would</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   that</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   help to calculate the checksum in a different/faster way?</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   -----------------------------------------------------------------------------------</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   Wei&#39;s suggestion&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   ------------------</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   The .so at <a href='http&#58;//wt2.slac.stanford.edu/gridftp' target='_blank' rel='nofollow'>http&#58;//wt2.slac.stanford.edu/gridftp</a> are Gridftp&#39;s DSI</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   modules using pure POSIX IO functions. They also have a built-in</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   function to calculate Adler32, and can be configured to use</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   external</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   tool if you prefer so. To try it for you environment, you need to</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   do</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   the following two steps&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   1. Download one of the .so for your platform and save it to</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   $VDT_LOCATION/globus/lib or any other location within</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   LD_LIBRARY_PATH.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   Make sure its &#39;x&#39; bit is set.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   2. Modify $VDT_LOCATION/vdt/services/vdt-run-gsiftp.sh. Append</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   &#34;-dsi</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   posix&#34; to the end of a line like this&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   exec $VDT_LOCATION/globus/sbin/globus-gridftp-server</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   ------------------------------------------------------------------------------------</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   Junmin, given the above conclusion, I didn&#39;t run the srm-ls tests</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   to</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   cross check.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   Thanks,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   Karthik</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;   On Tue, 27 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;   thanks.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;   -- Alex</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;   On 7/27/10 9&#58;07 AM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;   Hi Alex,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;   I see. Good point. Didn&#39;t think about that. OK, in that case I</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;   will do</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;   the test with random (non-repetitive) files for each xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;   process. I will also once again test with multiple srm-ls</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;   request.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;   Will report back once I have some results.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;   -Karthik</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;   On Tue, 27 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;   Hi Karthik,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;   I&#39;m afraid that your test might have benefited from file</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;   system</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;   caching.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;   -- Alex</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;   On 7/27/10 8&#58;31 AM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   Hi Alex,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   On Mon, 26 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   Hi karthik,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   Is 300 Adler32 on the same file or 300 different files?</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   That</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   practically makes a difference.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   It is on the same file.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   -Karthik</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   On Jul 26, 2010, at 9&#58;37 PM, Karthik Arunachalam</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   &#60;karunach@....&#62; wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   Hi Jumin,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   On Sat, 24 Jul 2010, Junmin wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   Karthik,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   Is it possible to not involing bestman, but just test</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   process alone?</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   Sure. I have done this and below are the results.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   e.g. for the same large file (the one you use now)</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   a) how long does it take with one xrdadler32 process</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   to calculate</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   5 seconds average for a ~ 2 GB file. Not much at all.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   b) using threads, each initiating a xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   calculation on the</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   same file, how long does that take with different</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   values of</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   concurrency?</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   I ran concurrent processes ranging from 1 to 300 in</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   increments of 5</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   i.e 1, 5, 10.....290, 295, 300 and measured the average</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   time it</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   took</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   for each case. The maximum time it took for *300*</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   concurrent</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   processes calculating the xrdadler32 was around 2</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   minutes.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   I am attaching the results (xavg contains the average</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   time for each</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   case. xtime.tar.gz contains the individual time</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   statistics for each</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   case. For example file x10 contains the individual</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   times taken by</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   all the 10 threads). Please take a look.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   So even in the case where 300 xrdadler32 process ran</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   simultaneously,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   the average time taken was around 2 minutes per</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   process. But if the</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   same xrdadler32 process runs as a result of the bestman</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   srm-ls</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   request, it takes 10 times or more of this time i.e.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   more than 20</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   minutes, with say only 100 srm-ls requests in parallel.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   So the</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   performance of xrdadler32 by itself is good/acceptable.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   But its</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   performance seems to degrade rapidly when triggered by</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   the bestman</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   process (srm-ls). At least this is what I am able to</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   infer from the</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   limited load tests that have been conducted.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   Let me know your feedback.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   Thanks,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   Karthik</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   when those are settled, add bestman in testing.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   is it possible?</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   - Junmin</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   On 7/26/2010 11&#58;39 AM, Open Science Grid FootPrints</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;   [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_1583923516').click(function() {
            $('#detail_1583923516').slideDown("normal");
            $('#show_1583923516').hide();
            $('#hide_1583923516').show();
        });
        $('#hide_1583923516').click(function() {
            $('#detail_1583923516').slideUp();
            $('#hide_1583923516').hide();
            $('#show_1583923516').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='8961#1280422809'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-29T17:00:09+00:00">Jul 29, 2010 05:00 PM UTC</time> by <b>Alex Sim</b><a class="anchor" name="1280422809">&nbsp;</a></div><pre>Hi Karthik,

It seems that your current file system or storage, based on your test,
can handle only 4 concurrent reads in a reasonable time (under a
minute). You cannot ask all users out there to coordinate their requests
to 4 at a time because FTS may not be the only client.
Even if bestman provides concurrency limit on ls to put on hold for all
requests, the problem is not resolved, but deferred. For example, when
you have 20 concurrent ls requests, the 20th request takes the same
amount of time as before to get the results because the waiting time
gets accumulated for each, and according to your test, only 4 requests
will successfully return to the users and all the others will still get
timeout.

You need to resolve it at the storage or file system level.

-- Alex

On 7/28/10 11&#58;06 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1280415787'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-29T15:03:07+00:00">Jul 29, 2010 03:03 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1280415787">&nbsp;</a></div><pre>Hi Karthik,

I have asked Sarah Williams(saewill@....) if she has experienced the
same problems. She is running Midwest Atlas Tier2.   Her response is below&#58;
****************************************************************************
******
Yes, I had this problem with high load when I attached my xrootd testbed to
FTS.  I altered xrdadler32 to do the checksum on the dataserver rather than
the bestman gateway. I didn&#39;t see the failover to the gridftp servers,
though.

Sarah
****************************************************************************
***********

Thanks,
Tanya
-----Original Message-----
From&#58; Open Science Grid FootPrints [mailto&#58;osg@....]
Sent&#58; Thursday, July 29, 2010 1&#58;06 AM
To&#58; tlevshin@....
Subject&#58; Open Science Grid&#58; OSG Storage&#58; Issues with Storage Element at
HEP_OU ISSUE=8961 PROJ=71

[Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='8961#1280383567'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-29T06:06:07+00:00">Jul 29, 2010 06:06 AM UTC</time> by <b>Karthik Arunachalam</b><a class="anchor" name="1280383567">&nbsp;</a></div><pre>Hi Junmin,

On Wed, 28 Jul 2010, Junmin wrote&#58;

<font color='#7F7E6F'>&#62; Karthik,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Not sure whether you will need it, but</font>
<font color='#7F7E6F'>&#62; here is the way configure different gsiftp servers&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; supportedProtocolList=<a href='gsiftp&#58;//dmx09.lbl.gov&#58;2811///' target='_blank' rel='nofollow'>gsiftp&#58;//dmx09.lbl.gov&#58;2811///</a>;<a href='gsiftp&#58;//hello.lbl.gov&#58;2813' target='_blank' rel='nofollow'>gsiftp&#58;//hello.lbl.gov&#58;2813</a></font>

I checked our bestman.rc file and I already see that we have all of our
servers in the list (guess that is how Horst configured it to start with),
as shown below.

supportedProtocolList=<a href='gsiftp&#58;//tier2-02.ochep.ou.edu' target='_blank' rel='nofollow'>gsiftp&#58;//tier2-02.ochep.ou.edu</a>;<a href='gsiftp&#58;//tier2-03.ochep.ou.edu' target='_blank' rel='nofollow'>gsiftp&#58;//tier2-03.ochep.ou.edu</a>;<a href='gsiftp&#58;//tier2-04.ochep.ou.edu' target='_blank' rel='nofollow'>gsiftp&#58;//tier2-04.ochep.ou.edu</a>

So this is already taken care of.

<font color='#7F7E6F'>&#62; As we mentioned in the meeting, I will add concurrency limit on ls and send</font>
<font color='#7F7E6F'>&#62; updated binary to you.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; At the mean time, would you see what is a good concurrency number your system</font>
<font color='#7F7E6F'>&#62; can handle?</font>

Here is the statistics on how long it takes on an average for computing
the checksum for one file, given the # of concurrent processes&#58;

# of concurrent process &#58; minutes, seconds
1 &#58; 0m, 40s
2 &#58; 0m, 34s
3 &#58; 0.33m, 45s
4 &#58; 0.25m, 43s
5 &#58; 1.80m, 36s
6 &#58; 4.33m, 19s
<div id='show_1460042040' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1460042040'>7 &#58; 4.57m, 15s
8 &#58; 4.75m, 28s
9 &#58; 6.00m, 31s
10 &#58; 8.50m, 32s

I don&#39;t know what is the timeout limit for the FTS process. Hiro, what is
the FTS timeout value? Also what is the relationship between the # of FTS
requests and the number of simultaneous srm-ls requests? What are the
other factors involved in determining the # of concurrent srm-ls requests?
A &#34;good&#34; concurrency # might depend on these details.

Thanks,
Karthik

<font color='#7F7E6F'>&#62; On 7/28/2010 9&#58;35 AM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;  Hi Alex,</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;  I ran xrdadler32 on the same files stored on a different machine with the</font>
<font color='#7F7E6F'>&#62;&#62;  all the files stored on the local hard drive (no DDN or lustre involved</font>
<font color='#7F7E6F'>&#62;&#62;  here). This is a dual quad core machine with 24 GB of RAM.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;  Surprisingly the result was that it took on an average 21 minutes per</font>
<font color='#7F7E6F'>&#62;&#62;  file, which is comparable to what it took on our SRM server with files</font>
<font color='#7F7E6F'>&#62;&#62;  stored on the lustre mounted DDN disks. So I am not sure if it is obvious</font>
<font color='#7F7E6F'>&#62;&#62;  here that the file system (DDN) is the issue.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;  May be this is an inherent performance issue with the xrdadler32 program</font>
<font color='#7F7E6F'>&#62;&#62;  itself. It reads the file 64K blocks at a time (would take &#62; 30000 reads</font>
<font color='#7F7E6F'>&#62;&#62;  for a 2GB file) and given 50 xrdadler32 processes reading 50 different</font>
<font color='#7F7E6F'>&#62;&#62;  files, one can imagine how long it might take.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;  -Karthik</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;  On Tue, 27 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;  Hi Karthik,</font>
<font color='#7F7E6F'>&#62;&#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;  I suspect it&#39;s not xrdadler32 only. It could be either DDN configuration</font>
<font color='#7F7E6F'>&#62;&#62; &#62;  or the file system configuration. Bottom line is that reading on many</font>
<font color='#7F7E6F'>&#62;&#62; &#62;  files concurrently slows down the storage performance significantly.  My</font>
<font color='#7F7E6F'>&#62;&#62; &#62;  previous experience with DDN configuration with PVFS was that it was</font>
<font color='#7F7E6F'>&#62;&#62; &#62;  significantly slow with many inode access and often hung indefinitely.</font>
<font color='#7F7E6F'>&#62;&#62; &#62;  We mount the partitions on DDN as local to the hosts rather than using</font>
<font color='#7F7E6F'>&#62;&#62; &#62;  PVFS to resolve the issue. (People use PVFS successfully, but for some</font>
<font color='#7F7E6F'>&#62;&#62; &#62;  reason, we didn&#39;t have such opportunity.)  So, if you have any Lustre</font>
<font color='#7F7E6F'>&#62;&#62; &#62;  mounting points not from the DDN, you can test how it&#39;s different from</font>
<font color='#7F7E6F'>&#62;&#62; &#62;  DDN, just to eliminate the possibility of the file system issues.</font>
<font color='#7F7E6F'>&#62;&#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;  -- Alex</font>
<font color='#7F7E6F'>&#62;&#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;  On 7/27/10 1&#58;30 PM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  Hi,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  I ran xrdadler32 on 56 different files at the same time (I only did</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  this once, rather than in a sequence like 1,5,10...).  The good (or</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  bad?) news is that the average time it took for one file (of size ~ 2</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  GB) was 31 minutes &#58;(. So Alex, you put it right. The last time file</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  caching was helping, but this time it didn&#39;t since every file was</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  different.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  The question is, why xrdadler32 takes such a long time. I was talking</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  to Hiro during the throughput phone call today and he mentioned that</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  there are some issues with the underlying DDN hardware and it chokes</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  when more than 50 clients run (in this case calculating the xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  checksum). On a strace of the process I could see output like&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  read(4,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  &#34;&#92;311&#92;300&#92;245&#92;262&#92;317D&#92;370&#92;356&j&#92;17&#92;225&#92;250k&#92;34&#92;21Z&#92;271&#92;256xe&#92;365&#92;240&#92;317&#92;32&#92;251&#92;265&#92;257ox&#92;264&#92;306&#34;...,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  65536) = 65536 &#60;3.421719&#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  read(4,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  &#34;T&#92;363&#92;312k&#92;353&#92;2&#92;271&#92;205V&#92;177t&#92;323&#92;276v&#92;205}&#92;252&#92;33&#92;7&#92;232$r~u&#92;355&#92;304&#92;20H&#92;352@&#92;202&#92;341&#34;...,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  65536) = 65536 &#60;0.054670&#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  ....</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  xrdadler32 is reading 64K blocks at a time and working on the file.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  You could see the time it takes for this one operation at the end of</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  the output above.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  We know what the symptom is (xrdadler32 taking a long time). But we</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  need to find the root cause and get this fixed. May be DDN is the</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  issue or may be it is something else. Hiro, let us know what you find</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  from DDN. Then we could also open a ticket with DDN. But it would also</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  be beneficial if we try alternative approaches to solve this issue.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  Ideas? Wei, should I implement your suggestion (below) and would that</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  help to calculate the checksum in a different/faster way?</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  -----------------------------------------------------------------------------------</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  Wei&#39;s suggestion&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  ------------------</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  The .so at <a href='http&#58;//wt2.slac.stanford.edu/gridftp' target='_blank' rel='nofollow'>http&#58;//wt2.slac.stanford.edu/gridftp</a> are Gridftp&#39;s DSI</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  modules using pure POSIX IO functions. They also have a built-in</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  function to calculate Adler32, and can be configured to use external</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  tool if you prefer so. To try it for you environment, you need to do</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  the following two steps&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  1. Download one of the .so for your platform and save it to</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  $VDT_LOCATION/globus/lib or any other location within LD_LIBRARY_PATH.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  Make sure its &#39;x&#39; bit is set.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  2. Modify $VDT_LOCATION/vdt/services/vdt-run-gsiftp.sh. Append &#34;-dsi</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  posix&#34; to the end of a line like this&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  exec $VDT_LOCATION/globus/sbin/globus-gridftp-server</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  ------------------------------------------------------------------------------------</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  Junmin, given the above conclusion, I didn&#39;t run the srm-ls tests to</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  cross check.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  Thanks,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  Karthik</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;  On Tue, 27 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;  thanks.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;  -- Alex</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62;  On 7/27/10 9&#58;07 AM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;  Hi Alex,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;  I see. Good point. Didn&#39;t think about that. OK, in that case I</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;  will do</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;  the test with random (non-repetitive) files for each xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;  process. I will also once again test with multiple srm-ls request.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;  Will report back once I have some results.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;  -Karthik</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;  On Tue, 27 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;  Hi Karthik,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;  I&#39;m afraid that your test might have benefited from file system</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;  caching.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;  -- Alex</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62;  On 7/27/10 8&#58;31 AM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;  Hi Alex,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;  On Mon, 26 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  Hi karthik,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  Is 300 Adler32 on the same file or 300 different files? That</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  practically makes a difference.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;  It is on the same file.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;  -Karthik</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  On Jul 26, 2010, at 9&#58;37 PM, Karthik Arunachalam</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  &#60;karunach@....&#62; wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  Hi Jumin,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  On Sat, 24 Jul 2010, Junmin wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  Karthik,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  Is it possible to not involing bestman, but just test</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  process alone?</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  Sure. I have done this and below are the results.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  e.g. for the same large file (the one you use now)</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  a) how long does it take with one xrdadler32 process to</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  calculate</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  5 seconds average for a ~ 2 GB file. Not much at all.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  b) using threads, each initiating a xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  calculation on the</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  same file, how long does that take with different values</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  of</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  concurrency?</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  I ran concurrent processes ranging from 1 to 300 in</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  increments of 5</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  i.e 1, 5, 10.....290, 295, 300 and measured the average</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  time it</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  took</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  for each case. The maximum time it took for *300*</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  concurrent</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  processes calculating the xrdadler32 was around 2 minutes.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  I am attaching the results (xavg contains the average time</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  for each</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  case. xtime.tar.gz contains the individual time statistics</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  for each</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  case. For example file x10 contains the individual times</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  taken by</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  all the 10 threads). Please take a look.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  So even in the case where 300 xrdadler32 process ran</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  simultaneously,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  the average time taken was around 2 minutes per process.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  But if the</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  same xrdadler32 process runs as a result of the bestman</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  srm-ls</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  request, it takes 10 times or more of this time i.e. more</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  than 20</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  minutes, with say only 100 srm-ls requests in parallel. So</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  the</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  performance of xrdadler32 by itself is good/acceptable.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  But its</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  performance seems to degrade rapidly when triggered by the</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  bestman</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  process (srm-ls). At least this is what I am able to infer</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  from the</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  limited load tests that have been conducted.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  Let me know your feedback.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  Thanks,</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  Karthik</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  when those are settled, add bestman in testing.</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  is it possible?</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  - Junmin</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  On 7/26/2010 11&#58;39 AM, Open Science Grid FootPrints</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62; &#62;  [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_1460042040').click(function() {
            $('#detail_1460042040').slideDown("normal");
            $('#show_1460042040').hide();
            $('#hide_1460042040').show();
        });
        $('#hide_1460042040').click(function() {
            $('#detail_1460042040').slideUp();
            $('#hide_1460042040').hide();
            $('#show_1460042040').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='8961#1280348827'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-28T20:27:07+00:00">Jul 28, 2010 08:27 PM UTC</time> by <b>jgu@....</b><a class="anchor" name="1280348827">&nbsp;</a></div><pre>Karthik,

Not sure whether you will need it, but
here is the way configure different gsiftp servers&#58;

supportedProtocolList=<a href='gsiftp&#58;//dmx09.lbl.gov&#58;2811///' target='_blank' rel='nofollow'>gsiftp&#58;//dmx09.lbl.gov&#58;2811///</a>;<a href='gsiftp&#58;//hello.lbl.gov&#58;2813' target='_blank' rel='nofollow'>gsiftp&#58;//hello.lbl.gov&#58;2813</a>

As we mentioned in the meeting, I will add concurrency limit on ls and
send updated binary to you.

At the mean time, would you see what is a good concurrency number your
system can handle?

- Junmin

On 7/28/2010 9&#58;35 AM, Karthik Arunachalam wrote&#58;
<font color='#7F7E6F'>&#62; Hi Alex,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; I ran xrdadler32 on the same files stored on a different machine with</font>
<font color='#7F7E6F'>&#62; the all the files stored on the local hard drive (no DDN or lustre</font>
<font color='#7F7E6F'>&#62; involved here). This is a dual quad core machine with 24 GB of RAM.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Surprisingly the result was that it took on an average 21 minutes per</font>
<font color='#7F7E6F'>&#62; file, which is comparable to what it took on our SRM server with files</font>
<font color='#7F7E6F'>&#62; stored on the lustre mounted DDN disks. So I am not sure if it is</font>
<font color='#7F7E6F'>&#62; obvious here that the file system (DDN) is the issue.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; May be this is an inherent performance issue with the xrdadler32</font>
<font color='#7F7E6F'>&#62; program itself. It reads the file 64K blocks at a time (would take &#62;</font>
<font color='#7F7E6F'>&#62; 30000 reads for a 2GB file) and given 50 xrdadler32 processes reading</font>
<font color='#7F7E6F'>&#62; 50 different files, one can imagine how long it might take.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; -Karthik</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On Tue, 27 Jul 2010, Alex Sim wrote&#58;</font>
<div id='show_423569069' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_423569069'><font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62; Hi Karthik,</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; I suspect it&#39;s not xrdadler32 only. It could be either DDN configuration</font>
<font color='#7F7E6F'>&#62;&#62; or the file system configuration. Bottom line is that reading on many</font>
<font color='#7F7E6F'>&#62;&#62; files concurrently slows down the storage performance significantly.  My</font>
<font color='#7F7E6F'>&#62;&#62; previous experience with DDN configuration with PVFS was that it was</font>
<font color='#7F7E6F'>&#62;&#62; significantly slow with many inode access and often hung indefinitely.</font>
<font color='#7F7E6F'>&#62;&#62; We mount the partitions on DDN as local to the hosts rather than using</font>
<font color='#7F7E6F'>&#62;&#62; PVFS to resolve the issue. (People use PVFS successfully, but for some</font>
<font color='#7F7E6F'>&#62;&#62; reason, we didn&#39;t have such opportunity.)  So, if you have any Lustre</font>
<font color='#7F7E6F'>&#62;&#62; mounting points not from the DDN, you can test how it&#39;s different from</font>
<font color='#7F7E6F'>&#62;&#62; DDN, just to eliminate the possibility of the file system issues.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; -- Alex</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; On 7/27/10 1&#58;30 PM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; Hi,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; I ran xrdadler32 on 56 different files at the same time (I only did</font>
<font color='#7F7E6F'>&#62;&#62;&#62; this once, rather than in a sequence like 1,5,10...).  The good (or</font>
<font color='#7F7E6F'>&#62;&#62;&#62; bad?) news is that the average time it took for one file (of size ~ 2</font>
<font color='#7F7E6F'>&#62;&#62;&#62; GB) was 31 minutes &#58;(. So Alex, you put it right. The last time file</font>
<font color='#7F7E6F'>&#62;&#62;&#62; caching was helping, but this time it didn&#39;t since every file was</font>
<font color='#7F7E6F'>&#62;&#62;&#62; different.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; The question is, why xrdadler32 takes such a long time. I was talking</font>
<font color='#7F7E6F'>&#62;&#62;&#62; to Hiro during the throughput phone call today and he mentioned that</font>
<font color='#7F7E6F'>&#62;&#62;&#62; there are some issues with the underlying DDN hardware and it chokes</font>
<font color='#7F7E6F'>&#62;&#62;&#62; when more than 50 clients run (in this case calculating the xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62;&#62; checksum). On a strace of the process I could see output like&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; read(4,</font>
<font color='#7F7E6F'>&#62;&#62;&#62; &#34;&#92;311&#92;300&#92;245&#92;262&#92;317D&#92;370&#92;356&j&#92;17&#92;225&#92;250k&#92;34&#92;21Z&#92;271&#92;256xe&#92;365&#92;240&#92;317&#92;32&#92;251&#92;265&#92;257ox&#92;264&#92;306&#34;...,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; 65536) = 65536 &#60;3.421719&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; read(4,</font>
<font color='#7F7E6F'>&#62;&#62;&#62; &#34;T&#92;363&#92;312k&#92;353&#92;2&#92;271&#92;205V&#92;177t&#92;323&#92;276v&#92;205}&#92;252&#92;33&#92;7&#92;232$r~u&#92;355&#92;304&#92;20H&#92;352@&#92;202&#92;341&#34;...,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; 65536) = 65536 &#60;0.054670&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; ....</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; xrdadler32 is reading 64K blocks at a time and working on the file.</font>
<font color='#7F7E6F'>&#62;&#62;&#62; You could see the time it takes for this one operation at the end of</font>
<font color='#7F7E6F'>&#62;&#62;&#62; the output above.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; We know what the symptom is (xrdadler32 taking a long time). But we</font>
<font color='#7F7E6F'>&#62;&#62;&#62; need to find the root cause and get this fixed. May be DDN is the</font>
<font color='#7F7E6F'>&#62;&#62;&#62; issue or may be it is something else. Hiro, let us know what you find</font>
<font color='#7F7E6F'>&#62;&#62;&#62; from DDN. Then we could also open a ticket with DDN. But it would also</font>
<font color='#7F7E6F'>&#62;&#62;&#62; be beneficial if we try alternative approaches to solve this issue.</font>
<font color='#7F7E6F'>&#62;&#62;&#62; Ideas? Wei, should I implement your suggestion (below) and would that</font>
<font color='#7F7E6F'>&#62;&#62;&#62; help to calculate the checksum in a different/faster way?</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; -----------------------------------------------------------------------------------</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; Wei&#39;s suggestion&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; ------------------</font>
<font color='#7F7E6F'>&#62;&#62;&#62; The .so at <a href='http&#58;//wt2.slac.stanford.edu/gridftp' target='_blank' rel='nofollow'>http&#58;//wt2.slac.stanford.edu/gridftp</a> are Gridftp&#39;s DSI</font>
<font color='#7F7E6F'>&#62;&#62;&#62; modules using pure POSIX IO functions. They also have a built-in</font>
<font color='#7F7E6F'>&#62;&#62;&#62; function to calculate Adler32, and can be configured to use external</font>
<font color='#7F7E6F'>&#62;&#62;&#62; tool if you prefer so. To try it for you environment, you need to do</font>
<font color='#7F7E6F'>&#62;&#62;&#62; the following two steps&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; 1. Download one of the .so for your platform and save it to</font>
<font color='#7F7E6F'>&#62;&#62;&#62; $VDT_LOCATION/globus/lib or any other location within LD_LIBRARY_PATH.</font>
<font color='#7F7E6F'>&#62;&#62;&#62; Make sure its &#39;x&#39; bit is set.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; 2. Modify $VDT_LOCATION/vdt/services/vdt-run-gsiftp.sh. Append &#34;-dsi</font>
<font color='#7F7E6F'>&#62;&#62;&#62; posix&#34; to the end of a line like this&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; exec $VDT_LOCATION/globus/sbin/globus-gridftp-server</font>
<font color='#7F7E6F'>&#62;&#62;&#62; ------------------------------------------------------------------------------------</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; Junmin, given the above conclusion, I didn&#39;t run the srm-ls tests to</font>
<font color='#7F7E6F'>&#62;&#62;&#62; cross check.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; Thanks,</font>
<font color='#7F7E6F'>&#62;&#62;&#62; Karthik</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; On Tue, 27 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; thanks.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; -- Alex</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; On 7/27/10 9&#58;07 AM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; Hi Alex,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; I see. Good point. Didn&#39;t think about that. OK, in that case I</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; will do</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; the test with random (non-repetitive) files for each xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; process. I will also once again test with multiple srm-ls request.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; Will report back once I have some results.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; -Karthik</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; On Tue, 27 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; Hi Karthik,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; I&#39;m afraid that your test might have benefited from file system</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; caching.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; -- Alex</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; On 7/27/10 8&#58;31 AM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; Hi Alex,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; On Mon, 26 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Hi karthik,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Is 300 Adler32 on the same file or 300 different files? That</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; practically makes a difference.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; It is on the same file.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; -Karthik</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; On Jul 26, 2010, at 9&#58;37 PM, Karthik Arunachalam</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; &#60;karunach@....&#62; wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Hi Jumin,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; On Sat, 24 Jul 2010, Junmin wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Karthik,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Is it possible to not involing bestman, but just test xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; process alone?</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Sure. I have done this and below are the results.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; e.g. for the same large file (the one you use now)</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; a) how long does it take with one xrdadler32 process to</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; calculate</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; 5 seconds average for a ~ 2 GB file. Not much at all.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; b) using threads, each initiating a xrdadler32 calculation on</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; same file, how long does that take with different values of</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; concurrency?</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; I ran concurrent processes ranging from 1 to 300 in increments</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; of 5</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; i.e 1, 5, 10.....290, 295, 300 and measured the average time it</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; took</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; for each case. The maximum time it took for *300* concurrent</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; processes calculating the xrdadler32 was around 2 minutes.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; I am attaching the results (xavg contains the average time for</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; each</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; case. xtime.tar.gz contains the individual time statistics for</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; each</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; case. For example file x10 contains the individual times taken by</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; all the 10 threads). Please take a look.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; So even in the case where 300 xrdadler32 process ran</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; simultaneously,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; the average time taken was around 2 minutes per process. But</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; if the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; same xrdadler32 process runs as a result of the bestman srm-ls</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; request, it takes 10 times or more of this time i.e. more than 20</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; minutes, with say only 100 srm-ls requests in parallel. So the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; performance of xrdadler32 by itself is good/acceptable. But its</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; performance seems to degrade rapidly when triggered by the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; bestman</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; process (srm-ls). At least this is what I am able to infer</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; from the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; limited load tests that have been conducted.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Let me know your feedback.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Thanks,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Karthik</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; when those are settled, add bestman in testing.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; is it possible?</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; - Junmin</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; On 7/26/2010 11&#58;39 AM, Open Science Grid FootPrints wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_423569069').click(function() {
            $('#detail_423569069').slideDown("normal");
            $('#show_423569069').hide();
            $('#hide_423569069').show();
        });
        $('#hide_423569069').click(function() {
            $('#detail_423569069').slideUp();
            $('#hide_423569069').hide();
            $('#show_423569069').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='8961#1280336409'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-28T17:00:09+00:00">Jul 28, 2010 05:00 PM UTC</time> by <b>Alex Sim</b><a class="anchor" name="1280336409">&nbsp;</a></div><pre>Hi Karthik,

If you just use the local disks, the performance is somewhere ~60MB/sec
mostly.
Since you have about 2000MB, you have about 33 seconds (per 2GB) with
divided by 60 (MB/sec), and Since you have 50 files, it&#39;s about 1600
seconds.
What I mean is the performance you saw here seems to be close to the
disk speed.
Having Lustre is to gain access to storage in parallel. So, if you want
to compare the storage hardware DDN vs hardware raid or something to
narrow down the problem for DDN, I suggest to keep the Lustre for
parallel access.

-- Alex

On 7/28/10 9&#58;36 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1280335867'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-28T16:51:07+00:00">Jul 28, 2010 04:51 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1280335867">&nbsp;</a></div><pre>Hi,
Can you do the same experiment with adler32 script coming from
srm-fermi-client?

Thanks,
Tanya

-----Original Message-----
From&#58; Open Science Grid FootPrints [mailto&#58;osg@....]
Sent&#58; Wednesday, July 28, 2010 11&#58;36 AM
To&#58; tlevshin@....
Subject&#58; Open Science Grid&#58; OSG Storage&#58; Issues with Storage Element at
HEP_OU ISSUE=8961 PROJ=71

[Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='8961#1280334966'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-28T16:36:06+00:00">Jul 28, 2010 04:36 PM UTC</time> by <b>Karthik Arunachalam</b><a class="anchor" name="1280334966">&nbsp;</a></div><pre>Hi Alex,

I ran xrdadler32 on the same files stored on a different machine with
the all the files stored on the local hard drive (no DDN or lustre
involved here). This is a dual quad core machine with 24 GB of RAM.

Surprisingly the result was that it took on an average 21 minutes per
file, which is comparable to what it took on our SRM server with files
stored on the lustre mounted DDN disks. So I am not sure if it is obvious
here that the file system (DDN) is the issue.

May be this is an inherent performance issue with the xrdadler32 program itself. It
reads the file 64K blocks at a time (would take &#62; 30000 reads for a 2GB
file) and given 50 xrdadler32 processes reading 50 different files, one
can imagine how long it might take.

-Karthik

On Tue, 27 Jul 2010, Alex Sim wrote&#58;

<font color='#7F7E6F'>&#62; Hi Karthik,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; I suspect it&#39;s not xrdadler32 only. It could be either DDN configuration</font>
<font color='#7F7E6F'>&#62; or the file system configuration. Bottom line is that reading on many</font>
<font color='#7F7E6F'>&#62; files concurrently slows down the storage performance significantly.  My</font>
<font color='#7F7E6F'>&#62; previous experience with DDN configuration with PVFS was that it was</font>
<font color='#7F7E6F'>&#62; significantly slow with many inode access and often hung indefinitely.</font>
<font color='#7F7E6F'>&#62; We mount the partitions on DDN as local to the hosts rather than using</font>
<font color='#7F7E6F'>&#62; PVFS to resolve the issue. (People use PVFS successfully, but for some</font>
<font color='#7F7E6F'>&#62; reason, we didn&#39;t have such opportunity.)  So, if you have any Lustre</font>
<font color='#7F7E6F'>&#62; mounting points not from the DDN, you can test how it&#39;s different from</font>
<font color='#7F7E6F'>&#62; DDN, just to eliminate the possibility of the file system issues.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; -- Alex</font>
<font color='#7F7E6F'>&#62;</font>
<div id='show_754981825' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_754981825'><font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On 7/27/10 1&#58;30 PM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; Hi,</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; I ran xrdadler32 on 56 different files at the same time (I only did</font>
<font color='#7F7E6F'>&#62;&#62; this once, rather than in a sequence like 1,5,10...).  The good (or</font>
<font color='#7F7E6F'>&#62;&#62; bad?) news is that the average time it took for one file (of size ~ 2</font>
<font color='#7F7E6F'>&#62;&#62; GB) was 31 minutes &#58;(. So Alex, you put it right. The last time file</font>
<font color='#7F7E6F'>&#62;&#62; caching was helping, but this time it didn&#39;t since every file was</font>
<font color='#7F7E6F'>&#62;&#62; different.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; The question is, why xrdadler32 takes such a long time. I was talking</font>
<font color='#7F7E6F'>&#62;&#62; to Hiro during the throughput phone call today and he mentioned that</font>
<font color='#7F7E6F'>&#62;&#62; there are some issues with the underlying DDN hardware and it chokes</font>
<font color='#7F7E6F'>&#62;&#62; when more than 50 clients run (in this case calculating the xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62; checksum). On a strace of the process I could see output like&#58;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; read(4,</font>
<font color='#7F7E6F'>&#62;&#62; &#34;&#92;311&#92;300&#92;245&#92;262&#92;317D&#92;370&#92;356&j&#92;17&#92;225&#92;250k&#92;34&#92;21Z&#92;271&#92;256xe&#92;365&#92;240&#92;317&#92;32&#92;251&#92;265&#92;257ox&#92;264&#92;306&#34;...,</font>
<font color='#7F7E6F'>&#62;&#62; 65536) = 65536 &#60;3.421719&#62;</font>
<font color='#7F7E6F'>&#62;&#62; read(4,</font>
<font color='#7F7E6F'>&#62;&#62; &#34;T&#92;363&#92;312k&#92;353&#92;2&#92;271&#92;205V&#92;177t&#92;323&#92;276v&#92;205}&#92;252&#92;33&#92;7&#92;232$r~u&#92;355&#92;304&#92;20H&#92;352@&#92;202&#92;341&#34;...,</font>
<font color='#7F7E6F'>&#62;&#62; 65536) = 65536 &#60;0.054670&#62;</font>
<font color='#7F7E6F'>&#62;&#62; ....</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; xrdadler32 is reading 64K blocks at a time and working on the file.</font>
<font color='#7F7E6F'>&#62;&#62; You could see the time it takes for this one operation at the end of</font>
<font color='#7F7E6F'>&#62;&#62; the output above.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; We know what the symptom is (xrdadler32 taking a long time). But we</font>
<font color='#7F7E6F'>&#62;&#62; need to find the root cause and get this fixed. May be DDN is the</font>
<font color='#7F7E6F'>&#62;&#62; issue or may be it is something else. Hiro, let us know what you find</font>
<font color='#7F7E6F'>&#62;&#62; from DDN. Then we could also open a ticket with DDN. But it would also</font>
<font color='#7F7E6F'>&#62;&#62; be beneficial if we try alternative approaches to solve this issue.</font>
<font color='#7F7E6F'>&#62;&#62; Ideas? Wei, should I implement your suggestion (below) and would that</font>
<font color='#7F7E6F'>&#62;&#62; help to calculate the checksum in a different/faster way?</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; -----------------------------------------------------------------------------------</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; Wei&#39;s suggestion&#58;</font>
<font color='#7F7E6F'>&#62;&#62; ------------------</font>
<font color='#7F7E6F'>&#62;&#62; The .so at <a href='http&#58;//wt2.slac.stanford.edu/gridftp' target='_blank' rel='nofollow'>http&#58;//wt2.slac.stanford.edu/gridftp</a> are Gridftp&#39;s DSI</font>
<font color='#7F7E6F'>&#62;&#62; modules using pure POSIX IO functions. They also have a built-in</font>
<font color='#7F7E6F'>&#62;&#62; function to calculate Adler32, and can be configured to use external</font>
<font color='#7F7E6F'>&#62;&#62; tool if you prefer so. To try it for you environment, you need to do</font>
<font color='#7F7E6F'>&#62;&#62; the following two steps&#58;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; 1. Download one of the .so for your platform and save it to</font>
<font color='#7F7E6F'>&#62;&#62; $VDT_LOCATION/globus/lib or any other location within LD_LIBRARY_PATH.</font>
<font color='#7F7E6F'>&#62;&#62; Make sure its &#39;x&#39; bit is set.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; 2. Modify $VDT_LOCATION/vdt/services/vdt-run-gsiftp.sh. Append &#34;-dsi</font>
<font color='#7F7E6F'>&#62;&#62; posix&#34; to the end of a line like this&#58;</font>
<font color='#7F7E6F'>&#62;&#62; exec $VDT_LOCATION/globus/sbin/globus-gridftp-server</font>
<font color='#7F7E6F'>&#62;&#62; ------------------------------------------------------------------------------------</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; Junmin, given the above conclusion, I didn&#39;t run the srm-ls tests to</font>
<font color='#7F7E6F'>&#62;&#62; cross check.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; Thanks,</font>
<font color='#7F7E6F'>&#62;&#62; Karthik</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; On Tue, 27 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; thanks.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; -- Alex</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; On 7/27/10 9&#58;07 AM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; Hi Alex,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; I see. Good point. Didn&#39;t think about that. OK, in that case I will do</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; the test with random (non-repetitive) files for each xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; process. I will also once again test with multiple srm-ls request.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; Will report back once I have some results.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; -Karthik</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; On Tue, 27 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; Hi Karthik,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; I&#39;m afraid that your test might have benefited from file system</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; caching.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; -- Alex</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; On 7/27/10 8&#58;31 AM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; Hi Alex,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; On Mon, 26 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; Hi karthik,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; Is 300 Adler32 on the same file or 300 different files? That</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; practically makes a difference.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; It is on the same file.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; -Karthik</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; On Jul 26, 2010, at 9&#58;37 PM, Karthik Arunachalam</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; &#60;karunach@....&#62; wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Hi Jumin,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; On Sat, 24 Jul 2010, Junmin wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Karthik,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Is it possible to not involing bestman, but just test xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; process alone?</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Sure. I have done this and below are the results.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; e.g. for the same large file (the one you use now)</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; a) how long does it take with one xrdadler32 process to calculate</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; 5 seconds average for a ~ 2 GB file. Not much at all.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; b) using threads, each initiating a xrdadler32 calculation on the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; same file, how long does that take with different values of</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; concurrency?</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; I ran concurrent processes ranging from 1 to 300 in increments of 5</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; i.e 1, 5, 10.....290, 295, 300 and measured the average time it</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; took</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; for each case. The maximum time it took for *300* concurrent</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; processes calculating the xrdadler32 was around 2 minutes.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; I am attaching the results (xavg contains the average time for each</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; case. xtime.tar.gz contains the individual time statistics for each</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; case. For example file x10 contains the individual times taken by</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; all the 10 threads). Please take a look.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; So even in the case where 300 xrdadler32 process ran</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; simultaneously,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; the average time taken was around 2 minutes per process. But if the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; same xrdadler32 process runs as a result of the bestman srm-ls</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; request, it takes 10 times or more of this time i.e. more than 20</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; minutes, with say only 100 srm-ls requests in parallel. So the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; performance of xrdadler32 by itself is good/acceptable. But its</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; performance seems to degrade rapidly when triggered by the bestman</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; process (srm-ls). At least this is what I am able to infer from the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; limited load tests that have been conducted.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Let me know your feedback.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Thanks,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Karthik</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; when those are settled, add bestman in testing.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; is it possible?</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; - Junmin</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; On 7/26/2010 11&#58;39 AM, Open Science Grid FootPrints wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_754981825').click(function() {
            $('#detail_754981825').slideDown("normal");
            $('#show_754981825').hide();
            $('#hide_754981825').show();
        });
        $('#hide_754981825').click(function() {
            $('#detail_754981825').slideUp();
            $('#hide_754981825').hide();
            $('#show_754981825').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='8961#1280264947'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-27T21:09:07+00:00">Jul 27, 2010 09:09 PM UTC</time> by <b>Alex Sim</b><a class="anchor" name="1280264947">&nbsp;</a></div><pre>I agree with Wei.

-- Alex

On 7/27/10 1&#58;54 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1280264767'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-27T21:06:07+00:00">Jul 27, 2010 09:06 PM UTC</time> by <b>Alex Sim</b><a class="anchor" name="1280264767">&nbsp;</a></div><pre>Hi Karthik,

I suspect it&#39;s not xrdadler32 only. It could be either DDN configuration
or the file system configuration. Bottom line is that reading on many
files concurrently slows down the storage performance significantly.  My
previous experience with DDN configuration with PVFS was that it was
significantly slow with many inode access and often hung indefinitely.
We mount the partitions on DDN as local to the hosts rather than using
PVFS to resolve the issue. (People use PVFS successfully, but for some
reason, we didn&#39;t have such opportunity.)  So, if you have any Lustre
mounting points not from the DDN, you can test how it&#39;s different from
DDN, just to eliminate the possibility of the file system issues.

-- Alex

On 7/27/10 1&#58;30 PM, Karthik Arunachalam wrote&#58;
<font color='#7F7E6F'>&#62; Hi,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; I ran xrdadler32 on 56 different files at the same time (I only did</font>
<font color='#7F7E6F'>&#62; this once, rather than in a sequence like 1,5,10...).  The good (or</font>
<font color='#7F7E6F'>&#62; bad?) news is that the average time it took for one file (of size ~ 2</font>
<font color='#7F7E6F'>&#62; GB) was 31 minutes &#58;(. So Alex, you put it right. The last time file</font>
<font color='#7F7E6F'>&#62; caching was helping, but this time it didn&#39;t since every file was</font>
<font color='#7F7E6F'>&#62; different.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; The question is, why xrdadler32 takes such a long time. I was talking</font>
<font color='#7F7E6F'>&#62; to Hiro during the throughput phone call today and he mentioned that</font>
<font color='#7F7E6F'>&#62; there are some issues with the underlying DDN hardware and it chokes</font>
<font color='#7F7E6F'>&#62; when more than 50 clients run (in this case calculating the xrdadler32</font>
<font color='#7F7E6F'>&#62; checksum). On a strace of the process I could see output like&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; read(4,</font>
<font color='#7F7E6F'>&#62; &#34;&#92;311&#92;300&#92;245&#92;262&#92;317D&#92;370&#92;356&j&#92;17&#92;225&#92;250k&#92;34&#92;21Z&#92;271&#92;256xe&#92;365&#92;240&#92;317&#92;32&#92;251&#92;265&#92;257ox&#92;264&#92;306&#34;...,</font>
<font color='#7F7E6F'>&#62; 65536) = 65536 &#60;3.421719&#62;</font>
<font color='#7F7E6F'>&#62; read(4,</font>
<div id='show_530863247' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_530863247'><font color='#7F7E6F'>&#62; &#34;T&#92;363&#92;312k&#92;353&#92;2&#92;271&#92;205V&#92;177t&#92;323&#92;276v&#92;205}&#92;252&#92;33&#92;7&#92;232$r~u&#92;355&#92;304&#92;20H&#92;352@&#92;202&#92;341&#34;...,</font>
<font color='#7F7E6F'>&#62; 65536) = 65536 &#60;0.054670&#62;</font>
<font color='#7F7E6F'>&#62; ....</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; xrdadler32 is reading 64K blocks at a time and working on the file.</font>
<font color='#7F7E6F'>&#62; You could see the time it takes for this one operation at the end of</font>
<font color='#7F7E6F'>&#62; the output above.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; We know what the symptom is (xrdadler32 taking a long time). But we</font>
<font color='#7F7E6F'>&#62; need to find the root cause and get this fixed. May be DDN is the</font>
<font color='#7F7E6F'>&#62; issue or may be it is something else. Hiro, let us know what you find</font>
<font color='#7F7E6F'>&#62; from DDN. Then we could also open a ticket with DDN. But it would also</font>
<font color='#7F7E6F'>&#62; be beneficial if we try alternative approaches to solve this issue.</font>
<font color='#7F7E6F'>&#62; Ideas? Wei, should I implement your suggestion (below) and would that</font>
<font color='#7F7E6F'>&#62; help to calculate the checksum in a different/faster way?</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; -----------------------------------------------------------------------------------</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Wei&#39;s suggestion&#58;</font>
<font color='#7F7E6F'>&#62; ------------------</font>
<font color='#7F7E6F'>&#62; The .so at <a href='http&#58;//wt2.slac.stanford.edu/gridftp' target='_blank' rel='nofollow'>http&#58;//wt2.slac.stanford.edu/gridftp</a> are Gridftp&#39;s DSI</font>
<font color='#7F7E6F'>&#62; modules using pure POSIX IO functions. They also have a built-in</font>
<font color='#7F7E6F'>&#62; function to calculate Adler32, and can be configured to use external</font>
<font color='#7F7E6F'>&#62; tool if you prefer so. To try it for you environment, you need to do</font>
<font color='#7F7E6F'>&#62; the following two steps&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; 1. Download one of the .so for your platform and save it to</font>
<font color='#7F7E6F'>&#62; $VDT_LOCATION/globus/lib or any other location within LD_LIBRARY_PATH.</font>
<font color='#7F7E6F'>&#62; Make sure its &#39;x&#39; bit is set.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; 2. Modify $VDT_LOCATION/vdt/services/vdt-run-gsiftp.sh. Append &#34;-dsi</font>
<font color='#7F7E6F'>&#62; posix&#34; to the end of a line like this&#58;</font>
<font color='#7F7E6F'>&#62; exec $VDT_LOCATION/globus/sbin/globus-gridftp-server</font>
<font color='#7F7E6F'>&#62; ------------------------------------------------------------------------------------</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Junmin, given the above conclusion, I didn&#39;t run the srm-ls tests to</font>
<font color='#7F7E6F'>&#62; cross check.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Thanks,</font>
<font color='#7F7E6F'>&#62; Karthik</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On Tue, 27 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62; thanks.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; -- Alex</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; On 7/27/10 9&#58;07 AM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; Hi Alex,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; I see. Good point. Didn&#39;t think about that. OK, in that case I will do</font>
<font color='#7F7E6F'>&#62;&#62;&#62; the test with random (non-repetitive) files for each xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62;&#62; process. I will also once again test with multiple srm-ls request.</font>
<font color='#7F7E6F'>&#62;&#62;&#62; Will report back once I have some results.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; -Karthik</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; On Tue, 27 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; Hi Karthik,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; I&#39;m afraid that your test might have benefited from file system</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; caching.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; -- Alex</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; On 7/27/10 8&#58;31 AM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; Hi Alex,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; On Mon, 26 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; Hi karthik,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; Is 300 Adler32 on the same file or 300 different files? That</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; practically makes a difference.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; It is on the same file.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; -Karthik</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; On Jul 26, 2010, at 9&#58;37 PM, Karthik Arunachalam</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; &#60;karunach@....&#62; wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; Hi Jumin,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; On Sat, 24 Jul 2010, Junmin wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Karthik,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; Is it possible to not involing bestman, but just test xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; process alone?</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; Sure. I have done this and below are the results.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; e.g. for the same large file (the one you use now)</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; a) how long does it take with one xrdadler32 process to calculate</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; 5 seconds average for a ~ 2 GB file. Not much at all.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; b) using threads, each initiating a xrdadler32 calculation on the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; same file, how long does that take with different values of</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; concurrency?</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; I ran concurrent processes ranging from 1 to 300 in increments of 5</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; i.e 1, 5, 10.....290, 295, 300 and measured the average time it</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; took</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; for each case. The maximum time it took for *300* concurrent</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; processes calculating the xrdadler32 was around 2 minutes.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; I am attaching the results (xavg contains the average time for each</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; case. xtime.tar.gz contains the individual time statistics for each</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; case. For example file x10 contains the individual times taken by</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; all the 10 threads). Please take a look.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; So even in the case where 300 xrdadler32 process ran</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; simultaneously,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; the average time taken was around 2 minutes per process. But if the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; same xrdadler32 process runs as a result of the bestman srm-ls</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; request, it takes 10 times or more of this time i.e. more than 20</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; minutes, with say only 100 srm-ls requests in parallel. So the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; performance of xrdadler32 by itself is good/acceptable. But its</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; performance seems to degrade rapidly when triggered by the bestman</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; process (srm-ls). At least this is what I am able to infer from the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; limited load tests that have been conducted.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; Let me know your feedback.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; Thanks,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; Karthik</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; when those are settled, add bestman in testing.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; is it possible?</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; - Junmin</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; On 7/26/2010 11&#58;39 AM, Open Science Grid FootPrints wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_530863247').click(function() {
            $('#detail_530863247').slideDown("normal");
            $('#show_530863247').hide();
            $('#hide_530863247').show();
        });
        $('#hide_530863247').click(function() {
            $('#detail_530863247').slideUp();
            $('#hide_530863247').hide();
            $('#show_530863247').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='8961#1280264047'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-27T20:54:07+00:00">Jul 27, 2010 08:54 PM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1280264047">&nbsp;</a></div><pre>Hi Horst,

I think doing checksum via gridftp will help only if the current problem is with bestman. If the problem is at DDN, it probably won&#39;t help.

regards,
Wei Yang  |  yangw@....  |  650-926-3338(O)

On Jul 27, 2010, at 1&#58;33 PM, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1280262787'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-27T20:33:07+00:00">Jul 27, 2010 08:33 PM UTC</time> by <b>Karthik Arunachalam</b><a class="anchor" name="1280262787">&nbsp;</a></div><pre>Hi,

I ran xrdadler32 on 56 different files at the same time (I only did
this once, rather than in a sequence like 1,5,10...).  The good (or
bad?) news is that the average time it took for one file (of size ~ 2 GB)
was 31 minutes &#58;(. So Alex, you put it right. The last time file caching
was helping, but this time it didn&#39;t since every file was different.

The question is, why xrdadler32 takes such a long time. I was talking to
Hiro during the throughput phone call today and he mentioned that there
are some issues with the underlying DDN hardware and it chokes when more
than 50 clients run (in this case calculating the xrdadler32 checksum). On a
strace of the process I could see output like&#58;

read(4, &#34;&#92;311&#92;300&#92;245&#92;262&#92;317D&#92;370&#92;356&j&#92;17&#92;225&#92;250k&#92;34&#92;21Z&#92;271&#92;256xe&#92;365&#92;240&#92;317&#92;32&#92;251&#92;265&#92;257ox&#92;264&#92;306&#34;..., 65536) = 65536 &#60;3.421719&#62;
read(4, &#34;T&#92;363&#92;312k&#92;353&#92;2&#92;271&#92;205V&#92;177t&#92;323&#92;276v&#92;205}&#92;252&#92;33&#92;7&#92;232$r~u&#92;355&#92;304&#92;20H&#92;352@&#92;202&#92;341&#34;..., 65536) = 65536 &#60;0.054670&#62;
....

xrdadler32 is reading 64K blocks at a time and working on the file. You
could see the time it takes for this one operation at the end of the
output above.

We know what the symptom is (xrdadler32 taking a long time). But we
need to find the root cause and get this fixed. May be DDN is the
issue or may be it is something else. Hiro, let us know what you find
from DDN. Then we could also open a ticket with DDN. But it would also be
beneficial if we try alternative approaches to solve this issue.
Ideas? Wei, should I implement your suggestion (below) and would that help
to calculate the checksum in a different/faster way?

-----------------------------------------------------------------------------------
Wei&#39;s suggestion&#58;
------------------
The .so at <a href='http&#58;//wt2.slac.stanford.edu/gridftp' target='_blank' rel='nofollow'>http&#58;//wt2.slac.stanford.edu/gridftp</a> are Gridftp&#39;s DSI modules
using pure POSIX IO functions. They also have a built-in function to
<div id='show_467568567' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_467568567'>calculate Adler32, and can be configured to use external tool if you
prefer so. To try it for you environment, you need to do the following two steps&#58;

1. Download one of the .so for your platform and save it to
$VDT_LOCATION/globus/lib or any other location within LD_LIBRARY_PATH.
Make sure its &#39;x&#39; bit is set.

2. Modify $VDT_LOCATION/vdt/services/vdt-run-gsiftp.sh. Append &#34;-dsi
posix&#34; to the end of a line like this&#58;
exec $VDT_LOCATION/globus/sbin/globus-gridftp-server
------------------------------------------------------------------------------------

Junmin, given the above conclusion, I didn&#39;t run the srm-ls tests to cross
check.

Thanks,
Karthik

On Tue, 27 Jul 2010, Alex Sim wrote&#58;

<font color='#7F7E6F'>&#62; thanks.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; -- Alex</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On 7/27/10 9&#58;07 AM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; Hi Alex,</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; I see. Good point. Didn&#39;t think about that. OK, in that case I will do</font>
<font color='#7F7E6F'>&#62;&#62; the test with random (non-repetitive) files for each xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62; process. I will also once again test with multiple srm-ls request.</font>
<font color='#7F7E6F'>&#62;&#62; Will report back once I have some results.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; -Karthik</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; On Tue, 27 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; Hi Karthik,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; I&#39;m afraid that your test might have benefited from file system caching.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; -- Alex</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; On 7/27/10 8&#58;31 AM, Karthik Arunachalam wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; Hi Alex,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; On Mon, 26 Jul 2010, Alex Sim wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; Hi karthik,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; Is 300 Adler32 on the same file or 300 different files? That</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; practically makes a difference.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; It is on the same file.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62; -Karthik</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; On Jul 26, 2010, at 9&#58;37 PM, Karthik Arunachalam</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62; &#60;karunach@....&#62; wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; Hi Jumin,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; On Sat, 24 Jul 2010, Junmin wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; Karthik,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; Is it possible to not involing bestman, but just test xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; process alone?</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; Sure. I have done this and below are the results.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; e.g. for the same large file (the one you use now)</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; a) how long does it take with one xrdadler32 process to calculate</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; 5 seconds average for a ~ 2 GB file. Not much at all.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; b) using threads, each initiating a xrdadler32 calculation on the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; same file, how long does that take with different values of</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; concurrency?</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; I ran concurrent processes ranging from 1 to 300 in increments of 5</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; i.e 1, 5, 10.....290, 295, 300 and measured the average time it took</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; for each case. The maximum time it took for *300* concurrent</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; processes calculating the xrdadler32 was around 2 minutes.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; I am attaching the results (xavg contains the average time for each</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; case. xtime.tar.gz contains the individual time statistics for each</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; case. For example file x10 contains the individual times taken by</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; all the 10 threads). Please take a look.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; So even in the case where 300 xrdadler32 process ran simultaneously,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; the average time taken was around 2 minutes per process. But if the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; same xrdadler32 process runs as a result of the bestman srm-ls</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; request, it takes 10 times or more of this time i.e. more than 20</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; minutes, with say only 100 srm-ls requests in parallel. So the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; performance of xrdadler32 by itself is good/acceptable. But its</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; performance seems to degrade rapidly when triggered by the bestman</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; process (srm-ls). At least this is what I am able to infer from the</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; limited load tests that have been conducted.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; Let me know your feedback.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; Thanks,</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62; Karthik</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; when those are settled, add bestman in testing.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; is it possible?</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; - Junmin</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62; On 7/26/2010 11&#58;39 AM, Open Science Grid FootPrints wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;&#62;&#62;&#62;&#62;&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_467568567').click(function() {
            $('#detail_467568567').slideDown("normal");
            $('#show_467568567').hide();
            $('#hide_467568567').show();
        });
        $('#hide_467568567').click(function() {
            $('#detail_467568567').slideUp();
            $('#hide_467568567').hide();
            $('#show_467568567').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='8961#1280219046'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-27T08:24:06+00:00">Jul 27, 2010 08:24 AM UTC</time> by <b>jgu@....</b><a class="anchor" name="1280219046">&nbsp;</a></div><pre>Thanks Karthik for testing it out.

Would you send me the related event logs for the tests with srm-ls that
takes mroe than 20 minutes?
I would like to take a look. Thanks.

- Junmin
On 7/26/2010 9&#58;37 PM, Karthik Arunachalam wrote&#58;
<font color='#7F7E6F'>&#62; Hi Jumin,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On Sat, 24 Jul 2010, Junmin wrote&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62; Karthik,</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; Is it possible to not involing bestman, but just test xrdadler32</font>
<font color='#7F7E6F'>&#62;&#62; process alone?</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Sure. I have done this and below are the results.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62; e.g. for the same large file (the one you use now)</font>
<font color='#7F7E6F'>&#62;&#62; a) how long does it take with one xrdadler32 process to calculate</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; 5 seconds average for a ~ 2 GB file. Not much at all.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62; b) using threads, each initiating a xrdadler32 calculation on the</font>
<font color='#7F7E6F'>&#62;&#62; same file, how long does that take with different values of concurrency?</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; I ran concurrent processes ranging from 1 to 300 in increments of 5</font>
<font color='#7F7E6F'>&#62; i.e 1, 5, 10.....290, 295, 300 and measured the average time it took</font>
<font color='#7F7E6F'>&#62; for each case. The maximum time it took for *300* concurrent processes</font>
<font color='#7F7E6F'>&#62; calculating the xrdadler32 was around 2 minutes.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; I am attaching the results (xavg contains the average time for each</font>
<font color='#7F7E6F'>&#62; case. xtime.tar.gz contains the individual time statistics for each</font>
<font color='#7F7E6F'>&#62; case. For example file x10 contains the individual times taken by all</font>
<div id='show_2074577208' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_2074577208'><font color='#7F7E6F'>&#62; the 10 threads). Please take a look.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; So even in the case where 300 xrdadler32 process ran simultaneously,</font>
<font color='#7F7E6F'>&#62; the average time taken was around 2 minutes per process. But if the</font>
<font color='#7F7E6F'>&#62; same xrdadler32 process runs as a result of the bestman srm-ls</font>
<font color='#7F7E6F'>&#62; request, it takes 10 times or more of this time i.e. more than 20</font>
<font color='#7F7E6F'>&#62; minutes, with say only 100 srm-ls requests in parallel. So the</font>
<font color='#7F7E6F'>&#62; performance of xrdadler32 by itself is good/acceptable. But its</font>
<font color='#7F7E6F'>&#62; performance seems to degrade rapidly when triggered by the bestman</font>
<font color='#7F7E6F'>&#62; process (srm-ls). At least this is what I am able to infer from the</font>
<font color='#7F7E6F'>&#62; limited load tests that have been conducted.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Let me know your feedback.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Thanks,</font>
<font color='#7F7E6F'>&#62; Karthik</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62; when those are settled, add bestman in testing.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; is it possible?</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; - Junmin</font>
<font color='#7F7E6F'>&#62;&#62; On 7/26/2010 11&#58;39 AM, Open Science Grid FootPrints wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;  [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_2074577208').click(function() {
            $('#detail_2074577208').slideDown("normal");
            $('#show_2074577208').hide();
            $('#hide_2074577208').show();
        });
        $('#hide_2074577208').click(function() {
            $('#detail_2074577208').slideUp();
            $('#hide_2074577208').hide();
            $('#show_2074577208').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='8961#1280205547'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-27T04:39:07+00:00">Jul 27, 2010 04:39 AM UTC</time> by <b>Karthik Arunachalam</b><a class="anchor" name="1280205547">&nbsp;</a></div><pre>Hi Jumin,

On Sat, 24 Jul 2010, Junmin wrote&#58;

<font color='#7F7E6F'>&#62; Karthik,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Is it possible to not involing bestman, but just test xrdadler32 process</font>
<font color='#7F7E6F'>&#62; alone?</font>

Sure. I have done this and below are the results.

<font color='#7F7E6F'>&#62; e.g. for the same large file (the one you use now)</font>
<font color='#7F7E6F'>&#62; a) how long does it take with one xrdadler32 process to calculate</font>

5 seconds average for a ~ 2 GB file. Not much at all.

<font color='#7F7E6F'>&#62; b) using threads, each initiating a xrdadler32 calculation on the same file,</font>
<font color='#7F7E6F'>&#62; how long does that take with different values of concurrency?</font>

I ran concurrent processes ranging from 1 to 300 in increments of 5 i.e
1, 5, 10.....290, 295, 300 and measured the average time it took for each
case. The maximum time it took for *300* concurrent processes calculating
the xrdadler32 was around 2 minutes.

I am attaching the results (xavg contains the average time for each case.
xtime.tar.gz contains the individual time statistics for each case. For
example file x10 contains the individual times taken by all the 10
threads). Please take a look.

So even in the case where 300 xrdadler32 process ran simultaneously, the
average time taken was around 2 minutes per process. But if the same
xrdadler32 process runs as a result of the bestman srm-ls request, it
takes 10 times or more of this time i.e. more than 20 minutes, with say
only 100 srm-ls requests in parallel. So the performance of xrdadler32
by itself is good/acceptable. But its performance seems to degrade rapidly
<div id='show_588460143' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_588460143'>when triggered by the bestman process (srm-ls). At least this is what I am
able to infer from the limited load tests that have been conducted.

Let me know your feedback.

Thanks,
Karthik

<font color='#7F7E6F'>&#62; when those are settled, add bestman in testing.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; is it possible?</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; - Junmin</font>
<font color='#7F7E6F'>&#62; On 7/26/2010 11&#58;39 AM, Open Science Grid FootPrints wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;  [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_588460143').click(function() {
            $('#detail_588460143').slideDown("normal");
            $('#show_588460143').hide();
            $('#hide_588460143').show();
        });
        $('#hide_588460143').click(function() {
            $('#detail_588460143').slideUp();
            $('#hide_588460143').hide();
            $('#show_588460143').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='8961#1280173326'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-26T19:42:06+00:00">Jul 26, 2010 07:42 PM UTC</time> by <b>jgu@....</b><a class="anchor" name="1280173326">&nbsp;</a></div><pre>Karthik,

Is it possible to not involing bestman, but just test xrdadler32 process
alone?

e.g. for the same large file (the one you use now)
a) how long does it take with one xrdadler32 process to calculate
b) using threads, each initiating a xrdadler32 calculation on the same
file,  how long does that take with different values of concurrency?

when those are settled, add bestman in testing.

is it possible?

- Junmin
On 7/26/2010 11&#58;39 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1280170987'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-26T19:03:07+00:00">Jul 26, 2010 07:03 PM UTC</time> by <b>Alex Sim</b><a class="anchor" name="1280170987">&nbsp;</a></div><pre>Karthik,

How many did you try at the same time?
One way to find out is to increment the number of adler32 calculation by
one on each try, and see where it creates the significant delay.
I suspect the file size is not really a contributing factor to the file
system delay itself, but the number of concurrent reads. Large file size
consequently results in longer delay, and makes it visible.
You could compare the delay with &#34;local files&#34; calculations instead of
/storage/ area to confirm to see if it&#39;s coming from the machine itself
or only from the remote storage and the connection.

-- Alex

On 7/26/10 11&#58;39 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1280169547'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-26T18:39:07+00:00">Jul 26, 2010 06:39 PM UTC</time> by <b>Karthik Arunachalam</b><a class="anchor" name="1280169547">&nbsp;</a></div><pre>Hi,

I did the load tests again, but this time with the objective of trying to
analyze what is going on locally. I spawned several srm-ls requests in
parallel from the client. Looking on the server side, I could make these
observations&#58;

- Server load is very high
13&#58;22&#58;42 up 11 days, 23&#58;45,  1 user,  load average&#58; 57.16, 51.73, 30.41

- There are several xrdadler32 process as shown below that are going on
for quite sometime. This is where the srm-ls seems to be stuck and this is
where it might be taking the longest time.

daemon   19395  0.5  0.0   3728  1352 ?        D    13&#58;10   0&#58;04 /data/osg/adler32/xrdadler32 /storage/data/atlasproddisk/panda/dis/10/07/12/panda.150952.07.12.HITS.f59e4e61-fe21-43a1-87e6-b5ed030d1ce3_dis1087699386/HITS.150844._000334.pool.root.1

The question is what is causing it to take such a long time? On an
average, how long is it supposed to take on a system with our
configuration? How do we get this fixed or what are the alternatives? If
there are alternatives, we need a clear, detailed and specific
instructions on how to implement the alternatives or how to get it fixed.
That would  be really helpful.

I am trying to use strace to figure things out, but there is a bit of a
learning curve there. Obviously expert insight would help to quicken the
analysis/investigation cycle.

- Obviously &#34;top&#34; shows several of the xrdadler32 sitting in the process
tree for a long time (as already confirmed by ps command).

I am attaching all the observations for reference.

Thanks,
Karthik

<div id='show_412494612' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_412494612'>On Fri, 23 Jul 2010, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_412494612').click(function() {
            $('#detail_412494612').slideDown("normal");
            $('#show_412494612').hide();
            $('#hide_412494612').show();
        });
        $('#hide_412494612').click(function() {
            $('#detail_412494612').slideUp();
            $('#hide_412494612').hide();
            $('#show_412494612').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='8961#1280155606'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-26T14:46:46+00:00">Jul 26, 2010 02:46 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1280155606">&nbsp;</a></div><pre>Guys
I had forgotten to select the option that CC&#39;s the complete list for all changes (default option was to cc only on ticket creation) Its fixed now and you all
should receive all updates on this ticket

-neha</pre></div><div class='update_description'><i onclick="document.location='8961#1280144706'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-26T11:45:06+00:00">Jul 26, 2010 11:45 AM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1280144706">&nbsp;</a></div><pre>Hi again,

sorry, I forgot to send this to the ticket instead of the private thread.
Is everybody of the thread on this ticket -- who cares to to be on? &#58;)

Thanks,

Horst
---
Date&#58; Mon, 26 Jul 2010 05&#58;56&#58;55 -0500 (CDT)
From&#58; Horst Severini &#60;hs@....&#62;
To&#58; hs@...., mcguigan@....
Cc&#58; asim@...., hito@...., hito@...., jgu@....,
karunach@...., kaushik@...., mernst@...., sosebee@....,
srm@...., tlevshin@...., yangw@....
Subject&#58; Re&#58; [srm-support] SE at OU failing

Hi Patrick,

thanks for your input. Well, I don&#39;t think the tree gridftp servers
currently configured with bestman, tier2-02/3/4, should cause any problems,
since they&#39;re all identical installations and have the same Lustre clients
installed and talk to the same Lustre backend, and we&#39;ve always gotten
about the same throughput through all of them.

As far as configuring these gridftp servers for adler32, do I understand
your suggestion correctly that we should install Xrootd-GridFTP on
one of the machines into a different area, configure it there, and then
copy some of the modules over to our current OSG CE gridftp servers?
We could do that, but we&#39;d need to get some more detailed instructions
on how to do it exactly. That web page Wei sent us only speaks of two
.so modules. Is that all we need to replace in our current gridftp servers?
THat&#39;d be pretty straight forward.

Thanks a lot,
<div id='show_1439874397' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1439874397'>
Horst
</div><script type='text/javascript'>
        $('#show_1439874397').click(function() {
            $('#detail_1439874397').slideDown("normal");
            $('#show_1439874397').hide();
            $('#hide_1439874397').show();
        });
        $('#hide_1439874397').click(function() {
            $('#detail_1439874397').slideUp();
            $('#hide_1439874397').hide();
            $('#show_1439874397').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='8961#1280125446'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-26T06:24:06+00:00">Jul 26, 2010 06:24 AM UTC</time> by <b>Alex Sim</b><a class="anchor" name="1280125446">&nbsp;</a></div><pre>I think just about any direct adler32 calculations on multiple files
concurrently would stress the local file system at the same level as the
user load thru srmLs.
-- Alex

On 7/24/10 9&#58;51 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1279990268'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-24T16:51:08+00:00">Jul 24, 2010 04:51 PM UTC</time> by <b>Karthik Arunachalam</b><a class="anchor" name="1279990268">&nbsp;</a></div><pre>Hi Alex,

We know srm-ls takes a long time. But I would still like to see some
evidence *LOCALLY* that something isn&#39;t working right and the
system has scalability constraints.

I wonder how we could simulate this
locally (using some simple commands). I don&#39;t know the
internals of srm-ls enough to be able to understand what exactly is going
wrong or why.

Could you please help me understand this at a *local* level on the srm
server? What commands could I execute to simulate this behavior. Doing it
locally means we have more control to experiment and look at the internals
or investigate more about what is going on. This will take us one step
closer to understanding/diagnosing the root cause of the problem. Please
help!

Thanks,
Karthik

On Fri, 23 Jul 2010, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1279922047'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-23T21:54:07+00:00">Jul 23, 2010 09:54 PM UTC</time> by <b>Karthik Arunachalam</b><a class="anchor" name="1279922047">&nbsp;</a></div><pre>Hi Jumin,

On Fri, 23 Jul 2010, Junmin wrote&#58;

<font color='#7F7E6F'>&#62; Karthik,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Do you still have the event log that contains the srmLs than took 22</font>
minutes?

We don&#39;t delete any of the log files. So I hope we still have that event
log! Aren&#39;t all logs saved/archived by bestman for historic purposes?
Anyway, I
am attaching the latest tarball of the logs directory. Let me know if that
helps.

(Replying to the ticket as suggested). Hmmm...not sure how the attachment
works.

-Karthik

On Fri, 23 Jul 2010, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1279921508'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-23T21:45:08+00:00">Jul 23, 2010 09:45 PM UTC</time> by <b>Karthik Arunachalam</b><a class="anchor" name="1279921508">&nbsp;</a></div><pre>Hi,

<font color='#7F7E6F'>&#62; Karthik -- please let me know who else shall be CC&#39;ed on it</font>

I don&#39;t know who is all included in the ticket to start with to be able to
suggest who else should be included.

As a reference, here is the list of people to whom this discussions have
been CC&#39;d previously&#58;

Cc&#58; Hironori Ito &#60;hito@....&#62;, Horst Severini &#60;hs@....&#62;,
jgu@...., hito@...., kaushik@...., Patrick McGuigan &#60;mcguigan@....&#62;,
&#34;Ernst, Michael&#34; &#60;mernst@....&#62;, Mark Sosebee &#60;sosebee@....&#62;,
srm@...., Tanya Levshina &#60;tlevshin@....&#62;, Wei Yang &#60;yangw@....&#62;

-Karthik

On Fri, 23 Jul 2010, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8961#1279920778'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-23T21:32:58+00:00">Jul 23, 2010 09:32 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1279920778">&nbsp;</a></div><pre>Hello Everyone

Please use this ticket to exchange any more information on these issues
Karthik -- please let me know who else shall be CC&#39;ed on it

-Neha
OU SE issue at <a href='srm&#58;//tier2-02.ochep.ou.edu&#58;8443/srm/v2/server' target='_blank' rel='nofollow'>srm&#58;//tier2-02.ochep.ou.edu&#58;8443/srm/v2/server</a>

1. DN  &#34;/O=dutchgrid/O=users/O=nikhef/CN=Kors Bos&#34; produced &#34;Bad
sequence size&#58; 6&#34; during the GSI authentication.
- This could not be reproduced with the valid proxy later on.
- In the mean time, Horst found a message in the BNL RT ticket about
Kors&#39; DN being fixed&#58;

ggus 60035&#58;, user Kors CA mapping fixed from CERN end
-- by Hou Suen at Tue Jul 13 23&#58;56&#58;21 UTC 2010
-- by OSG-GOC at Wed Jul 14 14&#58;22&#58;21 UTC 2010

- This could have fixed the observed authentication issue with Kors
proxy at OU.

2. srmLs request gets time-out frequently, specially when there are many
connections to the OU SE and the requested file size is large enough for
checksum calculation.
- This is related to the underlying Lustre file system.
- It is observed that srmLs took about 22 minutes to return values
during high load.
- FTS transfer cannot wait that long, and the requests get timed
out. As the results, FTS requests checksum calculation to verify the
integrity of the transfer from the gridftp server.
- OU gridftp server returns MD5 checksum values, instead of ADLER32
values.
- During the high load stress test, OU bestman server hung due to the
configuration values. It is recommended to increase the java max memory
allocation and the number of container threads for scalability.
<div id='show_1364472013' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1364472013'>
- Two things are suggested to fix srmLs issue at OU&#58;
one, have a stress test with srmLs and adjust file system
performance specially under the heavy load
two, fix the gridftp checksum calculation from MD5 to ADLER32.

We could do that. That hopefully should take care of dealing with the
heaviest of loads on the bestman server. So that is the easy part.

It&#39;ll help your testing at
least.This wouldn&#39;t help 22 minute of srmLs results though as that
depends on the file system.

So this seems to be the bottleneck and the one that could be possibly
chocking us. This would require more investigation to diagnose and fix.
The leads we have from previous discussions on this are&#58;

- Fix gridftp server to have their checksumming method changed
- Possible scalability problems with our Lustre configuration. This
needs to be tested/confirmed. If so, we&#39;ll have to open a case with DDN
for them to fix it.
- Possible storage configuration issues

We are open to other ideas/suggestions.

-Karthik

-- Alex
</div><script type='text/javascript'>
        $('#show_1364472013').click(function() {
            $('#detail_1364472013').slideDown("normal");
            $('#show_1364472013').hide();
            $('#hide_1364472013').show();
        });
        $('#hide_1364472013').click(function() {
            $('#detail_1364472013').slideUp();
            $('#hide_1364472013').hide();
            $('#show_1364472013').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F8961">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 8961});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
