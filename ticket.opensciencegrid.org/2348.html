<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[2348] Possible SANS vulnerabilities in PHP and Twiki</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=2348" method="post">
<div class="page-header">
    <h3><span class="muted">2348</span> / Possible SANS vulnerabilities in PHP and Twiki</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Horst Severini</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Review</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2006-08-10</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Kyle Gross <span class="muted"> / OSG GOC Support Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/2348", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/2348?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/2348?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Possible%20SANS%20vulnerabilities%20in%20PHP%20and%20Twiki%20ISSUE%3D2348%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='2348#1156340420'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T13:40:20+00:00">Aug 23, 2006 01:40 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156340420">&nbsp;</a></div><pre>I investigated the mod_rewrite apache vulnerability in detail due to our standard
server configuration.  The part of the detailed text on the vulnerability that seems
to means that we are not vulnerable is &#58;

&#34;An off-by-one error exists in the ldap scheme handling in mod_rewrite. For some
RewriteRules, specifically those where the remote user can influence the beginning of
a rewritten URL and that do not include any of the following flags&#58; Forbidden (F),
Gone (G), or NoEscape (NE), this could lead to a pointer being written out of bounds.
This flaw causes a remotely exploitable vulnerability on web servers that have
mod_rewrite enabled (configuration directive &#34;RewriteEngine on&#34;) and configured to
use certain rules.&#34;

Our standard setting enables mod_rewrite to avoid another vulnerability that is
scanned by the IU security staff.  The rule in question is &#58;

RewriteRule .* - [F]

And its the Forbidden [F] that seems to protect us even if we were vulnerable.  The
versions of apache
listed as vulnerable appear to be older and all our machines with apache appear to
use a much newer version.

I believe we have dealt with all the vulnerabilities described in the original
report.  This ticket can be closed.</pre></div><div class='update_description'><i onclick="document.location='2348#1155221891'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-10T14:58:11+00:00">Aug 10, 2006 02:58 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1155221891">&nbsp;</a></div><pre>As far as the TWiki is concerned, the hotfix that fixes this patch
was applied.

The mambo vulns are older and didn&#39;t pertain to us.

Kyle

On Aug 10, 2006, at 8&#58;52 AM, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='2348#1155179549'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-10T03:12:29+00:00">Aug 10, 2006 03:12 AM UTC</time> by <b>James Dickerson</b><a class="anchor" name="1155179549">&nbsp;</a></div><pre>From&#58; Horst Severini &#60;hs@....&#62;
To&#58; goc@....
cc&#58; hs@....
Subject&#58; possible vulnerabilities
Date-Sent&#58; Wednesday, August 09, 2006 10&#58;07 PM -0500

Hi guys,

I just read through the latest SANS Security Vulnerability Alert,
and there are a few items which might affect us, so I thought I&#39;d
pass them on and ask you what you think and/or know about the subjects.

It&#39;s mostly TWiki and PHP related. Not sure how the PHP vulnerabilities
affect us, but we&#39;re running ROCKS 3.3.0, and a bunch of other sites
are also running ROCKS, which comes with a PHP enabled web server --
mostly for Ganglia, if I understand this correctly -- so I was wondering
if you had a feel for how dangerous these vulnerabilities might be
for the web servers?

Thanks a lot,

Horst

----------------
****************************************************************

(5) MODERATE&#58; PHP Functions Multiple Vulnerabilities
Affected&#58; PHP version 4.4.3 and prior.

Description&#58; PHP, the popular web-centric programming language, contains
several remotely-exploitable vulnerabilities. The exact nature of these
flaws has not been publicly disclosed. Flaws have been reported in the
wordwrap(), tempnam(), error_log(), substr_compare(), and phpinfo()
functions as well as the code used to parse session names. Users of
these functions, and users who allow arbitrary individuals to upload PHP
<div id='show_2121582649' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_2121582649'>scripts, are advised to upgrade immediately. Because PHP is open source
software, technical details for these vulnerabilities can be easily
obtained by analyzing the source code.

Status&#58; PHP confirmed, updates available.

Council Site Actions&#58;  Only one of the responding council sites plans
to address this issue -- their servers will be updated within the next
week.

References&#58;
PHP 4.4.3 Release Announcement
<a href='http&#58;//www.php.net/release_4_4_3.php' target='_blank' rel='nofollow'>http&#58;//www.php.net/release_4_4_3.php</a>
SecurityFocus BIDs
<a href='http&#58;//www.securityfocus.com/bid/17363' target='_blank' rel='nofollow'>http&#58;//www.securityfocus.com/bid/17363</a>
<a href='http&#58;//www.securityfocus.com/bid/19349' target='_blank' rel='nofollow'>http&#58;//www.securityfocus.com/bid/19349</a>

****************************************************************

(8) CRITICAL&#58; TWiki Arbitrary Remote Command Execution
Affected&#58; TWiki versions 4.0.0 through 4.0.4

Description&#58; TWiki, a popular enterprise collaboration platform,
contains a remote command-execution vulnerability. By sending a
specially-crafted HTTP POST request to the TWiki &#34;configure&#34; script
(installed by default as &#34;/twiki/bin/configure&#34;), an attacker can
execute arbitrary commands with the privileges of the web server
process. This flaw is due to a failure to sanitize calls to the Perl
&#34;system()&#34; function. The TWiki security advisory includes technical
details and a proof-of-concept for this vulnerability.

Status&#58; TWiki confirmed, updates available. Users are advised to
implement server-based access control on the configure script (through,
for example &#34;.htaccess&#34; files on Apache) and to limit the IP addresses
that can connect to the configuration interface.

Council Site Actions&#58; The affected software and/or configuration are not in
production or widespread use, or are not officially supported at any of the
council sites. They reported that no action was necessary.

References&#58;
TWiki Security Alert
<a href='http&#58;//archives.neohapsis.com/archives/vulnwatch/2006-q3/0017.html' target='_blank' rel='nofollow'>http&#58;//archives.neohapsis.com/archives/vulnwatch/2006-q3/0017.html</a>
TWiki Home Page
<a href='http&#58;//twiki.org' target='_blank' rel='nofollow'>http&#58;//twiki.org</a>
SecurityFocus BID
<a href='http&#58;//www.securityfocus.com/bid/19188' target='_blank' rel='nofollow'>http&#58;//www.securityfocus.com/bid/19188</a>

****************************************************************

06.31.33 CVE&#58; CVE-2006-3747
Platform&#58; Cross Platform
Title&#58; Apache Mod_Rewrite Off-By-One Buffer Overflow
Description&#58; Apache&#39;s mod_rewrite is a rule-based rewriting engine
which rewrites requested URLs for the Apache web server. It is prone
to a buffer overflow condition that presents itself on a system with
the active configuration &#34;RewriteEngine on&#34;. Versions 2.0.53-55 and
prior to 1.3.35 are reported as vulnerable.
Ref&#58; <a href='http&#58;//www.kb.cert.org/vuls/id/395412' target='_blank' rel='nofollow'>http&#58;//www.kb.cert.org/vuls/id/395412</a>
______________________________________________________________________

06.31.41 CVE&#58; Not Available
Platform&#58; Cross Platform
Title&#58; MySQL MERGE Priviledge Revoke Bypass
Description&#58; MySQL is exposed to a privilege revoke bypass issue. The
issue exists when a user is revoked access permissions from a table
that was used to create another MERGE table. The second table created
by the user will still grant permission to access the original table
even though privileges were revoked. MySQL versions 5.1.10 and earlier
are affected.
Ref&#58; <a href='http&#58;//dev.mysql.com/doc/refman/4.1/en/news-4-1-21.html' target='_blank' rel='nofollow'>http&#58;//dev.mysql.com/doc/refman/4.1/en/news-4-1-21.html</a>
______________________________________________________________________

06.31.69 CVE&#58; Not Available
Platform&#58; Web Application
Title&#58; Mambo com_bayesiannaivefilter Component Remote File Include
Description&#58; The com_bayesiannaivefilter component is a bayesian spam
filtering module for the Mambo content management system. It is
vulnerable to a remote file include issue due to insufficient
sanitization of user-supplied input to the &#34;mosConfig_absolute_path&#34;
parameter of the &#34;lang.php&#34; script. The com_bayesiannaivefilter
component version 1.1 is vulnerable.
Ref&#58; <a href='http&#58;//www.securityfocus.com/bid/19231' target='_blank' rel='nofollow'>http&#58;//www.securityfocus.com/bid/19231</a>
______________________________________________________________________

06.31.71 CVE&#58; Not Available
Platform&#58; Web Application
Title&#58; Mambatstaff MosConfig_Absolute_Path Remote File Include
Description&#58; Mambatstaff is a user management module for Mambo CMS. It
is prone to a remote file include vulnerability because it fails to
properly sanitize user-supplied input to the &#34;mosConfig_absolute_path&#34;
parameter of the &#34;mambatstaff.php&#34; script. A successful attacker can
compromise the application and gain access to the underlying system.
All current versions are affected.
Ref&#58; <a href='http&#58;//www.securityfocus.com/bid/19222' target='_blank' rel='nofollow'>http&#58;//www.securityfocus.com/bid/19222</a>
______________________________________________________________________

06.31.73 CVE&#58; Not Available
Platform&#58; Web Application
Title&#58; Mambo Gallery Manager MosConfig_Absolute_Path Remote File
Include
Description&#58; Mambo Gallery Manager is a publishing module for Mambo
CMS. It is prone to a remote file include vulnerability because it
fails to properly sanitize user-supplied input to the
&#34;mosConfig_absolute_path&#34; parameter of the &#34;help.mgm.php&#34; script.
Ref&#58; <a href='http&#58;//www.securityfocus.com/bid/19224' target='_blank' rel='nofollow'>http&#58;//www.securityfocus.com/bid/19224</a>
______________________________________________________________________
</div><script type='text/javascript'>
        $('#show_2121582649').click(function() {
            $('#detail_2121582649').slideDown("normal");
            $('#show_2121582649').hide();
            $('#hide_2121582649').show();
        });
        $('#hide_2121582649').click(function() {
            $('#detail_2121582649').slideUp();
            $('#hide_2121582649').hide();
            $('#show_2121582649').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F2348">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 2348});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
