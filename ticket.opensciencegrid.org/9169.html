<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[9169] OSG Storage&#58; Bestman using 2.9G RAM at UCSD SE</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=9169" method="post">
<div class="page-header">
    <h3><span class="muted">9169</span> / OSG Storage&#58; Bestman using 2.9G RAM at UCSD SE</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Terrence Martin</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2010-09-08</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Scott Teige <span class="muted"> / OSG Operations Infrastructure</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/9169", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/9169?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/9169?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20OSG%20Storage%26%2358%3B%20Bestman%20using%202.9G%20RAM%20at%20UCSD%20SE%20ISSUE%3D9169%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='9169#1285938365'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-10-01T13:06:05+00:00">Oct 1, 2010 01:06 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1285938365">&nbsp;</a></div><pre>Not really a ticket... closing</pre></div><div class='update_description'><i onclick="document.location='9169#1285789627'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-09-29T19:47:07+00:00">Sep 29, 2010 07:47 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1285789627">&nbsp;</a></div><pre>From Terrence response, looks like this can be closed.

-Neha</pre></div><div class='update_description'><i onclick="document.location='9169#1284003200'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-09-09T03:33:20+00:00">Sep 9, 2010 03:33 AM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1284003200">&nbsp;</a></div><pre>Removing myself.</pre></div><div class='update_description'><i onclick="document.location='9169#1283385207'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-09-01T23:53:27+00:00">Sep 1, 2010 11:53 PM UTC</time><a class="anchor" name="1283385207">&nbsp;</a></div><pre>I didn&#39;t open a ticket, or at least I did not think I did. I just posted to the mailing list for opinions. I have a solution, increase the amount of memory Java has, which is often the solution to Java, give it more memory. So far the error has not repeated.

Terrence</pre></div><div class='update_description'><i onclick="document.location='9169#1283370681'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-09-01T19:51:21+00:00">Sep 1, 2010 07:51 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1283370681">&nbsp;</a></div><pre>Terrence,

What do you want me & Scott do with your question? I am not sure why you have opened this ticket.

Soichi</pre></div><div class='update_description'><i onclick="document.location='9169#1283369975'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-09-01T19:39:35+00:00">Sep 1, 2010 07:39 PM UTC</time> by <b>Terrence Martin</b><a class="anchor" name="1283369975">&nbsp;</a></div><pre>How many sudo-related requests were there roughly at the time of this
failure?

-- Alex

On 8/30/10 1&#58;59 PM, Terrence Martin wrote&#58;
Yes I was just noting the rm, but any fork failed, but not consistently.

Terrence

On Monday, August 30, 2010 01&#58;34&#58;32 pm Tanya Levshina wrote&#58;
Hi Terrence,
mkdir, rmdir, rm were also failing.

Tanya

-----Original Message-----
From&#58; Terrence Martin [mailto&#58;tmartin@....]
Sent&#58; Monday, August 30, 2010 3&#58;29 PM
To&#58; Brian Bockelman
Cc&#58; Tanya Levshina; osg-storage@....
Subject&#58; Re&#58; Is bestman supposed to use 12.6GB of RAM?

This is the first occurance of error=12

ts=2010-08-28T03&#58;19&#58;21.860Z level=Info
class=gov.lbl.srm.util.GUMSClientSAML
fqanSize=3.getFQAN
content=0&#58;/cms/Role=production/Capability=NULL1&#58;/cms/Role=NULL/Capability=N
U LL2&#58;/cms/uscms/Role=NULL/Capa
bility=NULL tid=Thread-2466
ts=2010-08-28T03&#58;19&#58;21.863Z level=Info
class=gov.lbl.srm.util.GUMSClientSAML
event=getMappedID dn=/DC=org/DC=doegrids/OU=People/CN=Ajit Kumar Mohapatra
867118 hostDN=/DC=org/DC=doegrids/OU=Services/CN=
<div id='show_697068172' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_697068172'>bsrm-1.t2.ucsd.edu fqan=/cms/Role=production/Capability=NULL
acIssuer=CN=voms.cern.ch, OU=computers, DC=cern, DC=ch tid=Thread-2466
ts=2010-08-28T03&#58;19&#58;21.863Z level=Info
class=gov.lbl.srm.util.GUMSClientSAML
event=foundInCache result=cmswriter tid=Thread-2466
ts=2010-08-28T03&#58;19&#58;21.865Z level=Console class=gov.lbl.srm.util.TSRMUtil
invokeSudo=[sudo -u cmswriter  /bin/rm
/hadoop/cms/phedex/store/unmerged/mc/Summer10/QCD_DoubleMuFilter_OSAndSSMuo
n s_7TeV-
pythia
6/DQM/START36_V10-v1/0105/AA6E1586-D6B1-DF11-B195-001A9243D51F.root]
tid=Thread-2466
ts=2010-08-28T03&#58;19&#58;21.892Z level=Console class=gov.lbl.srm.util.TSRMUtil
Trouble with&#58; sudo -u cmswriter  /bin/rm
/hadoop/cms/phedex/store/unmerged/mc/Summer10/QCD_DoubleMuFilter_OSAndSSMuo
n s_7TeV-
pyth
ia6/DQM/START36_V10-v1/0105/AA6E1586-D6B1-DF11-B195-001A9243D51F.root
exception&#58;java.io.IOException&#58; Cannot run program &#34;sudo&#34;&#58;
java.io.IOException&#58;
error=12, Cannot allocate memory tid=Thread-2466
ts=2010-08-28T03&#58;19&#58;21.893Z level=Info  class=gov.lbl.srm.impl.TSRMService
event=outcoming.SrmRm tid=Thread-2466
ts=2010-08-28T03&#58;19&#58;21.898Z level=Info
class=org.globus.ogsa.impl.security.authorization.DefaultAuthorization
NoAuthForGUMS tid=Thread-2528
ts=2010-08-28T03&#58;19&#58;21.899Z level=Console class=gov.lbl.srm.util.TSRMUtil
=&#62;

incoming [srmRm()] tid=Thread-2528
ts=2010-08-28T03&#58;19&#58;21.900Z level=Console class=gov.lbl.srm.util.TSRMUtil
###
[srmRm()] tid =Thread-2528 tid=Thread-2528
ts=2010-08-28T03&#58;19&#58;21.900Z level=Console class=gov.lbl.srm.util.TSRMUtil
###
gGetChainPatched [getGUMSMap] tid =Thread-2528 tid=Thread-2528

Interestingly this memory allocation issue only affected deletes, not
transfers. So the files were put in hadoop, but they were just not deleted.
The
only folks that triggered the error were those that wanted to delete.

Terrence

On Monday, August 30, 2010 01&#58;21&#58;03 pm Brian Bockelman wrote&#58;
Who was using it prior to that time?

Brian

On Aug 30, 2010, at 3&#58;20 PM, Terrence Martin wrote&#58;
I see a ligo entry

ts=2010-08-29T17&#58;49&#58;04.588Z level=Info
class=gov.lbl.srm.util.GUMSClientSAML event=foundInCache result=ligo
tid=Thread-3202
ts=2010-08-29T17&#58;49&#58;04.588Z level=Console
class=gov.lbl.srm.util.TSRMUtil

invokeSudo=[sudo -u ligo  /bin/rmdir  /hadoop/ligo/DIRosg-
job.ligo.caltech.edu359UCSDT2] tid=Thread-3202
ts=2010-08-29T17&#58;49&#58;04.605Z level=Console
class=gov.lbl.srm.util.TSRMUtil

Trouble with&#58; sudo -u ligo  /bin/rmdir  /hadoop/ligo/DIRosg-
job.ligo.caltech.edu359UCSDT2 exception&#58;java.io.IOException&#58; Cannot
run program &#34;sudo&#34;&#58; java.io.IOException&#58; error=12, Cannot allocate
memory

tid=Thread-3202

But I do not think that the problem was LIGO necessarily.

The similar error occured with CMS as well a few minutes later.

Terrence

On Monday, August 30, 2010 11&#58;27&#58;21 am Tanya Levshina wrote&#58;
Sorry, wrong dates, please check logs&#58;

2010-08-29 17&#58;44&#58;01.281682
2010-08-29 18&#58;44&#58;01.685351

Thanks,
Tanya

----- Original Message -----
From&#58; Terrence Martin &#60;tmartin@....&#62;
Date&#58; Monday, August 30, 2010 1&#58;17 pm
Subject&#58; Re&#58; Is bestman supposed to use 12.6GB of RAM?
To&#58; Brian Bockelman &#60;bbockelm@....&#62;
Cc&#58; osg-storage@....

That is something we discussed, but did not implement yet. It might
be

something we do given the increase in VO traffic we expect to see.

Oh and that setting is 0.

Terrence

On Monday, August 30, 2010 11&#58;15&#58;32 am Brian Bockelman wrote&#58;
What setting do you have in&#58;

/proc/sys/vm/overcommit_memory

?  If it&#39;s set to &#39;2&#39;, setting it back to the default of &#39;0&#39;
probably would

help.

No clue what caused it to spike.  Ganglia graphs by any chance?

One trick that Nebraska uses is the SAM tests *only* utilize the
dedicated CMS endpoints and have all other OSG VOs separated onto
their own BestMan instance.

Brian

On Aug 30, 2010, at 1&#58;09 PM, Terrence Martin wrote&#58;
On Monday, August 30, 2010 10&#58;32&#58;29 am Brian Bockelman wrote&#58;
On Aug 30, 2010, at 12&#58;32 PM, Terrence Martin wrote&#58;
29469 daemon    18   0 12.6g 2.9g 4840 S  1.3 36.9   1238&#58;53
/osglocal/bestman/jdk1.6/bin/java -server -Xmx2048m -
DX509_CERT_DIR=/osglocal/bestman/globus/TRUSTED_CA -
Daxis.socketSecureFactory=org.glite.
It&#39;s only using 2.9GB of RAM.  Recall that virtual size is near
meaningless for most programs.

Brian
True but that does not change the fact it used so much it could
not use

sudo and put us red on SAM.

So why after all this time did Bestman suddenly decide it needed
so much

RAM? We even had a restart of bestman not that long ago so it was
not

like it was running for months.

Terrence

</div><script type='text/javascript'>
        $('#show_697068172').click(function() {
            $('#detail_697068172').slideDown("normal");
            $('#show_697068172').hide();
            $('#hide_697068172').show();
        });
        $('#hide_697068172').click(function() {
            $('#detail_697068172').slideUp();
            $('#hide_697068172').hide();
            $('#show_697068172').show();
        });
        </script></pre></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F9169">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
