<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="/">
    <title>[4116] dCache/inconsistent state of dcache after multiple srm-advisory-delete commands</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="//netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="https://ticket.opensciencegrid.org/images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="https://ticket.opensciencegrid.org/lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=4116" method="post">
<div class="page-header">
    <h3><span class="muted">4116</span> / dCache/inconsistent state of dcache after multiple srm-advisory-delete commands</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Neha Sharma</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">This ticket can be closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2007-10-30</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Neha Sharma <span class="muted"> / OSG Storage Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("https://ticket.opensciencegrid.org/attachment/list?id=4116", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="/4116?sort=up&"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="/4116?expandall=true&">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20dCache%2Finconsistent%20state%20of%20dcache%20after%20multiple%20srm-advisory-delete%20commands%20ISSUE%3D4116%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='4116#1193074250'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2007-10-22T17:30:50+00:00">Oct 22, 2007 05:30 PM UTC</time> by <b>Thomas Wang</b><a class="anchor" name="1193074250">&nbsp;</a></div><pre>this ticket was reopened by neha, but the GOC assignee was removed..
as discussed on the Ops call.  a GOC team members should be assigned to every ticket so that the ticket will no
become stale or forgotten.

reassigning Ops Workgroup (original person that was RR&#39;d to the ticket)
*reassign to myself to monitor as arvind will be out of the office
--tom</pre></div><div class='update_description'><i onclick="document.location='4116#1192573467'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2007-10-16T22:24:27+00:00">Oct 16, 2007 10:24 PM UTC</time> by <b>tlevshina</b><a class="anchor" name="1192573467">&nbsp;</a></div><pre>I have insatlled  dcache 1.7.46 and verified that I can not reproduce this
problem. We will close this ticket when we verify that it is fixe in 1.8.x.</pre></div><div class='update_description'><i onclick="document.location='4116#1192471636'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2007-10-15T18:07:16+00:00">Oct 15, 2007 06:07 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1192471636">&nbsp;</a></div><pre>Tanya,

Yes, I saw you&#39;d updated the ticket with some info on the 12th. But all the ticket
fields remained the same even after that update. When you enter updates.at a bare
minimum, you need to ensure the following are still appropriately set&#58;

Status
ENG Next Action Item*
ENG Next Action Item date
Summary of Current Status

Thanks,
Arvind</pre></div><div class='update_description'><i onclick="document.location='4116#1192471388'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2007-10-15T18:03:08+00:00">Oct 15, 2007 06:03 PM UTC</time> by <b>tlevshina</b><a class="anchor" name="1192471388">&nbsp;</a></div><pre>Hi,
I&#39;ve updated the ticket on 10/12/07. I do not understand why I&#39;ve got this email.
Please advice,

Tanya

----- Original Message -----
From&#58; Open Science Grid FootPrints &#60;osg@....&#62;
Date&#58; Monday, October 15, 2007 12&#58;03 pm
To&#58; tlevshin@....

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4116#1192467761'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2007-10-15T17:02:41+00:00">Oct 15, 2007 05:02 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1192467761">&nbsp;</a></div><pre>Hi Tanya,

Like I&#39;ve emailed you twice about, this ticket has been stale for more than 2 weeks,
and needs updates on status/next action date and related fields that we&#39;ve described
before.

I&#39;ve set it (on your behalf) to 10/18 this time but I&#39;d appreciate it if you update
tickets yourself so they stay current. We have ticket monitors and stale tickets show
up on it.

(Note&#58; This is my last of three reminders - if this ticket turns stale again then
I&#39;ll close the ticket next Monday).

Thanks.

Arvind</pre></div><div class='update_description'><i onclick="document.location='4116#1192210299'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2007-10-12T17:31:39+00:00">Oct 12, 2007 05:31 PM UTC</time> by <b>tlevshina</b><a class="anchor" name="1192210299">&nbsp;</a></div><pre>Tha bug has been reproduced and fixed by developers (see email from
Patrick Fuhrmann  below). I will retest the newest dcache release in order
to verify it.

*****************************

Hi Tanya,

it seems I found the reason. I could reproduce the situation on my labtop
without
using the srm. It showed up as soon as I simulated the sequence the srm
is doing.
i) set the d-flag to true
ii) remove the file.

The solution is in the pnfsd.log (see below).

Level 2 needs to be changed so that the d flag becomes true.
What the filesystem does &#58; it &#39;truncates the file to zero bytes&#39;
Then it wants to rewrite the new content;
What happens is that the truncate is ok but the &#39;write&#39; gets a timeout
because the server is busy. This is not a big deal (usually) because the
file-system would retry. (see log)
Unfortunately, now the remove comes. But at this time, level 2 is still
empty, (because of the previous &#39;truncate&#39;).
This is then the reason that the level 2 pnfsid is not written into
the trash/2 (we don&#39;t do this if the content is zero)

The last line in the log shows that now the file-system tries to
write level 2 (and of course it fails; we already removed the file)

Though I&#39;m not 100 % sure if this is the reason for the effect we
observe, it is compliant to all observations and it can be reproduced.

I will talk to timur on wednesday if it would be ok to remove
<div id='show_1711725858' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1711725858'>the &#39;set flag&#39; message from the SRM advisory delete code. It is legacy
code anyway.

thanks a lot for your help and your patience

patrick

09/30/07 17&#58;32&#58;31 127.0.0.1-1000-100(16,33,100,) - create  dir
0001000000000000000010E8-0000000000000000 name file-2-81
uid=1000;gid=-1;size=-1;mode=100755;a=ffffffff;m=ffffffff &#58;
000100000000000000013488-0000000000000000  (0)  -&#62; 0
09/30/07 17&#58;32&#58;32 127.0.0.1-0-0(0,) - setattr
000100000000000000013488-0000000500000002 uid=-1;gid=-1;size=-
1;mode=37777777777;a=ffffffff;m=46ffc190  (0)  -&#62; 0
09/30/07 17&#58;32&#58;32 127.0.0.1-0-0(0,) - write
000100000000000000013488-0000000500000002 0 1D  (0)  -&#62; 0
09/30/07 17&#58;32&#58;32 127.0.0.1-0-0(0,) - setattr
000100000000000000013488-0000000500000002 uid=-1;gid=-
1;size=0;mode=37777777777;a=ffffffff;m=46ffc190  (0)  -&#62; 0
09/30/07 17&#58;32&#58;32 127.0.0.1-0-0(0,) - write
000100000000000000013488-0000000500000002 0 26  (0)  -&#62; 0
09/30/07 17&#58;32&#58;32 127.0.0.1-0-0(0,) - create  dir
000000000000000000001040-0000000000000000 name .(pset)
(000100000000000000013488)(attr)(0)
(100755&#58;1000&#58;100&#58;46ffc190&#58;46ffc190&#58;46ffc190)  uid=0;gid=-1;size=-
1;mode=100644;a=ffffffff;m=ffffffff;id=000100000000000000013488;;lev
el=0;;line=100755&#58;1000&#58;100&#58;46ffc190&#58;46ffc190&#58;46ffc190; &#58;
000100000000000000013489-0000001B00000000  (0)  -&#62; 0
09/30/07 17&#58;32&#58;32 127.0.0.1-0-0(0,) - create  dir
000000000000000000001040-0000000000000000 name .(pset)
(000100000000000000013488)(attr)(1)
(100755&#58;1000&#58;100&#58;46ffc190&#58;46ffc190&#58;46ffc190)  uid=0;gid=-1;size=-
1;mode=100644;a=ffffffff;m=ffffffff;id=000100000000000000013488;;lev
el=1;;line=100755&#58;1000&#58;100&#58;46ffc190&#58;46ffc190&#58;46ffc190; &#58;
000100000000000000013489-0000001B00000001  (0)  -&#62; 0
09/30/07 17&#58;32&#58;32 127.0.0.1-0-0(0,) - create  dir
000000000000000000001040-0000000000000000 name .(pset)
(000100000000000000013488)(size)(557704)  uid=0;gid=-1;size=-
1;mode=100644;a=ffffffff;m=ffffffff;id=000100000000000000013488 &#58;
000100000000000000013489-0000001B00000000  (0)  -&#62; 0
09/30/07 17&#58;32&#58;32 127.0.0.1-0-0(0,) - setattr
000100000000000000013488-0000000500000002 uid=-1;gid=-
1;size=0;mode=37777777777;a=ffffffff;m=46ffc190  (0)  -&#62; 0
09/30/07 17&#58;32&#58;33 127.0.0.1-0-0(0,) - write
000100000000000000013488-0000000500000002 0 2B  (0)  -&#62; 0
09/30/07 18&#58;02&#58;35 127.0.0.1-0-0(0,) - setattr
000100000000000000013488-0000000500000002 uid=-1;gid=-
1;size=0;mode=37777777777;a=ffffffff;m=46ffc89b  (0)  -&#62; 0
09/30/07 18&#58;02&#58;35 127.0.0.1-0-0(0,) - write
000100000000000000013488-0000000500000002 0 32  (-335)  -&#62; -222
09/30/07 18&#58;02&#58;43 127.0.0.1-0-0(0,) - remove  dir
0001000000000000000010E8-0000000000000000 name file-2-81  &#58;
000100000000000000013488 ;mdmRmFile=0; (0)  -&#62; 0
09/30/07 18&#58;03&#58;16 127.0.0.1-0-0(0,) - write
000100000000000000013488-0000000500000002 0 32  (-1012)  -&#62; 2
</div><script type='text/javascript'>
        $('#show_1711725858').click(function() {
            $('#detail_1711725858').slideDown("normal");
            $('#show_1711725858').hide();
            $('#hide_1711725858').show();
        });
        $('#hide_1711725858').click(function() {
            $('#detail_1711725858').slideUp();
            $('#hide_1711725858').hide();
            $('#show_1711725858').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='4116#1191849358'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2007-10-08T13:15:58+00:00">Oct 8, 2007 01:15 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1191849358">&nbsp;</a></div><pre>Hi Tanya,

This ticket has turned stale and needs updates on status/next action date and related
fields that we&#39;ve described before. Can you please get on it? (Note&#58; This is my
second of three reminders). Thanks.

Arvind</pre></div><div class='update_description'><i onclick="document.location='4116#1191248749'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2007-10-01T14:25:49+00:00">Oct 1, 2007 02:25 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1191248749">&nbsp;</a></div><pre>Hi Tanya,

This ticket has turned stale and needs updates on status/next action date and related
fields
that we&#39;ve described before. Can you please get on it when you have a minute? &#58;) Thanks!

Arvind</pre></div><div class='update_description'><i onclick="document.location='4116#1190760342'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2007-09-25T22:45:42+00:00">Sep 25, 2007 10:45 PM UTC</time> by <b>Steven Timm</b><a class="anchor" name="1190760342">&nbsp;</a></div><pre>I have separated PnfsManager and cleaner to run in two jvms and enble
cleaner to log all the removed files in &#34;trash&#34;/archive. I was able to
reproduce the same problem, the error appears in PnfsManager, and the
file pnfsid doesn&#39;t appear either in cleaner log or pnfsods list stored in
archive.</pre></div><div class='update_description'><i onclick="document.location='4116#1189805433'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2007-09-14T21:30:33+00:00">Sep 14, 2007 09:30 PM UTC</time> by <b>tlevshina</b><a class="anchor" name="1189805433">&nbsp;</a></div><pre>The following test has been performed&#58; 1000 files (200KB each) has been deleted by
using srm-advisory-delete command. Every 10 deletions are started at the same time.
9 out of 10 times the following situation has been observed&#58;
all the files have been removed from pnfs
all the files have been removed from pnfs trash area
but several files are still exist in pools and replica manager
The error in PnfsManager log indicates that it is probably pnfs manager problem.</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F4116">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="/images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 4116});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
