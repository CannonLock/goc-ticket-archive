<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[24321] Inquiry - OSG Email gratiaweb1 down</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=24321" method="post">
<div class="page-header">
    <h3><span class="muted">24321</span> / Inquiry - OSG Email gratiaweb1 down</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Marco Mambelli</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Elevated</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Assess ticket/Determine NAI</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2015-03-10</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Scott Teige <span class="muted"> / OSG Operations Infrastructure</span></div><div class="assignee" style="width: 60%">Carl Edquist <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/24321", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/24321?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/24321?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Inquiry%20-%20OSG%20Email%20gratiaweb1%20down%20ISSUE%3D24321%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='24321#1426013332'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-10T18:48:52+00:00">Mar 10, 2015 06:48 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1426013332">&nbsp;</a></div><pre>Back in RR. Resolving ticket, will watch gratiaweb</pre></div><div class='update_description'><i onclick="document.location='24321#1425659059'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-06T16:24:19+00:00">Mar 6, 2015 04:24 PM UTC</time> by <b>echism</b><a class="anchor" name="1425659059">&nbsp;</a></div><pre>Adding Scott to this ticket for comments.</pre></div><div class='update_description'><i onclick="document.location='24321#1425437578'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-04T02:52:58+00:00">Mar 4, 2015 02:52 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1425437578">&nbsp;</a></div><pre>In the mean time, I&#39;ll also suggest that it&#39;s OK to put gratiaweb1 back into the RR.  With the big logs zipped now there&#39;s 3G+ free on each of them, and really I don&#39;t see gratiaweb1 as being any more susceptible to this failure than gratiaweb2.  (Is that Scott&#39;s department?)

Carl</pre></div><div class='update_description'><i onclick="document.location='24321#1425436194'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-04T02:29:54+00:00">Mar 4, 2015 02:29 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1425436194">&nbsp;</a></div><pre>Wow, so here&#39;s another insight...

From Soichi&#39;s ls output&#58;

2015-03-03 15&#58;12&#58;56 UTC [root@gratiaweb1&#58;/var/log]# ls -laS
total 3640652
-rw-r--r--  1 daemon root   2307989504 Mar  1 06&#58;10 GratiaWeb.out
-rw-r--r--  1 daemon root   1266737152 Mar  1 03&#58;29 GratiaWeb.out-20150301

These are actually the same log!  GratiaWeb.out-20150301 had data from 02/24/15 - 02/27/15, and GratiaWeb.out from 02/24/15 - 03/01/15.

So, it appears that the &#34;copytruncate&#34; option in the logrotate conf just ran out of disk on /var (a 5G volume) while making a copy there of the 2G file.  So if we want to keep the copytruncate option, really there needs to be &#62; 2x the log size free on that volume when it&#39;s time to rotate otherwise this will always happen.  Given the earlier estimation of upwards of 3G possible weekly, we can probably expect to always hit this with DEBUG log level and only weekly rotation.  But again, switching to daily rotation ought to take care of the problem, since that would rotate every ~500M and compress down to &#60; 10M.

I don&#39;t know all the history for why copytruncate is used -- maybe we can look into alternatives.  But anyway I think the fix for now is still just to switch from weekly to daily rotation.

Carl</pre></div><div class='update_description'><i onclick="document.location='24321#1425433168'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-04T01:39:28+00:00">Mar 4, 2015 01:39 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1425433168">&nbsp;</a></div><pre>I have updated the gratia logrotate conf on gratiaweb-itb from&#58;

/var/log/GratiaWeb.out {
weekly
copytruncate
rotate 4
compress
missingok
notifempty
}

to

/var/log/GratiaWeb.out {
daily
copytruncate
rotate 28
compress
missingok
notifempty
}

Let&#39;s schedule to do the same for gratiaweb1/2.

Carl</pre></div><div class='update_description'><i onclick="document.location='24321#1425419102'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-03T21:45:02+00:00">Mar 3, 2015 09:45 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1425419102">&nbsp;</a></div><pre>Since I see consistently about 500M accumulated per day in the big logs (and at a consistent hourly rate), I propose that we just change the logrotate config (/etc/logrotate.d/gratia_logrotate.conf) for /var/log/GratiaWeb.out from &#34;weekly&#34; to &#34;daily&#34;.

Do we need to wait for the appropriate service interval to update this on gratiaweb1/2 ?

Carl</pre></div><div class='update_description'><i onclick="document.location='24321#1425418390'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-03T21:33:10+00:00">Mar 3, 2015 09:33 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1425418390">&nbsp;</a></div><pre><font color='#7F7E6F'>&#62; ... given that 20M/day = 3.3G/week on a 5.2G /var volume.</font>

Sorry I meant 20M/hour = 3.3G/week</pre></div><div class='update_description'><i onclick="document.location='24321#1425417374'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-03T21:16:14+00:00">Mar 3, 2015 09:16 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1425417374">&nbsp;</a></div><pre>So I took the big GratiaWeb.out from gratiaweb1 and broke it up by hour (based on the timestamps in the log), and I see consistently ~20M accumulating in each 1h block.  (The max was 23M.)

This is basically identical to what I see in GratiaWeb.out-20150222 on gratiaweb2.  I take that to mean that the situation isn&#39;t actually that different between gratiaweb1 and gratiaweb2.

I&#39;d agree that the default log level can probably be something other than DEBUG, but we can change that on these servers without needing to put out a new version of the software.

But I also think we should be able to run with DEBUG on, especially if we are trying to track queries getting run.

I think it would be better to configure logrotate to be more careful about rotating at a certain log size, especially given that 20M/day = 3.3G/week on a 5.2G /var volume.  These logs compress very well too, 2.3G gzips to 33M.  So as long as we rotate/gzip reasonably quickly (let&#39;s say daily or at 500M, whichever comes first), we should be in good shape.

<font color='#7F7E6F'>&#62; &#62; 2) There is a possibility that the Gratiaweb service fails when /var/log is full (python logger crashes?)</font>
<font color='#7F7E6F'>&#62; If this is true, then can you investigate how hard it is to make this not true?</font>

While I don&#39;t object -- personally I would expect all sorts of things to fail when /var is full...

Carl</pre></div><div class='update_description'><i onclick="document.location='24321#1425414038'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-03T20:20:38+00:00">Mar 3, 2015 08:20 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1425414038">&nbsp;</a></div><pre>Juan,

While you are at it, can you make sure to rule out this theory?
<font color='#7F7E6F'>&#62; 2) There is a possibility that the Gratiaweb service fails when /var/log is full (python logger crashes?)</font>
If this is true, then can you investigate how hard it is to make this not true?</pre></div><div class='update_description'><i onclick="document.location='24321#1425413820'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-03T20:17:00+00:00">Mar 3, 2015 08:17 PM UTC</time><a class="anchor" name="1425413820">&nbsp;</a></div><pre>Hi All,

I have just examined the files, and I found out that there are some &#34;empty&#34; lines (lines that didn&#39;t contain regex words) but this lines are printed from the gratia web code. However this lines together only use about 60MB of the whole file.

I think the issue is that all the logs are setted up to DEBUG level, and gratia web1 is receiving a significant amount of requests, and all of them are logging the SQL plus some more information, and the log rotate is executed on a weekly schedule that is letting it grow a lot if in one week the server receives a significant amount of requests.

I&#39;m going to make a little modification so the rpm installation by default only log INFO level messages.

Thanks,
Juan F. Mosquera

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=JUAN FELIPE MOSQUERA MORALES 2663</pre></div><div class='update_description'><i onclick="document.location='24321#1425408518'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-03T18:48:38+00:00">Mar 3, 2015 06:48 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1425408518">&nbsp;</a></div><pre>It might not hurt to make the /var partition a little bigger too; currently it&#39;s 5G.</pre></div><div class='update_description'><i onclick="document.location='24321#1425408465'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-03T18:47:45+00:00">Mar 3, 2015 06:47 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1425408465">&nbsp;</a></div><pre>Ok, no problem; we can still have a look at this one.  It&#39;s a little bit hard to tell what&#39;s different about the logs -- they look pretty much the same, but I&#39;m guessing there must be some very verbose parts hidden in there somewhere...

Carl</pre></div><div class='update_description'><i onclick="document.location='24321#1425407052'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-03T18:24:12+00:00">Mar 3, 2015 06:24 PM UTC</time><a class="anchor" name="1425407052">&nbsp;</a></div><pre>Carl,

The last time i deleted the file while restoring the service, but i didn&#39;t backed it up. I am sorry about that.

Thanks,
Juan F. Mosquera

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jmosquer/CN=760823/CN=Juan Felipe Mosquera Morales</pre></div><div class='update_description'><i onclick="document.location='24321#1425406698'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-03T18:18:18+00:00">Mar 3, 2015 06:18 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1425406698">&nbsp;</a></div><pre>So just to be clear, this does not appear to be a DB issue this time.

Soichi, I just noticed your comment&#58;

<font color='#7F7E6F'>&#62; /var/log on gratiaweb1 is full again - just like last week.</font>
<font color='#7F7E6F'>&#62; This time, I will not touch it so that proper personal can</font>
<font color='#7F7E6F'>&#62; take a look and investigate the cause of this problem.</font>

I was not aware of it filling up last week -- did you notice anything else interesting last time, or was it basically the same as this time?

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='24321#1425404218'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-03T17:36:58+00:00">Mar 3, 2015 05:36 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1425404218">&nbsp;</a></div><pre>By the way, the GratiaWeb.out log on gratiaweb1 was 2.2G, while the one on gratiaweb2 is 33M.

I haven&#39;t noticed yet what&#39;s taking up all the space -- seems to be mostly loggging sql queries, but then again that&#39;s what I see on gratiaweb2 also, which clearly isn&#39;t so big...

Carl</pre></div><div class='update_description'><i onclick="document.location='24321#1425403758'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-03T17:29:18+00:00">Mar 3, 2015 05:29 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1425403758">&nbsp;</a></div><pre>For now I have gzipped GratiaWeb.out and GratiaWeb.out-20150301 (combined they only take up 53M zipped), and deleted the originals, just so /var/log doesn&#39;t stay full.  We can inspect the gzipped versions.

Carl</pre></div><div class='update_description'><i onclick="document.location='24321#1425395896'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-03T15:18:16+00:00">Mar 3, 2015 03:18 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1425395896">&nbsp;</a></div><pre>2015-03-03 15&#58;12&#58;56 UTC [root@gratiaweb1&#58;/var/log]# ls -laS
total 3640652
-rw-r--r--  1 daemon root   2307989504 Mar  1 06&#58;10 GratiaWeb.out
-rw-r--r--  1 daemon root   1266737152 Mar  1 03&#58;29 GratiaWeb.out-20150301
-rw-r--r--  1 root   root    216236804 Mar  3 15&#58;11 lastlog
-rw-------  1 root   root     48388481 Mar  3 15&#58;13 maillog
..

GratiaWeb.out is already in the logrotate, but the real problems are following.
1) Some reason, GratiaWeb.out is exploding on gratiaweb1 - this is not the case for gratiaweb2.
2) There is a possibility that the Gratiaweb service fails when /var/log is full (python logger crashes?)

Here is the last entry from /var/log/GratiaWeb.out.

03/01/15 04&#58;50&#58;35. GraphTool.Cache&#58;DEBUG. Cache sorted &#60;graphtool.database.connection_manager.MySqlDatabase object at 0x6823310&#62; has 5 objects
Traceback (most recent call last)&#58;
File &#34;/usr/lib64/python2.6/logging/__init__.py&#34;, line 800, in emit
self.flush()
File &#34;/usr/lib64/python2.6/logging/__init__.py&#34;, line 762, in flush
self.stream.flush()
IOError&#58; [Errno 28] No space left on device
execute_sql&#58; SUCCESS&#58;
SELECT
R.ApplicationExitCode   ,
truncate( unix_timestamp(EndTime) / &#58;span, 0 ) * &#58;span as time,
sum(Njobs)
FROM
MasterSummaryData R
JOIN
Probe P on R.ProbeName = P.probename
JOIN
Site S on S.siteid = P.siteid
JOIN
VONameCorrection VC ON (VC.corrid=R.VOcorrid)
JOIN
<div id='show_1482021284' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1482021284'>VO on (VC.void = VO.void)

WHERE
R.EndTime &#62;= &#58;starttime AND
R.EndTime &#60; &#58;endtime AND
S.SiteName regexp &#58;facility AND
VO.VOName regexp &#58;vo AND
VC.VOName regexp &#58;role AND
(NOT (VC.VOName regexp &#58;exclude-role)) AND
(R.ResourceType regexp &#58;resource-type or R.ResourceType = &#39;&#39;) AND
R.CommonName regexp &#58;user AND
(&#58;includeFailed=&#39;true&#39; OR ApplicationExitCode=0) AND
(&#58;includeSuccess =&#39;true&#39; OR ApplicationExitCode!=0) AND
(NOT (S.SiteName regexp &#58;exclude-facility)) AND
</div><script type='text/javascript'>
        $('#show_1482021284').click(function() {
            $('#detail_1482021284').slideDown("normal");
            $('#show_1482021284').hide();
            $('#hide_1482021284').show();
        });
        $('#hide_1482021284').click(function() {
            $('#detail_1482021284').slideUp();
            $('#hide_1482021284').hide();
            $('#show_1482021284').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='24321#1425394908'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-03T15:01:48+00:00">Mar 3, 2015 03:01 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1425394908">&nbsp;</a></div><pre>Please find out which log files filled up the disk and why.
How big are they and how much is the space available for them?
How quickly do they grow?
Is it because of an unusual condition/error or because they are verbose?
Specially if the latter is true, Is it possible to add them to logrotate?
Thanks,
Marco</pre></div><div class='update_description'><i onclick="document.location='24321#1425393616'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-03T14:40:16+00:00">Mar 3, 2015 02:40 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1425393616">&nbsp;</a></div><pre>gratiaweb1 has been removed from RR, currently only gratiaweb2 serves the outside world. Adding Carl.</pre></div><div class='update_description'><i onclick="document.location='24321#1425320747'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-02T18:25:47+00:00">Mar 2, 2015 06:25 PM UTC</time> by <b>echism</b><a class="anchor" name="1425320747">&nbsp;</a></div><pre>I&#39;m adding Joe and Juan to this ticket. Please investigate.</pre></div><div class='update_description'><i onclick="document.location='24321#1425320521'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-02T18:22:01+00:00">Mar 2, 2015 06:22 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1425320521">&nbsp;</a></div><pre>/var/log on gratiaweb1 is full again - just like last week. This time, I will not touch it so that proper personal can take a look and investigate the cause of this problem.</pre></div><div class='update_description'><i onclick="document.location='24321#1425308217'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-02T14:56:57+00:00">Mar 2, 2015 02:56 PM UTC</time> by <b>echism</b><a class="anchor" name="1425308217">&nbsp;</a></div><pre>Rob had also reported&#58;

GratiaWeb is unavailable.This is more than likely another Gratia DB problem.</pre></div><div class='update_description'><i onclick="document.location='24321#1425244033'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-01T21:07:13+00:00">Mar 1, 2015 09:07 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1425244033">&nbsp;</a></div><pre>Here more details.
Any gratiaweb1 page gives proxy error (502)&#58;
<a href='http&#58;//gratiaweb1.grid.iu.edu/gratia/' target='_blank' rel='nofollow'>http&#58;//gratiaweb1.grid.iu.edu/gratia/</a>
<a href='http&#58;//gratiaweb1.grid.iu.edu/gratia/bar_graphs/osg_sharing_vos?facility=.*&probe=.*&resource-type=' target='_blank' rel='nofollow'>http&#58;//gratiaweb1.grid.iu.edu/gratia/bar_graphs/osg_sharing_vos?facility=.*&probe=.*&resource-type=</a>^Batch%24&user=.*&exclude-vo=unknown|other&includeFailed=true&exclude-role=NONE&span=86400&title=Wall+Hours+by+%20Accelerator+on+FermiGrid&role=.*&exclude-facility=NONE|Generic|Obsolete|.FERMIGRID.*&exclude-user=NONE&includeSuccess=true&vo=accelerator&starttime=2015-02-01+00%3A00%3A00&endtime=2015-02-28+23%3A59%3A59

The same pages work fine using gratiaweb2.

As you said the service is not critical, so restarting it in the morning will be OK.

Best,
Marco</pre></div><div class='update_description'><i onclick="document.location='24321#1425243296'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-01T20:54:56+00:00">Mar 1, 2015 08:54 PM UTC</time> by <b>kmctush</b><a class="anchor" name="1425243296">&nbsp;</a></div><pre>Marco is saying that there are issues with gratiaweb1, i see no alarms though, looked in documentation, gratiaweb is considered a non-critical service,
RR&#39;ing to OSG Infrastructure to look at in the morning

From&#58; Marco Mambelli &#60;marcom@....&#62;
To&#58; goc@....
cc&#58; Scott Teige &#60;steige@....&#62;, Juan Mosquera &#60;juanfmx2@....&#62;
Subject&#58; gratiaweb1 down
Date-Sent&#58; Sunday, March 01, 2015 7&#58;52 PM +0000

Hi all,
gratiaweb1 seems to be unresponsive. gratiaweb2 seems to be OK.
Thanks,
Marco</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F24321">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
