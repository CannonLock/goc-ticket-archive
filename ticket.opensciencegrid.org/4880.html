<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[4880] OSG AGLT2 Timeouts caused by jobmanager-fork</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=4880" method="post">
<div class="page-header">
    <h3><span class="muted">4880</span> / OSG AGLT2 Timeouts caused by jobmanager-fork</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Bobby Ball</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Closing ticket - SC reports resolution (of initial issue</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2008-04-18</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
        <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/4880", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/4880?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/4880?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20OSG%20AGLT2%20Timeouts%20caused%20by%20jobmanager-fork%20ISSUE%3D4880%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='4880#1208790609'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-21T15:10:09+00:00">Apr 21, 2008 03:10 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1208790609">&nbsp;</a></div><pre>OK, thanks.
bob

Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4880#1208790109'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-21T15:01:49+00:00">Apr 21, 2008 03:01 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1208790109">&nbsp;</a></div><pre>Bob,

I am closing this GOC ticket since the initial issue you reported is resolved (RSV
probes timing out). I&#39;ll let you work out the fork/managed-fork time out issue with
Alain and VDT on the VDT ticket
<a href='http&#58;//vdt.cs.wisc.edu/rt/Ticket/Display.html?user=guest&amp' target='_blank' rel='nofollow'>http&#58;//vdt.cs.wisc.edu/rt/Ticket/Display.html?user=guest&amp</a>;pass=guest&amp;id=3483

Thanks,
Arvind</pre></div><div class='update_description'><i onclick="document.location='4880#1208463189'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-17T20:13:09+00:00">Apr 17, 2008 08:13 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1208463189">&nbsp;</a></div><pre>Those were the only ones tested. Seemed to be what all the rsv probes were using. All our rsv probes went back to green once this change was made.

bob

Open Science Grid FootPrints wrote&#58;  [Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='4880#1208462828'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-17T20:07:08+00:00">Apr 17, 2008 08:07 PM UTC</time> by <b>VDT</b><a class="anchor" name="1208462828">&nbsp;</a></div><pre><font color='#7F7E6F'>&#62; The short on the symptoms is that globus-job-run was taking 2-3</font>
<font color='#7F7E6F'>&#62; minutes, if not longer, to run. Lots of red rsv probes, plus Nagios</font>
<font color='#7F7E6F'>&#62; timeouts from BNL. So, we turned off the managed-fork as shown below</font>
<font color='#7F7E6F'>&#62; and this run time dropped to under 10 seconds.</font>

All jobs, or just fork jobs?

-alain

--
View ticket at &#60;<a href='http&#58;//vdt.cs.wisc.edu/rt/Ticket/Display.html?user=guest&pass=guest&id=3483&#62' target='_blank' rel='nofollow'>http&#58;//vdt.cs.wisc.edu/rt/Ticket/Display.html?user=guest&pass=guest&id=3483&#62</a>;
VDT Support, vdt-support@....</pre></div><div class='update_description'><i onclick="document.location='4880#1208451850'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-17T17:04:10+00:00">Apr 17, 2008 05:04 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1208451850">&nbsp;</a></div><pre>I have a meeting in a few minutes.

The short on the symptoms is that globus-job-run was taking 2-3 minutes, if not longer, to run. Lots of red rsv probes, plus Nagios timeouts from BNL. So, we turned off the managed-fork as shown below and this run time dropped to under 10 seconds.

I&#39;m pretty sure the standard pacman command was used to install the managed-fork, but this is an x86_64 machine, with a 32-bit OSG080 install (history).

[gate01&#58;OSG080]# cd /etc/grid-security
[gate01&#58;grid-security]# cat gsi-authz.conf
globus_mapping /opt/OSG080/prima/lib/libprima_authz_module_gcc32dbg globus_gridmap_callout

I suspect the managed-fork got 64 bit libs, but don&#39;t know that for a fact, hence my request to somehow reverse the install and either get the 32-bit managed-fork in place, or....

bob

Open Science Grid FootPrints wrote&#58;  [Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='4880#1208451669'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-17T17:01:09+00:00">Apr 17, 2008 05:01 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1208451669">&nbsp;</a></div><pre>Hi, Alain,

I am sending the vdt-profile.txt to you directly as it is 6MB zipped (91MB unzipped).

bob

[gate01&#58;~]# cd /opt/OSG080
[gate01&#58;OSG080]# source setup.sh
[gate01&#58;OSG080]# vdt-system-profiler
VDT System Profiler
Analyzing...
/opt/OSG080
/opt/OSG080
/opt/OSG080

Your system profile is located in&#58;
/opt/OSG080/vdt-profile.txt.

If you are having problems, please mail a description of your problem and
this file to vdt-support@....

Open Science Grid FootPrints wrote&#58;  [Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='4880#1208450409'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-17T16:40:09+00:00">Apr 17, 2008 04:40 PM UTC</time> by <b>VDT</b><a class="anchor" name="1208450409">&nbsp;</a></div><pre>Hi,

I don&#39;t have enough context to understand the symptoms of the problem.
Can someone fill me in? What version of the OSG software stack? What
exactly is the problem? What makes you unsure if you have the 32-bit
version?

Something that might help&#58; Can you run the following commands?

cd $VDT_LOCATION
. setup.sh  (or source setup.csh, as appropriate)
vdt-system-profiler

Then mail me the vdt-profile.txt that is created.

It&#39;s not easy to remove a portion of an installation and re-install, my
sincere apologies. If that&#39;s necessary, it&#39;s easier to reinstall. But do
you know about setting OLD_VDT_LOCATION so you can preserve configuration?

-alain
-----------------------------------------------------------------
Alain Roy                         vdt-support@....
VDT Support                   <a href='http&#58;//vdt.cs.wisc.edu/support.html' target='_blank' rel='nofollow'>http&#58;//vdt.cs.wisc.edu/support.html</a>

<font color='#7F7E6F'>&#62; VDT,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Bob Ball from Michigan has some questions about uninstalling Managed-</font>
<font color='#7F7E6F'>&#62; Fork on his OSG</font>
<font color='#7F7E6F'>&#62; CE. Here are the two emails from him with relevant information -</font>
<font color='#7F7E6F'>&#62; please help him out</font>
<font color='#7F7E6F'>&#62; here. Thanks.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; ----------------</font>
<font color='#7F7E6F'>&#62;</font></pre></div><div class='update_description'><i onclick="document.location='4880#1208285170'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-15T18:46:10+00:00">Apr 15, 2008 06:46 PM UTC</time> by <b>VDT</b><a class="anchor" name="1208285170">&nbsp;</a></div><pre>Greetings from the VDT support system!

This message was generated automatically in response to the creation of a
ticket regarding&#58;

Open Science Grid&#58; OSG AGLT2 Timeouts caused by jobmanager-fork ISSUE=4880 PROJ=71

Your original request is copied below for reference.

There is no need to reply to this message right now -- someone from the VDT
team will respond to you as soon as possible.  If you wish to view your
support ticket online, visit&#58;

<a href='http&#58;//vdt.cs.wisc.edu/rt/Ticket/Display.html?user=guest&pass=guest&id=3483' target='_blank' rel='nofollow'>http&#58;//vdt.cs.wisc.edu/rt/Ticket/Display.html?user=guest&pass=guest&id=3483</a>

Your ticket has been assigned an ID as follows&#58;

[vdt-support #3483]

Please include the ticket ID in the subject line of all future email about
this issue.  To do so, you may reply to this message.

Thank you for your interest in the VDT.

-------------------------------------------------------------------------
[Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='4880#1208284844'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-15T18:40:44+00:00">Apr 15, 2008 06:40 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1208284844">&nbsp;</a></div><pre>VDT,

Bob Ball from Michigan has some questions about uninstalling Managed-Fork on his OSG
CE. Here are the two emails from him with relevant information - please help him out
here. Thanks.

----------------</pre></div><div class='update_description'><i onclick="document.location='4880#1208284628'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-15T18:37:08+00:00">Apr 15, 2008 06:37 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1208284628">&nbsp;</a></div><pre>FYI my last message about turning off managed-fork&#58;

Our systems are x86-64 with 32-bit compatibility libs installed.
However, I believe we are using the 32-bit OSG080.  Could this have
caused a problem, somehow, with the managed fork?

[gate01&#58;~]# uname -a
Linux gate01.aglt2.org 2.6.20-20UL5smp #1 SMP Wed Feb 13 20&#58;50&#58;22 EST
2008 x86_64 x86_64 x86_64 GNU/Linux

bob

Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4880#1208284448'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-15T18:34:08+00:00">Apr 15, 2008 06:34 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1208284448">&nbsp;</a></div><pre>FYI, I turned off the managed fork via
/opt/OSG080/vdt/setup/configure_globus_gatekeeper --managed-fork n
--server y

and now get a response in a few seconds.  Something is amiss with our
managed fork.

How do I uninstall this, then re-install?  I can see a pacman command
for installation in the docs, but not an uninstall.  Or, should I just
re-install over what is already in place?

bob

Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4880#1208272570'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-15T15:16:10+00:00">Apr 15, 2008 03:16 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1208272570">&nbsp;</a></div><pre>Is there any way we can trace the JM better, to get a clue where the problem resides? Knowing how to increase the timeout will definitely be helpful.

bob

Open Science Grid FootPrints wrote&#58;  [Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='4880#1208272568'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-15T15:16:08+00:00">Apr 15, 2008 03:16 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1208272568">&nbsp;</a></div><pre>Hi Charles,

Ok, thanks .. I just wanted to check with you before I provided
instructions to increase the timeout on RSV probes to Bob.

Hi Bob,

Please try the following (I assume this is a 0.8.0 install - please
correct me if that&#39;s not true)

1) Setup environment and turn off RSV

. &#60;/path/to/CE or RSV/setup.sh&#62;
vdt-control --off osg-rsv

2) Add timeout parameter to global specs

cd $VDT_LOCATION/osg-rsv/specs/global-specs

## Add timeout of 300 seconds or what you see fit to the RSV probes
for file in &#96;/bin/ls *spec|grep -v &#34;ping-host-probe@....&#34;&#96;; do echo $file ; echo &#39;--timeout 300&#39; &#62;&#62; $file; done

3) Reconfigure RSV probes -- best probably to run the same command you
ran before from Unix History
If you don&#39;t have it in Unix History or need help, let me know. This
step is also documented in bullet #2 here
<a href='https&#58;//twiki.grid.iu.edu/twiki/bin/view/ReleaseDocumentation/ComputeElementInstall#RSV_configuration_steps' target='_blank' rel='nofollow'>https&#58;//twiki.grid.iu.edu/twiki/bin/view/ReleaseDocumentation/ComputeElementInstall#RSV_configuration_steps</a>

4) cd to $VDT_LOCATION (this is important to avoid bug in RSV init
script), start RSV again and check one of the submission files to ensure
the --timeout parameter got through&#58;

cd $VDT_LOCATION
vdt-control --on osg-rsv
## Check  $VDT_LOCATION/osg-rsv/submissions/probes/*__osg-version*.sub to see if --timeout parameter got through to the Args.
<div id='show_1000457556' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1000457556'>
Let me know if this helps avoid those probe timeouts. It&#39;ll probably
take some time for the new results to propogate depending on how you&#39;ve
configured the metric intervals. By default that could take upto 2 hours.

FWIW, in RSV vesion 2 that&#39;ll be released in a couple of weeks, probe
times out will result in UNKNOWN status as opposed to CRITICAL.

Cheers,
Arvind

On 4/15/2008 10&#58;55 AM, Open Science Grid FootPrints pondered&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_1000457556').click(function() {
            $('#detail_1000457556').slideDown("normal");
            $('#show_1000457556').hide();
            $('#hide_1000457556').show();
        });
        $('#hide_1000457556').click(function() {
            $('#detail_1000457556').slideUp();
            $('#hide_1000457556').hide();
            $('#show_1000457556').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='4880#1208271308'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-15T14:55:08+00:00">Apr 15, 2008 02:55 PM UTC</time> by <b>Charles Bacon</b><a class="anchor" name="1208271308">&nbsp;</a></div><pre>Okay.  I don&#39;t know of any good reason why it would take 3 minutes to
run /bin/date even under those conditions, but the issue is definitely
unrelated to firewalls if everything is running to completion.  I
think the resolution to this is going to be increasing the RSV timeouts.

Charles

On Apr 15, 2008, at 9&#58;43 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4880#1208270589'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-15T14:43:09+00:00">Apr 15, 2008 02:43 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1208270589">&nbsp;</a></div><pre>The firewall is off on the gatekeeper. On the node from which I submitted the request, the firewall is on, but the ports inbound are open, and I made the same setups there as on the gatekeeper.

the gatekeeper has a relatively high load for the number of processors/RAM it has (2 with hyper-threading, 4GB, and the load yesterday was averaging around 12) We will upgrade the RAM next week, and are looking at replacing the gatekeeper with a heftier machine. In the meantime, we are trying to resolve this problem and cut down on the timeout errors that are turning us red.

The quote is actually &#34;initial run took 1 minutes, later runs took 3 minutes&#34;, or at least it should have been this. In other words, yes, they succeed, but they exceed the timeouts built into rsv and elsewhere.

Status today, with two tests. /bin/date is no faster. gate01 is the gatekeeper with the rsv probes. gate02 is a neighboring OSG080 node from which I ran my tests.

[gate01&#58;~]# uptime
10&#58;34&#58;51 up 1 day, 16&#58;23, 1 user, load average&#58; 16.16, 18.95, 17.73

[gate01&#58;~]# top
top - 10&#58;36&#58;30 up 1 day, 16&#58;25, 1 user, load average&#58; 16.87, 18.91, 17.86
Tasks&#58; 359 total, 22 running, 336 sleeping, 0 stopped, 1 zombie
Cpu0 &#58; 87.3% us, 11.8% sy, 0.0% ni, 0.0% id, 0.0% wa, 0.3% hi, 0.6% si
Cpu1 &#58; 78.0% us, 19.8% sy, 0.3% ni, 0.0% id, 0.0% wa, 0.6% hi, 1.3% si
Cpu2 &#58; 86.3% us, 13.3% sy, 0.3% ni, 0.0% id, 0.0% wa, 0.0% hi, 0.0% si
Cpu3 &#58; 78.7% us, 21.0% sy, 0.3% ni, 0.0% id, 0.0% wa, 0.0% hi, 0.0% si
Mem&#58; 4039272k total, 3830940k used, 208332k free, 51008k buffers
Swap&#58; 2031608k total, 144k used, 2031464k free, 1877036k cached

PID USER PR NI %CPU TIME+ %MEM VIRT RES SHR S COMMAND
199704 usatlas1 15 0 15 0&#58;00.44 0.2 13008 7820 6200 D globus-gatekeep
199558 root 16 0 12 0&#58;00.35 0.2 12548 6448 5188 S globus-gatekeep
200377 usatlas1 25 0 11 0&#58;00.32 0.1 9268 5596 1428 S perl.real
200412 usatlas1 18 0 11 0&#58;00.32 0.1 9248 5600 1428 S perl.real
200283 usatlas1 17 0 10 0&#58;00.31 0.1 9252 5604 1428 S perl.real
200285 usatlas1 23 0 10 0&#58;00.31 0.1 9248 5496 1396 R perl.real
200123 usatlas1 18 0 10 0&#58;00.30 0.1 9252 5608 1436 S perl.real
200479 usatlas1 18 0 10 0&#58;00.30 0.1 9248 5600 1428 S perl.real
200495 usatlas1 18 0 10 0&#58;00.30 0.1 9284 5632 1440 D perl.real
200679 usatlas1 18 0 10 0&#58;00.30 0.1 9020 5372 1396 R perl.real
200124 usatlas1 21 0 10 0&#58;00.29 0.1 9248 5600 1428 S perl.real
200420 usatlas1 25 0 10 0&#58;00.29 0.1 9120 5348 1396 R perl.real
200478 usatlas1 21 0 5 0&#58;00.16 0.1 8716 4080 1304 R perl.real
<div id='show_646228415' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_646228415'>200509 usatlas1 16 0 4 0&#58;00.13 0.1 5668 3552 2660 S globus-gass-cac
195941 usatlas1 15 0 2 0&#58;00.21 0.1 6532 4248 3092 S globus-job-mana
200381 usatlas1 16 0 2 0&#58;00.07 0.1 5384 2960 2412 S globus-gass-cac
200508 usatlas1 17 0 2 0&#58;00.07 0.1 5384 2956 2412 S globus-gass-cac

[ball@gate02&#58;~]$ !53
time globus-job-run gate01.aglt2.org/jobmanager-fork /bin/env
[ output suppressed ]

real 2m57.623s
user 0m0.197s
sys 0m0.073s
[ball@gate02&#58;~]$ date
Tue Apr 15 10&#58;36&#58;37 EDT 2008

[ball@gate02&#58;~]$ time globus-job-run gate01.aglt2.org/jobmanager-fork /bin/date
Tue Apr 15 10&#58;41&#58;07 EDT 2008

real 3m27.526s
user 0m0.180s
sys 0m0.087s
[ball@gate02&#58;~]$ date
Tue Apr 15 10&#58;41&#58;14 EDT 2008

bob

Open Science Grid FootPrints wrote&#58;  [Duplicate message snipped]
</div><script type='text/javascript'>
        $('#show_646228415').click(function() {
            $('#detail_646228415').slideDown("normal");
            $('#show_646228415').hide();
            $('#hide_646228415').show();
        });
        $('#hide_646228415').click(function() {
            $('#detail_646228415').slideUp();
            $('#hide_646228415').hide();
            $('#show_646228415').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='4880#1208267348'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-15T13:49:08+00:00">Apr 15, 2008 01:49 PM UTC</time> by <b>Charles Bacon</b><a class="anchor" name="1208267348">&nbsp;</a></div><pre>If the client is behind a firewall, it needs to set a port range
appropriate to its firewall.  If the server is behind a firewall, it
needs to set a port range appropriate to its firewall.  There&#39;s a
quite good PDF explaining all the firewall requirements at <a href='http&#58;//www.globus.org/toolkit/security/firewalls/' target='_blank' rel='nofollow'>http&#58;//www.globus.org/toolkit/security/firewalls/</a>

However, the &#34;initial run took 1 minutes, later runs took 1 minute&#34;
makes it sound like the jobs are known to be succeeding?  One minute
for an unmodified fork jobmanager sounds correct - it will poll once
per minute for job completion, so even the shortest jobs all appear to
take one minute.  How heavily loaded is the node?  Does running /bin/
date instead of the RSV probe make it go faster?

Charles

On Apr 15, 2008, at 7&#58;29 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4880#1208263748'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-15T12:49:08+00:00">Apr 15, 2008 12:49 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1208263748">&nbsp;</a></div><pre>Note that I set both the GLOBUS_TCP_PORT_RANGE and the GLOBUS_TCP_SOURCE_RANGE in both of the $VDT_LOCATION/vdt/etc/vdt-local-setup.[sh|csh] files

bob

Open Science Grid FootPrints wrote&#58;  [Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='4880#1208262590'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-15T12:29:50+00:00">Apr 15, 2008 12:29 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1208262590">&nbsp;</a></div><pre>Hi Charles,

We have a GOC ticker with Bob Ball from Michigan - he&#39;s have trouble with Globus jobs
timing out. He appears to have set GLOBUS_TCP_PORT_RANGE but I am not an expert on
this. Can you see if what he has done is appropriate? (see his note below).

The background is this&#58; He has RSV, a resource probing infrastructure, running on his
OSG CE. RSV consists of probes that do a globus-job-run, or the like, to the CE to
test various functions of it. And his probes are timing out after 2 minutes. I can
tell him how to increase the probe timeout but I wanted to check with you first since
2 minutes sounds too long in the first place for a fork job to respond, isn&#39;t it?

Does he have to set  GLOBUS_TCP_SOURCE_RANGE (on the client initiating the Globus
job, in this case the same host) as well??  I do have it set on my test machine but I
did that to be safe (given I don&#39;t know if it&#39;s necessary). Will that help?

Thanks,
Arvind

----FWD-----------
Well, so far not much improvement, if any. An initial run time dropped to about a
minute (still too long) but then a later run took nearly 3 minutes.

I restarted the xinetd service after removing the globus-gatekeeper env line, then
also did
vdt-control --off globus-gatekeeper
vdt-control --on globus-gatekeeper
I also modified the local_port_range to not conflict.

BTW, I used 50001-60000 as the port range, not 40000-50000 because the
local_port_range had been extended even higher. And, in fact, was set to 33000-60000
before I changed it.

You suggested the rsv timeout could be extended. How is this done?

<div id='show_1762512166' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1762512166'>bob
---------------
</div><script type='text/javascript'>
        $('#show_1762512166').click(function() {
            $('#detail_1762512166').slideDown("normal");
            $('#show_1762512166').hide();
            $('#hide_1762512166').show();
        });
        $('#hide_1762512166').click(function() {
            $('#detail_1762512166').slideUp();
            $('#hide_1762512166').hide();
            $('#show_1762512166').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='4880#1208205789'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-14T20:43:09+00:00">Apr 14, 2008 08:43 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1208205789">&nbsp;</a></div><pre>Well, so far not much improvement, if any. An initial run time dropped to about a minute (still too long) but then a later run took nearly 3 minutes.

I restarted the xinetd service after removing the globus-gatekeeper env line, then also did
vdt-control --off globus-gatekeeper
vdt-control --on globus-gatekeeper
I also modified the local_port_range to not conflict.

BTW, I used 50001-60000 as the port range, not 40000-50000 because the local_port_range had been extended even higher. And, in fact, was set to 33000-60000 before I changed it.

You suggested the rsv timeout could be extended. How is this done?

bob

Open Science Grid FootPrints wrote&#58;  [Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='4880#1208203448'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-14T20:04:08+00:00">Apr 14, 2008 08:04 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1208203448">&nbsp;</a></div><pre>I believe you have to restart Globus services but I am not an expert on
that. -Arvind

On 4/14/2008 4&#58;01 PM, Open Science Grid FootPrints pondered&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4880#1208203269'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-14T20:01:09+00:00">Apr 14, 2008 08:01 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1208203269">&nbsp;</a></div><pre>The xinetd.d service for the globus-gatekeeper has the
GLOBUS_TCP_PORT_RANGE specified, but there is no specification anywhere
for the SOURCE_RANGE.  Can this be done in the same way?

Oh, wait, I see in the documentation you send that this can no longer be
done correctly for OSG 0.6 and above.  I will move these definitions to
the setup.sh/csh and see how it goes.  Do I need to restart any services
following this change?

bob

[gate01&#58;xinetd.d]# less globus-gatekeeper
service globus-gatekeeper
{
socket_type = stream
protocol    = tcp
wait        = no
user        = root
instances   = UNLIMITED
cps         = 400 10
server      = /opt/OSG080/vdt/services/vdt-run-globus-gatekeeper.sh
disable     = no
env         = GLOBUS_TCP_PORT_RANGE=40000,50000
}

Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4880#1208201594'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-14T19:33:14+00:00">Apr 14, 2008 07:33 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1208201594">&nbsp;</a></div><pre>Hi Bob,

This is a known issue with Globus jobs but I don&#39;t have an easy solution for you.

One thing I can think of&#58; can you check if you have the Globus TCP port range
environment variables set on your CE as well as RSV host? For example&#58;
GLOBUS_TCP_PORT_RANGE=40000,50000
GLOBUS_TCP_SOURCE_RANGE=40000,50000

This stuff is explained in this part of the OSG CE guide&#58;
<a href='https&#58;//twiki.grid.iu.edu/twiki/bin/view/ReleaseDocumentation/ComputeElementPostInstall#Port_ranges' target='_blank' rel='nofollow'>https&#58;//twiki.grid.iu.edu/twiki/bin/view/ReleaseDocumentation/ComputeElementPostInstall#Port_ranges</a>

Let me know.

You can also set a longer timeout if you wish to, on the RSV probes -- perhaps you
could experiment first to see how much time might be ideal on a typical
globus-job-run...  I can tell you how to set the timeout but it&#39;s not a foolproof fix.

Arvind</pre></div><div class='update_description'><i onclick="document.location='4880#1208198001'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-14T18:33:21+00:00">Apr 14, 2008 06:33 PM UTC</time> by <b>Peter Serguta</b><a class="anchor" name="1208198001">&nbsp;</a></div><pre>From&#58; Bob Ball &#60;ball@....&#62;
To&#58; OSG Operations Center &#60;goc@....&#62;
cc&#58; Bob Ball &#60;ball@....&#62;
Subject&#58; Takes too long for jobmanager-fork to run
Date-Sent&#58; Monday, April 14, 2008 2&#58;09 PM -0400

OK, we are back in an old situation here at AGLT2, in which it takes too long for the
jobmanager-fork to run.  Over 2 minutes, in fact, which causes rsv timeouts.  This is
what I see in the &#34;messages&#34; in response to the following command&#58;  globus-job-run
gate01.aglt2.org/jobmanager-fork /bin/env

Apr 14 13&#58;55&#58;06 gate01.aglt2.org gridinfo[3311190]&#58; JMA 2008/04/14 13&#58;55&#58;06
GATEKEEPER_JM_ID 2008-04-14
.13&#58;55&#58;04.0003310914.0000000000 for /DC=org/DC=doegrids/OU=People/CN=Robert C Ball
331645 on 141.211.43
.122
Apr 14 13&#58;55&#58;06 gate01.aglt2.org gridinfo[3311190]&#58; JMA 2008/04/14 13&#58;55&#58;06
GATEKEEPER_JM_ID 2008-04-14
.13&#58;55&#58;04.0003310914.0000000000 mapped to usatlas3 (789090, 55670)
Apr 14 13&#58;55&#58;06 gate01.aglt2.org gridinfo[3311190]&#58; JMA 2008/04/14 13&#58;55&#58;06
GATEKEEPER_JM_ID 2008-04-14
.13&#58;55&#58;04.0003310914.0000000000 has GRAM_SCRIPT_JOB_ID 1038532 manager type managedfork

Apr 14 13&#58;57&#58;14 gate01.aglt2.org gridinfo[3311190]&#58; JMA 2008/04/14 13&#58;57&#58;14
GATEKEEPER_JM_ID 2008-04-14
.13&#58;55&#58;04.0003310914.0000000000 JM exiting

I have read that some of this delay can be attributed to a condor setting, which is
defaulting to 5 minutes (don&#39;t remember which right now).  But it seems that all the
delay here is in the JM?  Bottom line though is that this is taking too long.  We are
trying to get more RAM added to this busy machine, but have twice failed to get the
correct type.

What can we do to improve this situation?

<div id='show_1706476594' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1706476594'>Thanks,
bob
</div><script type='text/javascript'>
        $('#show_1706476594').click(function() {
            $('#detail_1706476594').slideDown("normal");
            $('#show_1706476594').hide();
            $('#hide_1706476594').show();
        });
        $('#hide_1706476594').click(function() {
            $('#detail_1706476594').slideUp();
            $('#hide_1706476594').hide();
            $('#show_1706476594').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='4880#0'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="1970-01-01T00:00:00+00:00">Jan 1, 1970 12:00 AM UTC</time> by <b>Bobby Ball&#58;</b><a class="anchor" name="0">&nbsp;</a></div><pre><font color='#7F7E6F'>&#62; FYI my last message about turning off managed-fork&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Our systems are x86-64 with 32-bit compatibility libs installed.</font>
<font color='#7F7E6F'>&#62; However, I believe we are using the 32-bit OSG080. Could this have</font>
<font color='#7F7E6F'>&#62; caused a problem, somehow, with the managed fork?</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [gate01&#58;~]# uname -a</font>
<font color='#7F7E6F'>&#62; Linux gate01.aglt2.org 2.6.20-20UL5smp #1 SMP Wed Feb 13 20&#58;50&#58;22 EST</font>
<font color='#7F7E6F'>&#62; 2008 x86_64 x86_64 x86_64 GNU/Linux</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; bob</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Open Science Grid FootPrints wrote&#58;</font>
<font color='#7F7E6F'>&#62; &#62; [Duplicate message snipped]</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>

<font color='#7F7E6F'>&#62; FYI, I turned off the managed fork via</font>
<font color='#7F7E6F'>&#62; /opt/OSG080/vdt/setup/configure_globus_gatekeeper --managed-fork n</font>
<font color='#7F7E6F'>&#62; --server y</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; and now get a response in a few seconds. Something is amiss with our</font>
<font color='#7F7E6F'>&#62; managed fork.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; How do I uninstall this, then re-install? I can see a pacman command</font>
<font color='#7F7E6F'>&#62; for installation in the docs, but not an uninstall. Or, should I just</font>
<font color='#7F7E6F'>&#62; re-install over what is already in place?</font>

--
View ticket at &#60;<a href='http&#58;//vdt.cs.wisc.edu/rt/Ticket/Display.html?user=guest&pass=guest&id=3483&#62' target='_blank' rel='nofollow'>http&#58;//vdt.cs.wisc.edu/rt/Ticket/Display.html?user=guest&pass=guest&id=3483&#62</a>;
VDT Support, vdt-support@....


FYI my last message about turning off managed-fork&#58;

<div id='show_367558240' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_367558240'>Our systems are x86-64 with 32-bit compatibility libs installed.
However, I believe we are using the 32-bit OSG080. Could this have
caused a problem, somehow, with the managed fork?

[gate01&#58;~]# uname -a
Linux gate01.aglt2.org 2.6.20-20UL5smp #1 SMP Wed Feb 13 20&#58;50&#58;22 EST
2008 x86_64 x86_64 x86_64 GNU/Linux

bob

Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>



FYI, I turned off the managed fork via
/opt/OSG080/vdt/setup/configure_globus_gatekeeper --managed-fork n
--server y

and now get a response in a few seconds. Something is amiss with our
managed fork.

How do I uninstall this, then re-install? I can see a pacman command
for installation in the docs, but not an uninstall. Or, should I just
re-install over what is already in place?

bob

-----------

Thanks,
Arvind
</div><script type='text/javascript'>
        $('#show_367558240').click(function() {
            $('#detail_367558240').slideDown("normal");
            $('#show_367558240').hide();
            $('#hide_367558240').show();
        });
        $('#hide_367558240').click(function() {
            $('#detail_367558240').slideUp();
            $('#hide_367558240').hide();
            $('#show_367558240').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F4880">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 4880});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
