<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[34626] singularity updates not working</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=34626" method="post">
<div class="page-header">
    <h3><span class="muted">34626</span> / singularity updates not working</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Richard T. Jones</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Richard T. Jones</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2017-10-16</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
        <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/34626", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='34626#1507839973'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-12T20:26:13+00:00">Oct 12, 2017 08:26 PM UTC</time> by <b>GLUEX</b><a class="anchor" name="1507839973">&nbsp;</a></div><pre>Thank you, the rjones30/gluextest&#58;latest image is now showing up on cvmfs/
singularity.opensciencegrid.org/rjones30. This ticket can now be closed.

-Richard Jones

On Thu, Oct 12, 2017 at 1&#58;47 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34626#1507830457'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-12T17:47:37+00:00">Oct 12, 2017 05:47 PM UTC</time> by <b>echism</b><a class="anchor" name="1507830457">&nbsp;</a></div><pre>Is there anything further?

Thanks</pre></div><div class='update_description'><i onclick="document.location='34626#1507662876'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-10T19:14:36+00:00">Oct 10, 2017 07:14 PM UTC</time> by <b>Derek Weitzel</b><a class="anchor" name="1507662876">&nbsp;</a></div><pre>Ok, merged.</pre></div><div class='update_description'><i onclick="document.location='34626#1507662491'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-10T19:08:11+00:00">Oct 10, 2017 07:08 PM UTC</time> by <b>GLUEX</b><a class="anchor" name="1507662491">&nbsp;</a></div><pre>Derek,

I cannot remember exactly what happened back in June, but I recall that I
created a pull request for docker_images.txt to the master
cvmfs-singularity-sync from my private fork on github. But then, some other
PR got applied before mine and manual merging was needed. That is the last
I recall, from back in June. I just went and saw that my PR is no longer
listed, so I created it again. I believe it should be all set, if it gets
acted on before new conflicts arise.

-Richard Jones

On Tue, Oct 10, 2017 at 2&#58;41 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34626#1507660873'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-10T18:41:13+00:00">Oct 10, 2017 06:41 PM UTC</time> by <b>Derek Weitzel</b><a class="anchor" name="1507660873">&nbsp;</a></div><pre>I don’t see a gluextest&#58;
<a href='https&#58;//github.com/opensciencegrid/cvmfs-singularity-sync/blob/master/docker_images.txt' target='_blank' rel='nofollow'>https&#58;//github.com/opensciencegrid/cvmfs-singularity-sync/blob/master/docker_images.txt</a>

-Derek

<font color='#7F7E6F'>&#62; On Oct 10, 2017, at 1&#58;32 PM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34626#1507660332'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-10T18:32:12+00:00">Oct 10, 2017 06:32 PM UTC</time> by <b>GLUEX</b><a class="anchor" name="1507660332">&nbsp;</a></div><pre>Derek,

Ok, thanks for the update.

Meanwhile, could I ask that someone look into why one of my singularity
images requested in the config file is still not showing up on /cvmfs/
singularity.opensciencegrid.org/rjones30? My gluex and gluex6 images are
showing up there, but not my gluextest.

thanks
-Richard Jones

On Tue, Oct 10, 2017 at 2&#58;06 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34626#1507658787'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-10T18:06:27+00:00">Oct 10, 2017 06:06 PM UTC</time> by <b>Derek Weitzel</b><a class="anchor" name="1507658787">&nbsp;</a></div><pre>Hi,

Sorry to let this fall of our radar.  This week we are re-writing the tools used to create these images.  We are hoping that this will fix the issues that Richard is seeing.</pre></div><div class='update_description'><i onclick="document.location='34626#1507649741'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-10T15:35:41+00:00">Oct 10, 2017 03:35 PM UTC</time> by <b>echism</b><a class="anchor" name="1507649741">&nbsp;</a></div><pre>Is this an issue for which I should contact the developers of singularity or some other person? I think Brian and Derek need some backup.

Thanks</pre></div><div class='update_description'><i onclick="document.location='34626#1505740943'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-18T13:22:23+00:00">Sep 18, 2017 01:22 PM UTC</time> by <b>echism</b><a class="anchor" name="1505740943">&nbsp;</a></div><pre>Brian or Derek,

Do you have any insight on this?

Thanks</pre></div><div class='update_description'><i onclick="document.location='34626#1504898931'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-08T19:28:51+00:00">Sep 8, 2017 07:28 PM UTC</time> by <b>echism</b><a class="anchor" name="1504898931">&nbsp;</a></div><pre>Hi Derek,

Can you check in?

Thanks</pre></div><div class='update_description'><i onclick="document.location='34626#1504717677'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-06T17:07:57+00:00">Sep 6, 2017 05:07 PM UTC</time> by <b>echism</b><a class="anchor" name="1504717677">&nbsp;</a></div><pre>Hi Derek,

What&#39;s happening with this one?

Thanks</pre></div><div class='update_description'><i onclick="document.location='34626#1504294176'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-01T19:29:36+00:00">Sep 1, 2017 07:29 PM UTC</time> by <b>echism</b><a class="anchor" name="1504294176">&nbsp;</a></div><pre>Hi Derek,

Is there any news?

Thanks</pre></div><div class='update_description'><i onclick="document.location='34626#1504109231'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-30T16:07:11+00:00">Aug 30, 2017 04:07 PM UTC</time> by <b>echism</b><a class="anchor" name="1504109231">&nbsp;</a></div><pre>Hi Derek,

Is there any news?

Thanks</pre></div><div class='update_description'><i onclick="document.location='34626#1503934138'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-28T15:28:58+00:00">Aug 28, 2017 03:28 PM UTC</time> by <b>echism</b><a class="anchor" name="1503934138">&nbsp;</a></div><pre>Hi Derek,

Is there any news?

Thanks</pre></div><div class='update_description'><i onclick="document.location='34626#1503600492'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-24T18:48:12+00:00">Aug 24, 2017 06:48 PM UTC</time> by <b>GLUEX</b><a class="anchor" name="1503600492">&nbsp;</a></div><pre>Hello Elizabeth,

I believe Derek W. is working on an issue related to how symlinks from the
standard Centos rpm installs are being propagated to the singularity image
server. Meanwhile, I am checking daily for the appearance of a new link at
the location /cvmfs/
singularity.opensciencegrid.org/rjones30/gluextest&#58;latest/. So far, nothing.

-Richard J.

On Thu, Aug 24, 2017 at 12&#58;30 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34626#1503592211'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-24T16:30:11+00:00">Aug 24, 2017 04:30 PM UTC</time> by <b>echism</b><a class="anchor" name="1503592211">&nbsp;</a></div><pre>What&#39;s the next step on this?

Thanks</pre></div><div class='update_description'><i onclick="document.location='34626#1503407530'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-22T13:12:10+00:00">Aug 22, 2017 01:12 PM UTC</time> by <b>GLUEX</b><a class="anchor" name="1503407530">&nbsp;</a></div><pre>Hello,

My update went in with another related one from Derek. So I am expecting to
see my new container show up on singularity.opensciencegrid.org. So far, I
do not see it. The expected area is /cvmfs/
singularity.opensciencegrid.org/rjones30/gluextest&#58;latest

-Richard Jones

On Tue, Aug 22, 2017 at 9&#58;07 AM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34626#1503407273'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-22T13:07:53+00:00">Aug 22, 2017 01:07 PM UTC</time> by <b>echism</b><a class="anchor" name="1503407273">&nbsp;</a></div><pre>Is there any news on this?

Thanks</pre></div><div class='update_description'><i onclick="document.location='34626#1503089471'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-18T20:51:11+00:00">Aug 18, 2017 08:51 PM UTC</time> by <b>GLUEX</b><a class="anchor" name="1503089471">&nbsp;</a></div><pre>Derek,

Yes the base shared libraries themselves are installed in one rpm, and the
symlinks in the corresponding *-devel package. I need the *-devel packages
so that my makefiles work without customizing for the particular
version-release of every package each time there is an update.

-Richard J.

On Fri, Aug 18, 2017 at 4&#58;12 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34626#1503087130'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-18T20:12:10+00:00">Aug 18, 2017 08:12 PM UTC</time> by <b>Derek Weitzel</b><a class="anchor" name="1503087130">&nbsp;</a></div><pre>Indeed.  It seems to fail when the symlink is ../../lib64/lib*.  Do you know what RPM is doing these odd symlinks?  rpm -qf seems to think it’s glibc-devel, which seems like a legitmate RPM.

When I look at another Centos 7 image, those symlinks do not exist, for example, libresolv is just&#58;
# ls -l lib64/ | grep resol
-rwxr-xr-x.  1 root root   111080 Jul 17 13&#58;36 libresolv-2.17.so
lrwxrwxrwx.  1 root root       17 Aug  1 17&#58;23 libresolv.so.2 -&#62; libresolv-2.17.so

No bare libresolv.so

-Derek

<font color='#7F7E6F'>&#62; On Aug 18, 2017, at 2&#58;54 PM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34626#1503086052'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-18T19:54:12+00:00">Aug 18, 2017 07:54 PM UTC</time> by <b>GLUEX</b><a class="anchor" name="1503086052">&nbsp;</a></div><pre>Derek,

It looks like the script needs to be customized to cover this special case
of these funny interlinking symlinks. Tar does not seem to know what to do
with them. You can look in the docker container itself, and see how these
symlinks are configured in a weird way by the rpm installs because /lib64
no longer exists in Centos 7.

-Richard J.

On Fri, Aug 18, 2017 at 3&#58;35 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34626#1503084941'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-18T19:35:41+00:00">Aug 18, 2017 07:35 PM UTC</time> by <b>Derek Weitzel</b><a class="anchor" name="1503084941">&nbsp;</a></div><pre>It&#39;s not really &#39;converting&#39; anything to a singularity image.  Really, what the script is doing is pulling all the layers and from DockerHub, and untarring them, one on top of the other.  I see these errors in the logs of the script&#58;

Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/libthread_db.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/librt.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/libresolv.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/libnss_nisplus.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/libnss_nis.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/libnss_hesiod.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/libnss_files.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/libnss_dns.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/libnss_db.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/libnss_compat.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/libnsl.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/libm.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/libdl.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/libcrypt.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/libcidn.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/libanl.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; usr/lib64/libBrokenLocale.so&#58; Cannot unlink&#58; Permission denied
Aug 17 09&#58;46&#58;19 hcc-cvmfs-repo.unl.edu cvmfs-singularity-sync[17255]&#58; tar&#58; Exiting with failure status due to previous errors

I don&#39;t know why this is the case though.</pre></div><div class='update_description'><i onclick="document.location='34626#1503082091'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-18T18:48:11+00:00">Aug 18, 2017 06:48 PM UTC</time><a class="anchor" name="1503082091">&nbsp;</a></div><pre>Derek,

Ok, yes looks good! I now see the effect reproduced in your test container. This is an example of the symlinks in the docker container (see your docker image) that get converted to zero-length regular files in the conversion to singularity image.

[jonesrt@gluey Desktop]$ ls -l /cvmfs/singularity.opensciencegrid.org/djw8605/gluexprod&#58;latest/usr/lib64/librt.so
-r-------- 1 cvmfs cvmfs 0 Aug 17 10&#58;46 /cvmfs/singularity.opensciencegrid.org/djw8605/gluexprod&#58;latest/usr/lib64/librt.so

-Richard J.

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Richard T. Jones 594</pre></div><div class='update_description'><i onclick="document.location='34626#1503081910'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-18T18:45:10+00:00">Aug 18, 2017 06:45 PM UTC</time> by <b>Derek Weitzel</b><a class="anchor" name="1503081910">&nbsp;</a></div><pre>I beat you to it by a day&#58;
<a href='https&#58;//github.com/opensciencegrid/cvmfs-singularity-sync/pull/27' target='_blank' rel='nofollow'>https&#58;//github.com/opensciencegrid/cvmfs-singularity-sync/pull/27</a>

It should be under /cvmfs/singularity.opensciencegrid.org/djw8605/gluexprod&#58;latest</pre></div><div class='update_description'><i onclick="document.location='34626#1503057340'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-18T11:55:40+00:00">Aug 18, 2017 11:55 AM UTC</time><a class="anchor" name="1503057340">&nbsp;</a></div><pre>To help move this forward, I went ahead and created a gluextest docker container in which my symlink fixup patch is not applied. I have submitted a pull request to opensciencegrid/cvmfs-singularity-sync, and as soon as that is accepted then a new area called rjones30/gluextest&#58;latest should then appear on /cvmfs/singularity.opensciencegrid.org in which these zero-length files will be present, if I have understood the issue correctly. Once I have verified this, I will update this ticket.
-Richard Jones

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Richard T. Jones 594</pre></div><div class='update_description'><i onclick="document.location='34626#1502978435'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-17T14:00:35+00:00">Aug 17, 2017 02:00 PM UTC</time> by <b>GLUEX</b><a class="anchor" name="1502978435">&nbsp;</a></div><pre>Derek,

That is what you see NOW, because I had to put the fix-up back in so my
jobs would work again. That is NOT what you get if you just do the normal
RPM install in the dockerfile. So what you are seeing is what I get AFTER I
do a post-install fixup to delete all of the broken files in /usr/lib64 and
replace them with the ones you see.

-Richard Jones

On Thu, Aug 17, 2017 at 9&#58;53 AM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34626#1502978005'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-17T13:53:25+00:00">Aug 17, 2017 01:53 PM UTC</time> by <b>Derek Weitzel</b><a class="anchor" name="1502978005">&nbsp;</a></div><pre>Hi Richard,

Sorry, yeah, I was removed from CC&#39;s for some reason.  Anyways...

When I run that ls -l command, I get&#58;

$ ls -l /cvmfs/singularity.opensciencegrid.org/rjones30/gluex&#58;latest/usr/lib64/librt.so
lrwxrwxrwx 1 cvmfs cvmfs 10 Aug 14 17&#58;15 /cvmfs/singularity.opensciencegrid.org/rjones30/gluex&#58;latest/usr/lib64/librt.so -&#62; librt.so.1

Which seems right?  Correct? (ignore the permissions).</pre></div><div class='update_description'><i onclick="document.location='34626#1502916115'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-16T20:41:55+00:00">Aug 16, 2017 08:41 PM UTC</time> by <b>echism</b><a class="anchor" name="1502916115">&nbsp;</a></div><pre>Hey Derek,

Could you check in? Richard&#58; somehow the cc&#39;s were stripped from this ticket midway.

Thanks</pre></div><div class='update_description'><i onclick="document.location='34626#1502746750'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-14T21:39:10+00:00">Aug 14, 2017 09:39 PM UTC</time> by <b>GLUEX</b><a class="anchor" name="1502746750">&nbsp;</a></div><pre>Hello Derek,

I have not heard back on this for a while, so I am going ahead and
reinstalling my fix-ups in the Dockerfile so my container will start
working again.  This work-around is ok for the moment, but at some point I
believe it should be fixed.

-Richard Jones

On Mon, Aug 14, 2017 at 8&#58;42 AM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34626#1502714529'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-14T12:42:09+00:00">Aug 14, 2017 12:42 PM UTC</time> by <b>GLUEX</b><a class="anchor" name="1502714529">&nbsp;</a></div><pre>correction, make that &#34;I tried it again WITHOUT the ad-hoc fixup, and again
the zero-length files are there...&#34;
-Richard

On Mon, Aug 14, 2017 at 1&#58;40 AM, Richard Jones &#60;richard.t.jones@....&#62;
wrote&#58;

<font color='#7F7E6F'>&#62; Derek,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; I tried it again with the ad-hoc fixup, and again the zero-length files</font>
<font color='#7F7E6F'>&#62; are there where the symlinks should be. Please confirm that you see this,</font>
<font color='#7F7E6F'>&#62; so I can put my workaround back in, because right at the moment my</font>
<font color='#7F7E6F'>&#62; container is broken and my jobs are failing.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; -Richard J.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On Thu, Aug 10, 2017 at 3&#58;55 PM, Open Science Grid FootPrints &#60;</font>
<font color='#7F7E6F'>&#62; osg@....&#62; wrote&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34626#1502689330'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-14T05:42:10+00:00">Aug 14, 2017 05:42 AM UTC</time> by <b>GLUEX</b><a class="anchor" name="1502689330">&nbsp;</a></div><pre>Derek,

I tried it again with the ad-hoc fixup, and again the zero-length files are
there where the symlinks should be. Please confirm that you see this, so I
can put my workaround back in, because right at the moment my container is
broken and my jobs are failing.

-Richard J.

On Thu, Aug 10, 2017 at 3&#58;55 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34626#1502394924'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-10T19:55:24+00:00">Aug 10, 2017 07:55 PM UTC</time> by <b>Derek Weitzel</b><a class="anchor" name="1502394924">&nbsp;</a></div><pre>Hi Richard,

I just deleted the the image, then let it redownload and build the image.  I checked a few of the libraries that you mentioned here and they are non-zero length.  Could you try the image again?  Please verify that the publish version you test against is new.

I suspect this was caused by an update when this node ran out of space about a week ago.

-Derek</pre></div><div class='update_description'><i onclick="document.location='34626#1502230506'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-08T22:15:06+00:00">Aug 8, 2017 10:15 PM UTC</time><a class="anchor" name="1502230506">&nbsp;</a></div><pre>Sorry I did not see your update until after sending my question. We will try to reproduce the problem and see what causes that issue.

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Mats Rynge 45</pre></div><div class='update_description'><i onclick="document.location='34626#1502230388'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-08T22:13:08+00:00">Aug 8, 2017 10:13 PM UTC</time><a class="anchor" name="1502230388">&nbsp;</a></div><pre>Richard,

Did you push the image again? I did see the 0-byte files, but the look ok now.

Thanks,
Mats

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Mats Rynge 45</pre></div><div class='update_description'><i onclick="document.location='34626#1502226122'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-08T21:02:02+00:00">Aug 8, 2017 09:02 PM UTC</time><a class="anchor" name="1502226122">&nbsp;</a></div><pre>Update&#58; I think I have a clue to what is going wrong in the singularity container build. In the docker container, /lib64/librt.so is a symlink to ../../usr/lib64/librt.so.1, which looks invalid. However, it is not because /lib64 is a symlink in centos7 to /usr/lib64, and a symlink /usr/lib64/librt.so -&#62; ../../usr/lib64/librt.so.1 is valid. If I look directly into the docker container, the link is there just as it would be on a native centos7 host. However, the link is converted to a zero-length ordinary file once the docker container is dup&#39;ed into /cvmfs/singularity.opensciencegrid.org/rjones30/gluex&#58;latest. See below.

[jonesrt@gluey containers]$ sudo docker run rjones30/gluex&#58;latest ls -l /usr/lib64/librt.so
lrwxrwxrwx 1 root root 22 Aug  8 19&#58;32 /usr/lib64/librt.so -&#62; ../../lib64/librt.so.1
[jonesrt@gluey containers]$ ls -l /cvmfs/singularity.opensciencegrid.org/rjones30/gluex&#58;latest/usr/lib64/librt.so
-r-------- 1 cvmfs cvmfs 0 Aug  8 16&#58;05 /cvmfs/singularity.opensciencegrid.org/rjones30/gluex&#58;latest/usr/lib64/librt.so

I have made the following work-around. I did a find for all zero-length regular files in /usr/lib64 on /cvmfs/singularity.opensciencegrid.org/rjones30/gluex&#58;latest and made a list. Then I created a blank directory called usr/lib64 in which I dup&#39;ed all of these symlinks, but dropped the &#34;../../usr/lib64&#34; prefix. I captured these symlinks in a tarball and then added a line to Dockerfile to fetch this tarball and unpack it into my container overwriting the problematic symlinks with variants that point to the same file without the &#34;../../usr/lib64&#34; prefix. I think this will allow me to work in the meantime, but I still think that this should be addressed in the scripts that copy the dockerfile into a singularity image.
-Richard Jones

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Richard T. Jones 594</pre></div><div class='update_description'><i onclick="document.location='34626#1502223534'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-08T20:18:54+00:00">Aug 8, 2017 08:18 PM UTC</time><a class="anchor" name="1502223534">&nbsp;</a></div><pre>Update&#58; woops, I mistyped that command, here is the correct report&#58;
[jonesrt@gluey containers]$ date -d &#34;1970-1-1 GMT + $(wget -qO- $(attr -qg host /cvmfs/singularity.opensciencegrid.org)/.cvmfspublished | &#92;
cat -v|sed -n &#39;/^T/{s/^T//p;q;}&#39;) sec&#34;
Tue Aug  8 15&#58;58&#58;46 EDT 2017

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Richard T. Jones 594</pre></div><div class='update_description'><i onclick="document.location='34626#1502222657'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-08-08T20:04:17+00:00">Aug 8, 2017 08:04 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1502222657">&nbsp;</a></div><pre>Hello,

Might I ask someone to check what has gone wrong with my singularity image updates on /cvmfs/singularity.opensciencegrid.org/rjones30/gluex&#58;latest?
I just did &#34;git push&#34; on my latest update to the Dockerfile, and the image rebuild on dockerhub was successful, but the image on the above /cvmfs filesystem is not updated, even though the .cvmfspublished file indicates the update was done.

[jonesrt@gluey containers]$ date -d &#34;1970-1-1 GMT + $(wget -qO- $(attr -qg host /cvmfs/oasis.opensciencegrid.org)/.cvmfspublished | &#92;
cat -v|sed -n &#39;/^T/{s/^T//p;q;}&#39;) sec&#34;
Tue Aug  8 14&#58;25&#58;51 EDT 2017

Instead, I have a bunch of files in my image that are zero-length, eg. /lib64/libcrypt.so, /lib64/libm.so, /lib64/librt.so, etc.

thank you,
-Richard Jones

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Richard T. Jones 594</pre></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F34626">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
