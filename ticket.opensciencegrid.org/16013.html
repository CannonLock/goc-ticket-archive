<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[16013] Dangerous default on hadoop-0.20-osg log4j configuration</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=16013" method="post">
<div class="page-header">
    <h3><span class="muted">16013</span> / Dangerous default on hadoop-0.20-osg log4j configuration</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Samir Cury Siqueira</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Samir Cury Siqueira</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Waiting for user response</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2013-09-06</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Kyle Gross <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div><div class="assignee" style="width: 60%">Brian Lin <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/16013", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='16013#1378068913'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-01T20:55:13+00:00">Sep 1, 2013 08:55 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1378068913">&nbsp;</a></div><pre>Samir,

Sorry we couldn&#39;t solve your issue, good luck with your alternate solution. If anything else comes up, go ahead and open up a new ticket for it.

- Brian</pre></div><div class='update_description'><i onclick="document.location='16013#1377878940'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-30T16:09:00+00:00">Aug 30, 2013 04:09 PM UTC</time><a class="anchor" name="1377878940">&nbsp;</a></div><pre>Hi Carl,

I don&#39;t think so [1]. At this point I&#39;m giving up the proper way and will go for an external solution to log4j. Maybe in HDFS 2.0 this gets better, or I&#39;m making some basic mistake.

Anyway, this was supposed to be the quick fix for the problem, but it ended up as longer than the log archival schema I wanted to deploy later on, I will skip directly for it (similar to Brian Bockelman&#39;s).

As not much seems to work, maybe changing the default configuration is not something that will help. From my side, feel free to close the ticket.

Thanks a lot for all the help,
Samir

[1] &#58;

[root@compute-10-5 ~]# ll /var/log/hadoop/
total 1086192
-rw-r--r--. 1 root   root   331406828 Jul 29 07&#58;33 13-7-4.tar.gz
-rw-r--r--. 1 hadoop hadoop  71536085 Aug 30 09&#58;04 hadoop-hadoop-datanode-compute-10-5.tier2.log
-rw-r--r--. 1 hadoop hadoop  83911593 Aug 20 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-20
-rw-r--r--. 1 hadoop hadoop 101607664 Aug 21 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-21
-rw-r--r--. 1 hadoop hadoop 105414058 Aug 22 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-22
-rw-r--r--. 1 hadoop hadoop  96524064 Aug 23 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-23
-rw-r--r--. 1 hadoop hadoop  33786845 Aug 24 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-24
-rw-r--r--. 1 hadoop hadoop  54428290 Aug 25 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-25
-rw-r--r--. 1 hadoop hadoop  62451604 Aug 26 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-26
-rw-r--r--. 1 hadoop hadoop  39521741 Aug 27 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-27
-rw-r--r--. 1 hadoop hadoop  53238088 Aug 28 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-28
-rw-r--r--. 1 hadoop hadoop  78320296 Aug 29 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-29

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div><div class='update_description'><i onclick="document.location='16013#1377724676'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-28T21:17:56+00:00">Aug 28, 2013 09:17 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1377724676">&nbsp;</a></div><pre>Hi Samir,

Did you have any luck after making the changes?

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='16013#1377036891'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-20T22:14:51+00:00">Aug 20, 2013 10:14 PM UTC</time><a class="anchor" name="1377036891">&nbsp;</a></div><pre>Hi Brian,

The upgrade to 0.20 thought me a lot about HDFS - but at a price, so I&#39;m trying to upgrade it again only when we really need new features. Not the case so far.

Thanks a lot for pointing the env var. It was not present in my env file (inherited from 0.19). I just tried with RFA and it failed in many ways (as you told here it would). The DRFA setup looks good though. Hadoop restarted fine after I&#39;ve set that, I will delete the old logs so we see what happens in the next days.

Thanks,
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div><div class='update_description'><i onclick="document.location='16013#1376933248'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-19T17:27:28+00:00">Aug 19, 2013 05:27 PM UTC</time><a class="anchor" name="1376933248">&nbsp;</a></div><pre>Hi,

Aside - I thought Caltech had already upgraded to HDFS 2.0?

Anyhow, the environment variable&#58;

HADOOP_ROOT_LOGGER

in hadoop-env.sh controls which logger is used.  By default, it uses DRFA in 0.20 and RFA in 2.0.  Try setting&#58;

HADOOP_ROOT_LOGGER=&#34;INFO,RFA&#34;

Alternately, one can adopt this script we use at HCC&#58;

<a href='https&#58;//github.com/bbockelm/hcc-config/blob/master/modules/hadoop/files/hdfs-log-rotate' target='_blank' rel='nofollow'>https&#58;//github.com/bbockelm/hcc-config/blob/master/modules/hadoop/files/hdfs-log-rotate</a>

It compresses old logfiles with bz2 and deletes the files after 30 days.

Brian

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Brian Bockelman</pre></div><div class='update_description'><i onclick="document.location='16013#1376918486'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-19T13:21:26+00:00">Aug 19, 2013 01:21 PM UTC</time><a class="anchor" name="1376918486">&nbsp;</a></div><pre>Sure, here.

Thanks,
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div><div class='update_description'><i onclick="document.location='16013#1376581935'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-15T15:52:15+00:00">Aug 15, 2013 03:52 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1376581935">&nbsp;</a></div><pre>Samir,

This is getting quite strange. Could you run osg-system-profiler and attach its output?

- Brian</pre></div><div class='update_description'><i onclick="document.location='16013#1376573130'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-15T13:25:30+00:00">Aug 15, 2013 01:25 PM UTC</time><a class="anchor" name="1376573130">&nbsp;</a></div><pre>Hi,

It seems to have not much effect.

I&#39;m attaching the file, if case you spot anything obviously wrong. In principle I didn&#39;t find &#58;

<a href='http&#58;//samir.web.cern.ch/samir/log4j.properties' target='_blank' rel='nofollow'>http&#58;//samir.web.cern.ch/samir/log4j.properties</a>

[root@compute-10-5 ~]# ll /var/log/hadoop/
-rw-r--r--. 1 root   root   331406828 Jul 29 07&#58;33 13-7-4.tar.gz
-rw-r--r--. 1 hadoop hadoop  24569776 Aug 15 06&#58;15 hadoop-hadoop-datanode-compute-10-5.tier2.log
-rw-r--r--. 1 hadoop hadoop  86167614 Aug  1 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-01
-rw-r--r--. 1 hadoop hadoop  22901803 Aug  2 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-02
-rw-r--r--. 1 hadoop hadoop  17048578 Aug  3 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-03
-rw-r--r--. 1 hadoop hadoop  15106131 Aug  4 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-04
-rw-r--r--. 1 hadoop hadoop 331085544 Aug  5 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-05
-rw-r--r--. 1 hadoop hadoop  77074623 Aug  6 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-06
-rw-r--r--. 1 hadoop hadoop  69416949 Aug  7 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-07
-rw-r--r--. 1 hadoop hadoop 107109418 Aug  8 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-08
-rw-r--r--. 1 hadoop hadoop  77078248 Aug  9 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-09
-rw-r--r--. 1 hadoop hadoop 160204401 Aug 10 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-10
-rw-r--r--. 1 hadoop hadoop 170398236 Aug 11 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-11
-rw-r--r--. 1 hadoop hadoop 151610628 Aug 12 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-12
-rw-r--r--. 1 hadoop hadoop 138556169 Aug 13 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-13
-rw-r--r--. 1 hadoop hadoop 154310762 Aug 14 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-14

Thanks,
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div><div class='update_description'><i onclick="document.location='16013#1376081920'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-09T20:58:40+00:00">Aug 9, 2013 08:58 PM UTC</time> by <b>echism</b><a class="anchor" name="1376081920">&nbsp;</a></div><pre>I&#39;m advancing this action date as the last response indicated that time was needed.</pre></div><div class='update_description'><i onclick="document.location='16013#1375882521'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-07T13:35:21+00:00">Aug 7, 2013 01:35 PM UTC</time><a class="anchor" name="1375882521">&nbsp;</a></div><pre>Thanks Brian, maybe I was doing it too fast and overlooked those. Obviously, if the very first is not present the RFA is never instantiated. It makes sense that it didn&#39;t work. The relevant parts now look like &#58;

# Rolling File Appender
#

log4j.appender.RFA=org.apache.log4j.RollingFileAppender
log4j.appender.RFA.File=${hadoop.log.dir}/${hadoop.log.file}

# Logfile size and and 30-day backups
#log4j.appender.RFA.MaxFileSize=1MB
log4j.appender.RFA.MaxBackupIndex=7

#log4j.appender.RFA.layout=org.apache.log4j.PatternLayout
#log4j.appender.RFA.layout.ConversionPattern=%d{ISO8601} %-5p %c{2} - %m%n
#log4j.appender.RFA.layout.ConversionPattern=%d{ISO8601} %-5p %c{2} (%F&#58;%M(%L)) - %m%n

I also left only the last 6 logs, so maybe a couple more of days until we see it taking effect if any &#58;

[root@compute-10-5 ~]# ll /var/log/hadoop/
total 875828
-rw-r--r--. 1 root   root   331406828 Jul 29 07&#58;33 13-7-4.tar.gz
-rw-r--r--. 1 hadoop hadoop  15974094 Aug  7 06&#58;35 hadoop-hadoop-datanode-compute-10-5.tier2.log
-rw-r--r--. 1 hadoop hadoop  86167614 Aug  1 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-01
-rw-r--r--. 1 hadoop hadoop  22901803 Aug  2 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-02
-rw-r--r--. 1 hadoop hadoop  17048578 Aug  3 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-03
-rw-r--r--. 1 hadoop hadoop  15106131 Aug  4 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-04
-rw-r--r--. 1 hadoop hadoop 331085544 Aug  5 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-05
-rw-r--r--. 1 hadoop hadoop  77074623 Aug  6 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-08-06
-rw-r--r--. 1 hadoop hadoop         0 Aug  7 06&#58;31 hadoop-hadoop-datanode-compute-10-5.tier2.out
-rw-r--r--. 1 hadoop hadoop         0 Jul 26 12&#58;26 hadoop-hadoop-datanode-compute-10-5.tier2.out.1
-rw-r--r--. 1 hadoop hadoop        91 Jul 26 12&#58;25 hadoop-hadoop-datanode-compute-10-5.tier2.out.2
-rw-r--r--. 1 hadoop hadoop        91 Jul 26 12&#58;17 hadoop-hadoop-datanode-compute-10-5.tier2.out.3
-rw-r--r--. 1 hadoop hadoop        91 Jul  2 06&#58;57 hadoop-hadoop-datanode-compute-10-5.tier2.out.4
-rw-r--r--. 1 hadoop hadoop         0 Jun 13 05&#58;40 hadoop-hadoop-datanode-compute-10-5.tier2.out.5
-rw-r--r--. 1 root   root       25424 Aug  7 06&#58;31 hadoop-syslog.log
<div id='show_636391912' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_636391912'>
Regards,
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira
</div><script type='text/javascript'>
        $('#show_636391912').click(function() {
            $('#detail_636391912').slideDown("normal");
            $('#show_636391912').hide();
            $('#hide_636391912').show();
        });
        $('#hide_636391912').click(function() {
            $('#detail_636391912').slideUp();
            $('#hide_636391912').hide();
            $('#show_636391912').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='16013#1375827121'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-06T22:12:01+00:00">Aug 6, 2013 10:12 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1375827121">&nbsp;</a></div><pre>Samir,

Just a shot in the dark, did you also uncomment the few lines before it? Namely the following&#58;

#log4j.appender.RFA=org.apache.log4j.RollingFileAppender
#log4j.appender.RFA.File=${hadoop.log.dir}/${hadoop.log.file}

#log4j.appender.RFA.MaxFileSize=1MB

I&#39;m going to try and set up/find a hadoop cluster of my own so I can try these out but that may take a while.

Thanks,
Brian</pre></div><div class='update_description'><i onclick="document.location='16013#1375282842'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-31T15:00:42+00:00">Jul 31, 2013 03:00 PM UTC</time><a class="anchor" name="1375282842">&nbsp;</a></div><pre>I&#39;m not sure that it worked &#58;

[root@compute-10-5 ~]# ll /var/log/hadoop/
total 882188
-rw-r--r--. 1 root   root   331406828 Jul 29 07&#58;33 13-7-4.tar.gz
-rw-r--r--. 1 hadoop hadoop   7204159 Jul 31 07&#58;57 hadoop-hadoop-datanode-compute-10-5.tier2.log
-rw-r--r--. 1 hadoop hadoop  57415831 Jul 23 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-23
-rw-r--r--. 1 hadoop hadoop 100337416 Jul 24 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-24
-rw-r--r--. 1 hadoop hadoop  48342385 Jul 25 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-25
-rw-r--r--. 1 hadoop hadoop  82525997 Jul 26 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-26
-rw-r--r--. 1 hadoop hadoop  87198474 Jul 27 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-27
-rw-r--r--. 1 hadoop hadoop  58649485 Jul 28 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-28
-rw-r--r--. 1 hadoop hadoop  68798088 Jul 29 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-29
-rw-r--r--. 1 hadoop hadoop  61408590 Jul 30 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-30
-rw-r--r--. 1 hadoop hadoop         0 Jul 26 12&#58;26 hadoop-hadoop-datanode-compute-10-5.tier2.out
-rw-r--r--. 1 hadoop hadoop        91 Jul 26 12&#58;25 hadoop-hadoop-datanode-compute-10-5.tier2.out.1
-rw-r--r--. 1 hadoop hadoop        91 Jul 26 12&#58;17 hadoop-hadoop-datanode-compute-10-5.tier2.out.2
-rw-r--r--. 1 hadoop hadoop        91 Jul  2 06&#58;57 hadoop-hadoop-datanode-compute-10-5.tier2.out.3
-rw-r--r--. 1 hadoop hadoop         0 Jun 13 05&#58;40 hadoop-hadoop-datanode-compute-10-5.tier2.out.4
-rw-r--r--. 1 hadoop hadoop         0 May 24 11&#58;11 hadoop-hadoop-datanode-compute-10-5.tier2.out.5
-rw-r--r--. 1 root   root       25298 Jul 26 12&#58;26 hadoop-syslog.log

I would say no, as we have 8 archived logs + the current. do you see any way to limit this that actually works?  Or am I expecting the wrong behavior?

Thanks,
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div><div class='update_description'><i onclick="document.location='16013#1375108992'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-29T14:43:12+00:00">Jul 29, 2013 02:43 PM UTC</time><a class="anchor" name="1375108992">&nbsp;</a></div><pre>Meant &#34;next couple of days&#34;

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div><div class='update_description'><i onclick="document.location='16013#1375108761'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-29T14:39:21+00:00">Jul 29, 2013 02:39 PM UTC</time><a class="anchor" name="1375108761">&nbsp;</a></div><pre>Hi Brian,

Sorry I didn&#39;t prepare the lab (should have), Now I archived all old logs and left the last 6 days. In the last couple of days we will see if it remains in 7 logs or not &#58;

[root@compute-10-5 hadoop]# ll
total 771124
-rw-r--r--. 1 root   root   331406828 Jul 29 07&#58;33 13-7-4.tar.gz
-rw-r--r--. 1 hadoop hadoop  23687828 Jul 29 07&#58;38 hadoop-hadoop-datanode-compute-10-5.tier2.log
-rw-r--r--. 1 hadoop hadoop  57415831 Jul 23 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-23
-rw-r--r--. 1 hadoop hadoop 100337416 Jul 24 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-24
-rw-r--r--. 1 hadoop hadoop  48342385 Jul 25 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-25
-rw-r--r--. 1 hadoop hadoop  82525997 Jul 26 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-26
-rw-r--r--. 1 hadoop hadoop  87198474 Jul 27 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-27
-rw-r--r--. 1 hadoop hadoop  58649485 Jul 28 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-28
-rw-r--r--. 1 hadoop hadoop         0 Jul 26 12&#58;26 hadoop-hadoop-datanode-compute-10-5.tier2.out
-rw-r--r--. 1 hadoop hadoop        91 Jul 26 12&#58;25 hadoop-hadoop-datanode-compute-10-5.tier2.out.1
-rw-r--r--. 1 hadoop hadoop        91 Jul 26 12&#58;17 hadoop-hadoop-datanode-compute-10-5.tier2.out.2
-rw-r--r--. 1 hadoop hadoop        91 Jul  2 06&#58;57 hadoop-hadoop-datanode-compute-10-5.tier2.out.3
-rw-r--r--. 1 hadoop hadoop         0 Jun 13 05&#58;40 hadoop-hadoop-datanode-compute-10-5.tier2.out.4
-rw-r--r--. 1 hadoop hadoop         0 May 24 11&#58;11 hadoop-hadoop-datanode-compute-10-5.tier2.out.5
-rw-r--r--. 1 root   root       25298 Jul 26 12&#58;26 hadoop-syslog.log

Regards,
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div><div class='update_description'><i onclick="document.location='16013#1375107801'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-29T14:23:21+00:00">Jul 29, 2013 02:23 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1375107801">&nbsp;</a></div><pre>Samir,

Thanks for the informative reply! Before I make any changes, I want to make sure that the logs actually get rotated on your end so let&#39;s see if setting RFA.MaxBackupIndex=7 actually works as expected.

Thanks,
Brian</pre></div><div class='update_description'><i onclick="document.location='16013#1374866995'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-26T19:29:55+00:00">Jul 26, 2013 07:29 PM UTC</time><a class="anchor" name="1374866995">&nbsp;</a></div><pre>Sorry for the late reply, so, I was looking into one of my nodes, in prinple configured correctly &#58;

log4j.appender.DRFA=org.apache.log4j.DailyRollingFileAppender
log4j.appender.DRFA.File=${hadoop.log.dir}/${hadoop.log.file}

# Rollver at midnight
log4j.appender.DRFA.DatePattern=.yyyy-MM-dd

log4j.appender.DRFA.MaxBackupIndex=7
log4j.appender.DRFA.layout=org.apache.log4j.PatternLayout

The only difference from the default conf fine is the &#34;MaxBackupIndex=7&#34; - But impressively enough I still see the warning, in fact after restart&#58;

log4j&#58;WARN No such property [maxBackupIndex] in org.apache.log4j.DailyRollingFileAppender.
[root@compute-10-5 hadoop]# ll hadoop-hadoop-datanode-compute-10-5.tier2.out
-rw-r--r--. 1 hadoop hadoop 91 Jul 26 12&#58;17 hadoop-hadoop-datanode-compute-10-5.tier2.out

Even more impressive, is that now, after few weeks from the change I can observe that the configuration is not taking effect as I see more than 7 days of logs &#58;

-rw-r--r--. 1 hadoop hadoop 153307551 Jul 12 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-12
-rw-r--r--. 1 hadoop hadoop 135414414 Jul 13 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-13
-rw-r--r--. 1 hadoop hadoop 114037072 Jul 14 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-14
-rw-r--r--. 1 hadoop hadoop 263038921 Jul 15 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-15
-rw-r--r--. 1 hadoop hadoop 129046549 Jul 16 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-16
-rw-r--r--. 1 hadoop hadoop  63909370 Jul 17 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-17
-rw-r--r--. 1 hadoop hadoop  53580344 Jul 18 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-18
-rw-r--r--. 1 hadoop hadoop  76178533 Jul 19 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-19
-rw-r--r--. 1 hadoop hadoop  79060064 Jul 20 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-20
-rw-r--r--. 1 hadoop hadoop  45803714 Jul 21 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-21
-rw-r--r--. 1 hadoop hadoop  88298294 Jul 22 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-22
-rw-r--r--. 1 hadoop hadoop  57415831 Jul 23 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-23
-rw-r--r--. 1 hadoop hadoop 100337416 Jul 24 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-24
-rw-r--r--. 1 hadoop hadoop  48342385 Jul 25 23&#58;59 hadoop-hadoop-datanode-compute-10-5.tier2.log.2013-07-25

So your supposition is right. I tried commenting the DRFA.MaxBackupIndex and the warning goes away from the .out log file upon restart. I also observe that later in the file we can see the actual RFA setting &#58;
<div id='show_775698364' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_775698364'>
log4j.appender.RFA.MaxBackupIndex=7

Which makes the DRFA commented option curious, given it&#39;s being suggested to admins while it wouldn&#39;t work. I will give a try on reconfiguring the whole cluster to use RFA.MaxBackupIndex instead. This should do.

So if there are improvements that could be done in the default file are to remove the DRFA.MaxBackupIndex suggestion and maybe uncomment the RFA.MaxBackupIndex with a reasonable default (30 to 60 days)

Cheers
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira
</div><script type='text/javascript'>
        $('#show_775698364').click(function() {
            $('#detail_775698364').slideDown("normal");
            $('#show_775698364').hide();
            $('#hide_775698364').show();
        });
        $('#hide_775698364').click(function() {
            $('#detail_775698364').slideUp();
            $('#hide_775698364').hide();
            $('#show_775698364').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='16013#1374773626'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-25T17:33:46+00:00">Jul 25, 2013 05:33 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1374773626">&nbsp;</a></div><pre>Samir,

Do you have a response for Brian?

-Kyle</pre></div><div class='update_description'><i onclick="document.location='16013#1374074024'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-17T15:13:44+00:00">Jul 17, 2013 03:13 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1374074024">&nbsp;</a></div><pre>Samir,

I was mostly asking because MaxBackupIndex only seems to be documented for the RollingFileAppender (RFA) and not for the DailyRollingFileAppender (DRFA) so I&#39;m not entirely convinced that uncommenting that line will solve this problem. If you uncomment the line, I think the warning may still show up. Also, what were the names of the files that were piling up in /var for you?

Thanks,
Brian</pre></div><div class='update_description'><i onclick="document.location='16013#1374067708'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-17T13:28:28+00:00">Jul 17, 2013 01:28 PM UTC</time><a class="anchor" name="1374067708">&nbsp;</a></div><pre>Hi Brian,

Actually, I&#39;m happy that the warning shows up and is the least of the point. IMHO the issue is that default configurations are nicer if they are protective (instead of damaging) for people that want the &#34;quick & dirty&#34; setup.

What happens currently is that, as there&#39;s no such configuration (it&#39;s commented), log4j will pretty much rotate but store logs indefinitely. This is good if one has an external log cleanup schema, but then counting on this goes away from the concept of the quick, OOTB and safe setup.

So maybe a month or 2 is reasonable to keep logs so a nice default.

I guess that it&#39;s up to the package maintainers to keep or change it, I am just reporting as an user who was hit by this. One day suddenly I had many nodes with /var filled.

Regards,
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div><div class='update_description'><i onclick="document.location='16013#1373991593'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-16T16:19:53+00:00">Jul 16, 2013 04:19 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1373991593">&nbsp;</a></div><pre>Samir, so if you were to uncomment the MaxBackupIndex line, do you not get that log4j warning?

Thanks,
Brian</pre></div><div class='update_description'><i onclick="document.location='16013#1373962367'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-16T08:12:47+00:00">Jul 16, 2013 08:12 AM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1373962367">&nbsp;</a></div><pre>Dear OSG support,

(this is for the hadoop-0.20-osg package maintainers)

As an user of osg-release repository, and admin of a site that uses hadoop-hdfs, I realized a somewhat dangerous behavior on the hadoop-0.20-osg package. The default /etc/hadoop/conf/log4j.properties contains &#58;

# 30-day backup
#log4j.appender.DRFA.MaxBackupIndex=30
log4j.appender.DRFA.layout=org.apache.log4j.PatternLayout

This actually generates &#58;

starting datanode, logging to
/usr/lib/hadoop/bin/../logs/hadoop-hadoop-datanode-datanode-21-3.local.out
log4j&#58;WARN No such property [maxBackupIndex] in
org.apache.log4j.DailyRollingFileAppender.

The effect that I observed is that I get 500 MB per day of logs, which will eventually fill the /var partition. From what I understand having that option commented causes the system to not cleanup very old rotated logs. If people trust the default, what ends up is that many nodes will start dying with their /var full, potentially in an unexpected moment.

This is good in the sense that once people have the problem, they will be forced to think what will be precisely the log archival strategy, but maybe we want that defaults just work OOTB without causing problems to users. In this case I would suggest that this default configuration is changed to 30 or 60 days.

This is more a report than an issue.

Regards,
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F16013">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
