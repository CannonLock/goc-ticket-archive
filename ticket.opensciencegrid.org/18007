<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[18007] CPU times reported in OSG display are wrong</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=18007" method="post">
<div class="page-header">
    <h3><span class="muted">18007</span> / CPU times reported in OSG display are wrong</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Chander Sehgal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Chander Sehgal</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2013-11-20</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div><div class="assignee" style="width: 60%">Tim Cartwright <span class="muted"> / OSG Software Team</span></div><div class="assignee" style="width: 60%">Carl Edquist <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("https://ticket.opensciencegrid.org/attachment/list?id=18007", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="https://ticket.opensciencegrid.org/\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="https://ticket.opensciencegrid.org/\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/18007?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/18007?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20CPU%20times%20reported%20in%20OSG%20display%20are%20wrong%20ISSUE%3D18007%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='18007#1385157562'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-22T21:59:22+00:00">Nov 22, 2013 09:59 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1385157562">&nbsp;</a></div><pre>Thank you for informing us that this issue has been resolved. I will close this ticket.  Please submit problems, requests, and questions at&#58; <a href='https&#58;//ticket.grid.iu.edu/goc/open' target='_blank' rel='nofollow'>https&#58;//ticket.grid.iu.edu/goc/open</a> OSG Grid Operations Center goc@...., 317-278-9699 Visit the OSG Operations Page&#58; <a href='http&#58;//osggoc.blogspot.com/' target='_blank' rel='nofollow'>http&#58;//osggoc.blogspot.com/</a></pre></div><div class='update_description'><i onclick="document.location='18007#1385142517'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-22T17:48:37+00:00">Nov 22, 2013 05:48 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1385142517">&nbsp;</a></div><pre>John Weigand has created Jira ticket <a href='https&#58;//jira.opensciencegrid.org/browse/GRATIA-127' target='_blank' rel='nofollow'>https&#58;//jira.opensciencegrid.org/browse/GRATIA-127</a>
It is again problem with slurm probe. The probe became orphan since John Thiltges left.  Currently the ticket is assigned to Brain B.

Steve Timm told me that gratia operation cleaned up offending records.
So, I think we can close this ticket and monitor Jira ticket progress.</pre></div><div class='update_description'><i onclick="document.location='18007#1385141100'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-22T17:25:00+00:00">Nov 22, 2013 05:25 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1385141100">&nbsp;</a></div><pre>Yes, I agree with Tim. I don&#39;t have any email from operation that they have cleanup the record. I am at SC13 right now, Let&#39;s leave this ticket opened until I get more info from gratia operation.</pre></div><div class='update_description'><i onclick="document.location='18007#1385140937'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-22T17:22:17+00:00">Nov 22, 2013 05:22 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1385140937">&nbsp;</a></div><pre>Brian,
Should it be in GOC SVN?
Tanya</pre></div><div class='update_description'><i onclick="document.location='18007#1385140900'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-22T17:21:40+00:00">Nov 22, 2013 05:21 PM UTC</time> by <b>Tim Cartwright</b><a class="anchor" name="1385140900">&nbsp;</a></div><pre>Hold on, before we close anything&#58; Do we understand how the bad data got into Gratia to begin with?
Is there another probe change that we need to make?</pre></div><div class='update_description'><i onclick="document.location='18007#1385140423'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-22T17:13:43+00:00">Nov 22, 2013 05:13 PM UTC</time><a class="anchor" name="1385140423">&nbsp;</a></div><pre>Hi Carl,

(Probably need another JIRA ticket to migrate the source over to UW SVN)

Brian

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Brian Bockelman</pre></div><div class='update_description'><i onclick="document.location='18007#1385140392'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-22T17:13:12+00:00">Nov 22, 2013 05:13 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1385140392">&nbsp;</a></div><pre>Thanks Brian!

Chander, are you ok with closing this ticket?

Carl</pre></div><div class='update_description'><i onclick="document.location='18007#1385139294'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-22T16:54:54+00:00">Nov 22, 2013 04:54 PM UTC</time><a class="anchor" name="1385139294">&nbsp;</a></div><pre>Hi,

So - looking at this, it seems OSG Display Data was doing exactly as designed?  We can develop filters to Gratia data, but that&#39;s really a JIRA ticket, not a GOC ticket.

Fermilab Ops separately removed the spike of hours from the Gratia DB which explains why Tanya doesn&#39;t see the spike anymore (and the display looks fine now).

Brian

PS - it&#39;s confusing, but it was a specific design decision to say &#34;CPU Hours&#34; while reporting the &#34;Wall Hours&#34; number.  Someone can re-open the discussion with Miron if they want to revisit that decision.

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Brian Bockelman</pre></div><div class='update_description'><i onclick="document.location='18007#1385073932'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-21T22:45:32+00:00">Nov 21, 2013 10:45 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1385073932">&nbsp;</a></div><pre>As for who maintains it, it looks like Ashu Guru was the last one maintaining it, and before that Brian B, who (it looks like) wrote it initially.

Brian, I&#39;m cc&#39;ing you in case you might have anything interesting to add...</pre></div><div class='update_description'><i onclick="document.location='18007#1385073185'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-21T22:33:05+00:00">Nov 21, 2013 10:33 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1385073185">&nbsp;</a></div><pre>Tanya, could you try running the first query also?  I am just curious to see if there is a spike 21 hours ago in the hourly results...</pre></div><div class='update_description'><i onclick="document.location='18007#1385072128'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-21T22:15:28+00:00">Nov 21, 2013 10:15 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1385072128">&nbsp;</a></div><pre>Thanks, this query produced the following for the last 4 days&#58;
ate	Records	Hours
2013-11-16	545871	2244733.93055556
2013-11-17	464939	2356648.73583333
2013-11-18	486032	2212958.63472222
2013-11-19	482668	2004945.53916667
2013-11-20	452082	2322814.26111111
2013-11-21	171505	986991.335555556

That are reasonable data. I have no clue where 7.5M are coming from.  Carl, you should try to figure out what is wrong with display.</pre></div><div class='update_description'><i onclick="document.location='18007#1385071267'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-21T22:01:07+00:00">Nov 21, 2013 10:01 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1385071267">&nbsp;</a></div><pre>Actually, I guess you probably want the one under &#34;class DailyDataSource(DataSource)&#34;, starting at line 432&#58;

jobs_query = &#34;&#34;&#34;
SELECT
Date,
SUM(Njobs) AS Records,
SUM(WallSeconds)/3600 AS Hours
FROM (
SELECT
ProbeName,
R.VOCorrid AS VOCorrid,
SUM(Njobs) AS NJobs,
SUM(WallDuration*Cores) AS WallSeconds,
DATE(EndTime) AS Date
FROM MasterSummaryData R FORCE INDEX(index02)
WHERE
EndTime &#62;= %(starttime)s AND
EndTime &#60; %(endtime)s AND
ResourceType = &#39;Batch&#39;
GROUP BY Date, ProbeName, VOCorrid
) as R
JOIN Probe P on R.ProbeName = P.probename
JOIN Site S on S.siteid = P.siteid
JOIN VONameCorrection VC ON (VC.corrid=R.VOcorrid)
JOIN VO on (VC.void = VO.void)
WHERE
S.SiteName NOT IN (&#39;NONE&#39;, &#39;Generic&#39;, &#39;Obsolete&#39;) AND
VO.VOName NOT IN (&#39;unknown&#39;, &#39;other&#39;)
GROUP BY Date
ORDER BY Date ASC
&#34;&#34;&#34;</pre></div><div class='update_description'><i onclick="document.location='18007#1385070821'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-21T21:53:41+00:00">Nov 21, 2013 09:53 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1385070821">&nbsp;</a></div><pre>Looks like maybe this one, from line 152 of src/osg_display/gratia_datasource.py&#58;

jobs_query = &#34;&#34;&#34;
SELECT
time,
sum(Records),
sum(Hours)
FROM (
SELECT
(truncate((unix_timestamp(JUR.EndTime)-%(offset)s)/%(span)s, 0)*
%(span)s) as time,
count(*) as Records,
sum(WallDuration)/3600 as Hours,
JUR.VOName as VOName,
JUR.ReportableVOName as ReportableVOName
FROM JobUsageRecord_Meta
JOIN JobUsageRecord JUR Ignore index (index16) ON JUR.dbid=JobUsageRecord_Meta.dbid
WHERE
ServerDate &#62;= %(starttime)s AND
ServerDate &#60; %(endtime)s AND
JUR.EndTime &#60; %(endtime)s AND
JUR.ResourceType = &#39;Batch&#39;
GROUP BY time, VOName, ReportableVOName
) as foo
JOIN VONameCorrection VC ON
((foo.VOName = BINARY VC.VOName) AND
(((foo.ReportableVOName IS NULL) AND (VC.ReportableVOName IS NULL))
OR (BINARY foo.ReportableVOName = BINARY VC.ReportableVOName)))
JOIN VO on (VC.void = VO.void)
WHERE
VO.VOName NOT IN (&#39;unknown&#39;, &#39;other&#39;)
GROUP BY time
ORDER BY time ASC
&#34;&#34;&#34;</pre></div><div class='update_description'><i onclick="document.location='18007#1385070484'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-21T21:48:04+00:00">Nov 21, 2013 09:48 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1385070484">&nbsp;</a></div><pre>Hi Tanya,

Looks like the source lives here&#58; svn&#58;//t2.unl.edu/brian/osg_display (so, check it out with &#34;svn co svn&#58;//t2.unl.edu/brian/osg_display&#34;).

I am not at all familiar with the code, but it looks like most of the queries are in src/osg_display/gratia_datasource.py, and one in src/osg_display/transfer_datasource.py</pre></div><div class='update_description'><i onclick="document.location='18007#1385067174'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-21T20:52:54+00:00">Nov 21, 2013 08:52 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1385067174">&nbsp;</a></div><pre>I need a query that is ran to generate 24 hours CPU usage report</pre></div><div class='update_description'><i onclick="document.location='18007#1385066822'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-21T20:47:02+00:00">Nov 21, 2013 08:47 PM UTC</time> by <b>Tim Cartwright</b><a class="anchor" name="1385066822">&nbsp;</a></div><pre>Technically, Carl Edquist owns this code now, but I am not sure that he has actually looked at it much yet.
Carl&#58; Please help Tanya (et al.) figure out what is going wrong with the reports, if indeed that is the issue.</pre></div><div class='update_description'><i onclick="document.location='18007#1385065550'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-21T20:25:50+00:00">Nov 21, 2013 08:25 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1385065550">&nbsp;</a></div><pre>Who is maintaining Display code? Can I have access to the queries it is doing?
Tanya</pre></div><div class='update_description'><i onclick="document.location='18007#1385047735'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-21T15:28:55+00:00">Nov 21, 2013 03:28 PM UTC</time> by <b>Tim Cartwright</b><a class="anchor" name="1385047735">&nbsp;</a></div><pre>I am adding the Software team to this ticket, so that we can monitor the discussion and jump in when needed.</pre></div><div class='update_description'><i onclick="document.location='18007#1385007877'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-21T04:24:37+00:00">Nov 21, 2013 04:24 AM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1385007877">&nbsp;</a></div><pre>Hi,
It looks to me like OSG Display problem (Does somebody know what query OSG Display execute?).
in gratia during last 24 hours&#58;
njobs=431,843
wallDuration=2,207,759 hours
cpuDuration=1,840,641 hours

select round(sum(CPUUserDuration+CPUSystemDuration)/3600.,0) from VOProbeSummary where EndTime&#62;&#39;2013-11-19&#39; and ResourceType=&#39;Batch&#39;;
+-------------------------------------------------------+
| round(sum(CPUUserDuration+CPUSystemDuration)/3600.,0) |
+-------------------------------------------------------+
|                                               1840641 |
+-------------------------------------------------------+

Display show similar amount of jobs 425,000 but cpu duration is 7,476,000

I have no access to OSG display so I can not figure out why the results are so different.</pre></div><div class='update_description'><i onclick="document.location='18007#1384980643'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-20T20:50:43+00:00">Nov 20, 2013 08:50 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1384980643">&nbsp;</a></div><pre>adding Tanya.
Scott</pre></div><div class='update_description'><i onclick="document.location='18007#1384980123'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-20T20:42:03+00:00">Nov 20, 2013 08:42 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1384980123">&nbsp;</a></div><pre>Adding attachment.</pre></div><div class='update_description'><i onclick="document.location='18007#1384980103'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-20T20:41:43+00:00">Nov 20, 2013 08:41 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1384980103">&nbsp;</a></div><pre>Please open a ticket to record that the CPU times reported at the OSG display (<a href='http&#58;//display.grid.iu.edu/' target='_blank' rel='nofollow'>http&#58;//display.grid.iu.edu/</a> ) are wrong.  See attached screenshot which reports over 7.5M CPU hours in the last day.

I do not believe this is a problem with the Display or Gratia-DB.  I think it is a problem with gratia probes sending bad data from the CE to the Gratia-DB.  (Perhaps it has to do with SLURM and the new Crane site.)

Chander</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F18007">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 18007});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
