<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[23391] Non-admin user unable to perform DN+FQAN-&#62;username mapping with KCA issued usercert loaded in browser</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=23391" method="post">
<div class="page-header">
    <h3><span class="muted">23391</span> / Non-admin user unable to perform DN+FQAN-&#62;username mapping with KCA issued usercert loaded in browser</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Neha Sharma</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Neha Sharma</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">determine how to load voms proxy cert in browser</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2015-03-02</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div><div class="assignee" style="width: 60%">Carl Edquist <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/23391", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/23391?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/23391?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Non-admin%20user%20unable%20to%20perform%20DN%2BFQAN-%26%2362%3Busername%20mapping%20with%20KCA%20issued%20usercert%20loaded%20in%20browser%20ISSUE%3D23391%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='23391#1425071836'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-27T21:17:16+00:00">Feb 27, 2015 09:17 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1425071836">&nbsp;</a></div><pre>Carl and I decided to track this <a href='https&#58;//jira.opensciencegrid.org/browse/SOFTWARE-1817' target='_blank' rel='nofollow'>https&#58;//jira.opensciencegrid.org/browse/SOFTWARE-1817</a>

Closing this GOC ticket

- Neha</pre></div><div class='update_description'><i onclick="document.location='23391#1425005119'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-27T02:45:19+00:00">Feb 27, 2015 02:45 AM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1425005119">&nbsp;</a></div><pre>Hi Carl
I think you no longer having root access on fermicloud085 was somehow related to FermiCloud downtime that happened today. I have added you back in.
This issue has been open for a while. If you have some time tomorrow, we can go over this on phone ( anytime except 11.45 - 1.30 pm works for me - 630-840-6791)
Let me know

Thanks
- Neha</pre></div><div class='update_description'><i onclick="document.location='23391#1424984250'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-26T20:57:30+00:00">Feb 26, 2015 08:57 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1424984250">&nbsp;</a></div><pre>Thanks Neha,

I hope to have a little more time to look at this tomorrow.  But for now&#58;

<font color='#7F7E6F'>&#62; VOMS FQAN for user&#58; /fermilab/Role=Analysis</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Cert that&#39;s loaded in web browser at the time is&#58;</font>
<font color='#7F7E6F'>&#62; You are signed in as /DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Neha Sharma/CN=UID&#58;neha</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; So, this cannot be the reason..</font>

I think the problem is, if you are loading the regular KCA cert that get-cert generates into your browser (but not the one generated by voms-proxy-init), then your browser cert will not have your VOMS FQAN of /fermilab/Role=Analysis, which much be matched exactly.

<font color='#7F7E6F'>&#62; And about loading voms proxy as browser cert - how do I do that?</font>

I&#39;m not actually sure!  &#58;)  But I&#39;m guessing this is what&#39;s needed to make the mapping work from your browser.  Probably we just need to find the right openssl command line to convert it...

Carl

PS, I don&#39;t seem to be able to log into fermicloud085</pre></div><div class='update_description'><i onclick="document.location='23391#1424976881'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-26T18:54:41+00:00">Feb 26, 2015 06:54 PM UTC</time> by <b>echism</b><a class="anchor" name="1424976881">&nbsp;</a></div><pre>Hi Carl,

Have you had a chance to look at this?

Thank you</pre></div><div class='update_description'><i onclick="document.location='23391#1424718469'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-23T19:07:49+00:00">Feb 23, 2015 07:07 PM UTC</time><a class="anchor" name="1424718469">&nbsp;</a></div><pre>Hi Carl,

Can you give this a look please?

Thanks,

Edgar
OSG Software Support

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Edgar Mauricio Fajardo Hernandez 2020</pre></div><div class='update_description'><i onclick="document.location='23391#1424712086'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-23T17:21:26+00:00">Feb 23, 2015 05:21 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1424712086">&nbsp;</a></div><pre>Hi Carl, Brian

(I accidentally shut down my VM and it wasn&#39;t persistent, so had to set up a new one - fermicloud085, on which you have root access Carl)

As non-admin, I am unable to do mapping even with matchFQAN=&#39;ignore&#39;  ( see fnal-ana in gums.config)

I get the same error&#58;
Error mapping grid identity&#58; java.lang.RuntimeException&#58; You are not authorized to perform this function. Contact your gums administrator if access is needed.

Values I am using to perform the mapping are&#58;
DN for service&#58; /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=fermigridosg1.fnal.gov
DN for user&#58; /DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Neha Sharma/CN=UID&#58;neha
VOMS FQAN for user&#58; /fermilab/Role=Analysis

Cert that&#39;s loaded in web browser at the time is&#58;
You are signed in as /DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Neha Sharma/CN=UID&#58;neha

So, this cannot be the reason..

And about loading voms proxy as browser cert - how do I do that? My attempt to import it in to firefox results in

&#34;Failed to decode the file.  Either it is not in PKCS #12 format, has been corrupted, or the password you entered was incorrect&#34;

Thanks
- Neha</pre></div><div class='update_description'><i onclick="document.location='23391#1424381069'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-19T21:24:29+00:00">Feb 19, 2015 09:24 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1424381069">&nbsp;</a></div><pre>So sorry again! I make it as far as thinking to work on it and then keep getting side tracked with other work..
I won&#39;t be able to look in to it today, but first thing tomorrow &#58;)

- Neha</pre></div><div class='update_description'><i onclick="document.location='23391#1424379181'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-19T20:53:01+00:00">Feb 19, 2015 08:53 PM UTC</time> by <b>echism</b><a class="anchor" name="1424379181">&nbsp;</a></div><pre>Hi Neha,

Do you have an update?

Thank you</pre></div><div class='update_description'><i onclick="document.location='23391#1424194454'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-17T17:34:14+00:00">Feb 17, 2015 05:34 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1424194454">&nbsp;</a></div><pre>Oh sorry! I did see it but haven&#39;t had a chance to look in to it carefully.
I will try to get to it later today.

- Neha</pre></div><div class='update_description'><i onclick="document.location='23391#1424181941'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-17T14:05:41+00:00">Feb 17, 2015 02:05 PM UTC</time> by <b>echism</b><a class="anchor" name="1424181941">&nbsp;</a></div><pre>Neha,

Did you receive the last inquiry?

Thank you</pre></div><div class='update_description'><i onclick="document.location='23391#1423517909'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-09T21:38:29+00:00">Feb 9, 2015 09:38 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1423517909">&nbsp;</a></div><pre>Neha,

Have you had the chance to try a voms proxy as your browser cert? And what values are you using on the &#39;Map Grid Identity&#39; page?

Thanks,
Brian</pre></div><div class='update_description'><i onclick="document.location='23391#1423098949'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-05T01:15:49+00:00">Feb 5, 2015 01:15 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1423098949">&nbsp;</a></div><pre>Thanks Neha!

I noticed a few things today&#58;

The two VOMS User Groups with &#34;read all&#34; access (fermilab-analysis and fermilab-production) both say

VOMS Server&#58; fermilab
Accept non-VOMS certificates&#58; false
VOMS certificate&#39;s FQAN is matched as&#58; exact
VO/Group&#58; /fermilab
Role&#58; Analysis
GUMS Access&#58; read all

I think that means that the cert you use has to be a voms proxy and has to have an FQAN of exactly /fermilab/Role=Analysis (or /fermilab/Role=Production for fermilab-production).  Otherwise I don&#39;t think your DN makes it into that user group, and thus doesn&#39;t get the &#34;read all&#34; access.

I forget the exact syntax for specifying roles on the command line, I think it&#39;s something like&#58;

voms-proxy-init -voms fermilab&#58;Analysis

Anyway, which cert file are you loading into your browser?  Is it the one created by get-cert or the one from voms-proxy-init?  (Because it seems like it has to be a voms proxy.)

On the other hand, when you manually added your KCA DN to the admins group&#58;

DN&#58; /DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Neha Sharma/CN=UID&#58;neha
User Group&#58; admins
FQAN&#58;
Email&#58;

There&#39;s no FQAN or VOMS requirements, so your regular non-voms KCA cert probably works fine to put you in the admins group.

Also, on the Map Grid Identity page, what values are you using for each input box?

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='23391#1423069158'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-04T16:59:18+00:00">Feb 4, 2015 04:59 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1423069158">&nbsp;</a></div><pre>Carl
You now have root on fermicloud008.

- Neha</pre></div><div class='update_description'><i onclick="document.location='23391#1423006630'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-03T23:37:10+00:00">Feb 3, 2015 11:37 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1423006630">&nbsp;</a></div><pre>Hi Neha, Brian asked me to take a look.

<font color='#7F7E6F'>&#62; However… when in the hostToGroupMapping, I change</font>
<font color='#7F7E6F'>&#62; ...</font>
<font color='#7F7E6F'>&#62; I can do mapping as both admin and non-admin</font>
<font color='#7F7E6F'>&#62; Why does this have any effect on who can map?</font>

Taking a look at the hasReadAllAccess() function here&#58;
<a href='https&#58;//github.com/opensciencegrid/gums/blob/master/gums-core/src/main/java/gov/bnl/gums/admin/GUMSAPIImpl.java#L846-L865' target='_blank' rel='nofollow'>https&#58;//github.com/opensciencegrid/gums/blob/master/gums-core/src/main/java/gov/bnl/gums/admin/GUMSAPIImpl.java#L846-L865</a>

It looks like the hostToGroupMappings are taken into consideration also, as a last resort.  But to get to that point for the hostToGroupMappings to matter, the user would have to not be in any of the readAllUserGroups.  Is that possible?

I can play around with the install on fermicloud008 if you add my fermicloud user (edquist) to that VM.

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='23391#1422481196'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-28T21:39:56+00:00">Jan 28, 2015 09:39 PM UTC</time> by <b>echism</b><a class="anchor" name="1422481196">&nbsp;</a></div><pre>Brian,

Have you had a chance to look at this?

Thank you</pre></div><div class='update_description'><i onclick="document.location='23391#1421946299'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-22T17:04:59+00:00">Jan 22, 2015 05:04 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1421946299">&nbsp;</a></div><pre>Elizabeth

This ticket is actually waiting from an update from Brian. He is CC&#39;ed on this and I am sure he will get to it when he gets a chance.

- Neha</pre></div><div class='update_description'><i onclick="document.location='23391#1421939324'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-22T15:08:44+00:00">Jan 22, 2015 03:08 PM UTC</time> by <b>echism</b><a class="anchor" name="1421939324">&nbsp;</a></div><pre>Neha,

Please send an update.

Thank you</pre></div><div class='update_description'><i onclick="document.location='23391#1421762637'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-20T14:03:57+00:00">Jan 20, 2015 02:03 PM UTC</time> by <b>echism</b><a class="anchor" name="1421762637">&nbsp;</a></div><pre>Neha,

Where are we on this?

Thank you</pre></div><div class='update_description'><i onclick="document.location='23391#1421284071'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-15T01:07:51+00:00">Jan 15, 2015 01:07 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1421284071">&nbsp;</a></div><pre><font color='#7F7E6F'>&#62; However… when in the hostToGroupMapping, I change</font>
<font color='#7F7E6F'>&#62; cn=&#39;*/?*.fnal.gov&#39;/&#62;</font>
<font color='#7F7E6F'>&#62; to</font>
<font color='#7F7E6F'>&#62; dn=&#39;(/*=*)+/CN=*/?*.fnal.gov(/CN=[0-9]+)?, *.fnal.gov&#39;/&#62;</font>
<font color='#7F7E6F'>&#62; I can do mapping as both admin and non-admin</font>

I&#39;m not sure about the details of why that is causing the issue (Brian can probably shed more light on it), but it may no longer be an issue in our next gums release, where you should be able to use just &#34;cn=&#39;*/?*.fnal.gov&#39;/&#62;&#34; again, instead of the more complicated dn=... expression.  (This is for <a href='https&#58;//jira.opensciencegrid.org/browse/SOFTWARE-1714' target='_blank' rel='nofollow'>https&#58;//jira.opensciencegrid.org/browse/SOFTWARE-1714</a>)

Carl</pre></div><div class='update_description'><i onclick="document.location='23391#1421277684'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-14T23:21:24+00:00">Jan 14, 2015 11:21 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1421277684">&nbsp;</a></div><pre>Hi Brian

Explaining the issue&#58;

Our GUMS server is configured so that access for all vomsUserGroup/s (except admins and banned) is set to &#39;read all&#39;
So, a non-admin user belonging to any usergroup and with a valid cert loaded in browser should be able to do mapping via the web interface
But this is not what we see in any (preprod/prod) of our GUMS instances
Behavior we see is&#58;

* Non-admin users (more than one) are un-able to perform mapping with their KCA certificate. They can perform the same mapping with Digicert certificate just fine.
* I am able to perform mapping with both my KCA and Digicert cert ( Also a non-admin)

Example&#58;

Service DN&#58; /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=fermigridosg1.fnal.gov
User DN&#58; /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Dmitry Litvintsev 1123
FQAN&#58; null ( nothing), so we leave this field blank

Marco is unable to perform this mapping.
I am able to perform it.  The local mapped username is &#39;fgtest&#39;

Me debugging this&#58;

1. I see that voms user group that gets used in this case is &#39;fermilab-test&#39;
2. I confirm that I am not an admin

mysql&#62; select * from USERS where GROUP_NAME like &#39;admins&#39; and DN like &#39;%UID&#58;neha%&#39;;
Empty set (0.00 sec)

mysql&#62;

3. I check entries for this DN+group in GUMS DB

mysql&#62; select * from USERS where GROUP_NAME like &#39;%fermilab-test%&#39; and DN like &#39;%Dmitry%&#39;;
+---------+---------------+---------------------------------------------------------------------------------------------------+----------------+------------------+
<div id='show_1798980003' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1798980003'>| ID      | GROUP_NAME    | DN                                                                                                | FQAN           | EMAIL            |
+---------+---------------+---------------------------------------------------------------------------------------------------+----------------+------------------+
|  506742 | fermilab-test | /DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Dmitry O. Litvintsev/CN=UID&#58;litvinse                      | /fermilab/test | unknown@.... |
| 1282582 | fermilab-test | /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Dmitry Litvintsev 1123                  | /fermilab/test | NULL             |
| 1519561 | fermilab-test | /DC=gov/DC=fnal/O=Fermilab/OU=Robots/CN=fifegrid/CN=batch/CN=Dmitry O. Litvintsev/CN=UID&#58;litvinse | /fermilab/test | NULL             |
+---------+---------------+---------------------------------------------------------------------------------------------------+----------------+------------------+
3 rows in set (0.07 sec)

mysql&#62;

I see that Marco&#39;s KCA DN does not belong to this group. So, just a shot in dark, I add it

mysql&#62; select * from USERS where GROUP_NAME like &#39;%fermilab-test%&#39; and DN like &#39;%Marco%&#39;;
+---------+---------------+-------------------------------------------------------------------------------------------+----------------+-------+
| ID      | GROUP_NAME    | DN                                                                                        | FQAN           | EMAIL |
+---------+---------------+-------------------------------------------------------------------------------------------+----------------+-------+
| 1645882 | fermilab-test | /DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Marco Mambelli/CN=UID&#58;marcom                      | /fermilab/test | NULL  |
| 1645892 | fermilab-test | /DC=gov/DC=fnal/O=Fermilab/OU=Robots/CN=fifegrid/CN=batch/CN=Marco Mambelli/CN=UID&#58;marcom | /fermilab/test | NULL  |
+---------+---------------+-------------------------------------------------------------------------------------------+----------------+-------+
2 rows in set (0.08 sec)

mysql&#62;

4. I ask Marco to try and voila he can do the mapping just fine.  I remove his KCA DN from this group and he is now unable to map. This behavior is 100% reproducible.

This super confuses me because not only does it mean that access=&#39;read all&#39; doesn&#39;t work as advertised, but also that it&#39;s behavior seems to be very inconsistent - for *certain* cert for *certain* users

( I don&#39;t belong to this group and neither does Marco with his Digicert certificate and mapping just works )

mysql&#62; select * from USERS where DN like &#39;%UID&#58;neha%&#39; and GROUP_NAME like &#39;%fermilab-test%&#39;;
Empty set (0.15 sec)

mysql&#62;

Why could this be happening? Can you try to do the same mapping with your KCA certificate?

<font color='#7F7E6F'>&#62; <a href='https&#58;//gums.fnal.gov&#58;8443/gums' target='_blank' rel='nofollow'>https&#58;//gums.fnal.gov&#58;8443/gums</a></font>

I see following entries for your KCA DN

mysql&#62; select * from USERS where DN like &#39;%UID&#58;bboc%&#39;;
+---------+--------------------+-------------------------------------------------------------------------------------------------+--------------------------+-------+
| ID      | GROUP_NAME         | DN                                                                                              | FQAN                     | EMAIL |
+---------+--------------------+-------------------------------------------------------------------------------------------------+--------------------------+-------+
|  890752 | fermilab           | /DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Brian P. Bockelman/CN=UID&#58;bbockelm                      | /fermilab                | NULL  |
| 1139181 | fermilab-clouduser | /DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Brian P. Bockelman/CN=UID&#58;bbockelm                      | /fermilab/Role=CloudUser | NULL  |
| 1435211 | fermilab           | /DC=gov/DC=fnal/O=Fermilab/OU=Robots/CN=fifegrid/CN=batch/CN=Brian P. Bockelman/CN=UID&#58;bbockelm | /fermilab                | NULL  |
| 1440911 | fermilab-analysis  | /DC=gov/DC=fnal/O=Fermilab/OU=People/CN=Brian P. Bockelman/CN=UID&#58;bbockelm                      | /fermilab/Role=Analysis  | NULL  |
| 1440921 | fermilab-analysis  | /DC=gov/DC=fnal/O=Fermilab/OU=Robots/CN=fifegrid/CN=batch/CN=Brian P. Bockelman/CN=UID&#58;bbockelm | /fermilab/Role=Analysis  | NULL  |
| 1447802 | fermilab-clouduser | /DC=gov/DC=fnal/O=Fermilab/OU=Robots/CN=fifegrid/CN=batch/CN=Brian P. Bockelman/CN=UID&#58;bbockelm | /fermilab/Role=CloudUser | NULL  |
+---------+--------------------+-------------------------------------------------------------------------------------------------+--------------------------+-------+
6 rows in set (0.13 sec)

I also did set up a test GUMS server (<a href='https&#58;//fermicloud008.fnal.gov&#58;8443/gums' target='_blank' rel='nofollow'>https&#58;//fermicloud008.fnal.gov&#58;8443/gums</a>) with minimal config.

Using default config ( and adding 2 user groups),  I can do the mapping only as an admin

However… when in the hostToGroupMapping, I change

cn=&#39;*/?*.fnal.gov&#39;/&#62;

to

dn=&#39;(/*=*)+/CN=*/?*.fnal.gov(/CN=[0-9]+)?, *.fnal.gov&#39;/&#62;

I can do mapping as both admin and non-admin

Why does this have any effect on who can map? Note the Service DN I use here is /DC=org/DC=doegrids/OU=Services/CN=fermigridosg1.fnal.gov, which satisfies both the above criteria.. Feel free to play around with GUMS config on fermicloud008 ( you have root access there and also GUMS admin access with your KCA DN)
</div><script type='text/javascript'>
        $('#show_1798980003').click(function() {
            $('#detail_1798980003').slideDown("normal");
            $('#show_1798980003').hide();
            $('#hide_1798980003').show();
        });
        $('#hide_1798980003').click(function() {
            $('#detail_1798980003').slideUp();
            $('#hide_1798980003').hide();
            $('#show_1798980003').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23391#1421255380'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-14T17:09:40+00:00">Jan 14, 2015 05:09 PM UTC</time> by <b>echism</b><a class="anchor" name="1421255380">&nbsp;</a></div><pre>Hey Neha,

What were your findings?

Thank you.</pre></div><div class='update_description'><i onclick="document.location='23391#1421168662'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-13T17:04:22+00:00">Jan 13, 2015 05:04 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1421168662">&nbsp;</a></div><pre>Hi GOC
Sorry for my absolute silence on updating this ticket. I have been debugging the issue and believe have reason as to why it happens.
Will post my findings later today

- Neha</pre></div><div class='update_description'><i onclick="document.location='23391#1421087881'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-12T18:38:01+00:00">Jan 12, 2015 06:38 PM UTC</time> by <b>echism</b><a class="anchor" name="1421087881">&nbsp;</a></div><pre>Neha,

Please update this.

Thank you</pre></div><div class='update_description'><i onclick="document.location='23391#1420481139'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-05T18:05:39+00:00">Jan 5, 2015 06:05 PM UTC</time><a class="anchor" name="1420481139">&nbsp;</a></div><pre>Neha,

Do you have an update on this. Were you able to replicate the production problem on the test instances?

Cheers,

Edgar
OSG Software

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Edgar Mauricio Fajardo Hernandez 2020</pre></div><div class='update_description'><i onclick="document.location='23391#1420220418'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-02T17:40:18+00:00">Jan 2, 2015 05:40 PM UTC</time> by <b>echism</b><a class="anchor" name="1420220418">&nbsp;</a></div><pre>Hello everyone,

Where are we on this?

Thank you</pre></div><div class='update_description'><i onclick="document.location='23391#1419443694'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-24T17:54:54+00:00">Dec 24, 2014 05:54 PM UTC</time> by <b>echism</b><a class="anchor" name="1419443694">&nbsp;</a></div><pre>Neha,

That is how I originally thought that worked. Please keep us posted.

Thank you</pre></div><div class='update_description'><i onclick="document.location='23391#1418932777'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-18T19:59:37+00:00">Dec 18, 2014 07:59 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1418932777">&nbsp;</a></div><pre>Hi Carl - sorry for delay in response.
Answer to both your questions is &#39;yes&#39;.
Update from my side is&#58;
I setup a test gums server ( with minimal config) but behavior I am observing there is different from what I observe in production instance.
On the test instance, I am able to perform the mapping only as an admin user. As non-admin it just doesn&#39;t work, no matter whether I come in with KCA or Digicert and yes, access is set to &#39;read all&#39; for the groups I have in the config.

I want to spend some more time looking in to this myself. This is reason I haven&#39;t yet asked Brian to look in to it further.

- Neha</pre></div><div class='update_description'><i onclick="document.location='23391#1418928698'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-18T18:51:38+00:00">Dec 18, 2014 06:51 PM UTC</time> by <b>echism</b><a class="anchor" name="1418928698">&nbsp;</a></div><pre>Hello,

Is there anything new on this?

Thank you</pre></div><div class='update_description'><i onclick="document.location='23391#1418689146'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-16T00:19:06+00:00">Dec 16, 2014 12:19 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1418689146">&nbsp;</a></div><pre>Ok, so, the groups with &#39;read all&#39; access are both on production and your test VM, right?

Can you confirm that the non-admin user DNs actually a member of at least one of those groups?  (as opposed to none at all)

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='23391#1418684230'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-15T22:57:10+00:00">Dec 15, 2014 10:57 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1418684230">&nbsp;</a></div><pre>Hi Carl

The access field for all groups (except admins and banned) is set to &#39;read all&#39; in all our GUMS instances.

I set up a test GUMS server with minimal config (pulling in users only from fermilab VO)  to troubleshoot this further.
Mapping behavior I am observing on this node is different than what I observe on production node.

On this test node, I can do the mapping as long as cert loaded in browser has admin access. Both KCA and Digicert CA issued certs work fine.

Coming in as non-admin user (with  KCA and Digicert certificate) , I get the &#34;Error mapping grid identity&#58; You are not authorized to perform this function. Contact your gums administrator if access is needed.&#34; error.

[root@fermicloud008 ~]# rpm -qa | grep gums
gums-client-1.3.18.009-24.osg31.el6.noarch
osg-gums-config-58-3.osg31.el6.noarch
gums-service-1.3.18.009-24.osg31.el6.noarch
osg-gums-1.0.0-2.osg.el6.noarch
gums-1.3.18.009-24.osg31.el6.noarch
[root@fermicloud008 ~]#

Atleast this failure more is more consistent than what we observe in production.

- Neha

On Dec 11, 2014, at 1&#58;44 PM, Open Science Grid FootPrints &#60;osg@....&#60;mailto&#58;osg@....&#62;&#62; wrote&#58;

[Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='23391#1418327096'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-11T19:44:56+00:00">Dec 11, 2014 07:44 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1418327096">&nbsp;</a></div><pre>Thanks Marco,

That is the error message I was referring to (it looks like the same one that&#39;s in Neha&#39;s original comment).  And both of the error messages you mention come from AuthorizationDeniedException, which as far as I can tell only happens in that one spot where the &#39;if&#39; condition I mentioned fails.

<font color='#7F7E6F'>&#62; I (and anyone with the DigiCert cert) can map also other users and am not an admin.</font>
<font color='#7F7E6F'>&#62; So I guess it could be hasReadAllAccess the condition used.</font>

Ah, sounds like that&#39;s probably it then.  (Since it looks like the default setting is only to allow &#34;read self&#34;.)

On the User Groups page (https&#58;//gums_server&#58;8443/gums/userGroups.jsp), each group lists a &#34;GUMS Access&#58;&#34; field, which should be one of &#34;write&#34;, &#34;read all&#34;, or &#34;read self&#34;.  For me, the &#34;admins&#34; group has &#34;write&#34; and everything else is &#34;read self&#34;.  Can you check to see if there are any groups for you with &#34;read all&#34; access?

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='23391#1418321321'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-11T18:08:41+00:00">Dec 11, 2014 06:08 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1418321321">&nbsp;</a></div><pre>Hi Carl,
I (and anyone with the DigiCert cert) can map also other users and am not an admin.
So I guess it could be hasReadAllAccess the condition used.

The error message I get on the web page is actually different (I don&#39;t have access to the logs)&#58;
&#34;Error mapping grid identity&#58; You are not authorized to perform this function. Contact your gums administrator if access is needed.&#34;

Another page giving error&#58;
https&#58;//gums_server&#58;8443/gums/map_account.jsp?accountName=snoplus
&#34;Error mapping account&#58; You are not authorized to perform this function. Contact your gums administrator if access is needed.&#34;

The message seem to come from AuthorizationDeniedException (AuthorizationDeniedException.java)
Cought by the asp page (map_grid_identity.jsp, ...)

Neha, maybe you can see if there is more in the log file.

Carl, as I said above it must be something more than entering the wrong DN in the form field. Since this difference in behavior is also with the mapping of a VO (generation of map file).

Thanks,
Marco</pre></div><div class='update_description'><i onclick="document.location='23391#1418320678'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-11T17:57:58+00:00">Dec 11, 2014 05:57 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1418320678">&nbsp;</a></div><pre>Based on what I see here&#58;

<a href='https&#58;//github.com/bbockelm/gums/blob/gums-1.4/gums-core/src/main/java/gov/bnl/gums/userGroup/UserGroup.java#L36' target='_blank' rel='nofollow'>https&#58;//github.com/bbockelm/gums/blob/gums-1.4/gums-core/src/main/java/gov/bnl/gums/userGroup/UserGroup.java#L36</a>

it looks like the only valid access types are&#58; &#34;write&#34;, &#34;read all&#34;, or &#34;read self&#34; -- I don&#39;t see a setting that has less access than ReadSelfAccess ... So I think that rules out #2.

But if you do indeed get the failures with the KCA cert even when the same DN is entered for the user DN, there could be something broken about the currentUser().compareDn(userDN)==0) check...  Anyway, let me know.

Carl</pre></div><div class='update_description'><i onclick="document.location='23391#1418318674'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-11T17:24:34+00:00">Dec 11, 2014 05:24 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1418318674">&nbsp;</a></div><pre>Ok, thanks!

So, from that page (map_grid_identity_form.jsp), it looks like the 3 inputs&#58;

host = DN (Distinguished Name) for service
DN = DN (Distinguished Name) for user
FQAN = VOMS FQAN for user

eventually get translated to a call to mapUserNonCached(String hostname, String userDN, String fqan)

(here&#58; <a href='https&#58;//github.com/bbockelm/gums/blob/gums-1.4/gums-core/src/main/java/gov/bnl/gums/admin/GUMSAPIImpl.java#L496' target='_blank' rel='nofollow'>https&#58;//github.com/bbockelm/gums/blob/gums-1.4/gums-core/src/main/java/gov/bnl/gums/admin/GUMSAPIImpl.java#L496</a>)

and, based on your error message (which comes from an AuthorizationDeniedException), this condition (2 lines into the function) ends up being false&#58;

if ( (hasReadSelfAccess(currentUser()) && currentUser().compareDn(userDN)==0) || hasReadAllAccess(currentUser(), hostname)) {

So, Neha, to answer your earlier question, probably the mapping always works admins, assuming that for an admin hasReadAllAccess(user,hostname) is always true.

Possible explanations for the KCA / Digicert discrepancy&#58;

1. your Digicert user has ReadAllAccess for the host in question but the KCA one does not

2. your Digicert user has ReadSelfAccess but the KCA one does not

3. the user DN you entered matches your Digicert DN but not your KCA DN

I&#39;d guess it&#39;s #3, but any of those would explain it.

Can you confirm the user DN you&#39;re entering matches your KCA DN?

Carl</pre></div><div class='update_description'><i onclick="document.location='23391#1418257014'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-11T00:16:54+00:00">Dec 11, 2014 12:16 AM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1418257014">&nbsp;</a></div><pre>This one&#58;
https&#58;//gums_host&#58;8443/gums/map_grid_identity_form.jsp

You&#39;ll have to use your GUMS server because the FNAL one is accessible only form inside.
Thanks,
Marco</pre></div><div class='update_description'><i onclick="document.location='23391#1418246923'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-10T21:28:43+00:00">Dec 10, 2014 09:28 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1418246923">&nbsp;</a></div><pre>Marco / Neha, which page are you using to check the mapping?

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='23391#1418230290'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-10T16:51:30+00:00">Dec 10, 2014 04:51 PM UTC</time> by <b>Tim Theisen</b><a class="anchor" name="1418230290">&nbsp;</a></div><pre>Assigning to Carl Edquist</pre></div><div class='update_description'><i onclick="document.location='23391#1418155129'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-09T19:58:49+00:00">Dec 9, 2014 07:58 PM UTC</time> by <b>echism</b><a class="anchor" name="1418155129">&nbsp;</a></div><pre>I&#39;m adding the software team to this ticket

Thank you</pre></div><div class='update_description'><i onclick="document.location='23391#1417797852'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-05T16:44:12+00:00">Dec 5, 2014 04:44 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1417797852">&nbsp;</a></div><pre>Somehow the ticket updates got merged together. The part about the example was from me. Marco</pre></div><div class='update_description'><i onclick="document.location='23391#1417797596'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-05T16:39:56+00:00">Dec 5, 2014 04:39 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1417797596">&nbsp;</a></div><pre>This issue happens when using GUMS Admin Interface to perform a mapping as non-root user with KCA issued user cert loaded in browser

- Neha


No, checking a mapping.
E.g. See on which username this DN+FQAN is mapped to on this server. Or list all the DNs in a VO.

Here is an example. I&#39;m a regular user (no admin), Neha is an admin. We both have x509 certificates from Digicert and from FNAL KCA.
There are 4 combinations&#58;
1. Neha performs admin actions with x509 from Digicert - works
2. Neha performs admin actions with x509 from FNAL KCA - works
3. I check a mapping with x509 from Digicert - works
4. I check a mapping with x509 from FNAL KCA - Does NOT work

I&#39;m not a special case (here &#58;) - Any user with  x509 from FNAL KCA cannot check mappings as well.

4 should work as well and we&#39;d like to troubleshoot why it does not and fix it.</pre></div><div class='update_description'><i onclick="document.location='23391#1417795824'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-05T16:10:24+00:00">Dec 5, 2014 04:10 PM UTC</time> by <b>echism</b><a class="anchor" name="1417795824">&nbsp;</a></div><pre>OK, I was confused because I thought you were adding a mapping. That&#39;s not the case?</pre></div><div class='update_description'><i onclick="document.location='23391#1417642670'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-03T21:37:50+00:00">Dec 3, 2014 09:37 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1417642670">&nbsp;</a></div><pre>Hi
I&#39;ll be setting up a simple GUMS instance for Brian to look into this issue.
- Neha</pre></div><div class='update_description'><i onclick="document.location='23391#1417640244'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-03T20:57:24+00:00">Dec 3, 2014 08:57 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1417640244">&nbsp;</a></div><pre>Hi Elizabeth,
the instance is only accessible from within Fermilab.
Usually admins are the only one able to edit but valid users can verify the mapping (e.g. normally hosts are not admin).
Thank you,
Marco</pre></div><div class='update_description'><i onclick="document.location='23391#1417639326'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-03T20:42:06+00:00">Dec 3, 2014 08:42 PM UTC</time> by <b>echism</b><a class="anchor" name="1417639326">&nbsp;</a></div><pre>Neha,

I thought only administrators were allowed to perform that function. Where is your gums instance? Is it world accessible?

Thank you</pre></div><div class='update_description'><i onclick="document.location='23391#1417558084'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-02T22:08:04+00:00">Dec 2, 2014 10:08 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1417558084">&nbsp;</a></div><pre>Hi OSG Software

While trying to perform a DN+FQAN-&#62; username mapping using &#39;Map Grid Identity&#39; form on GUMS (1.3.18) web interface,  following behavior is observed&#58;

As a user who is also a GUMS admin,  GUMS lets one do this mapping with both KCA and Digicert CA issued certs loaded in the browser

As a non-admin user, GUMS lets one do this mapping *only* with Digicert CA issued cert loaded in browser..
In case of KCA certificate, user gets following error

&#34;Error mapping grid identity&#58; You are not authorized to perform this function. Contact your gums administrator if access is needed.&#34;

Both the KCA and Digicert CA issued cert DNs are in the GUMS DB

It doesn&#39;t seem like KCA issue, since coming in as an admin , lookup works fine.

The cert and crl files for Fermi KCA are present on GUMS server nodes&#58;

[root@fg5x2 certificates]# ll FNAL-SLCS.*
-rw-r--r-- 1 root root 41 Jun 30 14&#58;33 FNAL-SLCS.crl_url
-rw-r--r-- 1 root root 389 Jun 30 14&#58;33 FNAL-SLCS.info
-rw-r--r-- 1 root root 651 Jun 30 14&#58;33 FNAL-SLCS.namespaces
-rw-r--r-- 1 root root 1395 Jun 30 14&#58;33 FNAL-SLCS.pem
-rw-r--r-- 1 root root 409 Jun 30 14&#58;33 FNAL-SLCS.signing_policy
[root@fg5x2 certificates]#

[root@fg6x2 certificates]# ll FNAL-SLCS.*
-rw-r--r-- 1 root root 41 Jun 30 14&#58;33 FNAL-SLCS.crl_url
-rw-r--r-- 1 root root 389 Jun 30 14&#58;33 FNAL-SLCS.info
-rw-r--r-- 1 root root 651 Jun 30 14&#58;33 FNAL-SLCS.namespaces
-rw-r--r-- 1 root root 1395 Jun 30 14&#58;33 FNAL-SLCS.pem
-rw-r--r-- 1 root root 409 Jun 30 14&#58;33 FNAL-SLCS.signing_policy
[root@fg6x2 certificates]#

To debug this further, I need to know more about how GUMS authorizes  one to do this lookup? Is the logic different for whether one is GUMS admin or not?

<div id='show_1445171783' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1445171783'>Any hints are much appreciated

Thanks!
- Neha
</div><script type='text/javascript'>
        $('#show_1445171783').click(function() {
            $('#detail_1445171783').slideDown("normal");
            $('#show_1445171783').hide();
            $('#hide_1445171783').show();
        });
        $('#hide_1445171783').click(function() {
            $('#detail_1445171783').slideUp();
            $('#hide_1445171783').hide();
            $('#show_1445171783').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F23391">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 23391});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
