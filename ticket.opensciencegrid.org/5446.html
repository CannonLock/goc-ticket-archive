<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[5446] dCache - DZero Problems using Opportunistic Storage at Purdue</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=5446" method="post">
<div class="page-header">
    <h3><span class="muted">5446</span> / dCache - DZero Problems using Opportunistic Storage at Purdue</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Neha sharma</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Neha to update</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2008-09-03</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Kyle Gross <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">Neha Sharma <span class="muted"> / OSG Storage Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/5446", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='5446#1220371835'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-09-02T16:10:35+00:00">Sep 2, 2008 04:10 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1220371835">&nbsp;</a></div><pre>Sorry for all these emails. The same token id should be fine (admin
interface shows actually space token for the whole space even in &#34;ls file
space tokens&#34; for files), the problem is that the file is in srm database
and the subsequent attempt to copy it is failing.

Tanya</pre></div><div class='update_description'><i onclick="document.location='5446#1219864915'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-08-27T19:21:55+00:00">Aug 27, 2008 07:21 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1219864915">&nbsp;</a></div><pre>Any updates for this ticket?</pre></div><div class='update_description'><i onclick="document.location='5446#1219432134'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-08-22T19:08:54+00:00">Aug 22, 2008 07:08 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1219432134">&nbsp;</a></div><pre>Updating NAD</pre></div><div class='update_description'><i onclick="document.location='5446#1219259431'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-08-20T19:10:31+00:00">Aug 20, 2008 07:10 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1219259431">&nbsp;</a></div><pre>Hi Tanya,

Attached is part of the srm logs.

For an unsuccessful srmcp, There&#39;s a java excepton in SrmSpaceManager&#58;
java.sql.SQLException&#58; found two records with pnfsPath=/pnfs/rcac.purdue.edu/data/VO/dzero/testfile2
while a successful srmcp doesn&#39;t have that.

srm log of a successful srmcp attempt&#58;
#####################################
08/19 17&#58;39&#58;07 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; updateLinkGroups()... at 1219181947885
08/19 17&#58;39&#58;07 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; updateLinkGroups() received reply
08/19 17&#58;39&#58;07 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; updateLinkGroups() number of
poolLinkGroupInfos is 1
08/19 17&#58;39&#58;07 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; updateLinkGroupAuthorizationFile
08/19 17&#58;39&#58;07 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; updateLinkGroups&#58; received LinkGroupInfo&#58;
name&#58;OSG_Opportunistic_Pools-link-group onlineAllowed&#58;true nearlineAllowed&#58;true replicaAllowed&#58;true
outputAllowed&#58;false custodialAllowed&#58;true avalSpaceInBytes&#58;2893541622005
08/19 17&#58;39&#58;07 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; UpdateLinkGroupInfo(
linkGroup=OSG_Opportunistic_Pools-link-group, onlineAllowed =true, nearlineAllowed =true, replicaAllowed
=true, outputAl
lowed =false, custodialAllowed =true, freeSpace=2893541622005
08/19 17&#58;39&#58;07 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; Executing SELECT * FROM srmlinkgroup
WHERE  name = ? FOR UPDATE ?=OSG_Opportunistic_Pools-link-group
08/19 17&#58;39&#58;07 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; executing statement&#58; SELECT VOGroup,VORole
FROM srmlinkgroupvos WHERE linkGroupId=? ?=0
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; Message  arrived&#58;
PnfsId=0003000000000000000025B0;StorageInfo=size=0;new=true;stored=false;sClass=opportunistic&#58;open
sciencegrid;cClass=-;hsm=
osm;accessLatency=ONLINE;retentionPolicy=REPLICA;path=/pnfs/rcac.purdue.edu/data/VO/dzero/testfile2;Sto
reName=opportunistic;store=opportunistic;group=opensciencegrid;bfid=&#60;Unknown&#62;;;PoolName=&#60;unkno
wn&#62; from [&#62;GFTP-dcache-05-Unknown-219@gridftp-dcache-05Domain&#58;*@gridftp-dcache-
05Domain&#58;*@dCacheDomain]
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;
selectPool(PnfsId=0003000000000000000025B0;StorageInfo=size=0;new=true;stored=false;sClass=opportun
<div id='show_1903447193' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1903447193'>istic&#58;opensciencegrid;cClass=-;hsm=osm;acc
essLatency=ONLINE;retentionPolicy=REPLICA;path=/pnfs/rcac.purdue.edu/data/VO/dzero/testfile2;StoreName
=opportunistic;store=opportunistic;group=opensciencegrid;bfid=&#60;Unknown&#62;;;PoolName=&#60;unknown&#62;)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; selectPool&#58;
getFile(/pnfs/rcac.purdue.edu/data/VO/dzero/testfile2)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; java.sql.SQLException&#58; found two records with
pnfsPath=/pnfs/rcac.purdue.edu/data/VO/dzero/testfile2
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;         at
diskCacheV111.services.space.ManagerV2.getFile(ManagerV2.java&#58;2035)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;         at
diskCacheV111.services.space.ManagerV2.selectPool(ManagerV2.java&#58;3308)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;         at
diskCacheV111.services.space.ManagerV2.processMessage(ManagerV2.java&#58;2272)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;         at
diskCacheV111.services.space.ManagerV2.access$000(ManagerV2.java&#58;101)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;         at
diskCacheV111.services.space.ManagerV2$1.run(ManagerV2.java&#58;2240)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;         at
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java&#58;650)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;         at
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java&#58;675)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;         at java.lang.Thread.run(Thread.java&#58;595)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; selectPool&#58; file is not found, no prior
reservations for this file
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; just forwarding the message to PoolManager
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; reply is not required, finished processing
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; messageToForward,  arrived&#58;
type=diskCacheV111.vehicles.PoolMgrSelectWritePoolMsg value=(19)=No write pools configured for
&#60;opportunistic&#58;ope
nsciencegrid@osm&#62; from [&#62;PoolManager@dCacheDomain&#58;*@dCacheDomain] going to [*@srm-
dcacheDomain&#58;&#62;SrmSpaceManager@srm-dcacheDomain&#58;*@dCacheDomain&#58;*@gridftp-dcache-
05Domain&#58;GFTP-dcache-05-Unknown-219@
gridftp-dcache-05Domain]false
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; selectPool((19)=No write pools configured for
&#60;opportunistic&#58;opensciencegrid@osm&#62;)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; selectPool&#58;
getFile(/pnfs/rcac.purdue.edu/data/VO/dzero/testfile2)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; java.sql.SQLException&#58; found two records with
pnfsPath=/pnfs/rcac.purdue.edu/data/VO/dzero/testfile2
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;         at
diskCacheV111.services.space.ManagerV2.getFile(ManagerV2.java&#58;2035)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;         at
diskCacheV111.services.space.ManagerV2.selectPool(ManagerV2.java&#58;3308)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;         at
diskCacheV111.services.space.ManagerV2.processMessageToForward(ManagerV2.java&#58;2347)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;         at
diskCacheV111.services.space.ManagerV2$2.run(ManagerV2.java&#58;2332)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;         at
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java&#58;650)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;         at
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java&#58;675)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;         at java.lang.Thread.run(Thread.java&#58;595)
08/19 17&#58;39&#58;08 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; selectPool&#58; file is not found, no prior
reservations for this file
08/19 17&#58;39&#58;16 Cell(SRM-dcache@srm-dcacheDomain) &#58; PutRequestHandler error&#58; copy request state changed
to Failed
#####################################

srm log of an unsuccessful srmcp attempt&#58;
#####################################
08/20 09&#58;54&#58;40 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; executing statement&#58; INSERT INTO
srmspacefile (id,vogroup,vorole,spacereservationid,sizeinbytes,creationtime,lifetime,pnfspath,pnfsid,state)
VALUES  (?,?,?,?,?,?,?,?,NULL,?)
08/20 09&#58;54&#58;40 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; Sending reply
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; Message  arrived&#58;
PnfsId=000300000000000000002618;StorageInfo=size=0;new=true;stored=false;sClass=opportunistic&#58;open
sciencegrid;cClass=-;hsm=
osm;accessLatency=ONLINE;retentionPolicy=REPLICA;path=/pnfs/rcac.purdue.edu/data/VO/dzero/testfile.22;S
toreName=opportunistic;store=opportunistic;group=opensciencegrid;bfid=&#60;Unknown&#62;;;PoolName=&#60;unk
nown&#62; from [&#62;GFTP-dcache-06-Unknown-281@gridftp-dcache-06Domain&#58;*@gridftp-dcache-
06Domain&#58;*@dCacheDomain]
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;
selectPool(PnfsId=000300000000000000002618;StorageInfo=size=0;new=true;stored=false;sClass=opportun
istic&#58;opensciencegrid;cClass=-;hsm=osm;acc
essLatency=ONLINE;retentionPolicy=REPLICA;path=/pnfs/rcac.purdue.edu/data/VO/dzero/testfile.22;StoreNam
e=opportunistic;store=opportunistic;group=opensciencegrid;bfid=&#60;Unknown&#62;;;PoolName=&#60;unknown&#62;)
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; selectPool&#58;
getFile(/pnfs/rcac.purdue.edu/data/VO/dzero/testfile.22)
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; selectPool&#58; file is not null, calling
updateSpaceFile()
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; executing statement&#58; SELECT * FROM
srmspacefile WHERE  id=?       FOR UPDATE ,?=20007
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; Executing&#58; SELECT * FROM srmspace where
id=?,?=10003
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; selectPool&#58; found linkGroup =
OSG_Opportunistic_Pools-link-group, forwarding message
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; reply is not required, finished processing
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; messageToForward,  arrived&#58;
type=diskCacheV111.vehicles.PoolMgrSelectWritePoolMsg
value=PnfsId=000300000000000000002618;StorageInfo=size=0;ne
w=true;stored=false;sClass=opportunistic&#58;opensciencegrid;cClass=-
;hsm=osm;accessLatency=ONLINE;retentionPolicy=REPLICA;SpaceToken=10003;path=/pnfs/rcac.purdue.edu/
data/VO/dzero/testfile.22;StoreNam
e=opportunistic;store=opportunistic;group=opensciencegrid;bfid=&#60;Unknown&#62;;;PoolName=higgs_1 from
[&#62;PoolManager@dCacheDomain&#58;*@dCacheDomain] going to [*@srm-dcacheDomain&#58;&#62;SrmSpaceManager@srm-
dcacheDo
main&#58;*@dCacheDomain&#58;*@gridftp-dcache-06Domain&#58;GFTP-dcache-06-Unknown-281@gridftp-dcache-
06Domain]false
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;
selectPool(PnfsId=000300000000000000002618;StorageInfo=size=0;new=true;stored=false;sClass=opportun
istic&#58;opensciencegrid;cClass=-;hsm=osm;acc
essLatency=ONLINE;retentionPolicy=REPLICA;SpaceToken=10003;path=/pnfs/rcac.purdue.edu/data/VO/dzero
/testfile.22;StoreName=opportunistic;store=opportunistic;group=opensciencegrid;bfid=&#60;Unknown&#62;;;Poo
lName=higgs_1)
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; selectPool&#58;
getFile(/pnfs/rcac.purdue.edu/data/VO/dzero/testfile.22)
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; selectPool&#58; file is not null, calling
updateSpaceFile()
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; executing statement&#58; SELECT * FROM
srmspacefile WHERE  id=?       FOR UPDATE ,?=20007
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; Executing&#58; SELECT * FROM srmspace where
id=?,?=10003
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; messageToForward,  arrived&#58;
type=diskCacheV111.vehicles.PoolAcceptFileMessage value=Pool=higgs_1 from [&#62;GFTP-dcache-06-Unknown-
281@gridftp-dc
ache-06Domain&#58;*@gridftp-dcache-06Domain&#58;*@dCacheDomain] going to
[&#62;SrmSpaceManager@local&#58;higgs_1@local]false
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;
transferToBeStarted(000300000000000000002618)
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; Executing&#58; SELECT * FROM srmspace where
id=?,?=10003
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; transferToBeStarted(), set AL to ONLINE RP to
REPLICA
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; messageToForward,  arrived&#58;
type=diskCacheV111.vehicles.PoolAcceptFileMessage value=Pool=higgs_1 from
[&#62;higgs_1@higgsDomain&#58;*@higgsDomain&#58;*@d
CacheDomain] going to [*@dCacheDomain&#58;*@srm-dcacheDomain&#58;&#62;SrmSpaceManager@srm-
dcacheDomain&#58;*@dCacheDomain&#58;*@gridftp-dcache-06Domain&#58;GFTP-dcache-06-Unknown-281@gridftp-
dcache-06Domain]false
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;
transferStarted(000300000000000000002618,true)
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; executing statement&#58; SELECT * FROM
srmspacefile WHERE  pnfsid=?   FOR UPDATE ,?=000300000000000000002618
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; executing statement&#58; SELECT * FROM
srmspace WHERE  id = ? FOR UPDATE ,?=10003
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; messageToForward,  arrived&#58;
type=diskCacheV111.vehicles.DoorTransferFinishedMessage value= from
[&#62;higgs_1@higgsDomain&#58;*@higgsDomain&#58;*@dCacheD
omain] going to [*@dCacheDomain&#58;*@srm-dcacheDomain&#58;&#62;SrmSpaceManager@srm-
dcacheDomain&#58;*@dCacheDomain&#58;*@gridftp-dcache-06Domain&#58;GFTP-dcache-06-Unknown-281@gridftp-
dcache-06Domain]false
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58;
transferFinished(000300000000000000002618,true)
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; executing statement&#58; SELECT * FROM
srmspacefile WHERE  pnfsid=?   FOR UPDATE ,?=000300000000000000002618
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; executing statement&#58; SELECT * FROM
srmspace WHERE  id = ? FOR UPDATE ,?=10003
08/20 09&#58;54&#58;42 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; executing statement&#58; SELECT * FROM
srmlinkgroup WHERE  id = ? FOR UPDATE,?=0
08/20 09&#58;54&#58;44 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; Message  arrived&#58;  from [&#62;SRM-dcache@srm-
dcacheDomain]
08/20 09&#58;54&#58;44 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; executing statement&#58; SELECT * FROM
srmspacefile WHERE  pnfsId = &#39;000300000000000000002618&#39;
08/20 09&#58;54&#58;44 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; Sending reply
08/20 09&#58;54&#58;44 Cell(SRM-dcache@srm-dcacheDomain) &#58; PutRequestHandler error&#58; copy request state changed
to Done
08/20 09&#58;54&#58;59 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; updateLinkGroups()... at 1219240499194
08/20 09&#58;54&#58;59 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; updateLinkGroups() received reply
08/20 09&#58;54&#58;59 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; updateLinkGroups() number of
poolLinkGroupInfos is 1
08/20 09&#58;54&#58;59 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; updateLinkGroupAuthorizationFile
08/20 09&#58;54&#58;59 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; updateLinkGroups&#58; received LinkGroupInfo&#58;
name&#58;OSG_Opportunistic_Pools-link-group onlineAllowed&#58;true nearlineAllowed&#58;true replicaAllowed&#58;true
outputAllowed&#58;false custodialAllowed&#58;true avalSpaceInBytes&#58;2893541622005
08/20 09&#58;54&#58;59 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; UpdateLinkGroupInfo(
linkGroup=OSG_Opportunistic_Pools-link-group, onlineAllowed =true, nearlineAllowed =true, replicaAllowed
=true, outputAl
lowed =false, custodialAllowed =true, freeSpace=2893541622005
08/20 09&#58;54&#58;59 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; Executing SELECT * FROM srmlinkgroup
WHERE  name = ? FOR UPDATE ?=OSG_Opportunistic_Pools-link-group
08/20 09&#58;54&#58;59 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; executing statement&#58; SELECT VOGroup,VORole
FROM srmlinkgroupvos WHERE linkGroupId=? ?=0
08/20 09&#58;55&#58;29 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; updateLinkGroups()... at 1219240529241
08/20 09&#58;55&#58;29 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; updateLinkGroups() received reply
08/20 09&#58;55&#58;29 Cell(SrmSpaceManager@srm-dcacheDomain) &#58; updateLinkGroups() number of
poolLinkGroupInfos is 1
#####################################
Hi,
I have realized that the absence of VO in LinkAuthorization should not
prevent from writing to the pool when the space token is known, so this
should not be the problem.

Configuration looks absolutely fine, and I was able to  &#34;match&#34; higgs_1 pool
for
LinkGroup 	                            I/O Direction 	Store
dCache 	Net 	Protocol

OSG_Opportunistic_Pools-link-group      Write
opportunistic&#58;opensciencegrid@osm   *    131.225.107.156    */*

using <a href='http&#58;//dcache.rcac.purdue.edu&#58;2288/poolInfo/' target='_blank' rel='nofollow'>http&#58;//dcache.rcac.purdue.edu&#58;2288/poolInfo/</a>

So it would be interesting to see srm log for successful and unsuccessful
attempt.

Thanks,
Tanya

-----Original Message-----
From&#58; Fengping Hu [mailto&#58;fhu@....]
Sent&#58; Wednesday, August 20, 2008 9&#58;27 AM
To&#58; Preston Smith
Cc&#58; Abhishek Singh Rana; Joel Snow; Andrew Baranovski; Ted Hesselroth; Tanya
Levshina
Subject&#58; Re&#58; Wrt Opportunistic Storage at Purdue

Hi Ted,

We&#39;ve tried the space token ourselves in different ways. They all worked.
But when dzero user do it, they got &#34;No write pools configured&#34; error as
quoted&#58;
I did &#58;
srmcp -srm_protocol_version=2 -debug -space_token=10010
-x509_user_cert=/home/sam/private/gsi/samserver.cert
-x509_user_key=/home/sam/private/gsi/samserver.key

-x509_user_trusted_certificates=/home/sam/private/gsi/jim_gridftp/certificat
es
-use_proxy=false file&#58;////home/sam/logFileStats.current
<a href='srm&#58;//dcache.rcac.purdue.edu&#58;8443/srm/managerv2?SFN=/VO/dzero/testfile2' target='_blank' rel='nofollow'>srm&#58;//dcache.rcac.purdue.edu&#58;8443/srm/managerv2?SFN=/VO/dzero/testfile2</a>

and got the same messahe .
org.globus.ftp.exception.ServerException&#58; Server refused performing
the request. Custom message&#58;  (error code 1) [Nested exception
message&#58;  Custom message&#58; Unexpected reply&#58; 451 Operation failed&#58;
Non-null return code from

[&#62;PoolManager@dCacheDomain&#58;*@dCacheDomain&#58;SrmSpaceManager@srm-dcacheDomain&#58;*
@srm-dcacheDomain&#58;*@dCacheDomain]
with error No write pools configured for
&#60;opportunistic&#58;opensciencegrid@osm&#62;].  Nested exception is
org.globus.ftp.exception.UnexpectedReplyCodeException&#58;  Custom
message&#58; Unexpected reply&#58; 451 Operation failed&#58; Non-null return code
from

[&#62;PoolManager@dCacheDomain&#58;*@dCacheDomain&#58;SrmSpaceManager@srm-dcacheDomain&#58;*
@srm-dcacheDomain&#58;*@dCacheDomain]
with error No write pools configured for
&#60;opportunistic&#58;opensciencegrid@osm&#62;

We tried a srmcp as close as possible to be a dzero user by modifying the
mapping of my DN to a dzero user. But we still can&#39;t reproduce the problem.

Here&#39;s the PoolManager.conf that&#39;s related to opportunistic storage&#58;
###################################################
psu create unit -store  opportunistic&#58;opensciencegrid@osm
psu create ugroup opportunistic-store
psu addto ugroup opportunistic-store opportunistic&#58;opensciencegrid@osm
psu create pool higgs_1
psu create pgroup OSG_Opportunistic_Pools
psu addto pgroup OSG_Opportunistic_Pools higgs_1

psu create link OSG_Opportunistic_Pools-link opportunistic-store
world-net any-protocol
psu set link OSG_Opportunistic_Pools-link
-section=OSG_Opportunistic-section -readpref=10 -writepref=10
-cachepref=10 -p2ppref=-1
psu add link OSG_Opportunistic_Pools-link OSG_Opportunistic_Pools

psu create linkGroup OSG_Opportunistic_Pools-link-group
psu addto linkGroup OSG_Opportunistic_Pools-link-group
OSG_Opportunistic_Pools-link
psu set linkGroup custodialAllowed OSG_Opportunistic_Pools-link-group true
psu set linkGroup onlineAllowed OSG_Opportunistic_Pools-link-group true
psu set linkGroup nearlineAllowed OSG_Opportunistic_Pools-link-group true
psu set linkGroup replicaAllowed OSG_Opportunistic_Pools-link-group true
psu set linkGroup outputAllowed OSG_Opportunistic_Pools-link-group false
psu set linkGroup attribute OSG_Opportunistic_Pools-link-group HSM=None

pm set OSG_Opportunistic-section -p2p=4.0  -spacecostfactor=0.0
-cpucostfactor=0.0 -stage-oncost=no
###################################################
Here&#39;s the directory tags&#58;
###################################################
&#58;/pnfs/rcac.purdue.edu/data/VO/dzero$grep &#34;&#34; $(cat &#34;.(tags)()&#34;)
.(tag)(OSMTemplate)&#58;StoreName opportunistic
.(tag)(sGroup)&#58;opensciencegrid
.(tag)(AccessLatency)&#58;ONLINE
.(tag)(RetentionPolicy)&#58;REPLICA
###################################################

Here&#39;s the space reservation&#58;
###################################################
[dcache.rcac.purdue.edu] (SrmSpaceManager) admin &#62; ls
Reservations&#58;
1 voGroup&#58;/dzero voRole&#58;null linkGroupId&#58;0 size&#58;1099511627776
created&#58;Mon Jul 28 17&#58;02&#58;22 EDT 2008 lifetime&#58;31556926000ms
expiration&#58;Tue Jul 28 22&#58;51&#58;08 EDT 2009 descr&#58;Dzero_on_OSG
state&#58;RESERVEDused&#58;0allocated&#58;0
10003 voGroup&#58;/cms voRole&#58;null linkGroupId&#58;0 size&#58;1000 created&#58;Tue Aug
12 13&#58;12&#58;09 EDT 2008 lifetime&#58;1000000000ms  expiration&#58;Sun Aug 24
02&#58;58&#58;49 EDT 2008 descr&#58;uscms state&#58;RESERVEDused&#58;55allocated&#58;0
10010 voGroup&#58;/dzero voRole&#58;null linkGroupId&#58;0 size&#58;1099511627776
created&#58;Wed Aug 13 16&#58;21&#58;41 EDT 2008 lifetime&#58;31556926000ms
expiration&#58;Thu Aug 13 22&#58;10&#58;27 EDT 2009 descr&#58;Dzero_on_OSG_1
state&#58;RESERVEDused&#58;0allocated&#58;0
total number of reservations&#58; 3
total number of bytes reserved&#58; 2199023256552

LinkGroups&#58;
0 Name&#58;OSG_Opportunistic_Pools-link-group FreeSpace&#58;2893541622005
ReservedSpace&#58;2199023256497 VOs&#58; onlineAllowed&#58;true nearlineAllowed&#58;true
replicaAllowed&#58;true onlineAllowed&#58;true custodialAllowed&#58;true
UpdateTime&#58;1219242091274
total number of linkGroups&#58; 1
total number of bytes reservable&#58; 2893541622005
last time all link groups were updated&#58; 1219242091274
[dcache.rcac.purdue.edu] (SrmSpaceManager) admin &#62;
###################################################

Help is really needed at this point.
Thanks!

Fengping Hu
Unix Systems Administrator
Rosen Center for Advanced Computing, Purdue University
email&#58;fhu@.... phone&#58; 765-494-0032

Preston Smith wrote&#58;
We haven&#39;t gotten them to actually work yet.
We can use the space token ourselves, and write to the pool that we
want, but when D0 tries to do so, it fails.

Fengping is trying one or two things more today, but if it doesn&#39;t
succeed, we may need some extra wisdom.

-Preston

On Aug 20, 2008, at 2&#58;00 AM, Abhishek Singh Rana wrote&#58;

Preston, Fengping -

Can you please confirm if D0&#39;s SRM transfers work on the opportunistic
storage area there?

Abhishek

-- On Thu, 07/31/08 9&#58;43pm-0700, Abhishek Singh Rana wrote&#58;

Hi Preston, Fengping -

This is absolutely great! If you like, please keep us posted on D0&#39;s
progress and possible success there.

Thanks,
Abhishek

--
Preston Smith  &#60;psmith@....&#62;
Systems Research Engineer
Rosen Center for Advanced Computing, Purdue University
</div><script type='text/javascript'>
        $('#show_1903447193').click(function() {
            $('#detail_1903447193').slideDown("normal");
            $('#show_1903447193').hide();
            $('#hide_1903447193').show();
        });
        $('#hide_1903447193').click(function() {
            $('#detail_1903447193').slideUp();
            $('#hide_1903447193').hide();
            $('#show_1903447193').show();
        });
        </script></pre></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F5446">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
