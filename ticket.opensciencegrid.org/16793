<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="/">
    <title>[16793] gratia slurm probe reports unrealistic data</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="//netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="https://ticket.opensciencegrid.org/images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="https://ticket.opensciencegrid.org/lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=16793" method="post">
<div class="page-header">
    <h3><span class="muted">16793</span> / gratia slurm probe reports unrealistic data</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Tanya Levshina</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Resource Name</label><div class="controls">Sandhills</div></div><div class="control-group"><label class="control-label">Associated VO</label><div class="controls">HCC</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Tanya Levshina</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">CSC</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2013-09-27</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">CSC <span class="muted"> / OSG Support Centers</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("https://ticket.opensciencegrid.org/attachment/list?id=16793", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="/16793?sort=up&"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="/16793?expandall=true&">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20gratia%20slurm%20probe%20reports%20unrealistic%20data%20ISSUE%3D16793%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='16793#1381514538'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-10-11T18:02:18+00:00">Oct 11, 2013 06:02 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1381514538">&nbsp;</a></div><pre>I&#39;m going to resolve this ticket. If this is still an issue please let me know and I can reopen it.

Thanks,
Chris</pre></div><div class='update_description'><i onclick="document.location='16793#1380130573'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-25T17:36:13+00:00">Sep 25, 2013 05:36 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1380130573">&nbsp;</a></div><pre>Tanya,

Should this issue be resolved ?

Thanks,
Chris</pre></div><div class='update_description'><i onclick="document.location='16793#1379356832'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-16T18:40:32+00:00">Sep 16, 2013 06:40 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1379356832">&nbsp;</a></div><pre>Tanya,

Were the patches you mentioned released with OSG 3.1.23 on the 9/10 or were you referring to the next release after that?
Thanks,
Chris</pre></div><div class='update_description'><i onclick="document.location='16793#1378760468'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-09T21:01:08+00:00">Sep 9, 2013 09:01 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1378760468">&nbsp;</a></div><pre>Hi,

Patches that John Thiltges has provided will be in the next osg release.
Tanya</pre></div><div class='update_description'><i onclick="document.location='16793#1378758901'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-09T20:35:01+00:00">Sep 9, 2013 08:35 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1378758901">&nbsp;</a></div><pre>Hello All,

Has this issue been resolved or are we still missing data (the NULL in user_sec). ?

Thanks,
Chris</pre></div><div class='update_description'><i onclick="document.location='16793#1377806084'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-29T19:54:44+00:00">Aug 29, 2013 07:54 PM UTC</time><a class="anchor" name="1377806084">&nbsp;</a></div><pre>Good question on the timezones. For readability in my earlier example, I used FROM_UNIXTIME() in the query, which converted to local time (CDT). In the probe, I pass the epoch seconds to the Gratia python library, and I think it passes everything along as UTC.

Yes, the patch should work as you described. For the example job, here&#39;s the output from the revised query&#58;

id_job&#58; 1949020
time_start&#58; 1375465950
time_end&#58; 1375595423
wall_time&#58; 87807
acct&#58; grid
user&#58; engage
cpu_user&#58; 80426.0424
cpu_sys&#58; 551.0752

It does appear the numbers line up with expectations. Thank you for your help and patience.

Regards,
John

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Thiltges 819</pre></div><div class='update_description'><i onclick="document.location='16793#1377804731'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-29T19:32:11+00:00">Aug 29, 2013 07:32 PM UTC</time><a class="anchor" name="1377804731">&nbsp;</a></div><pre>John,

thanks for the explanation and especially the example.

One oddity, I see is that you mention putting the start/end times in the probe data
as UTC time.  I&#39;t looks like Gratia (or some common library for the probes) does the
conversion to UTC.  So in Gratia, for job 1949020, it shows
Start - 2013-08-02 17&#58;52&#58;30
End - 2013-08-02 18&#58;51&#58;36
as Gratia has all dates as UTC.
I&#39;m guessing on this.

So, just to make sure I understand your patch (from the email thread), you are now going to sum the Wall and CPU for all
slurm records for a job.  In the case 1949020 will have 3 records summed up before sending 1 record
to Gratia.  You will still net Start and End to determine Wall on each slurm db record.
So for 1949020, Wall = 87807 and CPU = 80426.0414 with the NULL piece being a slurm db issue.
Correct?

John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='16793#1377802570'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-29T18:56:10+00:00">Aug 29, 2013 06:56 PM UTC</time><a class="anchor" name="1377802570">&nbsp;</a></div><pre>Hi John,

On your comments on the CPU vs Wall number type strangeness&#58; I tried to return the values as they are stored in the underlying SLURM accounting database. The database stores job start and end in epoch seconds, and I return the difference as WallDuration. For CPU times, it has a column for seconds, and another column for microseconds, and I return that as a float.

For sandhills job 1949020, here&#39;s the SLURM data&#58;

+---------+---------------------+---------------------+-----------+------------+
| id_job  | job_start           | job_end             | wall_time | user_sec   |
+---------+---------------------+---------------------+-----------+------------+
| 1949020 | 2013-08-02 12&#58;52&#58;30 | 2013-08-02 13&#58;51&#58;36 |      3546 |       NULL |
| 1949020 | 2013-08-02 15&#58;28&#58;33 | 2013-08-02 15&#58;39&#58;20 |       647 |     0.0040 |
| 1949020 | 2013-08-03 01&#58;36&#58;49 | 2013-08-04 00&#58;50&#58;23 |     83614 | 80426.0384 |
+---------+---------------------+---------------------+-----------+------------+

The job was preempted twice and later restarted. The probe reported the WallDuration from the first run (3546s) and the CpuUserDuration from the last run (80426s).

Toward getting it fixed, I&#39;ve made a patch for review by Tanya and company that will address part of the problem&#58; the patched probe reports the total of WallDuration and CPU times for every run of preempted jobs.

The other issue is that we&#39;re missing some data (the NULL in user_sec). I&#39;m hoping to get feedback from the SLURM devs to help resolve it.

Regards,
John

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Thiltges 819</pre></div><div class='update_description'><i onclick="document.location='16793#1377800353'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-29T18:19:13+00:00">Aug 29, 2013 06:19 PM UTC</time><a class="anchor" name="1377800353">&nbsp;</a></div><pre>John,

I&#39;m the one who has written the script to identify the excessive efficiency reporting to Gratia.
Part of this is to take corrective action and remove the bad data from the Gratia summary tables.
What we try to do is understand why a site gets this over/under reported data before making
the corrections.

Based on what you are saying about preempted jobs, I am very reluctant to fix anything in
your case.  This is occurring with both the sandhills and tusker probes.

On an aggregate basis the sandhills probes are not that bad.  These are the only days for
a VO that are excessive.  The threshold on the Efficiency is 1000% not 100% so there may be
more.  The data we see is just plain strange.
+-------------------------------------------+-----------+------------+------+-----------+----------+------------+
| ProbeName                                 | VOName    | EndTime    | Jobs | CPU_Hrs   | Wall_hrs | Efficiency |
+-------------------------------------------+-----------+------------+------+-----------+----------+------------+
| slurm&#58;sandhills-ce1.unl.edu               | hcc       | 2013-07-24 |   51 |       414 |       26 |       1592 |
| slurm&#58;sandhills-ce1.unl.edu               | osg       | 2013-07-24 |   49 |       527 |       15 |       3513 |

We have other sites that are grossly over-reporting cpu or under-reporting wall compared to this.

What I am seeing in the detail Gratia data substantiates maybe what you are saying about preemption.

I ran some more queries on the individual records for some jobs with certain characteristics.
Can you look here and give me some feedback if you can think of anything.
The one thing I find strange in here is that for both CPU numbers is says they are in seconds and
for the Wall the description is NULL.  This has no affect on how Gratia handles the data as it
assumes seconds but it just seems strange.  Also the CPU&#39;s have decimal and Wall is always an
integer.  No big deal.. Just strange.
<a href='http&#58;//home.fnal.gov/' target='_blank' rel='nofollow'>http&#58;//home.fnal.gov/</a>~weigand/tmp/slurm.html

Can you also explain further &#34;I&#39;m working on getting this fixed.&#34;?

Hope this is less confusing to you than me as I am totally baffled.

<div id='show_1580312748' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1580312748'>John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144
</div><script type='text/javascript'>
        $('#show_1580312748').click(function() {
            $('#detail_1580312748').slideDown("normal");
            $('#show_1580312748').hide();
            $('#hide_1580312748').show();
        });
        $('#hide_1580312748').click(function() {
            $('#detail_1580312748').slideUp();
            $('#hide_1580312748').hide();
            $('#show_1580312748').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='16793#1377791805'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-29T15:56:45+00:00">Aug 29, 2013 03:56 PM UTC</time><a class="anchor" name="1377791805">&nbsp;</a></div><pre>Hi Tanya,

I&#39;m working on getting this fixed. At present, I believe this issue is limited to preempted jobs only, and it causes underreporting of wall and CPU times. A WallDuration is reported from one run and CPU durations from another run.

Regards,
John

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Thiltges 819</pre></div><div class='update_description'><i onclick="document.location='16793#1377644745'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-27T23:05:45+00:00">Aug 27, 2013 11:05 PM UTC</time><a class="anchor" name="1377644745">&nbsp;</a></div><pre>Hi Tanya,

The reported efficiency values look reasonable for this cluster.  However, I&#39;d be surprised if these map to an OSG job - what VO does this show up under?

Brian

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Brian Bockelman</pre></div><div class='update_description'><i onclick="document.location='16793#1377642791'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-27T22:33:11+00:00">Aug 27, 2013 10:33 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1377642791">&nbsp;</a></div><pre>Hi,

We have noticed that slurm&#58;tusker-gw1.unl.edu (5314 records) and slurm&#58;sandhills-ce1.unl.edu (1413) probes report jobs with extremely high efficiency. eg (# cores is 1)
+--------------+-----------------+-------------------+
| WallDuration | CpuUserDuration | CpuSystemDuration |
+--------------+-----------------+-------------------+
|          250 |        40444.61 |             39.55 |
+--------------+-----------------+-------------------+

Please let us know how to interpret this data.</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F16793">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="/images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 16793});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
