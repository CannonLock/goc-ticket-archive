<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[34173] Enabling multicore at T2_BR_SPRACE</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=34173" method="post">
<div class="page-header">
    <h3><span class="muted">34173</span> / Enabling multicore at T2_BR_SPRACE</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Jadir Silva</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Associated VO</label><div class="controls">CMS</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GGUS</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Jadir Silva</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">USCMS_Tier2</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">WIP</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2017-07-11</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">USCMS Tier 2 <span class="muted"> / OSG Support Centers</span></div><div class="assignee" style="width: 60%">GGUS (Prod)&nbsp;<a target="_blank" href="https://ggus.eu/ws/ticket_info.php?ticket=128863">128863</a> <span class="muted"> / Ticket Exchange</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/34173", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="https://ticket.opensciencegrid.org/\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="https://ticket.opensciencegrid.org/\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/34173?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/34173?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Enabling%20multicore%20at%20T2_BR_SPRACE%20ISSUE%3D34173%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='34173#1499438350'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-07-07T14:39:10+00:00">Jul 7, 2017 02:39 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1499438350">&nbsp;</a></div><pre>Thanks for the details, Jadir. As it seems to be working fine, let me go ahead and close the ticket.

Cheers,

Antonio.enabled multicore pilot submission&#13;

-- by Antonio Perez-Calero Yzquierdo at Fri Jul 07 10&#58;44&#58;53 UTC 2017

Hi Antonio,

I forgot to mention, but the guilty was really the defrag daemon, the MAX_JOB_RETIREMENT_TIME on the worker nodes was set to 0, this never caused throuble to us because we never drained machines using -graceful(which take into account MAX_JOB_RETIREMENT_TIME before start killing) and the default defrag policy is graceful and jobs were killed immediately.

Cheers,
Jadir&#13;

-- by Jadir Silva at Thu Jul 06 13&#58;40&#58;49 UTC 2017

Hi Jadir,

Looking again at the last days, the situation looks normal to me, so we have finally achieved a correct setting of all the elements. I suggest we close the ticket, if any issue arises, then we could open a new one.

Cheers,

Antonio.&#13;

-- by Antonio Perez-Calero Yzquierdo at Thu Jul 06 12&#58;08&#58;22 UTC 2017

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=128863' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=128863</a></pre></div><div class='update_description'><i onclick="document.location='34173#1499438332'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-07-07T14:38:52+00:00">Jul 7, 2017 02:38 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1499438332">&nbsp;</a></div><pre>Have the WN changes stopped these evictions?  Please advise.

Thank you,
Vince</pre></div><div class='update_description'><i onclick="document.location='34173#1499118124'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-07-03T21:42:04+00:00">Jul 3, 2017 09:42 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1499118124">&nbsp;</a></div><pre>Hi Antonio,

Looking at CE the numbers are almost the same

condor_ce_status -const &#39;totalcpus&#62;=8 && DynamicSlot&#39;
[root@osg-ce ~]# condor_ce_status -const &#39;totalcpus&#62;=8 && DynamicSlot&#39; -total
Machines Owner Claimed Unclaimed Matched Preempting

X86_64/LINUX      777     0     777         0       0          0

Total      777     0     777         0       0          0

concerning WN evicting jobs I had a look and I found an old START expression(We dont touch configs files so often) that could lead to this, I changed to the default value

START = True

Hope this help.

Cheers,
Jadir&#13;

-- by Jadir Silva at Mon Jul 03 17&#58;12&#58;17 UTC 2017

Hi Jadir,

Are you evicting jobs from the WNs in your defrag policy? Otherwise, I don&#39;t see a connection. Also, can you confirm the number of pilots and slots shown here

<a href='http&#58;//submit-3.t2.ucsd.edu/CSstoragePath/aperez/HTML/T2s/multicore_usage_t2s_24h.html' target='_blank' rel='nofollow'>http&#58;//submit-3.t2.ucsd.edu/CSstoragePath/aperez/HTML/T2s/multicore_usage_t2s_24h.html</a>

with what you see locally?

Amjad, could you please check logs from multicore pilots run at SPRACE, see if you can spot any problem with them?

Thanks,

<div id='show_708595811' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_708595811'>Antonio.&#13;

-- by Antonio Perez-Calero Yzquierdo at Mon Jul 03 15&#58;04&#58;22 UTC 2017

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=128863' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=128863</a>
</div><script type='text/javascript'>
        $('#show_708595811').click(function() {
            $('#detail_708595811').slideDown("normal");
            $('#show_708595811').hide();
            $('#hide_708595811').show();
        });
        $('#hide_708595811').click(function() {
            $('#detail_708595811').slideUp();
            $('#hide_708595811').hide();
            $('#show_708595811').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='34173#1499090180'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-07-03T13:56:20+00:00">Jul 3, 2017 01:56 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1499090180">&nbsp;</a></div><pre><font color='#7F7E6F'>&#62;for allocated and in use cores in each of the multicore T2s. It looks to me that the picture we get for SPRACE it&#39;s a bit more unstable than that of other sites, &#62;meaning the number of running glideins connecting to the global pool would be going up and down unusually quick. That could indicate a problem in glideins &#62;starting up, validating, connecting to the pool, or pulling</font>

Could this be a side effect of condor defrag policy?&#13;

-- by Jadir Silva at Fri Jun 30 17&#58;45&#58;30 UTC 2017

Hi Jadir,

during yesterday submission infra meeting we discussed that, Antonio is watching the entry, when he finds it is totally works fine we will disable the single core one.&#13;

-- by Amjad kotobi at Fri Jun 30 14&#58;09&#58;03 UTC 2017

Hi Jadir,

I have been looking at this monitor,

<a href='http&#58;//submit-3.t2.ucsd.edu/CSstoragePath/aperez/HTML/T2s/multicore_usage_t2s_168h.html' target='_blank' rel='nofollow'>http&#58;//submit-3.t2.ucsd.edu/CSstoragePath/aperez/HTML/T2s/multicore_usage_t2s_168h.html</a>

for allocated and in use cores in each of the multicore T2s. It looks to me that the picture we get for SPRACE it&#39;s a bit more unstable than that of other sites, meaning the number of running glideins connecting to the global pool would be going up and down unusually quick. That could indicate a problem in glideins starting up, validating, connecting to the pool, or pulling payloads. I&#39;d like therefore that to be checked in a bit more detail, both by you locally and also form the factory logs, see if anything unusual is spotted. For example, do the numbers of multicore pilots and cores match what you see locally, Jadir?

This is just my suspicion, but in other cases looking similar there was an actual misconfig.

Cheers,

Antonio.&#13;

-- by Antonio Perez-Calero Yzquierdo at Fri Jun 30 14&#58;05&#58;49 UTC 2017

Hi,

Any news? Do you guys see any constraint to remove the single core entries?

Cheers,
Jadir&#13;

<div id='show_1333471294' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1333471294'>-- by Jadir Silva at Fri Jun 30 13&#58;45&#58;12 UTC 2017

Hi Antonio and Amjad,

I guess you can remove  single core entries now, the cluster is behaving well.

Thanks a lot for your help guys.

Cheers,
Jadir&#13;

-- by Jadir Silva at Wed Jun 28 11&#58;31&#58;16 UTC 2017

Hi Antonio,

After changing the configs to start partitionable slots the WN are working as expected, I will drain the rest of the cluster in order to apply the configs to all remaining slots.

Jadir&#13;

-- by Jadir Silva at Mon Jun 26 10&#58;45&#58;41 UTC 2017

Thanks Jeff and Jadir.

Jadir, what&#39;s the status after the weekend? do you still see any such cases happening again?

Antonio.&#13;

-- by Antonio Perez-Calero Yzquierdo at Mon Jun 26 08&#58;28&#58;51 UTC 2017

Hi,

I just changed a bit our configuration to use partionable slots, so far the machine in testing is working as expected, 1 slot that starts another 8 sub slots[1].

[1]
[root@node096 ~]# condor_status node096
Name               OpSys      Arch   State     Activity LoadAv Mem    ActvtyTime

slot1@.... LINUX      X86_64 Owner     Idle      1.000 15842  0+02&#58;15&#58;36
slot1_1@.... LINUX      X86_64 Claimed   Busy      0.930 2048  0+02&#58;19&#58;38
slot1_2@.... LINUX      X86_64 Claimed   Busy      1.150 2048  0+02&#58;19&#58;15
slot1_3@.... LINUX      X86_64 Claimed   Busy      1.150 2048  0+02&#58;18&#58;52
slot1_4@.... LINUX      X86_64 Claimed   Busy      0.770 2048  0+02&#58;17&#58;52
slot1_5@.... LINUX      X86_64 Claimed   Busy      1.220 2048  0+02&#58;16&#58;51
slot1_6@.... LINUX      X86_64 Claimed   Busy      1.130 2048  0+02&#58;16&#58;29
slot1_7@.... LINUX      X86_64 Claimed   Busy      1.110 2048  0+02&#58;15&#58;58
slot1_8@.... LINUX      X86_64 Claimed   Busy      1.040 2048  0+02&#58;15&#58;36
slot2@.... LINUX      X86_64 Owner     Idle      0.840 15842  0+02&#58;15&#58;37
slot2_1@.... LINUX      X86_64 Claimed   Busy      0.900 2048  0+02&#58;19&#58;39
slot2_2@.... LINUX      X86_64 Claimed   Busy      1.120 2048  0+02&#58;19&#58;16
slot2_3@.... LINUX      X86_64 Claimed   Busy      1.120 2048  0+02&#58;18&#58;53
slot2_4@.... LINUX      X86_64 Claimed   Busy      0.890 2048  0+02&#58;17&#58;53
slot2_5@.... LINUX      X86_64 Claimed   Busy      1.150 2048  0+02&#58;16&#58;52
slot2_6@.... LINUX      X86_64 Claimed   Busy      0.960 2048  0+02&#58;16&#58;29
slot2_7@.... LINUX      X86_64 Claimed   Busy      1.040 2048  0+02&#58;15&#58;59
slot2_8@.... LINUX      X86_64 Claimed   Busy      1.160 2048  0+02&#58;15&#58;37
Machines Owner Claimed Unclaimed Matched Preempting

X86_64/LINUX       18     2      16         0       0          0

Total       18     2      16         0       0          0&#13;

-- by Jadir Silva at Fri Jun 23 17&#58;19&#58;20 UTC 2017

Amjad,

This is a typo&#58;
&#60;submit_attr name=&#34;+count&#34; value=&#34;8&#34;/&#62;

It should be &#34;+xcount&#34; not count.

I just updated the config and reconfigured the factories.

Jeff&#13;

-- by Jeffrey Dost at Fri Jun 23 16&#58;48&#58;01 UTC 2017

Thanks for confirming, Amjad. Then there&#39;s maybe some misconfiguration at the CE and/or BS level on SPRACE?

Antonio.&#13;

-- by Antonio Perez-Calero Yzquierdo at Fri Jun 23 15&#58;35&#58;45 UTC 2017

Hi Antonio,

I just checked configuration, +count=8 is there, configuration parameter all looks good from here.&#13;

-- by Amjad kotobi at Fri Jun 23 15&#58;24&#58;02 UTC 2017

Ah, so you mean your slots are static single core? An 8-core pilot is being allocated a 1-core slot? You should set it to partitionable slots in general (or set the static slots to be of 8 cores) to accommodate mcore pilots.

Also, there must be something wrong in the configuration (xcount) as otherwise the system should never allocate a 8-core request to a single core static slot.

I suggest we check both your local config and the entry parameters (xcount = 8 missing?)

Antonio.&#13;

-- by Antonio Perez-Calero Yzquierdo at Fri Jun 23 15&#58;18&#58;09 UTC 2017

Hi Antonio,

Now we have 1 slot per core for machines with N x 8 cores,  but we also have machines with 12 cores which have 16 slots. All slots are static slots, I mean there is no partionable slot in our current configuration and also HT is disabled to keep the ratio of 2Gb/slot.&#13;

-- by Jadir Silva at Fri Jun 23 13&#58;09&#58;51 UTC 2017

Hi Jadir,

A multicore pilot should create a max of 8 single core dynamic slots, i.e. showing 8 starter processes max. Is this the case or not?

However, the relation of that with the number of physical cores is not as simple as one to one. That depends also on your batch system settings, how many batch system slots you have configured per physical core. An example would be a 12 core machine, with HT enabled 24 logical cores, then partitioned in the BS as 16 slots. So ultimately you&#39;d have 4/3 slots (and starter proc) per core.

Can you please check what is the situation a bit more in detail?

Antonio.&#13;

-- by Antonio Perez-Calero Yzquierdo at Fri Jun 23 11&#58;17&#58;15 UTC 2017

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=128863' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=128863</a>
</div><script type='text/javascript'>
        $('#show_1333471294').click(function() {
            $('#detail_1333471294').slideDown("normal");
            $('#show_1333471294').hide();
            $('#hide_1333471294').show();
        });
        $('#hide_1333471294').click(function() {
            $('#detail_1333471294').slideUp();
            $('#hide_1333471294').hide();
            $('#show_1333471294').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='34173#1498926917'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-07-01T16:35:17+00:00">Jul 1, 2017 04:35 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1498926917">&nbsp;</a></div><pre>Updating GGUS ticket exchange.</pre></div><div class='update_description'><i onclick="document.location='34173#1498148333'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-06-22T16:18:53+00:00">Jun 22, 2017 04:18 PM UTC</time><a class="anchor" name="1498148333">&nbsp;</a></div><pre>Hi Antonio and Amjad,

I saw one strange think, at least for me, when looking at one workernode after seing an huge increase in the overall cluster load. Seems that the pilot is starting several slots per physical slot[1]. Is that normal?

[1]
condor   1249242  0.8  0.0  95924  5168 ?        Ss   Jun21  15&#58;55      &#92;_ condor_starter -f -a slot6 osg-ce.local
glow     1249402  0.0  0.0   9940  1212 ?        Ss   Jun21   0&#58;00      |   &#92;_ /bin/bash /var/lib/condor/execute/dir_1249242/condor_exec.exe
glow     1285201  0.0  0.0   9548  1208 ?        S    Jun21   0&#58;00      |       &#92;_ /bin/bash /var/lib/condor/execute/dir_1249242/glide_o8lpu
glow     1289985  0.0  0.0  91936  6152 ?        S    Jun21   0&#58;01      |           &#92;_ /var/lib/condor/execute/dir_1249242/glide_o8lpuz/main
glow     1290460  0.1  0.0  24044  5700 ?        S    Jun21   2&#58;54      |               &#92;_ condor_procd -A /var/lib/condor/execute/dir_12492
glow     1290475  0.2  0.0  94308  9176 ?        S    Jun21   5&#58;15      |               &#92;_ condor_startd -f
glow     1296997  0.4  0.0  92072  6240 ?        S    Jun21   7&#58;59      |                   &#92;_ condor_starter -f -a slot1_2 submit-5.chtc.wi
glow     1916903  0.0  0.0   9420  1316 ?        S    Jun21   0&#58;00      |                   |   &#92;_ /bin/bash /var/lib/condor/execute/dir_124
glow     1920094 27.5  4.2 2690816 2106216 ?     R    Jun21 477&#58;31      |                   |       &#92;_ python run_sim.py 155
glow     1384552  0.0  0.0  92188  6616 ?        S    Jun21   0&#58;02      |                   &#92;_ condor_starter -f -a slot1_1 submit-5.chtc.wi
glow     1685118  0.0  0.0   9420  1108 ?        S    Jun21   0&#58;00      |                   |   &#92;_ /bin/sh /var/lib/condor/execute/dir_12492
glow     1691121  0.0  0.0 159372   304 ?        S    Jun21   0&#58;00      |                   |       &#92;_ /tmp/condor/execute/dir_1249242/glide
glow     1691326 29.2  0.4 395016 234336 ?       R    Jun21 526&#58;32      |                   |           &#92;_ /tmp/condor/execute/dir_1249242/g
glow     3255920  0.4  0.0  92072  7080 ?        S    Jun21   5&#58;52      |                   &#92;_ condor_starter -f -a slot1_3 submit-5.chtc.wi
glow     3326812  0.0  0.0   9420  1312 ?        S    Jun21   0&#58;00      |                   |   &#92;_ /bin/bash /var/lib/condor/execute/dir_124
glow     3330387 27.4  1.2 1077052 619084 ?      R    Jun21 358&#58;59      |                   |       &#92;_ python run_sim.py 5105
glow     3624319  0.0  0.0  92072  7396 ?        S    10&#58;07   0&#58;04      |                   &#92;_ condor_starter -f -a slot1_4 exocet.bmrb.wisc
glow     4035196  0.0  0.0   9420  1300 ?        S    10&#58;59   0&#58;00      |                   |   &#92;_ /bin/sh /var/lib/condor/execute/dir_12492
glow     4050965 28.3  0.6 410068 332520 ?       R    11&#58;01  37&#58;38      |                   |       &#92;_ ./minirosetta.static.linuxgccrelease
glow     4066122  0.2  0.0  92072  7428 ?        S    11&#58;03   0&#58;16      |                   &#92;_ condor_starter -f -a slot1_5 submit-5.chtc.wi
glow      433648  0.0  0.0   9420  1340 ?        S    12&#58;26   0&#58;00      |                       &#92;_ /bin/bash /var/lib/condor/execute/dir_124
glow      444690 25.8  0.1 512728 85052 ?        R    12&#58;27  11&#58;55      |                           &#92;_ python model_vi_phenology.py P25R28 2

by /C=BR/O=ANSP/OU=ANSPGrid CA/OU=People/CN=Jadir Marra da Silva</pre></div><div class='update_description'><i onclick="document.location='34173#1498144411'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-06-22T15:13:31+00:00">Jun 22, 2017 03:13 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1498144411">&nbsp;</a></div><pre>Notified CMS Glidein Factory team of this ticket.Hi Jadir, Amjad,

Looking at the past few days, it looks to me that multicore pilots at SPRACE are working fine.

<a href='http&#58;//submit-3.t2.ucsd.edu/CSstoragePath/aperez/HTML/T2s/multicore_usage_t2s_168h.html' target='_blank' rel='nofollow'>http&#58;//submit-3.t2.ucsd.edu/CSstoragePath/aperez/HTML/T2s/multicore_usage_t2s_168h.html</a>

I see we are still running single core pilots, about 200 right now. I think we can proceed and disable single core.

Cheers,

Antonio.&#13;

-- by Antonio Perez-Calero Yzquierdo at Thu Jun 22 15&#58;12&#58;36 UTC 2017

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=128863' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=128863</a></pre></div><div class='update_description'><i onclick="document.location='34173#1497960630'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-06-20T12:10:30+00:00">Jun 20, 2017 12:10 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1497960630">&nbsp;</a></div><pre>Hi,

T2_BR_SPRACE moved to production.

CERN GlideinWMS Factory Operations&#13;

-- by Amjad kotobi at Tue Jun 20 12&#58;10&#58;08 UTC 2017

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=128863' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=128863</a></pre></div><div class='update_description'><i onclick="document.location='34173#1497874742'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-06-19T12:19:02+00:00">Jun 19, 2017 12:19 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1497874742">&nbsp;</a></div><pre>Hi,

We want to start accepting multicore jobs at SPRACE, we wanna use the same gatekeeper for multi core and single core. Here is the information requested according to [1]&#58;

gatekeeper&#58; osg-ce.sprace.org.br&#58;9619
CE&#58; condor-ce
batch system&#58; condor
number of cores per WN&#58;

WN  Mem      Cores   Mem/Core
================================
16  24149     8       3018Mb
1  40264    16      2516Mb
59  48344    16      3021Mb
16  64452    16      4028Mb

If any more info is needed please let us know

Cheers,
Jadir

[1] <a href='https&#58;//twiki.cern.ch/twiki/bin/view/CMSPublic/MulticoreDeploymentToT2s' target='_blank' rel='nofollow'>https&#58;//twiki.cern.ch/twiki/bin/view/CMSPublic/MulticoreDeploymentToT2s</a>

[Ticket Origin]
<a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=128863' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=128863</a>

[Ticket History]
Subject&#58; Enabling multicore at T2_BR_SPRACE
Ticket Type&#58; USER
CC&#58;
-- by Jadir Silva at Thu Jun 08 12&#58;26&#58;49 UTC 2017

&#13;
Changed problem type to&#58; CMS_Submission Infrastructure&#13;

<div id='show_1867240536' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1867240536'>-- by Jadir Silva at Thu Jun 08 12&#58;37&#58;49 UTC 2017

Ticket category has been changed from Test to Incident.&#13;

-- by Jadir Silva at Thu Jun 08 12&#58;38&#58;12 UTC 2017

Notified CMS Glidein Factory team of this ticket.&#13;

-- by Jadir Silva at Thu Jun 08 12&#58;40&#58;50 UTC 2017

&#13;
Flushed field &#39;Notify Site&#39;&#13;

-- by Jadir Silva at Fri Jun 09 10&#58;46&#58;54 UTC 2017

Hi Jadir,

Multicore entry[1] created in ITB, we will start to send rounds of test jobs.

[1] <a href='http&#58;//glidein-itb.grid.iu.edu/factory/monitor/factoryEntryStatusNow.html?entry=CMSHTPC_T2_BR_SPRACE' target='_blank' rel='nofollow'>http&#58;//glidein-itb.grid.iu.edu/factory/monitor/factoryEntryStatusNow.html?entry=CMSHTPC_T2_BR_SPRACE</a>

CERN GlideinWMS Factory Operations&#13;

-- by Amjad kotobi at Mon Jun 12 09&#58;30&#58;29 UTC 2017

Thanks Amjad, in case you need adjusts from our side please let me know.&#13;

-- by Jadir Silva at Mon Jun 12 11&#58;18&#58;38 UTC 2017

Antonio Perez-Calero Yzquierdo has subscribed to this ticket.

&#13;

-- by Antonio Perez-Calero Yzquierdo at Mon Jun 12 15&#58;33&#58;32 UTC 2017

Hi,

Our previous test jobs some finished successfully without error and some did not claim, We will send more tests jobs to make sure everything is working fine.

CERN GlideinWMS Factory Operations&#13;

-- by Amjad kotobi at Thu Jun 15 09&#58;47&#58;51 UTC 2017

Thanks Amjad,

What are the next steps now?

Cheers,
Jadir&#13;

-- by Jadir Silva at Mon Jun 19 11&#58;32&#58;43 UTC 2017

Hi Jadir,

We are going to add the new tested entry to the production factories in order to start receiving real payloads in the multicore pilots. If everything is ok, we&#39;ll then disable single core pilot submission, as we&#39;d want CPU resources to be accessed in multicore mode.

Cheers,

Antonio.&#13;

-- by Antonio Perez-Calero Yzquierdo at Mon Jun 19 12&#58;18&#58;18 UTC 2017
</div><script type='text/javascript'>
        $('#show_1867240536').click(function() {
            $('#detail_1867240536').slideDown("normal");
            $('#show_1867240536').hide();
            $('#hide_1867240536').show();
        });
        $('#hide_1867240536').click(function() {
            $('#detail_1867240536').slideUp();
            $('#hide_1867240536').hide();
            $('#show_1867240536').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F34173">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 34173});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
