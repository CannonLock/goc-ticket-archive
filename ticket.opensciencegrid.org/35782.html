<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[35782] Cleanup Job Failures</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=35782" method="post">
<div class="page-header">
    <h3><span class="muted">35782</span> / Cleanup Job Failures</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">jean-roch vlimant</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Associated VO</label><div class="controls">CMS</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GGUS</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">jean-roch vlimant</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">fGOC</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">High</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">TX Incoming</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2018-02-06</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Kyle Gross <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">fGOC <span class="muted"> / OSG Support Centers</span></div><div class="assignee" style="width: 60%">GGUS (Prod)&nbsp;<a target="_blank" href="https://ggus.eu/ws/ticket_info.php?ticket=132801">132801</a> <span class="muted"> / Ticket Exchange</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/35782", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/35782?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/35782?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Cleanup%20Job%20Failures%20ISSUE%3D35782%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='35782#1517335991'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-01-30T18:13:11+00:00">Jan 30, 2018 06:13 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1517335991">&nbsp;</a></div><pre>If so, I will close this one based on the evidence after fixing the cvmfs oasis issue at Florida.
Please open another ticket if the same stageout errors recur.This is a Florida-only issue.
A fix was applied to correct the cvmfs oasis issue at Florida. (See update #14 for details.)&#13;

-- by Bockjoo Kim at Thu Jan 18 20&#58;01&#58;45 UTC 2018

the cleanup jobs were already submitted 3 times and failed, at the time.
there is no way to re-resubmit them at this point and things will clear once the workflow will be announced and your script will be able to delete the directory.
until then...&#13;

-- by jean-roch vlimant at Thu Jan 18 13&#58;33&#58;14 UTC 2018

du -sh /cms/data/store/unmerged
290T	/cms/data/store/unmerged
decreased, but I think the unmerged file left by the failed job ( before the fix mentioned in the update #14 ) is still not cleaned&#58;
[root@cslrm ~]# ls /cms/data//store/unmerged/RunIIFall17wmLHEGS/TTToHadronic_TuneCP5_PSweights_13TeV-powheg-pythia8/LHE/93X_mc2017_realistic_v3-v1/50020/DABD4741-C7E2-E711-855E-008CFAC93ECC.root -al
-rw-rw-r-- 1 cmsprod cmsdata 18038527 Dec 16 22&#58;51 /cms/data//store/unmerged/RunIIFall17wmLHEGS/TTToHadronic_TuneCP5_PSweights_13TeV-powheg-pythia8/LHE/93X_mc2017_realistic_v3-v1/50020/DABD4741-C7E2-E711-855E-008CFAC93ECC.root
Why does the job not get resubmitted for the cleanup?
Is this expected?
Thanks,
Bockjoo&#13;

-- by Bockjoo Kim at Thu Jan 18 13&#58;12&#58;37 UTC 2018

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801</a></pre></div><div class='update_description'><i onclick="document.location='35782#1517335943'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-01-30T18:12:23+00:00">Jan 30, 2018 06:12 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1517335943">&nbsp;</a></div><pre>Is anyone on the GGUS end of things able to confirm the fix for Bockjoo?

-Kyle</pre></div><div class='update_description'><i onclick="document.location='35782#1516217017'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-01-17T19:23:37+00:00">Jan 17, 2018 07:23 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1516217017">&nbsp;</a></div><pre>The unmerged area has 314TB now ( from 450TB).
So, I am guessing the stageout is working for the rhel7 workflows after the update #14.
Can somebody confirm/deny if the stageout failure is fixed?
Thanks,
Bockjoo&#13;

-- by Bockjoo Kim at Mon Jan 15 15&#58;05&#58;42 UTC 2018

The site worker node package is provided by oasis. Due to the nature of the site CVMFS over NFS.
It was installed in the non-default area.
So, the lines around 242 in condor_job_wrapper&#58;
elif [ &#34;x$OSG_SINGULARITY_IMAGE&#34; = &#34;x/cvmfs/singularity.opensciencegrid.org&#92;
/bbockelm/cms&#58;rhel7&#34; -a -e &#34;/cvmfs/oasis.opensciencegrid.org/osg-software/osg-w&#92;
n-client/3.4/current/el7-x86_64/setup.sh&#34; ]; then
source /cvmfs/oasis.opensciencegrid.org/osg-software/osg-wn-client/3.4/&#92;
current/el7-x86_64/setup.sh

could not pick up the correct rhel7 worker node env.

This is fixed by mounting the oasis in the expected directory.

Hopefully, now rhel7 image can see the correct worker node package and fix the stageout issue.&#13;

-- by Bockjoo Kim at Sat Jan 13 03&#58;40&#58;45 UTC 2018

The problem seems to be PYTHONPATH inside startup_environment.sh due to the /cvmfs/oasis.opensciencegrid.org worker node setup + rhel7 singulairty image.

If rhel7 singularity image is used, there should be a way to set the PYTHONPATH not to point to rhel6 python area.&#13;

-- by Bockjoo Kim at Fri Jan 12 20&#58;40&#58;38 UTC 2018

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801</a></pre></div><div class='update_description'><i onclick="document.location='35782#1515788530'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-01-12T20:22:10+00:00">Jan 12, 2018 08:22 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1515788530">&nbsp;</a></div><pre>Now, I can reproduce the error in singulairty&#58;
-bash-4.1$ uname -a
Linux c23a-s20.ufhpc 2.6.32-642.6.2.el6.x86_64 #1 SMP Mon Oct 24 10&#58;22&#58;33 EDT 2016 x86_64 x86_64 x86_64 GNU/Linux
-bash-4.1$ /apps/singularity/2.4.0/bin/singularity exec --home /osg/home/cmspilot&#58;/srv --bind /cms --bind /cvmfs --bind /osg/home/cmspilot&#58;/srv --pwd /srv --scratch /var/tmp --scratch /tmp --containall /cvmfs/singularity.opensciencegrid.org/bbockelm/cms&#58;${rhel} env -i X509_USER_PROXY=$X509_USER_PROXY JOBSTARTDIR=/srv bash -c &#39;echo $X509_USER_PROXY ; . $JOBSTARTDIR/startup_environment.sh; date; echo LD_LIBRARY_PATH ; echo $LD_LIBRARY_PATH ; export X509_USER_PROXY=/srv/.cmspilot.proxy ; echo X509_USER_PROXY=$X509_USER_PROXY ; echo which python ; which python ; echo Importing gfal2 using &#96;which python&#96; ; python -c &#34;import gfal2&#34; ; echo Importing gfal2 using /usr/bin/python ; /usr/bin/python -c &#34;import gfal2&#34;&#39;
WARNING&#58; Not mounting requested bind point (already mounted in container)&#58; /srv
WARNING&#58; Container does not have an exec helper script, calling &#39;env&#39; directly

/srv/startup_environment.sh&#58; line 2&#58; BASHOPTS&#58; readonly variable
/srv/startup_environment.sh&#58; line 9&#58; BASH_VERSINFO&#58; readonly variable
/srv/startup_environment.sh&#58; line 25&#58; EUID&#58; readonly variable
/srv/startup_environment.sh&#58; line 141&#58; PPID&#58; readonly variable
/srv/startup_environment.sh&#58; line 148&#58; SHELLOPTS&#58; readonly variable
/srv/startup_environment.sh&#58; line 191&#58; UID&#58; readonly variable
/srv/startup_environment.sh&#58; line 213&#58; syntax error near unexpected token &#96;(&#39;
/srv/startup_environment.sh&#58; line 213&#58; &#96;export finish () &#39;
Fri Jan 12 20&#58;01&#58;59 UTC 2018
LD_LIBRARY_PATH
/srv/condor/lib&#58;
X509_USER_PROXY=/srv/.cmspilot.proxy
which python
/bin/python
Importing gfal2 using /bin/python
Traceback (most recent call last)&#58;
File &#34;&#60;string&#62;&#34;, line 1, in &#60;module&#62;
ImportError&#58; libboost_python-mt.so.5&#58; cannot open shared object file&#58; No such file or directory
Importing gfal2 using /usr/bin/python
Traceback (most recent call last)&#58;
File &#34;&#60;string&#62;&#34;, line 1, in &#60;module&#62;
ImportError&#58; libboost_python-mt.so.5&#58; cannot open shared object file&#58; No such file or directory&#13;

-- by Bockjoo Kim at Fri Jan 12 20&#58;04&#58;42 UTC 2018

In the condor stdout from the tarball uploaded by Paola in update#1, I see this&#58;
[bockjoo@archer bockjoo]$ grep OSG_SINGULARITY_IMAGE= Job_1554569/*.out
Job_1554569/condor.14605.30.out&#58;  OSG_SINGULARITY_IMAGE=/cvmfs/singularity.opensciencegrid.org/bbockelm/cms&#58;rhel7
<div id='show_833824932' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_833824932'>Job_1554569/condor.14635.52.out&#58;  OSG_SINGULARITY_IMAGE=/cvmfs/singularity.opensciencegrid.org/bbockelm/cms&#58;rhel7
Job_1554569/condor.14717.76.out&#58;  OSG_SINGULARITY_IMAGE=/cvmfs/singularity.opensciencegrid.org/bbockelm/cms&#58;rhel7

But the condor stdout of one of the currently running production job shows
[root@c23a-s20 ~]# grep OSG_SINGULARITY_IMAGE=  /scratch/local/15787308/15787308.cms_slurm_job/glide_HG1P8o/execute/dir_23962/_condor_stdout
OSG_SINGULARITY_IMAGE=/cvmfs/singularity.opensciencegrid.org/bbockelm/cms&#58;rhel6

So, is there any job that fails the gfal-rm with the rhel6 image?&#13;

-- by Bockjoo Kim at Fri Jan 12 14&#58;44&#58;47 UTC 2018

In update #7, I mentioned it could be due to the RHEL7 CE, but in one of condor stdout, RHEL6 CE job also had the gfal-rm issue.
So, please disregard the comment on the RHEL7 CE.
Thanks,
Bockjoo&#13;

-- by Bockjoo Kim at Fri Jan 12 14&#58;20&#58;58 UTC 2018

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801</a>
</div><script type='text/javascript'>
        $('#show_833824932').click(function() {
            $('#detail_833824932').slideDown("normal");
            $('#show_833824932').hide();
            $('#hide_833824932').show();
        });
        $('#hide_833824932').click(function() {
            $('#detail_833824932').slideUp();
            $('#hide_833824932').hide();
            $('#show_833824932').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='35782#1515751419'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-01-12T10:03:39+00:00">Jan 12, 2018 10:03 AM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1515751419">&nbsp;</a></div><pre>Notified CMS Glidein Factory team of this ticket.&#13;

-- by Antonio Perez-Calero Yzquierdo at Fri Jan 12 10&#58;02&#58;34 UTC 2018

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801</a></pre></div><div class='update_description'><i onclick="document.location='35782#1515702121'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-01-11T20:22:01+00:00">Jan 11, 2018 08:22 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1515702121">&nbsp;</a></div><pre>Changed CC to ;cms-comp-ops-site-support-team@....;cms-comp-ops-workflow-team@....;cms-comp-ops-transfer-team@....; cms-ggus-glideinfactory@....; cms-ggus-submissioninfrastructure@....&#13;

-- by Stephan Lammel at Thu Jan 11 20&#58;20&#58;55 UTC 2018

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801</a></pre></div><div class='update_description'><i onclick="document.location='35782#1515698277'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-01-11T19:17:57+00:00">Jan 11, 2018 07:17 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1515698277">&nbsp;</a></div><pre>It&#39;s picking up /bin/gfal-rm (RHEL7) instead of RHEL6 /usr/bin/gfal-rm.
We have three CEs. All CEs submit jobs to the same SLURM cluster.
But one of them is RHEL7 and the other two CEs are RHEL6.
The failing stageout is from the jobs submitted from the RHEL7 CE.
Unfortunately, we don&#39;t have any RHEL7 worker nodes.
My guess is as a result for the jobs submitted from the RHEL7 the environment is mixed up between RHEL7 and RHEL6.
The RHEL7 CE is osg.rc.ufl.edu ( aka UFlorida-HPC )
The RHEL6 CEs are cslrm.rc.ufl.edu ( UFlorida-HPG2) and cms.rc.ufl.edu (UFlorida-CMS).
There is the blah script that I can play with, but
I don&#39;t have a good idea how to fix the mix.
In the meantime, the factory people might want to configure the glidein factory and stop sending jobs to osg.rc.ufl.edu.
Bockjoo&#13;

-- by Bockjoo Kim at Thu Jan 11 19&#58;17&#58;37 UTC 2018

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801</a></pre></div><div class='update_description'><i onclick="document.location='35782#1515680327'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-01-11T14:18:47+00:00">Jan 11, 2018 02:18 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1515680327">&nbsp;</a></div><pre>This runs fine&#58;
-bash-4.1$ /apps/singularity/2.4.0/bin/singularity exec --home /osg/home/cmspilot&#58;/srv --bind /cms --bind /cvmfs --bind /osg/home/cmspilot&#58;/srv --pwd /srv --scratch /var/tmp --scratch /tmp --containall /cvmfs/singularity.opensciencegrid.org/bbockelm/cms&#58;rhel6 python -c &#34;import gfal2&#34;
So, I don&#39;t know why the stageout can not find libboost_python-mt.so.5
Does anyone know a better way to emulate the singularity environment?
Anyway, I will keep looking.
Thanks,
Bockjoo&#13;

-- by Bockjoo Kim at Thu Jan 11 14&#58;17&#58;32 UTC 2018

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801</a></pre></div><div class='update_description'><i onclick="document.location='35782#1515672935'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-01-11T12:15:35+00:00">Jan 11, 2018 12:15 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1515672935">&nbsp;</a></div><pre>Hi Christoph,

wasn&#39;t this this ticket ?
<a href='https&#58;//ggus.eu/index.php?mode=ticket_info&ticket_id=128555' target='_blank' rel='nofollow'>https&#58;//ggus.eu/index.php?mode=ticket_info&ticket_id=128555</a>

Our site is fully CentOS 7. We jhave two CEs that advertise SL6, and there we drop the jobs into a generic SL6 container (cernvm) and are done with it. The CMS problems stopped when when we took CMS off these CEs that advertise EL6 and now CMS just uses the CentOS7 nodes as is without us setting up the generic container.
And we had to clean out out cms_local.sh (it&#39;s now empty -- after a lot of experimentation(*)).
Unless Florida has a similar setup, this is probably not relevant. As we gave up debugging the container from a container setup.

The ticket ended with an update from CMS.

All we setup in a WN is&#58;
# Pick corrent WN version
ELREL=&#96;lsb_release -r | awk &#39;{ print $2 }&#39; | cut -d. -f1&#96;
if [ ${ELREL} == &#34;7&#34; ]; then
# EL7
source ${BASE_DIR}/patch_env.sh /cvmfs/grid.cern.ch/umd-c7wn-test/etc/profile.d/setup-c7-wn-example.sh
else
# EL6 (probably in a container)
source ${BASE_DIR}/patch_env.sh /cvmfs/grid.cern.ch/umd-sl6wn-test/etc/profile.d/setup-wn-example.sh
fi

(pathc_env.sh just sets up DEFAULT_SE etc.)

More digging in my inbox revealed
<a href='https&#58;//ggus.eu/index.php?mode=ticket_info&ticket_id=127989' target='_blank' rel='nofollow'>https&#58;//ggus.eu/index.php?mode=ticket_info&ticket_id=127989</a>
and there we solved the problem by just not dumping CMS into an SL6 container to start with (as mentioned above)

Not sure any of this is helpful &#58;-S

Cheers,
Daniea

(*) <a href='https&#58;//gitlab.cern.ch/SITECONF/T2_UK_London_IC/commits/master/JobConfig/cmsset_local.sh&#13' target='_blank' rel='nofollow'>https&#58;//gitlab.cern.ch/SITECONF/T2_UK_London_IC/commits/master/JobConfig/cmsset_local.sh&#13</a>;

<div id='show_1154825453' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1154825453'>-- by Daniela Bauer at Thu Jan 11 12&#58;14&#58;42 UTC 2018

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801</a>
</div><script type='text/javascript'>
        $('#show_1154825453').click(function() {
            $('#detail_1154825453').slideDown("normal");
            $('#show_1154825453').hide();
            $('#hide_1154825453').show();
        });
        $('#hide_1154825453').click(function() {
            $('#detail_1154825453').slideUp();
            $('#hide_1154825453').hide();
            $('#show_1154825453').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='35782#1515670357'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-01-11T11:32:37+00:00">Jan 11, 2018 11:32 AM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1515670357">&nbsp;</a></div><pre>Hi Rokas,

we had a similar issue (likely the same) at Imperial College. They also had problems when using gfal-clients from CVMFS. I added Daniela from IC London, perhaps she recall more details and possibly a solution.

Christoph&#13;

-- by Christoph Wissing at Thu Jan 11 11&#58;32&#58;07 UTC 2018

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801</a></pre></div><div class='update_description'><i onclick="document.location='35782#1515668376'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-01-11T10:59:36+00:00">Jan 11, 2018 10:59 AM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1515668376">&nbsp;</a></div><pre>Hi Jean-Roch, All,

We do have test, that does clean up in the same way as WMAgent [1]. Strange, I don&#39;t see any failures in last 2 weeks [2].

I am wondering if it not singularity related. Florida runs singularity only on SLURM CE, right?

P&R,
Could you check if these failures are spread over all site&#39;s CEs or only SLURM (cslrm.rc.ufl.edu)?

Thanks!

[1] <a href='https&#58;//twiki.cern.ch/twiki/bin/view/CMSPublic/SAMMonteCarlo' target='_blank' rel='nofollow'>https&#58;//twiki.cern.ch/twiki/bin/view/CMSPublic/SAMMonteCarlo</a>
[2] <a href='http&#58;//wlcg-sam-cms.cern.ch/templates/ember/#/historicalsmry/heatMap?metrics=org.cms.WN-mc%20' target='_blank' rel='nofollow'>http&#58;//wlcg-sam-cms.cern.ch/templates/ember/#/historicalsmry/heatMap?metrics=org.cms.WN-mc%20</a>(%2Fcms%2FRole_lcgadmin)&profile=CMS_CRITICAL_FULL&site=T2_US_Florida&time=14d&view=Test%20History&#13;

-- by Rokas maciulaitis at Thu Jan 11 10&#58;59&#58;11 UTC 2018

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801</a></pre></div><div class='update_description'><i onclick="document.location='35782#1515666702'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-01-11T10:31:42+00:00">Jan 11, 2018 10:31 AM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1515666702">&nbsp;</a></div><pre>Hi all,

Here is one log for one of the failed jobs. The issue seems to be related to [1].

Regards.

[1]
Traceback (most recent call last)&#58;
File &#34;/bin/gfal-rm&#34;, line 24, in &#60;module&#62;
from gfal2_util.shell import Gfal2Shell
File &#34;/cvmfs/cms.cern.ch/grid/cvmfs/oasis.opensciencegrid.org/osg-software/osg-wn-client/current/el6-x86_64/usr/lib/python2.6/site-packages/gfal2_util/shell.py&#34;, line 23, in &#60;module&#62;
from base import CommandBase
File &#34;/cvmfs/cms.cern.ch/grid/cvmfs/oasis.opensciencegrid.org/osg-software/osg-wn-client/current/el6-x86_64/usr/lib/python2.6/site-packages/gfal2_util/base.py&#34;, line 32, in &#60;module&#62;
import gfal2
ImportError&#58; libboost_python-mt.so.5&#58; cannot open shared object file&#58; No such file or directory

ERROR&#58; Exception During Stage Out&#58;
2017-12-15T22&#58;14&#58;24 &#58; Command exited non-zero ExitCode&#58;1
Output&#58; (stdout&#58; Fri Dec 15 22&#58;14&#58;23 UTC 2017&#13;

-- by Paola Katherine Rozo at Thu Jan 11 10&#58;31&#58;06 UTC 2018

Added attachment Job_1554569.tar.bz2&#13;
<a href='https&#58;//ggus.eu/index.php?mode=download&attid=ATT108214&#13' target='_blank' rel='nofollow'>https&#58;//ggus.eu/index.php?mode=download&attid=ATT108214&#13</a>;

-- by Paola Katherine Rozo at Thu Jan 11 10&#58;31&#58;05 UTC 2018

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801</a></pre></div><div class='update_description'><i onclick="document.location='35782#1515664408'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-01-11T09:53:28+00:00">Jan 11, 2018 09:53 AM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1515664408">&nbsp;</a></div><pre>It looks like cleanup jobs are systematically failing at florida, leading to unmanageable unmerged space.

Paola, we would need some log of cleanup of pdmvserv_task_TOP-RunIIFall17wmLHEGS-00035__v1_T_171203_232528_3778 (not considered for Unified report, so not available)

Site support &#58; how can we include a cleanup test ?

[Ticket Origin]
<a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=132801</a>

[Ticket History]
Subject&#58; Cleanup Job Failures
Ticket Type&#58; USER
CC&#58; ;cms-comp-ops-site-support-team@....;cms-comp-ops-workflow-team@....;cms-comp-ops-transfer-team@....
-- by jean-roch vlimant at Thu Jan 11 09&#58;52&#58;20 UTC 2018</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F35782">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 35782});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
