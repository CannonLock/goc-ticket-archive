<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[24187] GLOW VO file downloads overloading Squid servers</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=24187" method="post">
<div class="page-header">
    <h3><span class="muted">24187</span> / GLOW VO file downloads overloading Squid servers</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Neha Sharma</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Neha Sharma</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2015-03-06</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
        <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/24187", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/24187?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/24187?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20GLOW%20VO%20file%20downloads%20overloading%20Squid%20servers%20ISSUE%3D24187%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='24187#1425673671'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-06T20:27:51+00:00">Mar 6, 2015 08:27 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1425673671">&nbsp;</a></div><pre>Thank you for informing us that this issue has been resolved. I will close this ticket.  Please submit problems, requests, and questions at&#58; <a href='https&#58;//ticket.grid.iu.edu/goc/open' target='_blank' rel='nofollow'>https&#58;//ticket.grid.iu.edu/goc/open</a> OSG Grid Operations Center goc@...., 317-278-9699 Visit the OSG Operations Page&#58; <a href='http&#58;//osggoc.blogspot.com/' target='_blank' rel='nofollow'>http&#58;//osggoc.blogspot.com/</a></pre></div><div class='update_description'><i onclick="document.location='24187#1425502170'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-04T20:49:30+00:00">Mar 4, 2015 08:49 PM UTC</time> by <b>nyehle@....</b><a class="anchor" name="1425502170">&nbsp;</a></div><pre>I think you can close the ticket, we are no longer over loading the squid servers.
-Nate
On Mar 4, 2015, at 2&#58;27 PM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='24187#1425500824'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-04T20:27:04+00:00">Mar 4, 2015 08:27 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1425500824">&nbsp;</a></div><pre>Hi Nate,

Do you have an update on this? How would you and Dave like to continue to handle this ticket? Let me know if I can help in some way.

Thanks,
Chris</pre></div><div class='update_description'><i onclick="document.location='24187#1424893770'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-25T19:49:30+00:00">Feb 25, 2015 07:49 PM UTC</time><a class="anchor" name="1424893770">&nbsp;</a></div><pre>Nate,

A lot depends on whether the these 500MB files are all the same for a batch of jobs, or different.  Squids perform much better if the same file is read over and over; they are designed for a high hit rate.  I heard that someone checked our squid logs and it looked like there were a lot of different files being loaded.  I would like to start a discussion with your user eswright to find out more about the application.

We have been looking extensively into the types of workflows that read from a set of shared files, but they&#39;re not all the same for every job in a batch.  We&#39;ve been calling this the &#34;auxiliary data file&#34; problem and we&#39;ve discussed several different types of solutions.  The one I have been researching the most and which seems to be very good is to use cvmfs but instead of using squids and storing in the worker node cache, use a feature of cvmfs called &#34;alien cache&#34; with a shared cache on the local high speed data filesystem that was engineered for data files (we&#39;ve tested dCache, lustre, and hadoop).

Dave

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Dave Dykstra 508</pre></div><div class='update_description'><i onclick="document.location='24187#1424802014'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-24T18:20:14+00:00">Feb 24, 2015 06:20 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1424802014">&nbsp;</a></div><pre>I will leave it up to Gerard and Tony ( CC&#39;ed) to follow up on this. Their group provides operations support for this service.

- Neha</pre></div><div class='update_description'><i onclick="document.location='24187#1424801597'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-24T18:13:17+00:00">Feb 24, 2015 06:13 PM UTC</time> by <b>nyehle@....</b><a class="anchor" name="1424801597">&nbsp;</a></div><pre>Neha,

Based on this ganglia I deduce you have a , 2x1G uplink on your 2 squids?  It probably was enough until we started hitting you with who I think are eswright’s jobs, his jobs download ~500M each.

<a href='http&#58;//fg-ganglia.fnal.gov/ganglia/?r=day&c=FermiGrid&h=squid1.fnal.gov&mc=2' target='_blank' rel='nofollow'>http&#58;//fg-ganglia.fnal.gov/ganglia/?r=day&c=FermiGrid&h=squid1.fnal.gov&mc=2</a>

CHTC runs a squid on each exec node to reduce the bottle neck on the squids like you are seeing with your two squid servers.

I am worried if BT the author of the jobs changes them to not use the proxy, we will just max out your entire site’s downlink instead, so we don’t want to change his jobs.

FNAL’s Two squid servers with 2x1G each for 7000 cores seems a bit light.

Could you consider running proxies on all your exec nodes instead of making us wait until march to use FNAL?

Right now I am unsure what to do to make this stop happening since your proxies are slated to get over run again if I do nothing as the job pressure increases.

For now I will look into banning eswright explicitly from FNAL so he doesn’t over run you until you upgrade your proxies.  We will see if your squids can keep up without eswright’s jobs.

-Nate

On Feb 24, 2015, at 11&#58;18 AM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='24187#1424798312'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-24T17:18:32+00:00">Feb 24, 2015 05:18 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1424798312">&nbsp;</a></div><pre>Hi

Our squid servers were getting hit pretty hard because of GLOW jobs and it was affecting other VO jobs badly.
So, we had to kill GLOW jobs running on CMS grid cluster.

Post that, our servers have resumed normal level of operation.
Please note that operations group is working on deploying this service on better hardware in March 2015.

You probably cannot access Fermi&#39;s internal ticketing system - just in case you can - details can be seen here - <a href='https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do%3Fsys_id=e7976bd76f927100240d9d4eae3ee402%26sysparm_stack=incident_list.do%3Fsysparm_query=active=true' target='_blank' rel='nofollow'>https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do%3Fsys_id=e7976bd76f927100240d9d4eae3ee402%26sysparm_stack=incident_list.do%3Fsysparm_query=active=true</a></pre></div><div class='update_description'><i onclick="document.location='24187#1424740717'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-24T01:18:37+00:00">Feb 24, 2015 01:18 AM UTC</time> by <b>nyehle@....</b><a class="anchor" name="1424740717">&nbsp;</a></div><pre>I am looking into this I have contacted the author of the jobs we will see
if something can be done to take some load off your servers.  By default
our code uses the local proxies at each site to keep network traffic down,
but if your proxies are unable to keep up we might be able to find a work
around using our own.

-N

On Mon, 23 Feb 2015, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='24187#1424730982'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-23T22:36:22+00:00">Feb 23, 2015 10:36 PM UTC</time><a class="anchor" name="1424730982">&nbsp;</a></div><pre>Added Nathan Yehle.  He&#39;s our GLOW primary.

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Aaron Moate 894</pre></div><div class='update_description'><i onclick="document.location='24187#1424724262'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-23T20:44:22+00:00">Feb 23, 2015 08:44 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1424724262">&nbsp;</a></div><pre>I&#39;ve added the GLOW admins for review.

Thanks,
Chris</pre></div><div class='update_description'><i onclick="document.location='24187#1424714691'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-23T18:04:51+00:00">Feb 23, 2015 06:04 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1424714691">&nbsp;</a></div><pre>We are seeing ~10K TCP connections at this moment on each of the squid servers. This is overloading the servers and seems to be caused by file downloads as part of GLOW jobs that are running at Fermilab.

Could GLOW VO users please bypass HTTP proxies when downloading big files? If  using &#39;wget&#39; , this can be achieved by running it with the --no-proxy flag.
Please note that if we observe jobs from other VOs being negatively affected by this, we will have to kill the GLOW jobs running on Fermilab resources.</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F24187">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 24187});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
