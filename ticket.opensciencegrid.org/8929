<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[8929] Gratia Records Loading Slowly</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=8929" method="post">
<div class="page-header">
    <h3><span class="muted">8929</span> / Gratia Records Loading Slowly</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Dan Fraser</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">High</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">review on ops call</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2010-08-03</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Fermilab <span class="muted"> / OSG Support Centers</span></div><div class="assignee" style="width: 60%">Rob Quick <span class="muted"> / OSG GOC Management</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/8929", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/8929?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/8929?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Gratia%20Records%20Loading%20Slowly%20ISSUE%3D8929%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='8929#1280328489'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-28T14:48:09+00:00">Jul 28, 2010 02:48 PM UTC</time> by <b>GRATIA</b><a class="anchor" name="1280328489">&nbsp;</a></div><pre>The Fermi/Remedy ticket has been resolved with the following solution.  Please resolve your ticket.

Resolution Categorization Tier 1 &#58;
Resolution Categorization Tier 2 &#58;
Resolution Categorization Tier 3 &#58;
Resolution                       &#58; Resolved by GOC
Resolution Method                &#58;

Fermi National Accelerator Laboratory Service DeskService Desk&#58; 630.840.2345</pre></div><div class='update_description'><i onclick="document.location='8929#1280327983'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-28T14:39:43+00:00">Jul 28, 2010 02:39 PM UTC</time> by <b>echism</b><a class="anchor" name="1280327983">&nbsp;</a></div><pre>Closing this.

Thank you,
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='8929#1280327767'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-28T14:36:07+00:00">Jul 28, 2010 02:36 PM UTC</time> by <b>Rob Quick</b><a class="anchor" name="1280327767">&nbsp;</a></div><pre>Elizabeth,

This can be closed. Gratia was back to normal on the evening of July
21st, and the incident was discussed at the Ops, Change, and Prod
meetings this week.

Rob

On Jul 28, 2010, at 10&#58;33 AM, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8929#1280327581'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-28T14:33:01+00:00">Jul 28, 2010 02:33 PM UTC</time> by <b>echism</b><a class="anchor" name="1280327581">&nbsp;</a></div><pre>Are there any updates on this?

Thank you,
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='8929#1279914196'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-23T19:43:16+00:00">Jul 23, 2010 07:43 PM UTC</time><a class="anchor" name="1279914196">&nbsp;</a></div><pre>I&#39;ll attend the Tuesday ops meeting.

-Keith.</pre></div><div class='update_description'><i onclick="document.location='8929#1279903510'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-23T16:45:10+00:00">Jul 23, 2010 04:45 PM UTC</time> by <b>Rob Quick</b><a class="anchor" name="1279903510">&nbsp;</a></div><pre>We&#39;d like to review this issue on the OSG Ops Review on Tuesday, July 27th at 10&#58;30 CDT. 510-665-5437 x1111. Can Fermigrid ops please plan on attending.

Thanks,
Rob</pre></div><div class='update_description'><i onclick="document.location='8929#1279833040'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-22T21:10:40+00:00">Jul 22, 2010 09:10 PM UTC</time><a class="anchor" name="1279833040">&nbsp;</a></div><pre>I&#39;ve put together a one page dashboard display of the various internal
Ganglia metrics that are being collected from the Gratia systems&#58;

<a href='http&#58;//fermigrid.fnal.gov/gratia-dashboard.html' target='_blank' rel='nofollow'>http&#58;//fermigrid.fnal.gov/gratia-dashboard.html</a>

I&#39;ll see about adding additional displays/features to this dashboard
over the next few days.

-Keith.</pre></div><div class='update_description'><i onclick="document.location='8929#1279821608'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-22T18:00:08+00:00">Jul 22, 2010 06:00 PM UTC</time> by <b>Philippe Canal</b><a class="anchor" name="1279821608">&nbsp;</a></div><pre>Hi,

The link
<a href='https&#58;//gratia-osg-prod.opensciencegrid.org/gratia-administration/monitor-status.html' target='_blank' rel='nofollow'>https&#58;//gratia-osg-prod.opensciencegrid.org/gratia-administration/monitor-status.html</a>
will return something like&#58;

record-count-hour=16167|record-count-24hour=979819|queuesize0=11831|

queuesize0 is the number of probe uploads waiting to be process by the
collector.  Each of
theses uploads is one xml file containing 1 or more records (the exact
number is defined per
probe via the BundleSize value.   Usually this is 20 for a batch probe
and 200 for a transfer probe.

record-count-[period] is the number of records actually processed by the
collector in the
last time period.

If queuesize0 reaches 100000 the collector stop accepting new input
until the queuesize0 goes
back down under 80000.    So if the number is greater than 80000, this
indicates that there
will be a backlog of data on the Probe side.

If the queue size number is high by the record-count-hour is low (a low
number is less than
15000 while a typical high number is 90000) then the collector is
&#39;slow-down&#39; by other
tasks (like daily backups or housekeeping).

Cheers,
Philippe.

On 7/22/10 8&#58;46 AM, Open Science Grid FootPrints wrote&#58;
<div id='show_1987629598' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1987629598'><font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_1987629598').click(function() {
            $('#detail_1987629598').slideDown("normal");
            $('#show_1987629598').hide();
            $('#hide_1987629598').show();
        });
        $('#hide_1987629598').click(function() {
            $('#detail_1987629598').slideUp();
            $('#hide_1987629598').hide();
            $('#show_1987629598').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='8929#1279806400'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-22T13:46:40+00:00">Jul 22, 2010 01:46 PM UTC</time> by <b>echism</b><a class="anchor" name="1279806400">&nbsp;</a></div><pre>adding Philippe to this ticket&#58;

&#34;I would like to add as a &#34;TODO&#34; for the next Gratia meeting to provide guidance (from the Gratia developer) to OSG about what metrics we could monitor (maybe the queue size?) which would give us an indication of the health of the collectors.&#34;</pre></div><div class='update_description'><i onclick="document.location='8929#1279770811'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-22T03:53:31+00:00">Jul 22, 2010 03:53 AM UTC</time><a class="anchor" name="1279770811">&nbsp;</a></div><pre>I concur that the accounting information over the last few days now looks sane.

If Philippe is on this ticket, I would like to add as a &#34;TODO&#34; for the next Gratia meeting to provide guidance (from the Gratia developer) to OSG about what metrics we could monitor (maybe the queue size?) which would give us an indication of the health of the collectors.</pre></div><div class='update_description'><i onclick="document.location='8929#1279765566'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-22T02:26:06+00:00">Jul 22, 2010 02:26 AM UTC</time><a class="anchor" name="1279765566">&nbsp;</a></div><pre>Update at 21&#58;23 CDT&#58;

The XML queue sizes for both osg_prod is small, and osg_transfer is declining
reasonably well&#58;

<a href='http&#58;//gratia-osg-prod.opensciencegrid.org/gratia-administration/monitor-status.html' target='_blank' rel='nofollow'>http&#58;//gratia-osg-prod.opensciencegrid.org/gratia-administration/monitor-status.html</a>
record-count-hour=36808|record-count-24hour=1829398|queuesize0=8|

<a href='http&#58;//gratia-osg-transfer.opensciencegrid.org/gratia-administration/monitor-status.html' target='_blank' rel='nofollow'>http&#58;//gratia-osg-transfer.opensciencegrid.org/gratia-administration/monitor-status.html</a>
record-count-hour=139546|record-count-24hour=2141992|queuesize0=19395|

Ganglia monitoring of gr13x5 shows that sec_behind_master is zero.
<a href='http&#58;//fg2x2.fnal.gov/ganglia/graph.php?&c=FermiGrid&h=gr13x5.fnal.gov&v=0&m=sec_behind_master&r=day&z=medium&jr=&js=&st=1279764975&vl=seconds&z=large' target='_blank' rel='nofollow'>http&#58;//fg2x2.fnal.gov/ganglia/graph.php?&c=FermiGrid&h=gr13x5.fnal.gov&v=0&m=sec_behind_master&r=day&z=medium&jr=&js=&st=1279764975&vl=seconds&z=large</a>

Ganglia monitoring of gr12x5 shows that the innodb_hist_list is &#34;reasonable&#34; ~3,800 records&#58;
<a href='http&#58;//fg2x2.fnal.gov/ganglia/graph.php?&c=FermiGrid&h=gr12x5.fnal.gov&v=3791&m=innodb_hist_list&r=day&z=medium&jr=&js=&st=1279765066&vl=history%20list%20length&z=large' target='_blank' rel='nofollow'>http&#58;//fg2x2.fnal.gov/ganglia/graph.php?&c=FermiGrid&h=gr12x5.fnal.gov&v=3791&m=innodb_hist_list&r=day&z=medium&jr=&js=&st=1279765066&vl=history%20list%20length&z=large</a>

The &#34;lag&#34; between the last record entered and the current time is &#34;reasonably&#34; small on
the master (collector) database&#58;

[chadwick@gr12x5 ~]$ tools/database_lag.sh
database gratia - lag is 706 seconds
database gratia_itb - lag is 733 seconds
database gratia_osg_transfer - lag is 912 seconds

Ditto for the slave (reporting) database&#58;

[chadwick@gr13x5 ~]$ tools/database_lag.sh
database gratia - lag is 1060 seconds
database gratia_itb - lag is 1065 seconds
database gratia_osg_transfer - lag is 1272 seconds

Also the displays at&#58;

<a href='http&#58;//display.grid.iu.edu/' target='_blank' rel='nofollow'>http&#58;//display.grid.iu.edu/</a>
<div id='show_1175855323' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1175855323'>
and

<a href='http&#58;//t2.unl.edu/gratia/byvo' target='_blank' rel='nofollow'>http&#58;//t2.unl.edu/gratia/byvo</a>

Appear to be showing reasonably current data.

So... for the moment, it appears that the gratia accounting system is
reasonably close to current.

We&#39;ll review the situation in the morning.

-Keith.
</div><script type='text/javascript'>
        $('#show_1175855323').click(function() {
            $('#detail_1175855323').slideDown("normal");
            $('#show_1175855323').hide();
            $('#hide_1175855323').show();
        });
        $('#hide_1175855323').click(function() {
            $('#detail_1175855323').slideUp();
            $('#hide_1175855323').hide();
            $('#show_1175855323').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='8929#1279742224'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-21T19:57:04+00:00">Jul 21, 2010 07:57 PM UTC</time> by <b>Dan Yocum</b><a class="anchor" name="1279742224">&nbsp;</a></div><pre>As it turns out, housekeeping had NOT caught up over the past weekend&#58;
OSG production is one week behind and OSG transfer is 4 _months_ behind
(recall that we disabled housekeeping during the last gratia slow-down
incident).

However, the new housekeeping is working so well that it is triggering
intense &#39;row purging&#39; by innodb which slows down operation and it
prevented the collector from catching up with the incoming records
which were accumulated during the upgrade last week.  We are testing a
new tuning parameter to see if this purging can be convinced to be
nicer, and allow new records to be inserted in a more timely manner.

Philippe has made a recommendation to solve the housekeeping backlog on
the Transfer database - we could drop (almost) all of the detail data
from the schema and start fresh since the amount of data to be kept is 1
month.

However, before we drop any data, Philippe proposes that we should
disable the housekeeping on both the OSG production and OSG transfer
collectors and allow them to catch up with the incoming data. Then we
will  enable the housekeeping only for the OSG production collector
until it is caught up.  After that has completed we will then try
enabling housekeeping on the OSG transfer collector to see what the
effect is.

Fermigrid Operations agrees with this plan.

We estimate that we should be caught up with incoming data within the
next day or 2.  Housekeeping this enormous amount of data will take
significantly longer to complete and we can make no estimates at this
time.

There&#39;s a lot of data to process and only one mysql daemon to do it - be
patient.

<div id='show_98030473' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_98030473'>On 07/21/2010 09&#58;15 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_98030473').click(function() {
            $('#detail_98030473').slideDown("normal");
            $('#show_98030473').hide();
            $('#hide_98030473').show();
        });
        $('#hide_98030473').click(function() {
            $('#detail_98030473').slideUp();
            $('#hide_98030473').hide();
            $('#show_98030473').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='8929#1279727288'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-21T15:48:08+00:00">Jul 21, 2010 03:48 PM UTC</time> by <b>Philippe Canal</b><a class="anchor" name="1279727288">&nbsp;</a></div><pre>Hi,

The delay was unexpected but it does not seems serious.   The Collector
should be caught in a day or two.
The root cause is a &#39;purge mechanism&#39; is the innodb engine that is
taking a large fraction of the I/O bandwidth on the db server.    This
purge is triggered by the housekeeping of the transfer database (which
needed a lot of catching up in its work) ; this housekeeping was
re-enabled following the installation of the latest release.   So this
should be a one time occurrence.

Cheers,
Philippe.

On 7/21/10 9&#58;08 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8929#1279721708'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-21T14:15:08+00:00">Jul 21, 2010 02:15 PM UTC</time> by <b>Dan Yocum</b><a class="anchor" name="1279721708">&nbsp;</a></div><pre>We are investigating.

On 07/21/2010 08&#58;54 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8929#1279721285'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-21T14:08:05+00:00">Jul 21, 2010 02:08 PM UTC</time><a class="anchor" name="1279721285">&nbsp;</a></div><pre>Dan (Yocum),

Please provide an update.

-Keith.</pre></div><div class='update_description'><i onclick="document.location='8929#1279720441'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-21T13:54:01+00:00">Jul 21, 2010 01:54 PM UTC</time> by <b>Rob Quick</b><a class="anchor" name="1279720441">&nbsp;</a></div><pre>Adding Dan and Myself to this ticket.</pre></div><div class='update_description'><i onclick="document.location='8929#1279720403'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-21T13:53:23+00:00">Jul 21, 2010 01:53 PM UTC</time> by <b>Rob Quick</b><a class="anchor" name="1279720403">&nbsp;</a></div><pre>While it does look like the data is coming in slowly, it does not seem to be catching up. Has there been any further attempts to rectify this and bring Gratia back to a near current state. Raising this to to HIGH status on request of OSG management. Please respond to this ticket with any additional details or call the GOC at 317-278-9699 to be forwarded to me.</pre></div><div class='update_description'><i onclick="document.location='8929#1279654987'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-20T19:43:07+00:00">Jul 20, 2010 07:43 PM UTC</time><a class="anchor" name="1279654987">&nbsp;</a></div><pre>The gratia status is that everything is now running, again.

That does not mean that everything is hunky-dory, however.

There is a HUGE amount of system I/O wait on the OSG DB, so the number of records actually being inserted into the database is about 4/sec right now.

The cause of the slow rate is due to length of the history list.

See <a href='http&#58;//dev.mysql.com/doc/refman/5.0/en/innodb-parameters.html#sysvar_innodb_max_purge_lag' target='_blank' rel='nofollow'>http&#58;//dev.mysql.com/doc/refman/5.0/en/innodb-parameters.html#sysvar_innodb_max_purge_lag</a>

and

<a href='http&#58;//dimitrik.free.fr/db_STRESS_MySQL_540_Purge_Lag_and_Ahead_Flushing_Jun2009.html' target='_blank' rel='nofollow'>http&#58;//dimitrik.free.fr/db_STRESS_MySQL_540_Purge_Lag_and_Ahead_Flushing_Jun2009.html</a>

At this point we have restarted all operation as normal and will monitor this value which is part of SHOW ENGINE INNODB STATUS;

Dan</pre></div><div class='update_description'><i onclick="document.location='8929#1279639205'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-20T15:20:05+00:00">Jul 20, 2010 03:20 PM UTC</time> by <b>Rob Quick</b><a class="anchor" name="1279639205">&nbsp;</a></div><pre>From email thread leading up to the creation of this ticket...

There are still no records. Just submitted a ticket.

Dan

On Jul 19, 2010, at 11&#58;43 PM, Brian Bockelman wrote&#58;

Hey Keith,

Yes - I see new records, and I know that Fermilab is significantly smaller today.  I don&#39;t see anything wrong with the health of the collectors or the DBs (I was aware of the failed over IP, and it doesn&#39;t seem to be the issue).

However, there are *no* UsageRecords for the last 24 hours according to the summary tables.  I find this very odd and probably worth investigating and/or filing a ticket tomorrow.  I see no reason for panic as long as things appear to be recording data.

Brian

On Jul 19, 2010, at 11&#58;33 PM, Keith Chadwick wrote&#58;

The central Gratia accounting service is currently receiving and processing records&#58;

<a href='http&#58;//gratia-osg-prod.opensciencegrid.org/gratia-administration/monitor-status.html' target='_blank' rel='nofollow'>http&#58;//gratia-osg-prod.opensciencegrid.org/gratia-administration/monitor-status.html</a>
record-count-hour=8450|record-count-24hour=204510|queuesize0=89211|

<a href='http&#58;//gratia-osg-prod-reports.opensciencegrid.org/gratia-reporting/monitor-status.html' target='_blank' rel='nofollow'>http&#58;//gratia-osg-prod-reports.opensciencegrid.org/gratia-reporting/monitor-status.html</a>
record-count-hour=8473|record-count-24hour=204417|queuesize0=0|

<a href='http&#58;//gratia-osg-transfer.opensciencegrid.org/gratia-administration/monitor-status.html' target='_blank' rel='nofollow'>http&#58;//gratia-osg-transfer.opensciencegrid.org/gratia-administration/monitor-status.html</a>
record-count-hour=9288|record-count-24hour=238757|queuesize0=28905|

<a href='http&#58;//gratia-osg-transfer-reports.opensciencegrid.org/gratia-reporting/monitor-status.html' target='_blank' rel='nofollow'>http&#58;//gratia-osg-transfer-reports.opensciencegrid.org/gratia-reporting/monitor-status.html</a>
record-count-hour=9178|record-count-24hour=238568|queuesize0=0|

-Keith.

At 11&#58;16 PM -0500 7/19/10, Brian Bockelman wrote&#58;
<div id='show_321470120' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_321470120'>Hey Chander,

Might be worth filing a GOC ticket instead of emails.  It does seem like there&#39;s something up - if I go to the view built into the collector&#58;

&#60;<a href='http&#58;//gratia-osg-prod-reports.opensciencegrid.org/gratia-reporting/&#62' target='_blank' rel='nofollow'>http&#58;//gratia-osg-prod-reports.opensciencegrid.org/gratia-reporting/&#62</a>;<a href='http&#58;//gratia-osg-prod-reports.opensciencegrid.org/gratia-reporting/' target='_blank' rel='nofollow'>http&#58;//gratia-osg-prod-reports.opensciencegrid.org/gratia-reporting/</a>

it also reports the last data as having date July 18.

Brian

On Jul 19, 2010, at 9&#58;44 PM, Chander Sehgal wrote&#58;

Keith, Chris,

Is Gratia operating normally at present ?

&#60;<a href='http&#58;//t2.unl.edu/gratia/byvo&#62' target='_blank' rel='nofollow'>http&#58;//t2.unl.edu/gratia/byvo&#62</a>;<a href='http&#58;//t2.unl.edu/gratia/byvo' target='_blank' rel='nofollow'>http&#58;//t2.unl.edu/gratia/byvo</a>

As I look at the reports they seem not to be current Š

Chander
</div><script type='text/javascript'>
        $('#show_321470120').click(function() {
            $('#detail_321470120').slideDown("normal");
            $('#show_321470120').hide();
            $('#hide_321470120').show();
        });
        $('#hide_321470120').click(function() {
            $('#detail_321470120').slideUp();
            $('#hide_321470120').hide();
            $('#show_321470120').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='8929#1279634503'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-20T14:01:43+00:00">Jul 20, 2010 02:01 PM UTC</time> by <b>Rob Quick</b><a class="anchor" name="1279634503">&nbsp;</a></div><pre>Adding Fermigrid and Gratia Ops to CC.</pre></div><div class='update_description'><i onclick="document.location='8929#1279634219'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-20T13:56:59+00:00">Jul 20, 2010 01:56 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1279634219">&nbsp;</a></div><pre>There have been no new records showing in Gratia for the past ~48 hours.
<a href='http&#58;//t2.unl.edu/gratia/byvo' target='_blank' rel='nofollow'>http&#58;//t2.unl.edu/gratia/byvo</a></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F8929">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 8929});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
