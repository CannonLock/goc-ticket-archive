<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="/">
    <title>[31056] Unable to communicate with the central collector</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="//netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="https://ticket.opensciencegrid.org/images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="https://ticket.opensciencegrid.org/lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=31056" method="post">
<div class="page-header">
    <h3><span class="muted">31056</span> / Unable to communicate with the central collector</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Brian Lin</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Brian Lin</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Check for update</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2016-09-09</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Scott Teige <span class="muted"> / OSG Operations Infrastructure</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("https://ticket.opensciencegrid.org/attachment/list?id=31056", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="/31056?sort=up&"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="/31056?expandall=true&">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Unable%20to%20communicate%20with%20the%20central%20collector%20ISSUE%3D31056%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='31056#1473450004'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-09T19:40:04+00:00">Sep 9, 2016 07:40 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1473450004">&nbsp;</a></div><pre>Thank you for informing us that this issue has been resolved. I will close this ticket.  Please submit problems, requests, and questions at&#58; <a href='https&#58;//ticket.grid.iu.edu/goc/open' target='_blank' rel='nofollow'>https&#58;//ticket.grid.iu.edu/goc/open</a> OSG Grid Operations Center goc@...., 317-278-9699 Visit the OSG Operations Page&#58; <a href='http&#58;//osggoc.blogspot.com/' target='_blank' rel='nofollow'>http&#58;//osggoc.blogspot.com/</a></pre></div><div class='update_description'><i onclick="document.location='31056#1473437809'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-09T16:16:49+00:00">Sep 9, 2016 04:16 PM UTC</time><a class="anchor" name="1473437809">&nbsp;</a></div><pre>Ok, looks good.  I mean, the CEView process is still not exactly correct, but it&#39;s getting there.

I think everything is done in this ticket.

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Derek Weitzel</pre></div><div class='update_description'><i onclick="document.location='31056#1473437496'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-09T16:11:36+00:00">Sep 9, 2016 04:11 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1473437496">&nbsp;</a></div><pre>LVS now forwards TCP ports 80 and 9619 from collector.grid.iu.edu to collector[12].grid.iu.edu. I just added port 80.</pre></div><div class='update_description'><i onclick="document.location='31056#1473430306'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-09T14:11:46+00:00">Sep 9, 2016 02:11 PM UTC</time><a class="anchor" name="1473430306">&nbsp;</a></div><pre>Ok, I see collector2 is working.  At least, I am able to query the main LVS machine multiple times and everything seems to be working.

Next, could you look at the configuration for port 80 on the LVS?

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Derek Weitzel</pre></div><div class='update_description'><i onclick="document.location='31056#1473429214'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-09T13:53:34+00:00">Sep 9, 2016 01:53 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1473429214">&nbsp;</a></div><pre>collector2 is now back in LVS.</pre></div><div class='update_description'><i onclick="document.location='31056#1473356982'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-08T17:49:42+00:00">Sep 8, 2016 05:49 PM UTC</time><a class="anchor" name="1473356982">&nbsp;</a></div><pre>Hi Chris,

Per the update prior to yours, please have a look at the configuration of port 80 before closing the ticket.

Brian

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=bbockelm/CN=659869/CN=Brian Paul Bockelman</pre></div><div class='update_description'><i onclick="document.location='31056#1473349659'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-08T15:47:39+00:00">Sep 8, 2016 03:47 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1473349659">&nbsp;</a></div><pre>To be clear, we can resolve this ticket then?

~Chris</pre></div><div class='update_description'><i onclick="document.location='31056#1473345274'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-08T14:34:34+00:00">Sep 8, 2016 02:34 PM UTC</time><a class="anchor" name="1473345274">&nbsp;</a></div><pre>The collector looks much better.  I am seeing many updates to the collector succeed.  Which is great!

I&#39;m prepared to declare that collector2 is back to good status.  And that we can put it back in the LVS.

The next step that needs to be corrected is sending traffic from port 80 on the LVS to the 2 backend collectors.  That was setup before this was all reconstructed, but it appears it didn&#39;t survive.

Once that port is configured, then I will open a new ticket with the issues with the service running on port 80, the CEView.

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Derek Weitzel</pre></div><div class='update_description'><i onclick="document.location='31056#1473339839'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-08T13:03:59+00:00">Sep 8, 2016 01:03 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1473339839">&nbsp;</a></div><pre>I discovered that collector2&#39;s configuration in Puppet was incorrect, causing it to get collector1&#39;s certificate, probably due to copying/pasting the configuration from collector1 without changing the 1 to a 2. This is probably my fault, as I set that up. I apologize for that and have fixed it. Rebooted collector2 as it is still out of LVS.

Once it&#39;s back up, if someone would test it again, that would be appreciated. If there are no further problems on collector2, I will put it back in LVS.</pre></div><div class='update_description'><i onclick="document.location='31056#1473339311'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-08T12:55:11+00:00">Sep 8, 2016 12:55 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1473339311">&nbsp;</a></div><pre>I have just noticed that collector2 has collector1&#39;s certificate for some reason. There is a certificate for collector2, but somehow collector1&#39;s certificate was installed in its place (/etc/grid-security/host/cert.pem).</pre></div><div class='update_description'><i onclick="document.location='31056#1473197307'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-06T21:28:27+00:00">Sep 6, 2016 09:28 PM UTC</time><a class="anchor" name="1473197307">&nbsp;</a></div><pre>Collector2 is still not working.  From a condor_ping command, I see it is a certificate issue.
WRITE failed!
AUTHENTICATE&#58;1003&#58;Failed to authenticate with any method
AUTHENTICATE&#58;1004&#58;Failed to authenticate using GSI
GSI&#58;5002&#58;Failed to authenticate because the remote (server) side was not able to acquire its credentials.

This usually indicates that the file /etc/grid-security/hostcert.pem and/or /etc/grid-security/hostkey.pem do not exist or are not correct, somehow.  Usually the log in /var/log/condor-ce-collector/CollectorLog or /var/log/condor-ce/CollectorLog will show the actual cause of the error.

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Derek Weitzel</pre></div><div class='update_description'><i onclick="document.location='31056#1473196706'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-06T21:18:26+00:00">Sep 6, 2016 09:18 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1473196706">&nbsp;</a></div><pre>Is there still an issue with collector2? Can someone please test?</pre></div><div class='update_description'><i onclick="document.location='31056#1472867230'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-03T01:47:10+00:00">Sep 3, 2016 01:47 AM UTC</time> by <b>dweitzel@....</b><a class="anchor" name="1472867230">&nbsp;</a></div><pre>Ok, it looks good.

Next item on the list is to figure out what is wrong with collector2?  Should we open a new ticket for that?

-Derek

<font color='#7F7E6F'>&#62; On Sep 2, 2016, at 4&#58;26 PM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='31056#1472851590'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-02T21:26:30+00:00">Sep 2, 2016 09:26 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1472851590">&nbsp;</a></div><pre>I am now seeing that collector.opensciencegrid.org has only an A record in DNS now.</pre></div><div class='update_description'><i onclick="document.location='31056#1472764913'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-01T21:21:53+00:00">Sep 1, 2016 09:21 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1472764913">&nbsp;</a></div><pre>Brian,

I have sent a request to the IU DNS admin to remove the AAAA record for vip-collector.grid.iu.edu (which is what collector.opensciencegrid.org resolves to). Also, I have removed collector2 from the collector LVS ensemble; applicable incoming packets will be forwarded only to collector1, and collector2 will receive no packets not sent directly to it.</pre></div><div class='update_description'><i onclick="document.location='31056#1472762674'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-01T20:44:34+00:00">Sep 1, 2016 08:44 PM UTC</time><a class="anchor" name="1472762674">&nbsp;</a></div><pre>Yes - two items&#58;

1) Please remove IPv6 addresses from the DNS alias.
2) Can you confirm collector2 is not in the VIP currently?

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=bbockelm/CN=659869/CN=Brian Paul Bockelman</pre></div><div class='update_description'><i onclick="document.location='31056#1472753637'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-01T18:13:57+00:00">Sep 1, 2016 06:13 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1472753637">&nbsp;</a></div><pre>Brian,

OK. Is any other action required on this ticket?</pre></div><div class='update_description'><i onclick="document.location='31056#1472753592'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-01T18:13:12+00:00">Sep 1, 2016 06:13 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1472753592">&nbsp;</a></div><pre>The IPv6 firewall accepts TCP packets on ports 9618&#58;9620 unconditionally, and no packet rejections are appearing in the firewall log. Besides that, tcpdump shows IPv6/TCP packets coming in. I currently believe this &#34;connection refused&#34; to be the case where simply nothing is listening for IPv6 packets on port 9619, rather than a firewall rejecting packets.</pre></div><div class='update_description'><i onclick="document.location='31056#1472753380'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-01T18:09:40+00:00">Sep 1, 2016 06:09 PM UTC</time><a class="anchor" name="1472753380">&nbsp;</a></div><pre>Hi Thomas,

I don&#39;t expect collector1/2 to be listening on IPv6; this is explicitly disabled in the configuration right now.

I&#39;m looking forward to enabling it in the future, but let&#39;s go through the ITB process for that first.

Brian

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=bbockelm/CN=659869/CN=Brian Paul Bockelman</pre></div><div class='update_description'><i onclick="document.location='31056#1472753091'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-01T18:04:51+00:00">Sep 1, 2016 06:04 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1472753091">&nbsp;</a></div><pre>I&#39;m not certain that collector1/2 are actually listening on IPv6 (but I don&#39;t know how to fix that)&#58;

root@collector2# netstat -tlpn | grep 9619
tcp        0      0 0.0.0.0&#58;9619                0.0.0.0&#58;*                   LISTEN      1037350/condor_coll

(same output on collector1)</pre></div><div class='update_description'><i onclick="document.location='31056#1472752866'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-01T18:01:06+00:00">Sep 1, 2016 06:01 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1472752866">&nbsp;</a></div><pre>Believing that perhaps because eth0 did not have an IPv6 address and therefore did not have an IPv6 stack running, LVS&#39; forwarding of IPv6 packets would not work, I requested our DNS adminstrator assign IPv6 addresses to our LVS servers, and once they did, I configured them to use those addresses. I did this less than 5 minutes ago, so I&#39;m not sure under what conditions Brian&#39;s message below (currently showing as 19 minutes ago) occurred.

When I telnet to port 9619 on collector.opensciencegrid.org, I now see packets arriving on the LVS server (and departing from it) via tcpdump; I also see packets arriving on collector2. However, I still get a &#34;connection refused.&#34;

$ telnet 2001&#58;18e8&#58;2&#58;6&#58;&#58;22d 9619
Trying 2001&#58;18e8&#58;2&#58;6&#58;&#58;22d...
telnet&#58; connect to address 2001&#58;18e8&#58;2&#58;6&#58;&#58;22d&#58; Connection refused

I then removed collector2 from the LVS ensemble, but I got the same behavior, although tcpdump showed that collector1 was receiving the packet instead.</pre></div><div class='update_description'><i onclick="document.location='31056#1472751504'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-09-01T17:38:24+00:00">Sep 1, 2016 05:38 PM UTC</time><a class="anchor" name="1472751504">&nbsp;</a></div><pre>Hi all,

I see the TCP issues with the VIP have been resolved.

However, it now seems that something is functionally wrong with collector2; collector1 appears healthy.

Can you please bump collector2 out of the VIP and/or restart the collector service?

Also, I still see IPv6 address in DNS.  Since IPv6 isn&#39;t working - and was not tested on ITB - can we please remove the address?

Brian

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=bbockelm/CN=659869/CN=Brian Paul Bockelman</pre></div><div class='update_description'><i onclick="document.location='31056#1472681768'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-31T22:16:08+00:00">Aug 31, 2016 10:16 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1472681768">&nbsp;</a></div><pre>Brian&#39;s telnet commands, however, do show &#34;connection timed out&#34; and &#34;connection refused&#34; rather than &#34;No route to host,&#34; so there is a change, at least.

I am unable to see any packets arriving on collector1/2 using tcpdump. I will have to investigate further as to why, but now that the LVS daemon is itself configured correctly, I must suspect something deeper such as the firewall or kernel settings.</pre></div><div class='update_description'><i onclick="document.location='31056#1472675168'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-31T20:26:08+00:00">Aug 31, 2016 08:26 PM UTC</time><a class="anchor" name="1472675168">&nbsp;</a></div><pre>Brian&#39;s telnet commands below still do not work.

It&#39;s great and all that we now are forwarding IPv6 addresses packets.  But the collector service (HTCondor) is not listening on the IPv6 address.

$ telnet collector.opensciencegrid.org 9619
Trying 2001&#58;18e8&#58;2&#58;6&#58;&#58;22d...
telnet&#58; connect to address 2001&#58;18e8&#58;2&#58;6&#58;&#58;22d&#58; Connection timed out
Trying 129.79.53.211...
^C
$ telnet collector1.opensciencegrid.org 9619
Trying 2001&#58;18e8&#58;2&#58;6&#58;&#58;12d...
telnet&#58; connect to address 2001&#58;18e8&#58;2&#58;6&#58;&#58;12d&#58; Connection refused
Trying 129.79.53.205...
Connected to collector1.opensciencegrid.org.
Escape character is &#39;^]&#39;.
^]

telnet&#62; q
Connection closed.

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Derek Weitzel</pre></div><div class='update_description'><i onclick="document.location='31056#1472674879'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-31T20:21:19+00:00">Aug 31, 2016 08:21 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1472674879">&nbsp;</a></div><pre>Thanks for the decision, Rob. The LVS servers are now configured NOT to auto-monitor collector1 and 2, but to forward IPv6 packets from collector to collector1/2. This should allow dual-stacked and IPv6-only clients to access collector, though I am unable to test this, so I would appreciate if someone with the ability to do so could test it.

Most of our services do not in fact use this automatic test function; if one of the instances goes down we will remove it from LVS manually until its issue is corrected.

Next production window we will try adding IPv6 addresses to the LVS servers and see what impact they may have on other services that use LVS.</pre></div><div class='update_description'><i onclick="document.location='31056#1472674261'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-31T20:11:01+00:00">Aug 31, 2016 08:11 PM UTC</time> by <b>Rob Quick</b><a class="anchor" name="1472674261">&nbsp;</a></div><pre>Tom,

I do not think we can wait until 9/13 to get this functional for dual-stacked clients.

I&#39;ll suggesting decoupling the LVS test. This will prevent auto-failover on an individual outage but since we have a SLA response time of 2 business days on query issues we should be able to keep this up. During the next maintenance cycle please find a more permanent solution that allows auto-forwarding.

Thanks!
Rob</pre></div><div class='update_description'><i onclick="document.location='31056#1472672239'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-31T19:37:19+00:00">Aug 31, 2016 07:37 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1472672239">&nbsp;</a></div><pre>There are really two choices. Our LVS is set up to monitor the two instances of collector, collector1 and collector2, and if one goes down it will automatically remove it from rotation. Currently this test is done via IPv4 (because our LVS servers have no IPv6 addresses). The LVS servers are configured not to forward packets receive on collector&#39;s IPv6 address, because doing so seems to cause the software to attempt to test via IPv6. So to solve that issue, we either have to lose IPv6, or lose the test, and right now we&#39;re opting to lose IPv6.

Another option exists, though&#58; get IPv6 addresses for the LVS servers and start forwarding packets for collector&#39;s IPv6 address. I don&#39;t _think_ this will affect the various other services that the other LVS servers forward for, but this isn&#39;t something I want to rush headlong into. If we choose to try this, we either have to wait for a production window or upgrade it to emergency maintenance.</pre></div><div class='update_description'><i onclick="document.location='31056#1472667566'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-31T18:19:26+00:00">Aug 31, 2016 06:19 PM UTC</time><a class="anchor" name="1472667566">&nbsp;</a></div><pre>Hi Tom,

Any update on the LVS?

-Derek

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Derek Weitzel</pre></div><div class='update_description'><i onclick="document.location='31056#1472489449'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-29T16:50:49+00:00">Aug 29, 2016 04:50 PM UTC</time><a class="anchor" name="1472489449">&nbsp;</a></div><pre>Hi Thomas,

The thing is that there should be *no* IPv6 DNS entries for any of the collector* aliases because the service isn&#39;t listening on IPv6.

However, that&#39;s not the problem here&#58; IPv4 is not working either.  Let&#39;s solve that first.

Brian

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=bbockelm/CN=659869/CN=Brian Paul Bockelman</pre></div><div class='update_description'><i onclick="document.location='31056#1472489057'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-29T16:44:17+00:00">Aug 29, 2016 04:44 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1472489057">&nbsp;</a></div><pre>Our LVS uses direct routing.

It seems as if our LVS servers don&#39;t actually have IPv6 addresses; this has been the case since the removal of all IPv6 addresses for production services a couple of years ago. The intent was to bring these back as we fixed individual services, but progress has been slow. At any rate, it seems that vip-collector.grid.iu.edu has an IPv6 address. Either it should not have one, or the LVS servers should.</pre></div><div class='update_description'><i onclick="document.location='31056#1472484215'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-29T15:23:35+00:00">Aug 29, 2016 03:23 PM UTC</time><a class="anchor" name="1472484215">&nbsp;</a></div><pre>No need to look at the output of condor commands.  You can simply see that the TCP port is not opened&#58;

$ telnet collector.opensciencegrid.org 9619
Trying 2001&#58;18e8&#58;2&#58;6&#58;&#58;22d...
telnet&#58; connect to address 2001&#58;18e8&#58;2&#58;6&#58;&#58;22d&#58; No route to host
Trying 129.79.53.211...
^C
$ telnet collector1.opensciencegrid.org 9619
Trying 2001&#58;18e8&#58;2&#58;6&#58;&#58;12d...
telnet&#58; connect to address 2001&#58;18e8&#58;2&#58;6&#58;&#58;12d&#58; Connection refused
Trying 129.79.53.205...
Connected to collector1.opensciencegrid.org.
Escape character is &#39;^]&#39;.
^]q

telnet&#62; q
Connection closed.

Let&#39;s not bring condor into the picture until we can at least connect to the TCP socket.

Also - *please* do not add IPv6 addresses to the DNS alias unless the service is listening on IPv6!

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=bbockelm/CN=659869/CN=Brian Paul Bockelman</pre></div><div class='update_description'><i onclick="document.location='31056#1472484048'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-29T15:20:48+00:00">Aug 29, 2016 03:20 PM UTC</time><a class="anchor" name="1472484048">&nbsp;</a></div><pre>I talked to some LVS admins here, it depends on NAT vs. direct routing for the IPv6 addresses.  Do you know what type of LVS it is routing?

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Derek Weitzel</pre></div><div class='update_description'><i onclick="document.location='31056#1472484010'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-29T15:20:10+00:00">Aug 29, 2016 03:20 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1472484010">&nbsp;</a></div><pre>Unfortunately &#96;condor_ce_info_status&#96; still hangs. Could you give the
output of the commands that Derek mentioned? Maybe that will help us get
to the bottom of this.

Thanks,
Brian</pre></div><div class='update_description'><i onclick="document.location='31056#1472483554'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-29T15:12:34+00:00">Aug 29, 2016 03:12 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1472483554">&nbsp;</a></div><pre>I looked at the LVS servers and saw that there was a mismatch between the running setup and the config files. I think Scott may have made a change without running the config script.

That said, it was already listening on port 9619 for collector. Scott (or someone; I assume Scott) changed it to listen on *all* TCP ports. Now that I&#39;ve run the config script, it should be doing that.

It&#39;s still configured to only forward IPv4 for collector; should that still be there, considering we recently (August 1) added IPv6 addresses for collector1/2?</pre></div><div class='update_description'><i onclick="document.location='31056#1472483223'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-29T15:07:03+00:00">Aug 29, 2016 03:07 PM UTC</time><a class="anchor" name="1472483223">&nbsp;</a></div><pre>Specifically, we suspect either it&#39;s a firewall issue or LVS issue.  So the output from &#34;iptables-save&#34; or &#34;ipvsadm&#34; could be useful.

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Derek Weitzel</pre></div><div class='update_description'><i onclick="document.location='31056#1472482722'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-29T14:58:42+00:00">Aug 29, 2016 02:58 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1472482722">&nbsp;</a></div><pre>Hey Thomas,

Since Scott&#39;s unavailable, would you be able to take a look at the configuration of the LVS machine?

Thanks,
Brian</pre></div><div class='update_description'><i onclick="document.location='31056#1472236976'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-26T18:42:56+00:00">Aug 26, 2016 06:42 PM UTC</time><a class="anchor" name="1472236976">&nbsp;</a></div><pre>I talked with Brian B.  He said it&#39;s a configuration error on the LVS machine.  It doesn&#39;t have port 9619 port open.

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Derek Weitzel</pre></div><div class='update_description'><i onclick="document.location='31056#1472234217'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-26T17:56:57+00:00">Aug 26, 2016 05:56 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1472234217">&nbsp;</a></div><pre>The following work&#58;
condor_ce_info_status --pool collector1.opensciencegrid.org
condor_ce_info_status --pool collector2.opensciencegrid.org
condor_ping -pool collector.opensciencegrid.org&#58;9619 -verbose READ
condor_ping -pool collector1.opensciencegrid.org&#58;9619 -verbose READ
condor_ping -pool collector2.opensciencegrid.org&#58;9619 -verbose READ
condor_status -pool collector1.opensciencegrid.org&#58;9619 -verbose
condor_status -pool collector2.opensciencegrid.org&#58;9619 -verbose

The following do not&#58;
condor_ce_info_status --pool collector.opensciencegrid.org
condor_status -pool collector.opensciencegrid.org&#58;9619 -verbose

Is there some sort of configuration change I need to make to get collector1,2... respond when hit via collector...?

BTW, I&#39;m heading off for 2 weeks of vacation at the end of the day. Please let me know
if you have ideas otherwise I&#39;ll roll back to previous version.
S</pre></div><div class='update_description'><i onclick="document.location='31056#1472232554'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-26T17:29:14+00:00">Aug 26, 2016 05:29 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1472232554">&nbsp;</a></div><pre>It&#39;s still broken Scott&#58;

$ condor_ce_info_status
Traceback (most recent call last)&#58;
File &#34;/bin/condor_ce_info_status&#34;, line 200, in &#60;module&#62;
sys.exit(main(sys.argv))
File &#34;/bin/condor_ce_info_status&#34;, line 176, in main
ce_ads = htcondorce.info_query.fetchCEAds(collector_addr)
File &#34;/usr/lib/python2.7/site-packages/htcondorce/info_query.py&#34;, line 89, in fetchCEAds
ads            = collector.query(htcondor.AdTypes.Any, constraint)
IOError&#58; Failed communication with collector.
$
$ condor_ping -pool collector.opensciencegrid.org&#58;9619 -verbose READ
ERROR&#58; couldn&#39;t locate (null)!
$
$ condor_status -pool collector.opensciencegrid.org&#58;9619 -verbose
Error&#58; communication error
CEDAR&#58;6001&#58;Failed to connect to &#60;129.79.53.211&#58;9619?alias=collector.opensciencegrid.org&#62;
Error&#58; Couldn&#39;t contact the condor_collector on vip-collector.grid.iu.edu
(&#60;129.79.53.211&#58;9619?alias=collector.opensciencegrid.org&#62;).

Extra Info&#58; the condor_collector is a process that runs on the central
manager of your Condor pool and collects the status of all the machines and
jobs in the Condor pool. The condor_collector might not be running, it might
be refusing to communicate with you, there might be a network problem, or
there may be some other problem. Check with your system administrator to fix
this problem.
If you are the system administrator, check that the condor_collector is
running on vip-collector.grid.iu.edu
(&#60;129.79.53.211&#58;9619?alias=collector.opensciencegrid.org&#62;), check the
ALLOW/DENY configuration in your condor_config, and check the MasterLog and
CollectorLog files in your log directory for possible clues as to why the
condor_collector is not responding. Also see the Troubleshooting section of
the manual.
$
<div id='show_5110247' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_5110247'>$ host collector.opensciencegrid.org
collector.opensciencegrid.org is an alias for vip-collector.grid.iu.edu.
vip-collector.grid.iu.edu has address 129.79.53.211
vip-collector.grid.iu.edu has IPv6 address 2001&#58;18e8&#58;2&#58;6&#58;&#58;22d
$
$ host 129.79.53.211
211.53.79.129.in-addr.arpa domain name pointer vip-collector.grid.iu.edu
</div><script type='text/javascript'>
        $('#show_5110247').click(function() {
            $('#detail_5110247').slideDown("normal");
            $('#show_5110247').hide();
            $('#hide_5110247').show();
        });
        $('#hide_5110247').click(function() {
            $('#detail_5110247').slideUp();
            $('#hide_5110247').hide();
            $('#show_5110247').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F31056">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="/images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 31056});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
