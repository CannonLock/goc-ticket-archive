<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[22263] gratiaweb is down</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=22263" method="post">
<div class="page-header">
    <h3><span class="muted">22263</span> / gratiaweb is down</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Tanya Levshina</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Tanya Levshina</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">High</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2014-09-10</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Thomas Lee <span class="muted"> / OSG Operations Infrastructure</span></div><div class="assignee" style="width: 60%">Scott Teige <span class="muted"> / OSG Operations Infrastructure</span></div><div class="assignee" style="width: 60%">FNAL (Prod)&nbsp;<a target="_blank" href="https://fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000442213">INC000000442213</a> <span class="muted"> / Ticket Exchange</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/22263", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='22263#1410466631'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-11T20:17:11+00:00">Sep 11, 2014 08:17 PM UTC</time><a class="anchor" name="1410466631">&nbsp;</a></div><pre>Yes, it seems to be ok again. Closing this, I know Carl, Marco, Scott and Tanya are talking about long term solutions.

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Robert Quick 62</pre></div><div class='update_description'><i onclick="document.location='22263#1410359139'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-10T14:25:39+00:00">Sep 10, 2014 02:25 PM UTC</time><a class="anchor" name="1410359139">&nbsp;</a></div><pre>Rob,
Are you satisfied that gratiaweb is once again functioning ok?
It would be nice to know the resolution.
John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22263#1410356829'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-10T13:47:09+00:00">Sep 10, 2014 01:47 PM UTC</time><a class="anchor" name="1410356829">&nbsp;</a></div><pre>Scott,
Can you confirm you re-cycled and that solved the problem?
I am seeing reasonable response now from gratiaweb.
John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22263#1410356342'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-10T13:39:02+00:00">Sep 10, 2014 01:39 PM UTC</time><a class="anchor" name="1410356342">&nbsp;</a></div><pre>Wait, Soichi&#39;s context was a suggestion for a code fix.
What we need is gratiaweb recycled is this part of his response...
&#34; at the moment it&#39;s hit and miss (I need to kill the GratiaWeb process and clean up the lock time, reastart apache , etc.. )&#34;
... I think anyway (consider the fact I know nothing about gratiaweb operations/internals.
John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22263#1410356162'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-10T13:36:02+00:00">Sep 10, 2014 01:36 PM UTC</time><a class="anchor" name="1410356162">&nbsp;</a></div><pre>Oh... re-read the Socihi comment... understand the context now.
yes... update
john weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22263#1410356087'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-10T13:34:47+00:00">Sep 10, 2014 01:34 PM UTC</time><a class="anchor" name="1410356087">&nbsp;</a></div><pre>Scott,
I don&#39;t know what you mean by &#34;not updated&#34;.... my ignorance or lack of coffee this morning.
John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22263#1410355983'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-10T13:33:03+00:00">Sep 10, 2014 01:33 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1410355983">&nbsp;</a></div><pre>Found both gratiaweb instances at 100% CPU, memory, had not updated since the 3rd. Reboot was required. If it behaves as usual, it will last a day or two.
John, if it would be useful, I can force an update at any time, just let me know.
S</pre></div><div class='update_description'><i onclick="document.location='22263#1410355802'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-10T13:30:02+00:00">Sep 10, 2014 01:30 PM UTC</time><a class="anchor" name="1410355802">&nbsp;</a></div><pre>Rob,
I don&#39;t think the problem this time is on the database side, at least not this morning.
The original problem was with a large number of &#34;hung&#34; long running queries in the
database which when we cleared them and recycled the database, all was well.
I have been trying to re-create that condition that last 2 days and was close yesterday.

TODAY, in resuming this attempt, gratiaweb is just plain acting weird.  It is not sending
the normal numbers of queries to the database and/or they are timing out.

Back on Friday 9/5, Soichi mentioned this...
&#34;Gratiaweb needs to be updated so that query timeout will not crash the application, and display reasonable error message to the user that there is some issue with the Gratia DB. Gratiaweb should also be updated so that &#34;service GratiaWeb restart&#34; will work without a hitch - at the moment it&#39;s hit and miss (I need to kill the GratiaWeb process and clean up the lock time, reastart apache , etc.. )&#34;

Can someone on the gratiaweb production side look at this to see if it is causing
the behavior I am seeing?   I want to eliminate that as the cause and get back to
seeing if database tuning will resolve the problem of hung queries.

John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22263#1410354622'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-10T13:10:22+00:00">Sep 10, 2014 01:10 PM UTC</time><a class="anchor" name="1410354622">&nbsp;</a></div><pre>Reopening as this is definitely a problem again this morning.

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Robert Quick 62</pre></div><div class='update_description'><i onclick="document.location='22263#1410353471'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-10T12:51:11+00:00">Sep 10, 2014 12:51 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1410353471">&nbsp;</a></div><pre>I&#39;m on vacation until 10/Sep. Please contact the GOC through usual channels in case of emergency.

Scott</pre></div><div class='update_description'><i onclick="document.location='22263#1410353352'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-10T12:49:12+00:00">Sep 10, 2014 12:49 PM UTC</time><a class="anchor" name="1410353352">&nbsp;</a></div><pre>This was down at least briefly again this morning.

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Robert Quick 62</pre></div><div class='update_description'><i onclick="document.location='22263#1409928961'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-05T14:56:01+00:00">Sep 5, 2014 02:56 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1409928961">&nbsp;</a></div><pre>Have we implemented this?
<font color='#7F7E6F'>&#62;  John&#39;s suggestion to kill long running reader queries sounds reasonable.</font>

Also, should I create Jira ticket for these items?
<font color='#7F7E6F'>&#62; Gratiaweb needs to be updated so that query timeout will not crash the application, and display reasonable error message to the user that there is some issue with the Gratia DB. Gratiaweb should also be updated so that &#34;service GratiaWeb restart&#34; will work without a hitch - at the moment it&#39;s hit and miss (I need to kill the GratiaWeb process and clean up the lock time, reastart apache , etc.. )</font></pre></div><div class='update_description'><i onclick="document.location='22263#1409928086'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-05T14:41:26+00:00">Sep 5, 2014 02:41 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1409928086">&nbsp;</a></div><pre>Resolving.</pre></div><div class='update_description'><i onclick="document.location='22263#1409928074'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-05T14:41:14+00:00">Sep 5, 2014 02:41 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1409928074">&nbsp;</a></div><pre>I will be out of the office until September 10th

On Sep 5, 2014, at 10&#58;38 AM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22263#1409928071'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-05T14:41:11+00:00">Sep 5, 2014 02:41 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1409928071">&nbsp;</a></div><pre>I will be out of the office until September 10th

On Sep 5, 2014, at 10&#58;38 AM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22263#1409927896'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-05T14:38:16+00:00">Sep 5, 2014 02:38 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1409927896">&nbsp;</a></div><pre>I will be out of the office until September 10th

On Sep 5, 2014, at 10&#58;34 AM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22263#1409927690'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-05T14:34:50+00:00">Sep 5, 2014 02:34 PM UTC</time><a class="anchor" name="1409927690">&nbsp;</a></div><pre>gratiaweb had been back in service now since Wednesday
so I think this ticket can be closed.
John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22263#1409845815'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-04T15:50:15+00:00">Sep 4, 2014 03:50 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1409845815">&nbsp;</a></div><pre>I&#39;ve un-paused gratiaweb-itb.</pre></div><div class='update_description'><i onclick="document.location='22263#1409840309'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-04T14:18:29+00:00">Sep 4, 2014 02:18 PM UTC</time><a class="anchor" name="1409840309">&nbsp;</a></div><pre>To whomever stopped gratiaweb-itb.grid.eu.edu (Soichi maybe?)...
go ahead and start it again.

John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22263#1409784627'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T22:50:27+00:00">Sep 3, 2014 10:50 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1409784627">&nbsp;</a></div><pre>Thanks Marco!

I took the first query in your attachment as an example (which had already been running for 20241s = ~5.5h).  Without competing with other queries it takes ~15s, and with some of the unnecessary regexs removed or replaced with &#34;=&#34; or &#34;in (...)&#34;, it only takes ~5s (a ~3x speedup).

But again the serious problem happens when they pile up...

Carl</pre></div><div class='update_description'><i onclick="document.location='22263#1409782725'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T22:18:45+00:00">Sep 3, 2014 10:18 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1409782725">&nbsp;</a></div><pre>I attached the full process list form yesterday with the long running queries. It is actually a csv file.
Marco</pre></div><div class='update_description'><i onclick="document.location='22263#1409776955'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T20:42:35+00:00">Sep 3, 2014 08:42 PM UTC</time><a class="anchor" name="1409776955">&nbsp;</a></div><pre>Hi All,

Marco and me were checking the graphtool library, that is the one handling the connections to the database, and  it allows a connection pool of size 25. Therefore if there are 5 instances of the server, there will be a maximum of 125 connections at once.

For now I&#39;ll&#58;

- make a modification to allow setting up a lower pool size for non production servers.
- add some lines to log information about why some connections get stucked for some reason and are not being released.
- review some sqlite cache that maybe is related with the memory leaking problem.

Juan F. Mosquera

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jmosquer/CN=760823/CN=Juan Felipe Mosquera Morales</pre></div><div class='update_description'><i onclick="document.location='22263#1409776272'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T20:31:12+00:00">Sep 3, 2014 08:31 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1409776272">&nbsp;</a></div><pre>So with Gerard&#39;s report in mind, the queries seem to be CPU bound and not bound by disk speed or memory capacity.

Areas mentioned for looking into for optimization&#58;

1. (Gerard&#39;s suggestion) Tune mysql server parameters, including increasing buffer sizes.

2. (Marco&#39;s suggestion) Optimize queries, including looking into regexs that prevent indexes from being used.

3. Look into the current state of indexes on the tables in question.

But, seeing as the gratiaweb page is instantly responsive (as it is now) without a backlog of queries running, things only seem to get bad when there is a backlog.  How can we prevent this?  Would it be helpful to reduce the max connections on the server side?  Or, on the client side, can we introduce a timeout to cancel a query that runs for longer than, say, 5 min?  Because the bad situation we were seeing was having many active querires each running together for several hours.  It seems like if we can cut them at 5 min (which is probably already beyond a browser timeout) we&#39;d be able to avoid things getting really bad.

Carl</pre></div><div class='update_description'><i onclick="document.location='22263#1409776216'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T20:30:16+00:00">Sep 3, 2014 08:30 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1409776216">&nbsp;</a></div><pre>A note in a different email thread, from Gerard&#58;

what I see from the system point of view (ie&#58; dstat, iostat, vmstat, top)
is that this is NOT a disk issue. I am sure about this because there&#39;s no
disk activity in the system, so anything that changes disk locations is
probably going to be an unnecessary risk.

What I do see is that queries are in &#39;Copying to tmp table&#39; and CPU is being
used. To me this means that the queries are causing memory copies and memory
is either not fast enough or perhaps some buffers are full and the DB is
trying to free memory in order to copy data and that&#39;s using the CPU (like
happens with Java and its garbage collection mechanism). Perhaps increasing
the buffers used for this tmp tables would help in this issue. There are
over 50GB of free RAM in the system (the DB is using ~80 out of 130GB).</pre></div><div class='update_description'><i onclick="document.location='22263#1409768121'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T18:15:21+00:00">Sep 3, 2014 06:15 PM UTC</time><a class="anchor" name="1409768121">&nbsp;</a></div><pre>Just an FYI.
I have set up a cron script to run every 15 minutes on fcl301 checking for queries on gratia
that take longer than 10 minutes. Hopefully, this will allow us to id any culprits or at least
identify a time frame when a problem(?) occurs in the event it is not query related.
For those who have access to fcl301, the output will be in this file for now...
/cloud/login/weigand/gratia-db-issue-9-3-14/monitor.sh.out
... don&#39;t do anything but read that file as it is set up to only contain those &#62; 600 seconds
Hopefully, it will be empty at least for now.  I will add some form of email notification tomorrow
but not today as I want that email notification to occur only once per day and I don&#39;t have time today
for that aspect.  Maybe there is some feature in MySql that will do this (would be nice).

John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22263#1409766700'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T17:51:40+00:00">Sep 3, 2014 05:51 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1409766700">&nbsp;</a></div><pre>I&#39;ve paused gratiaweb-itb, and also display-itb.

gratiaweb1/2 both seems to respond normally. John&#39;s suggestion to kill long running reader queries sounds reasonable.

Gratiaweb needs to be updated so that query timeout will not crash the application, and display reasonable error message to the user that there is some issue with the Gratia DB. Gratiaweb should also be updated so that &#34;service GratiaWeb restart&#34; will work without a hitch - at the moment it&#39;s hit and miss (I need to kill the GratiaWeb process and clean up the lock time, reastart apache , etc.. )</pre></div><div class='update_description'><i onclick="document.location='22263#1409765938'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T17:38:58+00:00">Sep 3, 2014 05:38 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1409765938">&nbsp;</a></div><pre>Several of the queries from GratiaWeb abuse the regexp operator also when the where clause could be omitted (a regexp &#39;.*&#39;) or become a comparison (a regexp &#39;^value$&#39;).
Regexp is more inefficient than comparison (=) and also like, because it never uses indexes.
This may not be the only culprit but these queries could be improved.
I opened a Jira ticket with more details&#58;  <a href='https&#58;//jira.opensciencegrid.org/browse/GRATIAWEB-60' target='_blank' rel='nofollow'>https&#58;//jira.opensciencegrid.org/browse/GRATIAWEB-60</a>
Marco</pre></div><div class='update_description'><i onclick="document.location='22263#1409763088'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T16:51:28+00:00">Sep 3, 2014 04:51 PM UTC</time><a class="anchor" name="1409763088">&nbsp;</a></div><pre>Forgot...
keep gratiaweb-itb off for now.

John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22263#1409762883'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T16:48:03+00:00">Sep 3, 2014 04:48 PM UTC</time><a class="anchor" name="1409762883">&nbsp;</a></div><pre>Consensus on this end it is...
let everyone know gratiaweb is available.

John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22263#1409762551'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T16:42:31+00:00">Sep 3, 2014 04:42 PM UTC</time><a class="anchor" name="1409762551">&nbsp;</a></div><pre>Here is what we did (actually Svetlana - fnal)...
1. started by killing off all mysql queries &#62; 10,000 seconds
.. no help
2. then killed them all off.
.. gratiaweb is functional
3. had gratiaweb-itb turned off
.. this one needs to be investigated as to why it creates so many queries/connections

John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22263#1409762031'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T16:33:51+00:00">Sep 3, 2014 04:33 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1409762031">&nbsp;</a></div><pre>Sorry guys, we have too many separate email threads going on about this right now.
Resending here to attempt to get everybody on the same page...

So yesterday we were seeing a ton of gratiaweb queries that had all been
going for several hours each.  John W also had a bunch of queries he was
running hourly from a cron job, also apparently normally very quick, which
had all been running for several hours also.

Killing all the gratiaweb queries didn&#39;t seem to help much initially since
new ones would start right away.  I just tried actually stopping the
gratiaweb service on gratiaweb1/2, killing all the gratiaweb queries, and
restarting the service, and, it does seem tor be pretty responsive now, at
least for the moment&#58;

<a href='http&#58;//gratiaweb.grid.iu.edu/gratia/' target='_blank' rel='nofollow'>http&#58;//gratiaweb.grid.iu.edu/gratia/</a>

Seems like we need to find a way to prevent this kind of downward spiral if
things get behind...

Carl</pre></div><div class='update_description'><i onclick="document.location='22263#1409761824'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T16:30:24+00:00">Sep 3, 2014 04:30 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1409761824">&nbsp;</a></div><pre>Can we try to stop itb (display and gratia web) for couple of days and see if it makes the difference?</pre></div><div class='update_description'><i onclick="document.location='22263#1409759638'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T15:53:58+00:00">Sep 3, 2014 03:53 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1409759638">&nbsp;</a></div><pre>There are a lot of queries that look like that (note - this is for a whole year and a specific vo). I think there are queries for each vo (I can be wrong).
SELECT
S.SiteName   ,
truncate( unix_timestamp(EndTime) / 604800   , 0 ) * 604800    as time,
sum(Cores*WallDuration)/3600
FROM
MasterSummaryData R
JOIN
Probe P on R.ProbeName = P.probename
JOIN
Site S on S.siteid = P.siteid
JOIN
VONameCorrection VC ON (VC.corrid=R.VOcorrid)
JOIN
VO on (VC.void = VO.void)

WHERE
R.EndTime &#62;= &#39;2013-09-03 00&#58;00&#58;00&#39;         AND
R.EndTime &#60; &#39;2014-09-02 23&#58;59&#58;59&#39;       AND
S.SiteName regexp &#39;.*&#39;        AND
VO.VOName regexp &#39;gadu&#39;  AND
VC.VOName regexp &#39;.*&#39;    AND
(NOT (VC.VOName regexp &#39;NONE&#39;           )) AND
(R.ResourceType regexp &#39;^Batch$&#39;             or R.ResourceType = &#39;&#39;) AND
R.CommonName regexp &#39;.*&#39;    AND
(&#39;true&#39;            =&#39;true&#39; OR ApplicationExitCode=0) AND
(&#39;true&#39;              =&#39;true&#39; OR ApplicationExitCode!=0) AND
(NOT (S.SiteName regexp &#39;NONE|Generic|Obsolete&#39;               )) AND
(NOT (R.CommonName regexp &#39;NONE&#39;           )) AND
(NOT (VO.VOName regexp &#39;Unknown|unknown|other&#39;         )) AND
R.WallDuration &#60; 1100000000 AND
R.ProbeName regexp &#39;.*&#39;
AND WallDuration &#62; 0
GROUP BY
S.SiteName   ,
<div id='show_174891407' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_174891407'>time |
</div><script type='text/javascript'>
        $('#show_174891407').click(function() {
            $('#detail_174891407').slideDown("normal");
            $('#show_174891407').hide();
            $('#hide_174891407').show();
        });
        $('#hide_174891407').click(function() {
            $('#detail_174891407').slideUp();
            $('#hide_174891407').hide();
            $('#show_174891407').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='22263#1409759400'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T15:50:00+00:00">Sep 3, 2014 03:50 PM UTC</time><a class="anchor" name="1409759400">&nbsp;</a></div><pre>Forgot to add myself on the cc.
John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22263#1409758650'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T15:37:30+00:00">Sep 3, 2014 03:37 PM UTC</time><a class="anchor" name="1409758650">&nbsp;</a></div><pre>Svetlana,

I think what needs to be done is to kill off all the current queries in the Gratia replica to free things up.
Then we should monitor it to see if there are any specific queries that are the causing this condition.
These are all none-update type processes when user is &#39;reader&#39;.

I believe the ID in the INFORMATION_SCHEMA.PROCESSLIST is the one you want to kill.
Correct me if I am wrong.
This gets the hung ones.

select id,time, user,host,db, state, command
from  INFORMATION_SCHEMA.PROCESSLIST
where user = &#34;reader&#34;
and command=&#34;query&#34;
and time &#62; 10000
order by host;

There are currently 84 rows.

Then we can see if we need to kill the ones where time &#60; 10000

Seem reasonable?
John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22263#1409695210'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-02T22:00:10+00:00">Sep 2, 2014 10:00 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1409695210">&nbsp;</a></div><pre>Sending this to FNAL.

I am not familiar with which support center (assignment group) to select for Gratia operations issue. But I hope this goes to the right group.</pre></div><div class='update_description'><i onclick="document.location='22263#1409694864'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-02T21:54:24+00:00">Sep 2, 2014 09:54 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1409694864">&nbsp;</a></div><pre>Please open a ticket for Gratia Operatio, so it will propagated to SNOW.
Thanks a lot,
Tanya</pre></div><div class='update_description'><i onclick="document.location='22263#1409692250'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-02T21:10:50+00:00">Sep 2, 2014 09:10 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1409692250">&nbsp;</a></div><pre>At the moment, I see 125 queries queued up on upstream gratia DB (gr-osg-mysql-reports.opensciencegrid.org). I am starting to wonder if the FNAL DB issue is back again, and that is the root cause of gratiaweb instability.

Can someone at FNAL check?</pre></div><div class='update_description'><i onclick="document.location='22263#1409690545'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-02T20:42:25+00:00">Sep 2, 2014 08:42 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1409690545">&nbsp;</a></div><pre>As discussed on the conference call, I have downgraded gratiaweb2.grid.iu.edu to roll back the OS update changes of 2014-08-26.  I have NOT done this on either gratiaweb-itb or gratiaweb1, which retain the OS updates of August 26.  I have also rebooted gratiaweb2, which is now running on kernel 2.6.32-431.11.2, as opposed to the 2.6.32-431.23.3 kernel that gratiaweb1 and gratiaweb-itb are currently running.</pre></div><div class='update_description'><i onclick="document.location='22263#1409685770'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-02T19:22:50+00:00">Sep 2, 2014 07:22 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1409685770">&nbsp;</a></div><pre>Do you understand if this is db timeout problem or it is something specific to goc installation?
From our dba&#58;
************************
From my brief observation one of the long running query&#58;
SELECT s.SiteName,
p.ProbeName,
date_format(max(vo.EndTime),&#34;%Y-%m-%d&#34;) as Last_reported,
date_format(p.currenttime,&#34;%Y-%m-%d&#34;) as Last_handshake,
vo.ResourceType,
format(SUM(vo.Njobs),0) AS Njobs,
format(Round(Sum(CpuUserDuration+CpuSystemDuration)/3600),0) as SumCPU,
format(Round(Sum(WallDuration)/3600),0) as SumWCT
FROM
VOProbeSummary vo, Probe p, Site s
WHERE
vo.EndTime &#62;= &#34;2014-02-27&#34;
and vo.ResourceType &#60;&#62; &#34;GridMonitor&#34;
and vo.probename    = p.ProbeName
and  p.siteid       = s.siteid

GROUP BY s.SiteName, p.ProbeName, Last_handshake, vo.ResourceType
ORDER BY s.SiteName, Last_reported desc, p.ProbeName, vo.ResourceType;

************************************
I don&#39;t know if this is related. Juan could get access to long queries log.</pre></div><div class='update_description'><i onclick="document.location='22263#1409685167'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-02T19:12:47+00:00">Sep 2, 2014 07:12 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1409685167">&nbsp;</a></div><pre>I&#39;ve installed Juan&#39;s SSH key on the appropriate hosts and emailed him with the details.</pre></div><div class='update_description'><i onclick="document.location='22263#1409684980'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-02T19:09:40+00:00">Sep 2, 2014 07:09 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1409684980">&nbsp;</a></div><pre>Can we see if there are errors in the apache log that line up with the Proxy Error that Rob pasted below?

Carl</pre></div><div class='update_description'><i onclick="document.location='22263#1409683366'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-02T18:42:46+00:00">Sep 2, 2014 06:42 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1409683366">&nbsp;</a></div><pre>gratiaweb1/2 are down again. This means downgrading to 1.2-28 does not fix this problem.

I still feel that the issue started happening after our last update. Apart from gratiaweb RPMs, we&#39;ve also made following updates.

Aug 26 14&#58;28&#58;40 Updated&#58; glibc-2.12-1.132.el6_5.3.x86_64
Aug 26 14&#58;29&#58;28 Updated&#58; glibc-common-2.12-1.132.el6_5.3.x86_64
Aug 26 14&#58;29&#58;49 Updated&#58; libcom_err-1.41.12-18.el6_5.1.x86_64
Aug 26 14&#58;30&#58;03 Updated&#58; nspr-4.10.6-1.el6_5.x86_64
Aug 26 14&#58;30&#58;10 Updated&#58; nss-util-3.16.1-1.el6_5.x86_64
Aug 26 14&#58;30&#58;16 Updated&#58; 1&#58;cups-libs-1.4.2-52.el6_5.2.x86_64
Aug 26 14&#58;30&#58;23 Updated&#58; php-common-5.3.3-27.el6_5.1.x86_64
Aug 26 14&#58;30&#58;30 Updated&#58; nss-3.16.1-4.el6_5.x86_64
Aug 26 14&#58;30&#58;36 Updated&#58; nss-sysinit-3.16.1-4.el6_5.x86_64
Aug 26 14&#58;30&#58;44 Updated&#58; libss-1.41.12-18.el6_5.1.x86_64
Aug 26 14&#58;30&#58;50 Updated&#58; e2fsprogs-libs-1.41.12-18.el6_5.1.x86_64
Aug 26 14&#58;30&#58;55 Updated&#58; plymouth-core-libs-0.8.3-27.el6_5.1.x86_64
Aug 26 14&#58;31&#58;32 Updated&#58; kernel-firmware-2.6.32-431.23.3.el6.noarch
Aug 26 14&#58;31&#58;37 Updated&#58; plymouth-scripts-0.8.3-27.el6_5.1.x86_64
Aug 26 14&#58;32&#58;08 Updated&#58; kernel-headers-2.6.32-431.23.3.el6.x86_64
Aug 26 14&#58;32&#58;26 Updated&#58; glibc-headers-2.12-1.132.el6_5.3.x86_64
Aug 26 14&#58;32&#58;34 Updated&#58; ca-certificates-2014.1.98-65.0.el6_5.noarch
Aug 26 14&#58;32&#58;42 Updated&#58; openssl-1.0.1e-16.el6_5.15.x86_64
Aug 26 14&#58;32&#58;44 Updated&#58; httpd-tools-2.2.15-31.el6_5.x86_64
Aug 26 14&#58;33&#58;04 Updated&#58; httpd-2.2.15-31.el6_5.x86_64
Aug 26 14&#58;33&#58;09 Updated&#58; php-cli-5.3.3-27.el6_5.1.x86_64
Aug 26 14&#58;33&#58;12 Updated&#58; php-5.3.3-27.el6_5.1.x86_64
Aug 26 14&#58;33&#58;15 Updated&#58; 1&#58;mod_ssl-2.2.15-31.el6_5.x86_64
Aug 26 14&#58;33&#58;21 Updated&#58; glibc-devel-2.12-1.132.el6_5.3.x86_64
Aug 26 14&#58;33&#58;26 Updated&#58; plymouth-0.8.3-27.el6_5.1.x86_64
Aug 26 14&#58;33&#58;50 Installed&#58; kernel-2.6.32-431.23.3.el6.x86_64
Aug 26 14&#58;33&#58;57 Updated&#58; e2fsprogs-1.41.12-18.el6_5.1.x86_64
Aug 26 14&#58;34&#58;22 Updated&#58; nss-tools-3.16.1-4.el6_5.x86_64
Aug 26 14&#58;34&#58;38 Updated&#58; samba4-libs-4.0.0-63.el6_5.rc4.x86_64
Aug 26 14&#58;34&#58;58 Updated&#58; 1&#58;cups-1.4.2-52.el6_5.2.x86_64
Aug 26 14&#58;35&#58;00 Updated&#58; 1&#58;microcode_ctl-1.17-17.el6_5.1.x86_64
<div id='show_532215441' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_532215441'>Aug 26 14&#58;35&#58;03 Updated&#58; nfs-utils-lib-1.1.5-6.el6_5.x86_64
Aug 26 14&#58;35&#58;14 Updated&#58; sos-2.2-47.el6_5.7.noarch
Aug 26 14&#58;35&#58;20 Updated&#58; 1&#58;grub-0.97-84.el6_5.x86_64
Aug 26 14&#58;45&#58;13 Updated&#58; osg-measurements-metrics-db-1.2-29.osg32.el6.noarch
Aug 26 14&#58;45&#58;13 Updated&#58; osg-measurements-metrics-web-1.2-29.osg32.el6.noarch

Question is.. could one of these RPMs cause the problem we are seeing today?
</div><script type='text/javascript'>
        $('#show_532215441').click(function() {
            $('#detail_532215441').slideDown("normal");
            $('#show_532215441').hide();
            $('#hide_532215441').show();
        });
        $('#hide_532215441').click(function() {
            $('#detail_532215441').slideUp();
            $('#hide_532215441').hide();
            $('#show_532215441').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='22263#1409674635'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-02T16:17:15+00:00">Sep 2, 2014 04:17 PM UTC</time> by <b>jmorales@....</b><a class="anchor" name="1409674635">&nbsp;</a></div><pre>Hi Thomas,

My public key is&#58;

---------------------------------------------

ssh-dss
AAAAB3NzaC1kc3MAAACBAPFvCbJWYkETliiYdut/25EHBLeo5AYaeqCBNRoZVbkUK4XUPnMOhsYvOK589pGwrYMWxlskOwWtOqENJM++j3Hi4a713ASZi/T1xXX7UlS/IrB3h6IXqYr1sx0ikr4Krxg58ZqsUcUc1zxUe07jr1zico4Gjo8NHveZblLj24vZAAAAFQCSM9pM/JLq5tuUzdRehGt6FMyVTwAAAIEAi52Ja5Z+Glt9qqWf7XwjSU3bbRlqHChV03VZAcZJCvGokjfuBjW2HQMzMdpZiPbTEJg1hJtrdDgx8ABrTwtEw/p0LBSys8L/eVsi3ZSDgmP9h1e4h0y6HumgKt8qkqDSD0OGKdXdiCq6m1SVcdKQjHaBWhNYT9qpxwd5WL4b/e4AAACBAKzKJa6UaNIgg/U07CjYHVljPGzo31mJwIOyYXHTGGvRzcplFmt7gokucGg5uj6yePbHCeoMMfa/L6y4ZeemVy/mWu0zVFYg8rlYzPqs5Jpuzni8riui9u+ovMzlJahiBOPQ8M30AFiPc8iXq1nwrqRQ8qBM57nJgBFK7wzsZmrW
jmorales@....

---------------------------------------------

Yes, I think I need sudo access if possible.

Thanks,

Juan F. Mosquera

On 2 September 2014 10&#58;44, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62;  [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22263#1409672696'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-02T15:44:56+00:00">Sep 2, 2014 03:44 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1409672696">&nbsp;</a></div><pre>I am set to give Juan access to gratiaweb1/2/-itb (as well as jump) as soon as I get an SSH key from him.  I&#39;m assuming he will need sudo access.</pre></div><div class='update_description'><i onclick="document.location='22263#1409672493'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-02T15:41:33+00:00">Sep 2, 2014 03:41 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1409672493">&nbsp;</a></div><pre>Scott has requested me to downgrade gratiaweb.

I have done following on gratiaweb-itb, and gratiaweb1/2 and restarted GratiaWeb services.

$ yum downgrade --enablerepo=osg-testing osg-measurements-metrics-db osg-measurements-metrics-web

<font color='#7F7E6F'>&#62; Downgrading&#58;</font>
<font color='#7F7E6F'>&#62;  osg-measurements-metrics-db                 noarch                1.2-28.osg32.el6                 osg-testing                126 k</font>
<font color='#7F7E6F'>&#62;  osg-measurements-metrics-web                noarch                1.2-28.osg32.el6                 osg-testing                324 k</font></pre></div><div class='update_description'><i onclick="document.location='22263#1409666210'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-02T13:56:50+00:00">Sep 2, 2014 01:56 PM UTC</time><a class="anchor" name="1409666210">&nbsp;</a></div><pre>Bumping the priority to High. We need to get resolution to this by EOB or downgrade to the previous version and research the updates before bringing them back into production.

Here is the notification sent to the community&#58;

Gratiaweb (gratiaweb.opensciencegrid.org) is currently unavailable. OSG Operations is aware of the situation and is looking into solutions. We apologize for any inconvenience.

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Robert Quick 62</pre></div><div class='update_description'><i onclick="document.location='22263#1409665937'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-02T13:52:17+00:00">Sep 2, 2014 01:52 PM UTC</time><a class="anchor" name="1409665937">&nbsp;</a></div><pre>Adding the error message for completeness&#58;

Proxy Error

The proxy server received an invalid response from an upstream server.
The proxy server could not handle the request GET /gratia/.

Reason&#58; Error reading from remote server

Apache/2.2.15 (Red Hat) Server at gratiaweb.opensciencegrid.org Port 80

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Robert Quick 62</pre></div><div class='update_description'><i onclick="document.location='22263#1409664773'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-02T13:32:53+00:00">Sep 2, 2014 01:32 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1409664773">&nbsp;</a></div><pre>Juan released the changes implemented by Brad. Do you see the same issues with itb? He needs to understand what is causing this problem and he cannot reproduce it locally. Can he get access to the production node and monitor the problem for couple of days? If not we need to downgrade.

Thanks,
Tanya</pre></div><div class='update_description'><i onclick="document.location='22263#1409664136'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-02T13:22:16+00:00">Sep 2, 2014 01:22 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1409664136">&nbsp;</a></div><pre>gratiaweb1/2 are down again now.

Should we downgrade the RPMs? I believe the issue became really bad since our last update (<a href='http&#58;//osggoc.blogspot.com/2014/08/goc-service-update-tuesday-august-26th.html' target='_blank' rel='nofollow'>http&#58;//osggoc.blogspot.com/2014/08/goc-service-update-tuesday-august-26th.html</a>)</pre></div><div class='update_description'><i onclick="document.location='22263#1409339292'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-29T19:08:12+00:00">Aug 29, 2014 07:08 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1409339292">&nbsp;</a></div><pre>Tom, please proceed.
S

Scott Teige PhD
Grid Operations Center Manager
Indiana University Research Technologies
steige@....
Office&#58; +1 812 856 7331

On Aug 29, 2014, at 3&#58;03 PM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22263#1409339022'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-29T19:03:42+00:00">Aug 29, 2014 07:03 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1409339022">&nbsp;</a></div><pre>Assigning this to Tom.

Tom, can you give Juan a temporarily ssh access to gratiaweb1/2?

Juan,

Please send Tom your ssh public key.</pre></div><div class='update_description'><i onclick="document.location='22263#1409333420'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-29T17:30:20+00:00">Aug 29, 2014 05:30 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1409333420">&nbsp;</a></div><pre>is it already a new version? Yes, please involve Juan
Thanks,
Tanya</pre></div><div class='update_description'><i onclick="document.location='22263#1409333290'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-29T17:28:10+00:00">Aug 29, 2014 05:28 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1409333290">&nbsp;</a></div><pre>I just tried and I see that both gratiaweb1/2 are up. Maybe someone already restarted it?

In any case, keep restarting GratiaWeb doesn&#39;t seem to be a good solution. Should we let Juan ssh to it and take a look?</pre></div><div class='update_description'><i onclick="document.location='22263#1409330741'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-29T16:45:41+00:00">Aug 29, 2014 04:45 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1409330741">&nbsp;</a></div><pre>It looks like gratiaweb is down again
Thanks,
Tanya</pre></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F22263">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
