<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[5777] dCache - &#39;No write pools configured&#39; - &#39;java.sql.SQLException&#58; found N records with&#39;</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=5777" method="post">
<div class="page-header">
    <h3><span class="muted">5777</span> / dCache - &#39;No write pools configured&#39; - &#39;java.sql.SQLException&#58; found N records with&#39;</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">neha sharma</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls"></div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2008-11-12</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Neha Sharma <span class="muted"> / OSG Storage Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/5777", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/5777?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/5777?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20dCache%20-%20%26%2339%3BNo%20write%20pools%20configured%26%2339%3B%20-%20%26%2339%3Bjava.sql.SQLException%26%2358%3B%20found%20N%20records%20with%26%2339%3B%20ISSUE%3D5777%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='5777#1225901865'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-11-05T16:17:45+00:00">Nov 5, 2008 04:17 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1225901865">&nbsp;</a></div><pre>user agrees that srmc p-srmrm-srmcp is working and that the problem is with lcg-cp . so closing this ticket.</pre></div><div class='update_description'><i onclick="document.location='5777#1225827114'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-11-04T19:31:54+00:00">Nov 4, 2008 07:31 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1225827114">&nbsp;</a></div><pre>Hi, Tanya

this has been enabled on our dcache,

thanks

wenjing
----- Original Message ----- From&#58; &#34;Tanya Levshina&#34; &#60;tlevshin@....&#62;
To&#58; &#34;&#39;McKee, Shawn&#39;&#34; &#60;smckee@....&#62;; &#34;&#39;Wu, Wenjing&#39;&#34; &#60;wuwj@....&#62;
Cc&#58; &#34;&#39;OSG STORAGE&#39;&#34; &#60;osg-storage@....&#62;
Sent&#58; Monday, November 03, 2008 11&#58;37 AM
Subject&#58; RE&#58; &#39;No write pools configured&#39; - &#39;java.sql.SQLException&#58; found N records with&#39;

Hi Shawn,

Could you please verify that your pnfs.batch has the following entry&#58;
-pnfsDeleteRelay=SrmSpaceManager

It is needed in order to clean up entries in srm database about deleted
files.
Please let us know if this option is set.

Thanks,
Tanya</pre></div><div class='update_description'><i onclick="document.location='5777#1225305030'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-10-29T18:30:30+00:00">Oct 29, 2008 06:30 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1225305030">&nbsp;</a></div><pre>Hi Alex,

This is exactly how it happens - eventually these files get garbage
collected. I just think the associated lifetimes are of the order of 24
hours.

But we want turn around at the level of seconds, that is why abortrequest.
Is needed. Effectively client executed ctl_c, but the client code just
quits w/o sending abortfilerequest.

Sarah, I will talk about it tomorrow in srm deployment teleconference,

Dmitry

On Mon, 27 Oct 2008, Alex Sim wrote&#58;

why is abort request required for non-transferred files?
when a space is allocated by the server and TURL is available for users,
TURL has a pin lifetime. When pin lifetime is expired and put_done is
not issued, server would know the file isn&#39;t properly transferred and
closed. so, in theory, abort request wouldn&#39;t be required although TURL
expiration and the subsequent SURL removal etc (i.e. garbage collection)
would take some time.

-- Alex
asim at lbl dot gov

On 10/27/08 1&#58;29 PM, Sarah Williams wrote&#58;
Hi Dmitry,

Did you ever find out for sure if this is the problem?

--Sarah</pre></div><div class='update_description'><i onclick="document.location='5777#1224694331'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-10-22T16:52:11+00:00">Oct 22, 2008 04:52 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1224694331">&nbsp;</a></div><pre>select count(*) as number, pnfspath, spacereservationid from srmspacefile
where state=0 group by pnfspath, spacereservationid order by number desc ;

should do it
Hi Dmitry,

I agree that we will need to upgrade soon, to avoid falling into this
situation again. I&#39;m looking at the changelog here&#58;
<a href='http&#58;//www.dcache.org/downloads/1.8.0/index.shtml' target='_blank' rel='nofollow'>http&#58;//www.dcache.org/downloads/1.8.0/index.shtml</a>
There&#39;s have been quite a few changes between 1.8.0-12p6 and 1.8.0-15p8,
and it looks like all our headnodes and pools will need to be upgraded
at the same time.   So, we will probably need to schedule downtime.

Thanks for the excellent detective work, Dmitry. &#58;)

- --Sarah

Dmitry Litvintsev wrote&#58;
Hi Sarah,

Thanks for all the information provided.

So here is conclusion&#58;

dcache release dcache-server-1.8.0-12p6

which you have does not have communication between
PnfsManager and SpaceManager implemented so files
do not get removed from srmspace on srmrm immediately.
They do get removed on cleaner action executed on the pool
(that is the file will get removed from space reservation
when it is cleaned from pool)
This does not help much for cases when client retries
quickly.

<div id='show_1850336007' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1850336007'>The bottomline you have to upgrade to newer dcache RPM
where this problem has been solved.

I know that VDT 1.10.1 distributes 1.8.0-15p8 which is free of this
problem.

I understand that soon there will be new VDT release w/ dache 1.9.0-2, but
I would notr recommend to wait for it and either upgrade to 1.8.0-15p8 or
to the last release of CCRC branch - 1.8.0-15p12 which is available from
dcache.org.

regards,

these transfers are from dq2.. so they are using lcg utilies from gLite, (I think),
I never try this with srmcp ..
actually there would be a few retries for this, the first one usually failed with an errormessage like
srm status has been changed..

then the second try would hit the stale db entry.. trigger the message&#58;
space being marked as used..

sorry, we dont have this information in our db any more.. it doesnot happen today..
if I see, I would keep sending more detailed info ..

wenjing

----- Original Message ----- From&#58; &#34;Dmitry Litvintsev&#34; &#60;litvinse@....&#62;
To&#58; &#34;wenjing wu&#34; &#60;wuwj@....&#62;
Cc&#58; &#60;osg-storage@....&#62;; &#60;saewill@....&#62;; &#60;smckee@....&#62;
Sent&#58; Friday, October 17, 2008 4&#58;31 PM
Subject&#58; Re&#58; &#39;No write pools configured&#39; - &#39;java.sql.SQLException&#58; found N records with&#39; (fwd)

Hi Wenjing,

This sounds like familiar problem. I need to recall what was done for
European T1 sites. I believe the issue was with not executing
srmAbortRequest by lcg-cp (or something similar). Thanks a lot for
information, I will try to re-check mail exchanges with LCG.

W/o abort request we do not know if transaction completed or not and
do nothing with the file. That is why you have headache.

Using fermi srmcp we do not have this problem as srmcp properly executes
abort request.

Dmitry

On Fri, 17 Oct 2008, wenjing wu wrote&#58;

Hi, Dmitry

I tried this on 15p11.. it is true it is working in this case..
-bash-3.00$ lcg-cp -v -D srmv2 -T srmv2 -b -t 100  -V atlas -S
ATLASGROUPDISK file&#58;////etc/hosts
<a href='srm&#58;//head01.aglt2.org&#58;8443/srm/managerv2?SFN=/pnfs/aglt2.org/atlasgroupdisk/lcgcptest11' target='_blank' rel='nofollow'>srm&#58;//head01.aglt2.org&#58;8443/srm/managerv2?SFN=/pnfs/aglt2.org/atlasgroupdisk/lcgcptest11</a>

-bash-3.00$ srmrm
<a href='srm&#58;//head01.aglt2.org&#58;8443/srm/managerv2?SFN=/pnfs/aglt2.org/atlasgroupdisk/lcgcptest11' target='_blank' rel='nofollow'>srm&#58;//head01.aglt2.org&#58;8443/srm/managerv2?SFN=/pnfs/aglt2.org/atlasgroupdisk/lcgcptest11</a>
-bash-3.00$ lcg-cp -v -D srmv2 -T srmv2 -b -t 100  -V atlas -S
ATLASGROUPDISK file&#58;////etc/hosts
<a href='srm&#58;//head01.aglt2.org&#58;8443/srm/managerv2?SFN=/pnfs/aglt2.org/atlasgroupdisk/lcgcptest11' target='_blank' rel='nofollow'>srm&#58;//head01.aglt2.org&#58;8443/srm/managerv2?SFN=/pnfs/aglt2.org/atlasgroupdisk/lcgcptest11</a>

dcache=&#62; select * from srmspacefile where pnfspath like &#39;%lcgcptest%&#39;;
id    |    vogroup     |   vorole   | spacereservationid | sizeinbytes |
creationtime  | lifetime |                  pnfspath                  |
pnfsid          | state | deleted
---------+----------------+------------+--------------------+-------------+---------------+----------+--------------------
------------------------+--------------------------+-------+---------
1881648 | /atlas/usatlas | production |             610962 |        7214 |
1224273410068 | 14399977 | /pnfs/aglt2.org/atlasgroupdisk/lcgcptest11 |
000600000000000000003830 |     2 |       1
1881679 | /atlas/usatlas | production |             610962 |        7214 |
1224273449382 | 14399833 | /pnfs/aglt2.org/atlasgroupdisk/lcgcptest11 |
000600000000000000003860 |     2 |       0
(2 rows)

but we do have got a problem with the srmspacefile table..

we have some failed lcg-cp transfers,
I think at first, srm creates an entry for the file, and mark its state as
0..
dcache=&#62; select * from srmspacefile where state=0;
id    | vogroup  | vorole | spacereservationid | sizeinbytes |
creationtime  | lifetime |
pnfspath                                                           |
pnfsid          | state | deleted
---------+----------+--------+--------------------+-------------+---------------+----------+------------------------------
------------------------------------------------------------------------------------------------+--------------------------+--
-----+---------
1881897 | usatlas3 |        |             781751 |     7746911 |
1224273744152 | 14399902 |
/pnfs/aglt2.org/atlascalibdisk/um/AA.v14022007/0085469/mdaq.NoTag.0085469.physics.HLT_Cosmics_MU1.
LB0000.SFO-5._0032.AA.root
| 00080000000000000079B4D0 |     0 |       0

then once the transfer gets started, the state would be modified to 1,
then if the transfer finishes,  the state would be modified to 2..

however, we got some write requests from lcg-cp which can not start the
transfer, then the lcg-cp times out,
but srm doesnt remove the entries.. and deleted is marked as 0..
so next time, when they retry the write with the same file name , it would
fail with a errormessage like&#58;

Space has  been marked as used..

so we end up with lots of stale entries in srmspacefile whose state=0
forever.. I dont know whether srm would delete them later or not, right now,
we run a script to delete those fileid  whoes state=0 and creationtime &#60;
30minutes from SrmSpaceManager to let the retries go through it..

I dont know if this is the same issue with the srmcp-&#62;srmls-&#62;srmcp problem..

thanks

wenjing
----- Original Message ----- From&#58; &#34;Dmitry Litvintsev&#34; &#60;litvinse@....&#62;
To&#58; &#60;osg-storage@....&#62;
Cc&#58; &#60;wuwj@....&#62;; &#60;saewill@....&#62;; &#60;smckee@....&#62;
Sent&#58; Friday, October 17, 2008 3&#58;14 PM
Subject&#58; Re&#58; &#39;No write pools configured&#39; - &#39;java.sql.SQLException&#58; found N
records with&#39; (fwd)

<font color='#7F7E6F'>&#62; Sorry for spamming. I had to fight LISTSERV</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; just to make sure that what am going to say is indeed correct, I build</font>
<font color='#7F7E6F'>&#62; 15p8 (the same one as in VDT), installed it on our test stand and  &#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; srmcp;srmrm;srmcp&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [litvinse@uqbar b15-official-CCRC08-release-p8]$ &#62; srmcp -space_token=587350</font>
<font color='#7F7E6F'>&#62; file&#58;////bin/sh</font>
<font color='#7F7E6F'>&#62; <a href='srm&#58;//fledgling06.fnal.gov/pnfs/fnal.gov/litvinse/NULL/testers/t1.data' target='_blank' rel='nofollow'>srm&#58;//fledgling06.fnal.gov/pnfs/fnal.gov/litvinse/NULL/testers/t1.data</a></font>
<font color='#7F7E6F'>&#62; [litvinse@uqbar b15-official-CCRC08-release-p8]$ srmrm</font>
<font color='#7F7E6F'>&#62; <a href='srm&#58;//fledgling06.fnal.gov/pnfs/fnal.gov/litvinse/NULL/testers/t1.data' target='_blank' rel='nofollow'>srm&#58;//fledgling06.fnal.gov/pnfs/fnal.gov/litvinse/NULL/testers/t1.data</a></font>
<font color='#7F7E6F'>&#62; [litvinse@uqbar b15-official-CCRC08-release-p8]$ &#62; srmcp -space_token=587350</font>
<font color='#7F7E6F'>&#62; file&#58;////bin/sh</font>
<font color='#7F7E6F'>&#62; <a href='srm&#58;//fledgling06.fnal.gov/pnfs/fnal.gov/litvinse/NULL/testers/t1.data' target='_blank' rel='nofollow'>srm&#58;//fledgling06.fnal.gov/pnfs/fnal.gov/litvinse/NULL/testers/t1.data</a></font>
<font color='#7F7E6F'>&#62; [litvinse@uqbar b15-official-CCRC08-release-p8]$ echo $?</font>
<font color='#7F7E6F'>&#62; 0</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; At the database level &#58;</font>
<font color='#7F7E6F'>&#62; srmdcache=# select * from srmspacefile where pnfspath like &#39;%t1.data&#39;;</font>
<font color='#7F7E6F'>&#62;   id   | vogroup | vorole | spacereservationid | sizeinbytes |</font>
<font color='#7F7E6F'>&#62; creationtime  | lifetime |                   pnfspath &#62; |</font>
<font color='#7F7E6F'>&#62; pnfsid          | state | deleted</font>
<font color='#7F7E6F'>&#62; --------+---------+--------+--------------------+-------------+---------------+----------+-----------------------------</font>
-----------------+--------------------------+-------+---------
<font color='#7F7E6F'>&#62; 627345 | testers |        |             587350 |      786424 |</font>
<font color='#7F7E6F'>&#62; 1224269857014 | 14399250 | /pnfs/fnal.gov/litvinse/NULL/testers/t1.data &#62; |</font>
<font color='#7F7E6F'>&#62; 0001000000000000002EA200 |     2 |       1</font>
<font color='#7F7E6F'>&#62; 627346 | testers |        |             587350 |      786424 |</font>
<font color='#7F7E6F'>&#62; 1224269977563 | 14399560 | /pnfs/fnal.gov/litvinse/NULL/testers/t1.data &#62; |</font>
<font color='#7F7E6F'>&#62; 0001000000000000002EA228 |     2 |       0</font>
<font color='#7F7E6F'>&#62; (2 rows)</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; See, there are 2 entries but one of them is marked deleted (this is the</font>
<font color='#7F7E6F'>&#62; first file I put there). You will not see &#39;java.sql.SQLException&#58; found &#62; N</font>
<font color='#7F7E6F'>&#62; records with..&#39; in the log file. Instead on removal you will see &#62; something</font>
<font color='#7F7E6F'>&#62; like this&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; 10/17 13&#58;59&#58;03 Cell(SrmSpaceManager@srm-fledgling06Domain) &#58; Message</font>
<font color='#7F7E6F'>&#62; arrived&#58; PnfsId=0001000000000000002EA200 from</font>
<font color='#7F7E6F'>&#62; [&#62;PnfsManager@pnfsDomain&#58;*@pnfsDomain&#58;*@dCacheDomain]</font>
<font color='#7F7E6F'>&#62; 10/17 13&#58;59&#58;03 Cell(SrmSpaceManager@srm-fledgling06Domain) &#58; Marking &#62; file</font>
<font color='#7F7E6F'>&#62; as deleted 627345 testers  587350 786424 1224269857014 14399250</font>
<font color='#7F7E6F'>&#62; /pnfs/fnal.gov/litvinse/NULL/testers/t1.data 0001000000000000002EA200</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; and subsequent attemp te re srmcp this file will not fail as the &#62; &#34;deleted&#34;</font>
<font color='#7F7E6F'>&#62; flag will be checked. The file with &#34;deleted&#34; flag will eventually be</font>
<font color='#7F7E6F'>&#62; removed by message from cleaner or upon lifetime expiration.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; The same picture must be in 15p11.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; The crucial difference between b12 and b15 setup is this&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [root@fledgling06 opt]# diff /opt/d-cache/config/pnfs.batch</font>
<font color='#7F7E6F'>&#62; /opt/d-cache/config/pnfs.batch.rpmsave</font>
<font color='#7F7E6F'>&#62; 65d64</font>
<font color='#7F7E6F'>&#62; &#60;         -pnfsDeleteRelay=SrmSpaceManager &#92;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; So the communcation between PnfsMAnager and SpaceManager has been added</font>
<font color='#7F7E6F'>&#62; and on removal from pnfs the file gets marked as &#34;deleted&#34;. If I remove</font>
<font color='#7F7E6F'>&#62; this line I will get back to 12p6 behaviour. Unfortunately adding</font>
<font color='#7F7E6F'>&#62; this line in pnfs.batch in 12p6 will not help, need upgrade.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Dmitry</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On Fri, 17 Oct 2008, wenjing wu wrote&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62; sorry, I made a typo there</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; our current version is 1.8.0-15p11</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; later, I could send you a deug package for that..</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; wenjing</font>
<font color='#7F7E6F'>&#62;&#62; ----- Original Message ----- &#62;&#62; From&#58; &#34;Dmitry Litvintsev&#34; &#60;litvinse@....&#62;</font>
<font color='#7F7E6F'>&#62;&#62; To&#58; &#34;wenjing wu&#34; &#60;wuwj@....&#62;</font>
<font color='#7F7E6F'>&#62;&#62; Cc&#58; &#34;Sarah Williams&#34; &#60;saewill@....&#62;; &#34;OSG STORAGE&#34;</font>
<font color='#7F7E6F'>&#62;&#62; &#60;osg-storage@....&#62;; &#34;McKee, Shawn&#34; &#60;smckee@....&#62;</font>
<font color='#7F7E6F'>&#62;&#62; Sent&#58; Friday, October 17, 2008 2&#58;36 PM</font>
<font color='#7F7E6F'>&#62;&#62; Subject&#58; Re&#58; &#39;No write pools configured&#39; - &#39;java.sql.SQLException&#58; &#62;&#62; found</font>
<font color='#7F7E6F'>&#62;&#62; N</font>
<font color='#7F7E6F'>&#62;&#62; records with&#39;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; Hi Wenjing,</font>
<font color='#7F7E6F'>&#62;&#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; There is no release 12p11. Where did you get if from?</font>
<font color='#7F7E6F'>&#62;&#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62; On Fri, 17 Oct 2008, wenjing wu wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;&#62; we have dcache-server-1.8.0-12p11, we still have the same &#62;&#62; &#62;&#62; problem...</font>
<font color='#7F7E6F'>&#62;&#62; &#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;&#62; it turns out we need to clean these entries  by an extral script.. &#62;&#62; &#62;&#62; or</font>
<font color='#7F7E6F'>&#62;&#62; &#62;&#62; else,</font>
<font color='#7F7E6F'>&#62;&#62; &#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;&#62; files retry with the same name would fail...</font>
<font color='#7F7E6F'>&#62;&#62; &#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; &#62;&#62; wenjing</font>
</div><script type='text/javascript'>
        $('#show_1850336007').click(function() {
            $('#detail_1850336007').slideDown("normal");
            $('#show_1850336007').hide();
            $('#hide_1850336007').show();
        });
        $('#hide_1850336007').click(function() {
            $('#detail_1850336007').slideUp();
            $('#hide_1850336007').hide();
            $('#show_1850336007').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='5777#1224635865'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-10-22T00:37:45+00:00">Oct 22, 2008 12:37 AM UTC</time> by <b>echism</b><a class="anchor" name="1224635865">&nbsp;</a></div><pre>Neha,

Are there any updates on this? This ticket has been inactive for a week.

Thank you,
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='5777#1224096251'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-10-15T18:44:11+00:00">Oct 15, 2008 06:44 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1224096251">&nbsp;</a></div><pre>Hey Dmitry,

Is there a query on the DB I can perform to test if any other files are in the same state?

Brian

On Oct 15, 2008, at 10&#58;48 AM, Dmitry Litvintsev wrote&#58;

Hi Sarah,

I cure this problem I  suggest the following&#58;

1) login to admin interface
2) cd SrmSpaceManager
issue &#58;
remove file 169438
remove file 169420

etc...

This way space will be calculated correctly.

back to understanding this problem.

Do you know if these entries were made on the same space token?
(to find out, you can modifiy you query to include also
spacereservationid in select clause)

I would appreciate if youl could do cycle of &#58;

srmcp, srmrm, srmcp

on a file using space token. And if it fails, I need catalina.out and
pnfs.batch file (gzip -9 them and just send them to me (litvinse@....))

<div id='show_1967075525' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1967075525'>In current release I could achieve the same effect as you report only by
misconfiguring pnfs.batch. I want to check this first.

Dmitry

On Wed, 15 Oct 2008, Sarah Williams wrote&#58;

-----BEGIN PGP SIGNED MESSAGE-----
Hash&#58; SHA1

Hi Tanya,

Sure, see attached.

I&#39;m seeing this inside the &#39;dcache&#39; database on our srm door&#58;

dcache=# select id, vogroup, vorole, creationtime from srmspacefile
where
pnfspath=&#39;/pnfs/iu.edu/atlasproddisk/mc08.105001.pythia_minbias.digit.RDO.e357_s462_d126_tid027253_s
ub02556314/RDO.027253._11157.pool.root.1&#39;;
id   |    vogroup     |   vorole   | creationtime
- --------+----------------+------------+---------------
169438 | /atlas/usatlas | production | 1224083377151
169420 | usatlas3       |            | 1224081412190
169416 | usatlas3       |            | 1224081318812
169375 | /atlas/usatlas | production | 1224078023066
169334 | /atlas/usatlas | production | 1224074329869
169125 | /atlas/usatlas | production | 1224070429591
(6 rows)

So indeed, it looks like we now have six space reservations on this
file.  I wonder if deleting these records would allow the transfer to go
through?

- --Sarah

Tanya Levshina wrote&#58;
Hi Sarah,

We have seen this problem in MIT and Purdue. We have submitted the bug to
dcache.org. Unfortunately we cannot reproduce it on our test stand.  It
would be great if you could send us catalina.out, pnfs.batch and
dcache.batch.

Thanks a lot,

Tanya
-----Original Message-----
From&#58; owner-osg-storage@....
[mailto&#58;owner-osg-storage@....] On Behalf Of Sarah Williams
Sent&#58; Wednesday, October 15, 2008 9&#58;48 AM
To&#58; OSG STORAGE
Subject&#58; &#39;No write pools configured&#39; - &#39;java.sql.SQLException&#58; found N
records with&#39;

Dear OSG Storage,

For the past few days, both MWT2 storage elements have had a high SRM
failure rate, mostly due to &#39;No write pools configured for
&#60;usatlas&#58;atlas@osm&#62;)&#39; type errors.  Today when I tried one of the
failing transfers by hand, I caught this in the srm log&#58;

10/15 10&#58;36&#58;54 Cell(SrmSpaceManager@srm-iut2-dc1Domain) &#58;
java.sql.SQLException&#58; found 5 records with
pnfsPath=/pnfs/iu.edu/atlasproddisk/mc08.105001.pythia_minbias.digit.RDO.e35
7_s462_d126_tid027253_sub02556314/RDO.027253._11157.pool.root.1
10/15 10&#58;36&#58;54 Cell(SrmSpaceManager@srm-iut2-dc1Domain) &#58; 	at
diskCacheV111.services.space.ManagerV2.getFile(ManagerV2.java&#58;2251)
10/15 10&#58;36&#58;54 Cell(SrmSpaceManager@srm-iut2-dc1Domain) &#58; 	at
diskCacheV111.services.space.ManagerV2.selectPool(ManagerV2.java&#58;3527)
10/15 10&#58;36&#58;54 Cell(SrmSpaceManager@srm-iut2-dc1Domain) &#58; 	at
diskCacheV111.services.space.ManagerV2.processMessage(ManagerV2.java&#58;2490)
10/15 10&#58;36&#58;54 Cell(SrmSpaceManager@srm-iut2-dc1Domain) &#58; 	at
diskCacheV111.services.space.ManagerV2.access$000(ManagerV2.java&#58;101)
10/15 10&#58;36&#58;54 Cell(SrmSpaceManager@srm-iut2-dc1Domain) &#58; 	at
diskCacheV111.services.space.ManagerV2$1.run(ManagerV2.java&#58;2458)
10/15 10&#58;36&#58;54 Cell(SrmSpaceManager@srm-iut2-dc1Domain) &#58; 	at
java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.ja
va&#58;885)
10/15 10&#58;36&#58;54 Cell(SrmSpaceManager@srm-iut2-dc1Domain) &#58; 	at
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java&#58;9
07)
10/15 10&#58;36&#58;54 Cell(SrmSpaceManager@srm-iut2-dc1Domain) &#58; 	at
java.lang.Thread.run(Thread.java&#58;619)
10/15 10&#58;36&#58;54 Cell(SrmSpaceManager@srm-iut2-dc1Domain) &#58; selectPool&#58;
file is not found, no prior reservations for this file
10/15 10&#58;36&#58;54 Cell(SrmSpaceManager@srm-iut2-dc1Domain) &#58; just
forwarding the message to PoolManager
10/15 10&#58;36&#58;54 Cell(SrmSpaceManager@srm-iut2-dc1Domain) &#58; reply is not
required, finished processing
10/15 10&#58;36&#58;54 Cell(SrmSpaceManager@srm-iut2-dc1Domain) &#58;
messageToForward,  arrived&#58;
type=diskCacheV111.vehicles.PoolMgrSelectWritePoolMsg value=(19)=No
write pools configured for &#60;usatlas&#58;atlas@osm&#62; from
[&#62;PoolManager@dCacheDomain&#58;*@dCacheDomain] going to
[*@srm-iut2-dc1Domain&#58;&#62;SrmSpaceManager@srm-iut2-dc1Domain&#58;*@dCacheDomain&#58;*@g
ridftp-iut2-dc1Domain&#58;GFTP-iut2-dc1-Unknown-156785@gridftp-iut2-dc1Domain]fa
lse
10/15 10&#58;36&#58;54 Cell(SrmSpaceManager@srm-iut2-dc1Domain) &#58;
selectPool((19)=No write pools configured for &#60;usatlas&#58;atlas@osm&#62;)

I&#39;ve seen the &#39;java.sql.SQLException&#58; found 5 records with
pnfsPath=/pnfs/...&#39; error before, when I used srmcp with space token to
write a file, used rm to delete it, and then used srmcp to try to write
it again.  If I understand correctly, the error occurred then because rm
removed the file in pnfs but not the space reservation.

However, I don&#39;t have any reason to believe that this file was every
successfully written, or that it was removed with rm.  Does anyone know
why this might be occurring, or suggestions for troubleshooting?

--Sarah
</div><script type='text/javascript'>
        $('#show_1967075525').click(function() {
            $('#detail_1967075525').slideDown("normal");
            $('#show_1967075525').hide();
            $('#hide_1967075525').show();
        });
        $('#hide_1967075525').click(function() {
            $('#detail_1967075525').slideUp();
            $('#hide_1967075525').hide();
            $('#show_1967075525').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F5777">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 5777});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
