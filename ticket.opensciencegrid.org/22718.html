<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[22718] Verifying user acceptable use policy(AUP) for CMS VO</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=22718" method="post">
<div class="page-header">
    <h3><span class="muted">22718</span> / Verifying user acceptable use policy(AUP) for CMS VO</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Anand Padmanabhan</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Associated VO</label><div class="controls">CMS</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Anand Padmanabhan</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">USCMS</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls"></div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">WIP</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2014-10-24</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">FNAL (Prod)&nbsp;<a target="_blank" href="https://fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000457762">INC000000457762</a> <span class="muted"> / Ticket Exchange</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/22718", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/22718?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/22718?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Verifying%20user%20acceptable%20use%20policy%28AUP%29%20for%20CMS%20VO%20ISSUE%3D22718%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='22718#1414078790'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-23T15:39:50+00:00">Oct 23, 2014 03:39 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1414078790">&nbsp;</a></div><pre>Hi Anand,

John W sent me his results. If the user is suspended in VOMS (due to not signing the AUP), they are removed from site GUMS servers in the next update and unable to unauthenticate to the site.
That&#39;s the desired behavior.

- B

-- by burt at Thu Oct 23 15&#58;38&#58;05 UTC 2014

GOCTX Source&#58; <a href='https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000457762' target='_blank' rel='nofollow'>https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000457762</a></pre></div><div class='update_description'><i onclick="document.location='22718#1413996697'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-22T16:51:37+00:00">Oct 22, 2014 04:51 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1413996697">&nbsp;</a></div><pre>Hi Vince -- thanks for the follow up.

If a user hasn&#39;t signed the AUP, they do get suspended from VOMS, and their DN should not get propagated.
I&#39;ve asked John W to check the GUMS behavior in this case -- it is possible that GUMS does not purge the DN in this instance.

- B

-- by burt at Wed Oct 22 16&#58;50&#58;15 UTC 2014

GOCTX Source&#58; <a href='https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000457762' target='_blank' rel='nofollow'>https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000457762</a></pre></div><div class='update_description'><i onclick="document.location='22718#1413993044'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-22T15:50:44+00:00">Oct 22, 2014 03:50 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1413993044">&nbsp;</a></div><pre>Hi Burt,

Have you had an opportunity to provide feedback to Anand regarding his question&#58;
Am I correct in understanding that if a user has not signed the AUP they will automatically get suspended from USCMS VOMS and their DNs will not be propogated to the sites who are getting this information through edgmkgridmap or GUMS.

Please let me know if I can assist.

Thanks,
Vince</pre></div><div class='update_description'><i onclick="document.location='22718#1413235260'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-13T21:21:00+00:00">Oct 13, 2014 09:21 PM UTC</time> by <b>Anand Padmanabhan</b><a class="anchor" name="1413235260">&nbsp;</a></div><pre>Thanks Burt! Am I correct in understanding that if a user has not signed the AUP they will automatically get suspended from USCMS VOMS and their DNs will not be propogated to the sites who are getting this information through edgmkgridmap or GUMS.</pre></div><div class='update_description'><i onclick="document.location='22718#1413229752'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-13T19:49:12+00:00">Oct 13, 2014 07:49 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1413229752">&nbsp;</a></div><pre>Hi Anand,

We have users sign the AUP via VOMRS, and there&#39;s a 1 year expiration date, so I can backtrack from there.
/C=AT/O=AustrianGrid/OU=OEAW/OU=oeaw-vienna/CN=Vasile Mihai Ghete -- signed 2014-7-30
/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Alberto Sanchez-Hernandez -- signed 2014-2-13

AUP is available here -- I&#39;ll cut and paste below too, in case you cannot access the link.
<a href='https&#58;//lcg-voms.cern.ch&#58;8443/vo/cms/vomrs?path=/RootNode/MemberAction/ResignUsageRules&action=execute' target='_blank' rel='nofollow'>https&#58;//lcg-voms.cern.ch&#58;8443/vo/cms/vomrs?path=/RootNode/MemberAction/ResignUsageRules&action=execute</a>

If the AUP is unsigned, VOMRS refuses to grant a VOMS-signed certificate to the user. I don&#39;t have a comprehensive list, but we could probably get it with some effort if it&#39;s necessary.

- B

--
=============GRID Acceptable Use Policy
By registering with the Virtual Organization (the &#34;VO&#34;) as a GRID user you shall be deemed to accept these conditions of use&#58;

1. You shall only use the GRID to perform work, or transmit or store data consistent with the stated goals and policies of the VO of which you are a member and in compliance with these conditions of use.

2. You shall not use the GRID for any unlawful purpose and not (attempt to) breach or circumvent any GRID administrative or security controls. You shall respect copyright and confidentiality agreements and protect your GRID credentials (e.g. private keys, passwords), sensitive data and files.

3. You shall immediately report any known or suspected security breach or misuse of the GRID or GRID credentials to the incident reporting locations specified by the VO and to the relevant credential issuing authorities.

4. Use of the GRID is at your own risk. There is no guarantee that the GRID will be available at any time or that it will suit any purpose.

5. Logged information, including information provided by you for registration purposes, shall be used for administrative, operational, accounting, monitoring and security purposes only. This information may be disclosed to other organizations anywhere in the world for these purposes. Although efforts are made to maintain confidentiality, no guarantees are given.

6. The Resource Providers, the VOs and the GRID operators are entitled to regulate and terminate access for administrative, operational and security purposes and you shall immediately comply with their instructions.

7. You are liable for the consequences of any violation by you of these conditions of use.

=============VO Acceptable Use Policy cms
This Acceptable Use Policy applies to all members of the CMS Virtual Organisation,
hereafter referred to as the VO, with reference to use of the LCG/EGEE Grid
infrastructure, hereafter referred to as the Grid. The CMS Collaboration
<div id='show_623645530' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_623645530'>owns and gives authority to this policy.
The goal of the VO is to allow members of the CMS collaboration to perform
all the computing activities relevant for the CMS experiment and the analysis of
the data collected by it.
Members and Managers of the VO agree to be bound by the Grid Acceptable
Usage Rules, VO Security Policy and other relevant Grid Policies, and to use the Grid
only in the furtherance of the stated goal of the VO.

-- by burt at Mon Oct 13 19&#58;48&#58;18 UTC 2014

GOCTX Source&#58; <a href='https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000457762' target='_blank' rel='nofollow'>https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000457762</a>
</div><script type='text/javascript'>
        $('#show_623645530').click(function() {
            $('#detail_623645530').slideDown("normal");
            $('#show_623645530').hide();
            $('#hide_623645530').show();
        });
        $('#hide_623645530').click(function() {
            $('#detail_623645530').slideUp();
            $('#hide_623645530').hide();
            $('#show_623645530').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='22718#1413228848'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-13T19:34:08+00:00">Oct 13, 2014 07:34 PM UTC</time> by <b>Anand Padmanabhan</b><a class="anchor" name="1413228848">&nbsp;</a></div><pre>Dear VO Managers,

The OSG security team is conducting a drill/audit of OSG VOs to check if VO users are actually signing Acceptable User Policy (AUP). As we mentioned in an email few weeks ago OSG VOs are expected to ensure that they have an AUP and that their users are made aware of it periodically. Specifically, three conditions were outlined

1. If VO users have a certificate that is registered in its VOMS server, then the associated VOMS Admin interface or another equivalent system should have a valid VO AUP and the users are expected to read and accept the AUP atleast once a year, failing which the user much be suspended from the VO. The acceptance of AUP by the user needs to be recorded.
2. If the VO uses a pilot job framework (e.g. glideinWMS), and its users have ssh access to a glidein frontend (or equivalent) from where they submit jobs to OSG, then the login to the frontend system should display the usage conditions and provide a link to the VO AUP. Since it would be difficult to record acceptance during every login, a message displayed immediately after login should indicate that if users don&#39;t accept the AUP they should immediately exit and not submit jobs to OSG.
3. If VO uses a Science Gateway (or equivalent) system, then users of such gateway should be asked to accept the VO AUP during registration, and a link to the AUP should be made available during login. The acceptance of AUP by the user needs to be recorded during their registration, and text indicating that they accept AUP by logging in to the system should be displayed on the login page.

We understand that USCMS users have their own certificates which they are required to use to submit jobs (even when using glidein) on the OSG. I selected two random users from your VO below.
/C=AT/O=AustrianGrid/OU=OEAW/OU=oeaw-vienna/CN=Vasile Mihai Ghete
/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Alberto Sanchez-Hernandez

Please send us the following information
(a) When they last signed the AUP. (Any information that would provide proof of the users having reviewed and signed the AUP is sufficient.)
(b) A link to the AUP they signed.
(c) A list of users if any who have not signed the AUP, and what action if any has been taken against them.

Best
Anand
On behalf of OSG Security</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F22718">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 22718});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
