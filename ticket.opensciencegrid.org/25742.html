<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[25742] gridftp/lcmaps</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=25742" method="post">
<div class="page-header">
    <h3><span class="muted">25742</span> / gridftp/lcmaps</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Kevin M Fox</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Kevin M Fox</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Resolved</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2015-07-02</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div><div class="assignee" style="width: 60%">Matyas Selmeci <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/25742", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/25742?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/25742?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20gridftp%2Flcmaps%20ISSUE%3D25742%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='25742#1435193430'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-25T00:50:30+00:00">Jun 25, 2015 12:50 AM UTC</time> by <b>Dave Dykstra</b><a class="anchor" name="1435193430">&nbsp;</a></div><pre>Right, sorry for the typo on the variable.  I should have copy/pasted instead of retyping.

I thought there was something in /usr/share/osg, but then I didn&#39;t see it in rpm -qf globus-gridftp-server.  That&#39;s because it is in globus-gridftp-server-progs.  I&#39;m glad you found the real source.</pre></div><div class='update_description'><i onclick="document.location='25742#1435188603'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-24T23:30:03+00:00">Jun 24, 2015 11:30 PM UTC</time><a class="anchor" name="1435188603">&nbsp;</a></div><pre>Ah. Found the problem. Its&#58;
LLGT_LIFT_PRIVILEGED_PROTECTION=0 /usr/sbin/globus-gridftp-server -c /etc/gridftp.conf -C /etc/gridftp.d -pidfile /var/run/globus-gridftp-server.pid
not
LLGT_LIFT_PRIVILEGE_PROTECTION=0 /usr/sbin/globus-gridftp-server -c /etc/gridftp.conf -C /etc/gridftp.d -pidfile /var/run/globus-gridftp-server.pid

The former does seem to work. I&#39;m able to transfer files and the owner is correct. Dave, you were right.

I think I tried sourcing the wrong file before. it should be &#34;. /usr/share/osg/sysconfig/globus-gridftp-server&#34; not &#34;. /etc/sysconfig/globus-gridftp-server&#34;

After destroying the container and restarting it with a &#34;. /usr/share/osg/sysconfig/globus-gridftp-server&#34; before the gridftp server start, it works.

So, I think that&#39;s the solution and this ticket can be closed.

Thanks for the help.
Kevin

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Kevin M Fox 2461</pre></div><div class='update_description'><i onclick="document.location='25742#1435187447'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-24T23:10:47+00:00">Jun 24, 2015 11:10 PM UTC</time><a class="anchor" name="1435187447">&nbsp;</a></div><pre>grepping through the rpm contents, /etc/sysconfig/globus-gridftp-server contains&#58;
export LLGT_LIFT_PRIVILEGED_PROTECTION=1

Sourcing the file and then rerunning the gridftp server didn&#39;t help.

Trying to manually run&#58;
LLGT_LIFT_PRIVILEGE_PROTECTION=0 /usr/sbin/globus-gridftp-server -c /etc/gridftp.conf -C /etc/gridftp.d -pidfile /var/run/globus-gridftp-server.pid

Didn&#39;t work either.

Thanks,
Kevin

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Kevin M Fox 2461</pre></div><div class='update_description'><i onclick="document.location='25742#1435183405'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-24T22:03:25+00:00">Jun 24, 2015 10:03 PM UTC</time> by <b>Dave Dykstra</b><a class="anchor" name="1435183405">&nbsp;</a></div><pre>That message is erroneous, because lcmaps is not supposed to switch the uid/gid for gridftp.  Globus does it after lcmaps returns. The message comes from lcas-lcmaps-gt4-interface and is supposed to be shut off via the environment variable LLGT_LIFT_PRIVILEGE_PROTECTION.   According to <a href='https&#58;//jira.opensciencegrid.org/browse/SOFTWARE-879' target='_blank' rel='nofollow'>https&#58;//jira.opensciencegrid.org/browse/SOFTWARE-879</a>, this was in bulit in to globus-gridftp-server-6.14-3.  However you&#39;re running globus-gridftp-server-7.20-1, the current version, and it appears to have been dropped from there, I don&#39;t know why (or if I did, I don&#39;t remember and can&#39;t find it in my saved email).   The only other related thing I found is <a href='https&#58;//jira.opensciencegrid.org/browse/REQUESTS-62' target='_blank' rel='nofollow'>https&#58;//jira.opensciencegrid.org/browse/REQUESTS-62</a> which includes a relatively recent set of instructions for telling lcmaps to set the uid & gid again in a case where we wanted lcmaps to set the gid because globus couldn&#39;t do it.  (I think the part about setting LLGT_LIFT_PRIVILEGE_PROTECTION=0 may be bogus though because it doesn&#39;t matter what it is set to if it is set at all).

So it might not have to do with being run from docker, it might be a general problem.</pre></div><div class='update_description'><i onclick="document.location='25742#1435179240'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-24T20:54:00+00:00">Jun 24, 2015 08:54 PM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1435179240">&nbsp;</a></div><pre>I&#39;m stumped. Adding Dave Dykstra to this ticket.

Dave, can you think of what might cause the lcmaps plugin to apparently authenticate but not attempt a setuid or variant? Or perhaps where we can look futher?

Thanks,
-Mat</pre></div><div class='update_description'><i onclick="document.location='25742#1434726123'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-19T15:02:03+00:00">Jun 19, 2015 03:02 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1434726123">&nbsp;</a></div><pre>Mat/Kevin,

Checking in to see if there has been any conversation outside of this ticket regarding this issue.
If I can assist please let me know.

Thank you,
Vince</pre></div><div class='update_description'><i onclick="document.location='25742#1434056281'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-11T20:58:01+00:00">Jun 11, 2015 08:58 PM UTC</time><a class="anchor" name="1434056281">&nbsp;</a></div><pre>Ok. If I run with --privileged and then&#58;
[root@pic /]# capsh --caps=&#39;=ep&#39; -- -c &#39;capsh --print&#39;
Current&#58; =ep
Bounding set =cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin
Securebits&#58; 00/0x0
secure-noroot&#58; no (unlocked)
secure-no-suid-fixup&#58; no (unlocked)
secure-keep-caps&#58; no (unlocked)
uid=0

Which looks the same as the non containered version.

then&#58;
capsh --caps=&#39;=ep&#39; -- -c &#39;strace -s 1000 -o /tmp/dump /usr/sbin/globus-gridftp-server -c /etc/gridftp.conf -C /etc/gridftp.d -pidfile /var/run/globus-gridftp-server.pid&#39;

still no setreuid or setuid in the dump.

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Kevin M Fox 2461</pre></div><div class='update_description'><i onclick="document.location='25742#1434055748'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-11T20:49:08+00:00">Jun 11, 2015 08:49 PM UTC</time><a class="anchor" name="1434055748">&nbsp;</a></div><pre>No setreuid&#39;s in the strace.

As far as I understand it, docker doesn&#39;t use UID namespaces? I don&#39;t see an option for it, and its a pretty new feature relative to pid,mount,network,etc namespaces.

The container is running as root, and if I set it to /bin/bash, I can sudo to other users. So its not a privilege thing. without lcmaps gridftp works ok. I even tried the docker run --privileged flag, jut to be sure. No difference.

The only thing I can think of is lcmaps is poking around looking at something that the container presents that is different then the physical machine, and then lcmaps is giving up and not even trying the setreuid.

I did notice this one difference just a few minutes ago. I don&#39;t know caps very well, but outside the container&#58;
[root@pic ~]# capsh --print
Current&#58; =ep
Bounding set =cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin
Securebits&#58; 00/0x0
secure-noroot&#58; no (unlocked)
secure-no-suid-fixup&#58; no (unlocked)
secure-keep-caps&#58; no (unlocked)
uid=0

Inside&#58;
Current&#58; =ep cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin,34,35,36+i
Bounding set =cap_chown,cap_dac_override,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_linux_immutable,cap_net_bind_service,cap_net_broadcast,cap_net_admin,cap_net_raw,cap_ipc_lock,cap_ipc_owner,cap_sys_module,cap_sys_rawio,cap_sys_chroot,cap_sys_ptrace,cap_sys_pacct,cap_sys_admin,cap_sys_boot,cap_sys_nice,cap_sys_resource,cap_sys_time,cap_sys_tty_config,cap_mknod,cap_lease,cap_audit_write,cap_audit_control,cap_setfcap,cap_mac_override,cap_mac_admin
Securebits&#58; 00/0x0
secure-noroot&#58; no (unlocked)
secure-no-suid-fixup&#58; no (unlocked)
secure-keep-caps&#58; no (unlocked)
uid=0

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Kevin M Fox 2461</pre></div><div class='update_description'><i onclick="document.location='25742#1434054182'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-11T20:23:02+00:00">Jun 11, 2015 08:23 PM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1434054182">&nbsp;</a></div><pre>Looks like the lcmaps plugin is using setreuid, not plain setuid.  Do you see any of those?
Do you see anything from lcmaps in the syslog?

I&#39;d be willing to bet this has something to do with UID namespaces in the container, but without further debugging, I don&#39;t know how...

-Mat</pre></div><div class='update_description'><i onclick="document.location='25742#1433971668'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-10T21:27:48+00:00">Jun 10, 2015 09:27 PM UTC</time><a class="anchor" name="1433971668">&nbsp;</a></div><pre>Nope. Still broken and I don&#39;t know why. I&#39;m assuming its a bug in lcmaps somehow since its clearly not trying to switch users like it claims it should.

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Kevin M Fox 2461</pre></div><div class='update_description'><i onclick="document.location='25742#1433968456'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-10T20:34:16+00:00">Jun 10, 2015 08:34 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1433968456">&nbsp;</a></div><pre>Greetings all,

Any updates outside of this ticket?  Please let me know if I can assist.

Thanks!
Vince</pre></div><div class='update_description'><i onclick="document.location='25742#1433528745'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-05T18:25:45+00:00">Jun 5, 2015 06:25 PM UTC</time><a class="anchor" name="1433528745">&nbsp;</a></div><pre>One more piece to the puzzle. I was logging the LCMAPS stuff to a file.

When I disabled that and passed in the underlying system&#39;s syslog socket, I saw one extra message in the logs&#58;
Jun  5 10&#58;58&#58;43 pic globus-gridftp-server&#58; You are still root after the LCMAPS execution. The implicit root-mapping safety is enabled. See documentation for details.

So, for some reason the plugin is not actually switching users.

Any idea why that might be? I&#39;m not seeing much in a strace that makes it look like its even trying to switch users. Shouldn&#39;t there be a setuid or some such syscall?

Thanks,
Kevin

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Kevin M Fox 2461</pre></div><div class='update_description'><i onclick="document.location='25742#1433524672'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-05T17:17:52+00:00">Jun 5, 2015 05:17 PM UTC</time><a class="anchor" name="1433524672">&nbsp;</a></div><pre>Hi,

Well maybe Mat, can u take a look here?

Edgar
OSG Software Support

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Edgar Mauricio Fajardo Hernandez 2020</pre></div><div class='update_description'><i onclick="document.location='25742#1433438363'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-04T17:19:23+00:00">Jun 4, 2015 05:19 PM UTC</time><a class="anchor" name="1433438363">&nbsp;</a></div><pre>See the attached rpm list. Note, I tried it with stock osg repo, and I also tried enabling osg-testing and upgrading to that. Both have the same issue. The attached list may still have a few rpms from osg-testing in the list.

Restarting the gridftp server doesn&#39;t help, nor re fetch-crl&#39;ing. If I comment everything out of /etc/grid-security/gsi-authz.conf, it works. So it is something to do with the liblcas_lcmaps_gt4_mapping.so subsystem somehow.

Thanks,
Kevin

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Kevin M Fox 2461</pre></div><div class='update_description'><i onclick="document.location='25742#1433437584'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-04T17:06:24+00:00">Jun 4, 2015 05:06 PM UTC</time><a class="anchor" name="1433437584">&nbsp;</a></div><pre>HI Kevin,

This looks interesting. I am not a docker expert, so I am not sure how this things would work in docker. But lets make sure of three things&#58;

1. osg-ca-certs is installed. yum install osg-ca-certs and u have the latest
2. Run fetch-crl

Restart the gridftp and try again. Also can u include the version of gridftp u are using?

Cheers,
Edgar
OSG Software Support

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Edgar Mauricio Fajardo Hernandez 2020</pre></div><div class='update_description'><i onclick="document.location='25742#1433436357'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-04T16:45:57+00:00">Jun 4, 2015 04:45 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1433436357">&nbsp;</a></div><pre>Kevin,

Thanks!  While I look through this, have you tried just restarting the gridftp server? I know it&#39;s a long shot, but for problems much like this (specifically with lcmaps), that has been a simple fix in the past.

-Kyle</pre></div><div class='update_description'><i onclick="document.location='25742#1433433460'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-04T15:57:40+00:00">Jun 4, 2015 03:57 PM UTC</time><a class="anchor" name="1433433460">&nbsp;</a></div><pre>/etc/sysconfig/globus-gridftp-server is default. only comments in it.

lcmaps.db attached. Its in gridmap mode, but switching it to gums has the same problem.

Thanks,
Kevin

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Kevin M Fox 2461</pre></div><div class='update_description'><i onclick="document.location='25742#1433431720'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-04T15:28:40+00:00">Jun 4, 2015 03:28 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1433431720">&nbsp;</a></div><pre>Hi Kevin,

Could you attach the following files to this ticket?

/etc/lcmaps.db
/etc/sysconfig/globus-gridftp-server

Thanks!
Vince</pre></div><div class='update_description'><i onclick="document.location='25742#1433375847'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-03T23:57:27+00:00">Jun 3, 2015 11:57 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1433375847">&nbsp;</a></div><pre>Trying to get gridftp into a docker container to make repeatable versioned deployments possible. Its 98% working.

If I use a gridmap file, it can transfer data properly. If I enable lcmaps like&#58;
more /etc/grid-security/gsi-authz.conf
globus_mapping liblcas_lcmaps_gt4_mapping.so lcmaps_callout

And set in lcmaps.db&#58;
gridmapfile -&#62; good | bad

and set LCMAPS_DEBUG_LEVEL=5
out of the client I get&#58;
error&#58; globus_ftp_client&#58; the server responded with an error
530 530-Login incorrect. &#58; globus_gss_assist&#58; Error invoking callout
530-globus_callout_module&#58; The callout returned an error
530-an unknown error occurred
530 End.

out of the lcmaps log&#58;
....
lcmaps[878]    LOG_INFO&#58; 2015-06-03.23&#58;27&#58;23Z&#58; lcmaps_dummy_good-plugin_run()&#58; good plugin succeeded
lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; Execution of plugin &#34;lcmaps_dummy_good.mod&#34;. Result&#58; Success.
lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; lcmaps.mod-lcmaps_runPluginManager()&#58; lcmaps_runEvaluationManager() succeeded.
lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; Credential Print&#58;
lcmaps[878]  LOG_NOTICE&#58; 2015-06-03.23&#58;27&#58;23Z&#58; LCMAPS CRED FINAL&#58; DN&#58;&#34;/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Kevin Fox&#34;-&#62;mapped uid&#58;&#39;700&#39;,pgid&#58;&#39;700&#39;,sgid&#58;&#39;700&#39;
lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; lcmaps_run_and_return_username()&#58; succeeded
lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; Termination LCMAPS
lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; lcmaps_term()&#58; terminating
lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; lcmaps.mod-lcmaps_stopPluginManager()&#58; cleaning credential data
lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; lcmaps_localaccount-plugin_terminate()&#58; terminating
lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; lcmaps.mod-clean_plugin_list()&#58; plugin module /usr/lib64/lcmaps/lcmaps_localaccount.mod terminated
lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; lcmaps_dummy_good-plugin_terminate()&#58; terminating
lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; lcmaps.mod-clean_plugin_list()&#58; plugin module /usr/lib64/lcmaps/lcmaps_dummy_good.mod terminated
lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; lcmaps_dummy_bad-plugin_terminate()&#58; terminating
lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; lcmaps.mod-clean_plugin_list()&#58; plugin module /usr/lib64/lcmaps/lcmaps_dummy_bad.mod terminated
lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; lcmaps_stopEvaluationManager&#58; cleaning up!
<div id='show_2052556599' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_2052556599'>lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; freeing plugin lcmaps_localaccount.mod at address 0x1c5ab90
lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; freeing plugin lcmaps_dummy_good.mod at address 0x1c8aa00
lcmaps[878]   LOG_DEBUG&#58; 2015-06-03.23&#58;27&#58;23Z&#58; freeing plugin lcmaps_dummy_bad.mod at address 0x1c6e5d0

A seemingly clean exit. But no workie. Any ideas why a simple lcmaps config that matches the non lcmaps config with gridmap fails? I see the same thing when I enable gums. it gets the right mapping, but things still fail in gridftp.

Docker container is here if you want to see the list of packages installed&#58;
<a href='https&#58;//registry.hub.docker.com/u/kfox1111/osg-gridftp/' target='_blank' rel='nofollow'>https&#58;//registry.hub.docker.com/u/kfox1111/osg-gridftp/</a>

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Kevin M Fox 2461

</div><script type='text/javascript'>
        $('#show_2052556599').click(function() {
            $('#detail_2052556599').slideDown("normal");
            $('#show_2052556599').hide();
            $('#hide_2052556599').show();
        });
        $('#hide_2052556599').click(function() {
            $('#detail_2052556599').slideUp();
            $('#hide_2052556599').hide();
            $('#show_2052556599').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F25742">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
