<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[33618] Suspicious looking &#34;SUM Wallclock Work HS06 Hours&#34; number for T2_US_Wisconsin (CMS VO usage) in EGI accounting portal for April</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=33618" method="post">
<div class="page-header">
    <h3><span class="muted">33618</span> / Suspicious looking &#34;SUM Wallclock Work HS06 Hours&#34; number for T2_US_Wisconsin (CMS VO usage) in EGI accounting portal for April</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">AJIT MOHAPATRA</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">AJIT MOHAPATRA</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">GRACC (Operations)</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2017-05-09</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Kyle Gross <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">GRACC (Operations) <span class="muted"> / OSG Support Centers</span></div><div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div><div class="assignee" style="width: 60%">Carl Edquist <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("https://ticket.opensciencegrid.org/attachment/list?id=33618", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="https://ticket.opensciencegrid.org/\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="https://ticket.opensciencegrid.org/\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/33618?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/33618?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Suspicious%20looking%20%26%2334%3BSUM%20Wallclock%20Work%20HS06%20Hours%26%2334%3B%20number%20for%20T2_US_Wisconsin%20%28CMS%20VO%20usage%29%20in%20EGI%20accounting%20portal%20for%20April%20ISSUE%3D33618%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='33618#1494609471'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-12T17:17:51+00:00">May 12, 2017 05:17 PM UTC</time><a class="anchor" name="1494609471">&nbsp;</a></div><pre>All the concerns we had in this ticket have been addressed.

Thanks!

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=dbradley/CN=614788/CN=Daniel Charles Bradley</pre></div><div class='update_description'><i onclick="document.location='33618#1494609221'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-12T17:13:41+00:00">May 12, 2017 05:13 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1494609221">&nbsp;</a></div><pre>Sounds good, was there anything else you needed, Dan?</pre></div><div class='update_description'><i onclick="document.location='33618#1494607057'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-12T16:37:37+00:00">May 12, 2017 04:37 PM UTC</time><a class="anchor" name="1494607057">&nbsp;</a></div><pre>As of a couple days ago, non-zero numbers started showing up in APEL.  Whatever was preventing updates seems to have been unplugged.

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=dbradley/CN=614788/CN=Daniel Charles Bradley</pre></div><div class='update_description'><i onclick="document.location='33618#1494604517'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-12T15:55:17+00:00">May 12, 2017 03:55 PM UTC</time><a class="anchor" name="1494604517">&nbsp;</a></div><pre><font color='#7F7E6F'>&#62; BrianL at Slack channel&#58;</font>
<font color='#7F7E6F'>&#62; wisc may hours still aren&#39;t showing up in APEL&#58; <a href='https&#58;//accounting.egi.eu/tier2/site/GLOW/normelap_processors/VO/DATE/2017/5/2017/5/lhc/onlyinfrajobs/' target='_blank' rel='nofollow'>https&#58;//accounting.egi.eu/tier2/site/GLOW/normelap_processors/VO/DATE/2017/5/2017/5/lhc/onlyinfrajobs/</a></font>

I can&#39;t explain why the link you posted with filter for GLOW doesn&#39;t show any numbers, but if I do this for May differently and search for GLOW I see accounting updated&#58; [1] <a href='https&#58;//accounting-next.egi.eu/wlcg/report/tier2/2017/5/2017/5/hours/' target='_blank' rel='nofollow'>https&#58;//accounting-next.egi.eu/wlcg/report/tier2/2017/5/2017/5/hours/</a>

I&#39;ll try to understand this better and eventually talk to APEL folks what&#39;s going on. Could be also that on GRACC side we have a bad label for certain cases of filters, or most likely how APEL display parses the thing since the summary of May [1] looks reasonable.

Sorry for the inconvenience.

Thanks,
Marian

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=zvada/CN=684832/CN=Marian Zvada</pre></div><div class='update_description'><i onclick="document.location='33618#1494356951'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-09T19:09:11+00:00">May 9, 2017 07:09 PM UTC</time> by <b>marian.zvada@....</b><a class="anchor" name="1494356951">&nbsp;</a></div><pre>Hi Dan,

<font color='#7F7E6F'>&#62; Yes, this ticket can be closed. I am curious, though, whether we should</font>
<font color='#7F7E6F'>&#62; expect periodic updates to the accounting data here&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; <a href='https&#58;//accounting.egi.eu/tier2/site/GLOW/normelap_processors/VO/DATE/2017/5/2017/5/lhc/onlyinfrajobs/' target='_blank' rel='nofollow'>https&#58;//accounting.egi.eu/tier2/site/GLOW/normelap_processors/VO/DATE/2017/5/2017/5/lhc/onlyinfrajobs/</a></font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; We have not seen any updates for May so far. Perhaps that is to be expected.</font>

we have related ticket to missing reports of May, see my comment here&#58;
<a href='33694#1494349222' target='_blank' rel='nofollow'>https&#58;//ticket.opensciencegrid.org/33694#1494349222</a>

Hope that explains and sorry for the inconvenience.

Thanks,
Marian</pre></div><div class='update_description'><i onclick="document.location='33618#1494356175'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-09T18:56:15+00:00">May 9, 2017 06:56 PM UTC</time><a class="anchor" name="1494356175">&nbsp;</a></div><pre>Yes, this ticket can be closed.  I am curious, though, whether we should expect periodic updates to the accounting data here&#58;

<a href='https&#58;//accounting.egi.eu/tier2/site/GLOW/normelap_processors/VO/DATE/2017/5/2017/5/lhc/onlyinfrajobs/' target='_blank' rel='nofollow'>https&#58;//accounting.egi.eu/tier2/site/GLOW/normelap_processors/VO/DATE/2017/5/2017/5/lhc/onlyinfrajobs/</a>

We have not seen any updates for May so far.  Perhaps that is to be expected.

--Dan

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=dbradley/CN=614788/CN=Daniel Charles Bradley</pre></div><div class='update_description'><i onclick="document.location='33618#1494348494'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-09T16:48:14+00:00">May 9, 2017 04:48 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1494348494">&nbsp;</a></div><pre>Thanks Ajit & Dan.  Can we mark this ticket resolved?

Carl</pre></div><div class='update_description'><i onclick="document.location='33618#1493829311'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-03T16:35:11+00:00">May 3, 2017 04:35 PM UTC</time> by <b>ajit@....</b><a class="anchor" name="1493829311">&nbsp;</a></div><pre>Hi Carl,

Thanks for correcting the GLOW numbers for April. The updated number looks very resonable, and consistent with the numbers from previous months.

- Ajit

On 05/03/2017 10&#58;09 AM, Open Science Grid FootPrints wrote&#58;
[Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='33618#1493824186'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-03T15:09:46+00:00">May 3, 2017 03:09 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1493824186">&nbsp;</a></div><pre>Based on discussion with Brian Lin&#58;

<font color='#7F7E6F'>&#62; this was causing local batch jobs (with Grid = Local) to show up as</font>
<font color='#7F7E6F'>&#62; ResourceType=Payload, when really they should be ResourceType=Batch.</font>

It&#39;s up for debate what the &#34;correct&#34; ResourceType is for these records, but in any case it seems we do want to count them for the purposes of the APEL report.

Carl</pre></div><div class='update_description'><i onclick="document.location='33618#1493822970'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-03T14:49:30+00:00">May 3, 2017 02:49 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1493822970">&nbsp;</a></div><pre>Just to recap what we covered yesterday; the MATCH_EXP_JOBGLIDEIN_ResourceName attribute was set from configuration in the gratia-probe-glideinwms package, and this was causing local batch jobs (with Grid = Local) to show up as ResourceType=Payload, when really they should be ResourceType=Batch.  GLOW is the only resource group showing up with the combination Grid=Local & ResourceType=Payload.

The short-term solution for the APEL report is to consider both ResourceType=Batch and also (Grid=Local & ResourceType=Payload).  (Technically this expression simplifies to (ResourceType=Batch | Grid=Local)).  I updated the reporting script last night, and the current numbers as of today should reflect this and include the Local Batch records at GLOW.  Ajit or Dan, can you confirm?

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='33618#1493758850'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-02T21:00:50+00:00">May 2, 2017 09:00 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1493758850">&nbsp;</a></div><pre>If you swing by any time we can discuss in the main lobby.  We&#39;re in the auditorium but can sneak out whenever  &#58;D

Carl</pre></div><div class='update_description'><i onclick="document.location='33618#1493756941'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-02T20:29:01+00:00">May 2, 2017 08:29 PM UTC</time><a class="anchor" name="1493756941">&nbsp;</a></div><pre>I can swing by the Fluno Center.  Is there a particular time that would be better?

--Dan

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=dbradley/CN=614788/CN=Daniel Charles Bradley</pre></div><div class='update_description'><i onclick="document.location='33618#1493756281'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-02T20:18:01+00:00">May 2, 2017 08:18 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1493756281">&nbsp;</a></div><pre><font color='#7F7E6F'>&#62;We&#39;re happy and available to make the changes to get the reports correct, but it&#39;s been sometimes difficult to reverse-compile the old shell scripts.</font>

Well that and we decided we don&#39;t want to report Payload jobs anymore  ;)

Carl</pre></div><div class='update_description'><i onclick="document.location='33618#1493754822'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-02T19:53:42+00:00">May 2, 2017 07:53 PM UTC</time><a class="anchor" name="1493754822">&nbsp;</a></div><pre>Hi Dan,

Any chance you&#39;d have time to meander to HTCondor Week (Fluno Center this year?)?  Both Carl and I are present and might be quicker with an in-person chat.

The issue is that in cases ABC, CMS wants these jobs reported.  In cases XYZ, CMS does not want these jobs reported.  It&#39;s been a bit of a struggle to distinguish the two cases programmatically (without the code littered with &#34;if GLOW, then foo else bar&#34;).

We&#39;re happy and available to make the changes to get the reports correct, but it&#39;s been sometimes difficult to reverse-compile the old shell scripts.

Thanks!

Brian

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=bbockelm/CN=659869/CN=Brian Paul Bockelman</pre></div><div class='update_description'><i onclick="document.location='33618#1493754485'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-02T19:48:05+00:00">May 2, 2017 07:48 PM UTC</time><a class="anchor" name="1493754485">&nbsp;</a></div><pre>We have MATCH_EXP_JOBGLIDEIN_ResourceName set, because Brian Lin requested us to install the gratia-probe-glideinwms-1.17.2-1.osg33.el6.noarch package.  That package includes a file /etc/condor/config.d/99_gratia-gwms.conf, which contains the following&#58;

#
# This file specifies the classads that need to be included in each
# job for proper accounting of GlideinWMS jobs.  If you experience any
# problems with JOBGLIDEIN_ResourceName, or the gratia probe, please
# email osg-software@....
#

# The JOBGLIDEIN_ResourceName is a macro to extract where the job
# ran. When a job matches to a slot, the expression gets evaluated and
# its value is placed in MATCH_EXPR_JOBGLIDEIN_ResourceName. The order
# of evaluation for the startd attributes is as follows&#58;
# 1 - GLIDEIN_ResourceName - Used in the OSG&#39;s GlideinWMS Factories
# 2 - GLIDEIN_Site - Used for all GlideinWMS instances to uniquely
#     identify a site
# If neither are defined, it means that the job ran locally and these
# records can be suppressed by setting &#39;SuppressGridLocalRecords=&#34;1&#34;&#39;
# in the ProbeConfig.
JOBGLIDEIN_ResourceName=&#34;$$([IfThenElse(IsUndefined(TARGET.GLIDEIN_ResourceName), IfThenElse(IsUndefined(TARGET.GLIDEIN_Site), &#92;&#34;Local Job&#92;&#34;, TARGET.GLIDEIN_Site), TARGET.GLIDEIN_ResourceName)])&#34;

# Add the JOBGLIDEIN_ResourceName to every job that is submitted from
# this host
SUBMIT_EXPRS = $(SUBMIT_EXPRS) JOBGLIDEIN_ResourceName

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=dbradley/CN=614788/CN=Daniel Charles Bradley</pre></div><div class='update_description'><i onclick="document.location='33618#1493753205'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-02T19:26:45+00:00">May 2, 2017 07:26 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1493753205">&nbsp;</a></div><pre>Dan,

Kevin points out that you have MATCH_EXP_JOBGLIDEIN_ResourceName set -- any idea why that is?  That&#39;s probably why it&#39;s showing up as Payload.

Carl</pre></div><div class='update_description'><i onclick="document.location='33618#1493753028'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-02T19:23:48+00:00">May 2, 2017 07:23 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1493753028">&nbsp;</a></div><pre><font color='#7F7E6F'>&#62; The jobs are ordinary jobs, not pilots.  They do not run inside a pilot.  I don&#39;t know what the expected ResourceType is in that case.</font>

I would expect those to be ResourceType = Batch in that case; but I&#39;m adding a few more CC&#39;s in case anybody knows otherwise...

Carl</pre></div><div class='update_description'><i onclick="document.location='33618#1493751869'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-02T19:04:29+00:00">May 2, 2017 07:04 PM UTC</time><a class="anchor" name="1493751869">&nbsp;</a></div><pre>The jobs are ordinary jobs, not pilots.  They do not run inside a pilot.  I don&#39;t know what the expected ResourceType is in that case.

To have them reported, we were advised to install gratia-probe-glideinwms with the following configuration&#58;

Grid=Local
SuppressUnknownVORecords=&#34;1&#34;

--Dan

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=dbradley/CN=614788/CN=Daniel Charles Bradley</pre></div><div class='update_description'><i onclick="document.location='33618#1493750694'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-02T18:44:54+00:00">May 2, 2017 06:44 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1493750694">&nbsp;</a></div><pre>Any idea why these records show up with ResourceType = Payload (aka, ResourceType = BatchPilot) ?

Carl</pre></div><div class='update_description'><i onclick="document.location='33618#1493747679'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-02T17:54:39+00:00">May 2, 2017 05:54 PM UTC</time><a class="anchor" name="1493747679">&nbsp;</a></div><pre>Hi Carl,

Thanks for the link.  Modifying the query a bit, I find that all jobs from our submit nodes (Grid == Local) appear to have ResourceType == Payload.  That makes me worried that none of the jobs submitted directly to condor at our site are being counted.

<a href='https&#58;//gracc.opensciencegrid.org/kibana/app/kibana#/discover?_g=' target='_blank' rel='nofollow'>https&#58;//gracc.opensciencegrid.org/kibana/app/kibana#/discover?_g=</a>(refreshInterval&#58;(display&#58;Off,pause&#58;!f,value&#58;0),time&#58;(from&#58;now-1M%2FM,mode&#58;quick,to&#58;now-1M%2FM))&_a=(columns&#58;!(Grid,ResourceType),filters&#58;!((%27$$hashKey%27&#58;%27object&#58;1243%27,%27$state%27&#58;(store&#58;appState),meta&#58;(alias&#58;!n,disabled&#58;!f,index&#58;gracc.osg.summary,key&#58;VOName,negate&#58;!f,value&#58;cms),query&#58;(match&#58;(VOName&#58;(query&#58;cms,type&#58;phrase)))),(%27$$hashKey%27&#58;%27object&#58;2192%27,%27$state%27&#58;(store&#58;appState),meta&#58;(alias&#58;!n,disabled&#58;!f,index&#58;gracc.osg.summary,key&#58;OIM_ResourceGroup,negate&#58;!f,value&#58;GLOW),query&#58;(match&#58;(OIM_ResourceGroup&#58;(query&#58;GLOW,type&#58;phrase)))),(%27$$hashKey%27&#58;%27object&#58;4042%27,%27$state%27&#58;(store&#58;appState),meta&#58;(alias&#58;!n,disabled&#58;!f,index&#58;gracc.osg.summary,key&#58;Grid,negate&#58;!f,value&#58;Local),query&#58;(match&#58;(Grid&#58;(query&#58;Local,type&#58;phrase))))),index&#58;gracc.osg.summary,interval&#58;auto,query&#58;(query_string&#58;(analyze_wildcard&#58;!f,query&#58;%27*%27)),sort&#58;!(EndTime,desc))

--Dan

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=dbradley/CN=614788/CN=Daniel Charles Bradley</pre></div><div class='update_description'><i onclick="document.location='33618#1493743498'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-02T16:44:58+00:00">May 2, 2017 04:44 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1493743498">&nbsp;</a></div><pre>Hey Dan; here are Payload records for GLOW / cms&#58;

<a href='https&#58;//gracc.opensciencegrid.org/kibana/app/kibana#/discover?_g=' target='_blank' rel='nofollow'>https&#58;//gracc.opensciencegrid.org/kibana/app/kibana#/discover?_g=</a>(refreshInterval&#58;(display&#58;Off,pause&#58;!f,value&#58;0),time&#58;(from&#58;now-1M%2FM,mode&#58;quick,to&#58;now-1M%2FM))&_a=(columns&#58;!(_source),filters&#58;!((&#39;$$hashKey&#39;&#58;&#39;object&#58;1243&#39;,&#39;$state&#39;&#58;(store&#58;appState),meta&#58;(alias&#58;!n,disabled&#58;!f,index&#58;gracc.osg.summary,key&#58;VOName,negate&#58;!f,value&#58;cms),query&#58;(match&#58;(VOName&#58;(query&#58;cms,type&#58;phrase)))),(&#39;$$hashKey&#39;&#58;&#39;object&#58;2192&#39;,&#39;$state&#39;&#58;(store&#58;appState),meta&#58;(alias&#58;!n,disabled&#58;!f,index&#58;gracc.osg.summary,key&#58;OIM_ResourceGroup,negate&#58;!f,value&#58;GLOW),query&#58;(match&#58;(OIM_ResourceGroup&#58;(query&#58;GLOW,type&#58;phrase)))),(&#39;$$hashKey&#39;&#58;&#39;object&#58;4042&#39;,&#39;$state&#39;&#58;(store&#58;appState),meta&#58;(alias&#58;!n,disabled&#58;!f,index&#58;gracc.osg.summary,key&#58;ResourceType,negate&#58;!f,value&#58;Payload),query&#58;(match&#58;(ResourceType&#58;(query&#58;Payload,type&#58;phrase))))),index&#58;gracc.osg.summary,interval&#58;auto,query&#58;(query_string&#58;(analyze_wildcard&#58;!f,query&#58;&#39;*&#39;)),sort&#58;!(EndTime,desc))

One example has&#58;

ProbeName	   	condor&#58;cmssubmit-r1.t2.ucsd.edu
SiteName	   	UCSD_GlideinWMS_Submit_r1
OIM_FQDN	   	cmsgrid01.hep.wisc.edu

but there are others...

Carl</pre></div><div class='update_description'><i onclick="document.location='33618#1493742925'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-02T16:35:25+00:00">May 2, 2017 04:35 PM UTC</time><a class="anchor" name="1493742925">&nbsp;</a></div><pre>Hi Carl,

I am surprised to hear that Wisconsin is reporting payload jobs at all, let alone to a greater extent that other sites.  We run gratia probes on our CEs and submit nodes.  None of those queues contain jobs that should not be counted.  Perhaps there is an additional reporting agent that we have forgotten about.

Can you give us a hint as to where the payload reporting is coming from?

Thanks,
--Dan

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=dbradley/CN=614788/CN=Daniel Charles Bradley</pre></div><div class='update_description'><i onclick="document.location='33618#1493741760'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-02T16:16:00+00:00">May 2, 2017 04:16 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1493741760">&nbsp;</a></div><pre>Ajit,

<font color='#7F7E6F'>&#62; Was GLOW the only site affected by the double-counting OR other USCMS T2s as well ?</font>

Any site that had payload jobs would be affected, but GLOW/cms might have been the most significant case.

Dan,

<font color='#7F7E6F'>&#62; You said that only pilot jobs are counted now.  We have a fair amount of</font>
<font color='#7F7E6F'>&#62; CMS activity at our site that does not use glideins.  Jobs are submitted</font>
<font color='#7F7E6F'>&#62; directly to condor.  [...] Is that usage being counted in the new scheme?</font>

Yes that should still be counted.  There are only two ResourceType categories, Batch and Payload (previously known as BatchPilot).  My understanding is that ResourceType=Batch counts both pilot jobs and jobs submitted directly to the Batch system (eg condor).  All we are doing now is filtering out the Payload jobs.

Carl</pre></div><div class='update_description'><i onclick="document.location='33618#1493741014'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-02T16:03:34+00:00">May 2, 2017 04:03 PM UTC</time><a class="anchor" name="1493741014">&nbsp;</a></div><pre>Hi Carl,

You said that only pilot jobs are counted now.  We have a fair amount of CMS activity at our site that does not use glideins.  Jobs are submitted directly to condor.  This usage is reported via gratia on the submit nodes registered in OIM as GLOW_SUBMIT1, GLOW_SUBMIT2, GLOW_SUBMIT3, GLOW_SUBMIT4, GLOW_SUBMIT5, GLOW_SUBMIT6, and GLOW_SUBMIT_CERN.

Is that usage being counted in the new scheme?

Thanks,
--Dan

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=dbradley/CN=614788/CN=Daniel Charles Bradley</pre></div><div class='update_description'><i onclick="document.location='33618#1493692689'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-02T02:38:09+00:00">May 2, 2017 02:38 AM UTC</time> by <b>ajit@....</b><a class="anchor" name="1493692689">&nbsp;</a></div><pre>Thanks Carl for the detailed note. Was GLOW the only site affected by
the double-counting OR other USCMS T2s as well ?
- Ajit

On 5/1/17 6&#58;21 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='33618#1493680898'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-01T23:21:38+00:00">May 1, 2017 11:21 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1493680898">&nbsp;</a></div><pre>Thanks Dan!

I&#39;ve updated the GRACC-based report to filter out resources with norm factors = 0 and in that case use whatever else is set for the resource group.  The updated GRACC-based report for March / GLOW / cms gives&#58;

NormalisedCpuDuration&#58; 160,634,581,254 sec (1,859,196 days)
NormalisedWallDuration&#58; 29,611,862,644 sec (342,729 days)
CpuDuration&#58; 16,275,033,562 sec (188,368 days)
WallDuration&#58; 3,000,188,718 sec (34,724 days)
CPU/Wall&#58; 542%
Avg NF&#58; 9.870

This is nearly identical to the Gratia-based report with payload jobs filtered out.

(Note that the remaining difference is expected from the payload jobs being removed.)

The updated GRACC report will run tonight.

Carl</pre></div><div class='update_description'><i onclick="document.location='33618#1493679355'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-01T22:55:55+00:00">May 1, 2017 10:55 PM UTC</time><a class="anchor" name="1493679355">&nbsp;</a></div><pre>Thanks for the investigation, Carl.  I have now set the normalization factor for cmsgrid03.hep.wisc.edu to 9.87 to match the other CEs.

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=dbradley/CN=614788/CN=Daniel Charles Bradley</pre></div><div class='update_description'><i onclick="document.location='33618#1493678726'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-01T22:45:26+00:00">May 1, 2017 10:45 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1493678726">&nbsp;</a></div><pre>As pointed out by Kevin, it looks like the cmsgrid03.hep.wisc.edu resource has no norm factor set, which the GRACC-based report was tripping up on
<a href='https&#58;//oim.opensciencegrid.org/oim/resource?id=644' target='_blank' rel='nofollow'>https&#58;//oim.opensciencegrid.org/oim/resource?id=644</a>

I&#39;ll add handling for resources that don&#39;t have this set.

Carl</pre></div><div class='update_description'><i onclick="document.location='33618#1493677302'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-01T22:21:42+00:00">May 1, 2017 10:21 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1493677302">&nbsp;</a></div><pre>Hi Ajit,

So yes we switched over our APEL report generation from our old Gratia DB to our GRACC backend between April 20-21.  One significant change in the new GRACC based report is that we now filter on ResourceType; previously both pilot and payload jobs were taken into account but now only pilot jobs are counted.  This is an intentional change since; the old reports were actually double-counting for any payload job usage.

For March 2017, the original Gratia-based report (with pilot + payload jobs) for Site=GLOW VO=cms had&#58;

NormalisedCpuDuration&#58; 174,439,917,790 sec (2,018,980 days)
NormalisedWallDuration&#58; 50,106,719,626 sec (579,938 days)
CpuDuration&#58; 17,772,856,452 sec (205,704 days)
WallDuration&#58; 5,095,541,874 sec (58,976 days)
CPU/Wall&#58; 348%
Avg NF (wall)&#58; 9.833

Modifying the old Gratia-based report to filter out payload jobs gives significantly less WallDuration&#58;

NormalisedCpuDuration&#58; 159,733,481,151 sec (1,848,767 days)
NormalisedWallDuration&#58; 29,442,537,665 sec (340,770 days)
CpuDuration&#58; 16,284,535,533 sec (188,478 days)
WallDuration&#58; 3,001,906,416 sec (34,744 days)
CPU/Wall&#58; 542%
Avg NF&#58; 9.808

This is the first issue -- the old report was double-counting payload job usage, which is corrected in the new GRACC-based reports.
bv
But there is also a second issue with the new GRACC-based report that the Normalization Factor is not getting calculated the same as the Gratia-based report in all cases.  The GRACC-based report for March / GLOW / cms had&#58;

NormalisedCpuDuration&#58; 80,317,290,625 sec (929,598 days)
NormalisedWallDuration&#58; 14,805,931,330 sec (171,364 days)
CpuDuration&#58; 16,275,033,562 sec (188,368 days)
WallDuration&#58; 3,000,188,718 sec (34,724 days)
CPU/Wall&#58; 542%
Avg NF&#58; 4.935

Note the raw CPU & Wall times were approximately the same but the Normalization Factor was off by a factor of two.  In GRACC for March / GLOW / cms pilot (Batch) jobs, I see 68% have a Norm Factor of 9.87 (more like what we had in the Gratia report), and the other 32% have a Norm Factor of 0.

<div id='show_1185671997' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1185671997'>I&#39;ll look into what&#39;s going on with the Norm Factor = 0 records in GRACC, and how to handle them properly.  But after we get that corrected you should still expect to see the drop (as described above) due to filtering out payload jobs.

Carl
</div><script type='text/javascript'>
        $('#show_1185671997').click(function() {
            $('#detail_1185671997').slideDown("normal");
            $('#show_1185671997').hide();
            $('#hide_1185671997').show();
        });
        $('#hide_1185671997').click(function() {
            $('#detail_1185671997').slideUp();
            $('#hide_1185671997').hide();
            $('#show_1185671997').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='33618#1493323136'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-27T19:58:56+00:00">Apr 27, 2017 07:58 PM UTC</time><a class="anchor" name="1493323136">&nbsp;</a></div><pre>Looks like it overlaps with time when we switched to APEL reports generated from GRACC directly instead of data from GRATIA DB. We just had discussion about it at GRACC meeting -- Carl will take a look at it and comment further. First guess is that we interpret some things differently and we need to investigate the cause of drop down in numbers. I&#39;m assigning ticket to GRACC Operations, but we need to stay on top of it especially that we are near &#34;beginning&#34; of next month when APEL reports are &#34;finalized&#34;! So it needs to get corrected before that.

Thanks,
Marian

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=zvada/CN=684832/CN=Marian Zvada</pre></div><div class='update_description'><i onclick="document.location='33618#1493321287'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-27T19:28:07+00:00">Apr 27, 2017 07:28 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1493321287">&nbsp;</a></div><pre>Thanks for reporting this; I&#39;ll start looking into it.

Carl</pre></div><div class='update_description'><i onclick="document.location='33618#1493312315'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-27T16:58:35+00:00">Apr 27, 2017 04:58 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1493312315">&nbsp;</a></div><pre>Just as an FYI to them, I am adding Marian and Carl to this ticket as the GRACC admin and the script developer.

-Kyle</pre></div><div class='update_description'><i onclick="document.location='33618#1493245818'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-26T22:30:18+00:00">Apr 26, 2017 10:30 PM UTC</time><a class="anchor" name="1493245818">&nbsp;</a></div><pre>Forgot to cc Dan Bradley. Adding.

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mohapatr/CN=659205/CN=Ajit Kumar Mohapatra</pre></div><div class='update_description'><i onclick="document.location='33618#1493245416'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-26T22:23:36+00:00">Apr 26, 2017 10:23 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1493245416">&nbsp;</a></div><pre>Hi,

On Apr 20, I had noticed in the EGI accounting page (below) that the &#34;SUM Wallclock Work HS06 Hours&#34; number for T2_US_Wisconsin (CMS VO usage) was ~43M, while the value for Purdue was ~40M, and Nebraska&#39;s number was well below that of Wisconsin.

<a href='https&#58;//accounting.egi.eu/tier2/country/USA/normelap_processors/FEDERATION/DATE/2017/4/2017/4/custom-cms/onlyinfrajobs/' target='_blank' rel='nofollow'>https&#58;//accounting.egi.eu/tier2/country/USA/normelap_processors/FEDERATION/DATE/2017/4/2017/4/custom-cms/onlyinfrajobs/</a>

But then on the 22nd April, I noticed that the Wisconsin number had gone down to ~30M, whereas the Purdue and Nebraska numbers were up compared to their values on the 20th. This sudden drop of ~13M (instead of going up) surprised me, and the value seem to have gone up by 3M since then (now at ~33M). But I am puzzled by the unexpected drop from 43M to 30M, and then going up again. Dan and I are trying to understand what caused the 13M drop ?

Our local monitoring of the cluster&#39;s daily condor usage for CMS VO during April 1 - April 26 indicates a total of ~6.5M CPU hours which when gets converted to HS06 hours should be = ( 6.5M CPU hours x APEL (9.87) ) =  ~64M SUM Wallclock Work HS06 Hours, which is almost 2x than what is reported in the EGI link above right now.

The CMS Dashboard provides a total of 236684 WC-days usage for Wisconsin during April 1 - April 26 which corresponds to ( 236,684 WC-days x APEL (9.87) x 24h/days ) ~56M HS06 WC hours, which looks more sensible compared to our local monitoring number (~64M), but significantly different (~23M more) than what is reported in the EGI link above.

So, this is a heads up to let you know about this discrepancy which if not understood and corrected before being reported to WLCG, the Wisconsin numbers for April will be highly inaccurate (underestimated) compared to the actual resource usage by CMS VO. We can provide our local daily condor usage numbers if you want to compare those with the numbers that you received from GLOW via Gratia probes.

Please let us know if you need any further info on this.

Thanks,
- Ajit

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mohapatr/CN=659205/CN=Ajit Kumar Mohapatra</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F33618">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 33618});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
