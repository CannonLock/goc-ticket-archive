<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[35616] Glidein validation fails on several WNs</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=35616" method="post">
<div class="page-header">
    <h3><span class="muted">35616</span> / Glidein validation fails on several WNs</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Marian Zvada</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Resource Name</label><div class="controls">UColorado_HEP</div></div><div class="control-group"><label class="control-label">Associated VO</label><div class="controls">CMS</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Marian Zvada</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">USCMS_Tier3</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2018-01-03</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Kyle Gross <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">Sarah Schmiechen <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">Sarah Schmiechen <span class="muted"> / OSG Operations Infrastructure</span></div><div class="assignee" style="width: 60%">USCMS_Tier3 <span class="muted"> / OSG Support Centers</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/35616", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/35616?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/35616?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Glidein%20validation%20fails%20on%20several%20WNs%20ISSUE%3D35616%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='35616#1514984754'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-01-03T13:05:54+00:00">Jan 3, 2018 01:05 PM UTC</time> by <b>Sarah Schmiechen</b><a class="anchor" name="1514984754">&nbsp;</a></div><pre>Closing out, thanks.</pre></div><div class='update_description'><i onclick="document.location='35616#1514585111'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-12-29T22:05:11+00:00">Dec 29, 2017 10:05 PM UTC</time> by <b>douglas.johnson@....</b><a class="anchor" name="1514585111">&nbsp;</a></div><pre>Greetings,

I believe that the ticket can be closed.

Thank you,
doug

On Fri, Dec 29, 2017 at 8&#58;01 AM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='35616#1514559668'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-12-29T15:01:08+00:00">Dec 29, 2017 03:01 PM UTC</time> by <b>Sarah Schmiechen</b><a class="anchor" name="1514559668">&nbsp;</a></div><pre>Hello,

Are there any updates on this? Can this be closed out?

Thanks,
Sarah</pre></div><div class='update_description'><i onclick="document.location='35616#1513966872'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-12-22T18:21:12+00:00">Dec 22, 2017 06:21 PM UTC</time><a class="anchor" name="1513966872">&nbsp;</a></div><pre>We (OSG VO, GLOW and some others) are using Singularity options to limit where the users can create temporary files&#58;

--scratch /var/tmp  --scratch /tmp

By default, Singularity create a directory under /tmp on the host, and bind mounts it to the /tmp inside the container. ~10 days ago, we had another site complaining about this, and we ended up telling Singularity to map those directories to the glidein work dir&#58;

<a href='https&#58;//github.com/opensciencegrid/osg-flock/blob/master/job-wrappers/user-job-wrapper.sh#L120' target='_blank' rel='nofollow'>https&#58;//github.com/opensciencegrid/osg-flock/blob/master/job-wrappers/user-job-wrapper.sh#L120</a>

Now, when a job start up inside Singularity, user can use /tmp (or $OSG_WN_TMP which has been repointed to /tmp), but on the outside host, they are actually using the glidein dir. This seems to work fine on at least my test CE. In the last few days, have you seen glideins misbehaving? I&#39;m not 100% sure this covers all the problems, but jobs should be way more sandboxed than they were before, and not be able to touch /tmp on your workers (you might still see Singularity session dirs, but they should be tiny).

/Mats

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Mats Rynge 45</pre></div><div class='update_description'><i onclick="document.location='35616#1513966152'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-12-22T18:09:12+00:00">Dec 22, 2017 06:09 PM UTC</time> by <b>douglas.johnson@....</b><a class="anchor" name="1513966152">&nbsp;</a></div><pre>Hi Matt,

We only see a significant problem when a job tries use /tmp as their work
directory. As was mentioned, there is no easy way to prevent a job from
doing this. We have moved to a more aggressive cleanup of /tmp but does not
fully address the issue. It is generally not a significant problem as it
usually just affects the current pilot, i.e., the opportunistic job crashes
itself. Sometimes the files in /tmp persist long enough to affect other
jobs that start on the same node. It is only malformed opportunist jobs
that cause problems and my take on it is that this is the cost of providing
opportunistic cycles. I think it is worth the cost and a rare inconvenience.

My previous question was whether or not if I find a way to prevent jobs
from accessing the &#34;real&#34; /tmp will it affect the running of jobs. So for
example, if I force the bind mount /tmp in Singularity to be a different
partition and/or directory than the &#34;real&#34; /tmp.  My understanding is that
T2 Nebraska runs jobs inside Docker containers. Then the Docker container
starts a Singularity container. They claim that these jobs are &#34;very
isolated&#34; and do not have access to the &#34;real&#34; /tmp on the worker node. I
am not sure I want to implement Singularity inside Docker, but perhaps I
can find a different method to isolate the jobs from /tmp.

Thank you,
doug

On Fri, Dec 22, 2017 at 9&#58;39 AM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='35616#1513960755'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-12-22T16:39:15+00:00">Dec 22, 2017 04:39 PM UTC</time><a class="anchor" name="1513960755">&nbsp;</a></div><pre>Doug,

For Singularity jobs, we have moved the work directories to be contained within the glidein assigned directory. Are you still seeing this problem on your nodes?

Thanks,
Mats

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Mats Rynge 45</pre></div><div class='update_description'><i onclick="document.location='35616#1513959501'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-12-22T16:18:21+00:00">Dec 22, 2017 04:18 PM UTC</time> by <b>echism</b><a class="anchor" name="1513959501">&nbsp;</a></div><pre>Mats,

You have dealt with a lot of undesirable user behaviors, do you have any ideas? I&#39;m not sure what to do with this one.

Thanks</pre></div><div class='update_description'><i onclick="document.location='35616#1513894363'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-12-21T22:12:43+00:00">Dec 21, 2017 10:12 PM UTC</time><a class="anchor" name="1513894363">&nbsp;</a></div><pre>work_dir=&#34;OSG&#34; sets the working directory to OSG_WN_TMP in the glidein, but we can&#39;t control whether or not users choose to do things in /tmp.

Jeff

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jdost/CN=732648/CN=Jeffrey Michael Dost</pre></div><div class='update_description'><i onclick="document.location='35616#1513822196'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-12-21T02:09:56+00:00">Dec 21, 2017 02:09 AM UTC</time> by <b>Marian Zvada</b><a class="anchor" name="1513822196">&nbsp;</a></div><pre>Hi Doug,

first I thought that Factory sets working dir to /tmp for Colorado but all looks good - it is set to&#58; work_dir=&#34;OSG&#34;.

This means it inherits whatever configuration is on your node via osg-configure, I suppose. Or something may use this as job requirement from the Frontend side of OSGFlock? Mats, do you have perphaps any idea here?

For the other part of your question regarding singularity I don&#39;t have any good recommendation, unfortunately.

Thanks,
Marian</pre></div><div class='update_description'><i onclick="document.location='35616#1513357872'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-12-15T17:11:12+00:00">Dec 15, 2017 05:11 PM UTC</time> by <b>douglas.johnson@....</b><a class="anchor" name="1513357872">&nbsp;</a></div><pre>Greetings,

Right after the ticket was filed, I implemented a more aggressive cleanup
policy of the /tmp partition on the worker nodes and have not heard of any
complaints since then. If you tell me where I can monitor these sorts of
sites errors, I will implement a local alarm so that I can address the
problem more quickly. In addition, future installations on the worker nodes
will create a much larger /tmp partition but that will not address rogue
jobs that will fill up /tmp no matter how large the partition.

Is there anyway that the containers can use  a different partition when
they bind mount /tmp? For example, can I configure my machines to force
Singularity containers to bind mount the batch scratch space at /tmp and
not cause any problems for the GRID jobs? Then within the container /tmp is
forced to be in the dynamically allocated scratch space.

Thank you,
doug

On Fri, Dec 15, 2017 at 9&#58;51 AM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='35616#1513356695'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-12-15T16:51:35+00:00">Dec 15, 2017 04:51 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1513356695">&nbsp;</a></div><pre>Have there been any updates in the last 7 days about this issue?

-Kyle</pre></div><div class='update_description'><i onclick="document.location='35616#1512787510'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-12-09T02:45:10+00:00">Dec 9, 2017 02:45 AM UTC</time> by <b>douglas.johnson@....</b><a class="anchor" name="1512787510">&nbsp;</a></div><pre>Greetings,

The /tmp partition on some these nodes is being filled by OSG jobs. I will
clean up the disks, but that partition should be not used by any job ever.
The batch system provides temporary space for batch jobs and the jobs
should not write outside of it. I believe CMS added a parameter to their
glideIn servers years ago so jobs would stay within the GRID defined
scratch space. /tmp on our worker nodes is deliberately a small partition.
I understand this is an ongoing issue and not unique to Colorado, but I
hope that a solution  can be found.

Thank you,
doug

On Fri, Dec 8, 2017 at 5&#58;50 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='35616#1512780643'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-12-09T00:50:43+00:00">Dec 9, 2017 12:50 AM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1512780643">&nbsp;</a></div><pre>Hello,

we&#39;ve noticed several nodes at your site where validation fails&#58;
&#60;detail&#62;
Cannot create temp &#39;/tmp/glide_osg_XXXXXX&#39;
&#60;/detail&#62;

The nodes in question are&#58;
lnxfarm149.colorado.edu
lnxfarm227.colorado.edu
lnxfarm144.colorado.edu
{noformat}

Could you take a look at your earliest convenience?

Thanks,
Marian
(gWMS Factory Ops)

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=zvada/CN=684832/CN=Marian Zvada</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F35616">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 35616});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
