<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[22692] [Critical Service Outage] -hadoop-hdfs-2.0.0+545 -- Namenode creates 2 processes and get stuck</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=22692" method="post">
<div class="page-header">
    <h3><span class="muted">22692</span> / [Critical Service Outage] -hadoop-hdfs-2.0.0+545 -- Namenode creates 2 processes and get stuck</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Samir Cury Siqueira</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Samir Cury Siqueira</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Elevated</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Resolved</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2014-10-10</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div><div class="assignee" style="width: 60%">Matyas Selmeci <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/22692", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/22692?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/22692?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20%5BCritical%20Service%20Outage%5D%20-hadoop-hdfs-2.0.0%2B545%20--%20Namenode%20creates%202%20processes%20and%20get%20stuck%20ISSUE%3D22692%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='22692#1412887447'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-09T20:44:07+00:00">Oct 9, 2014 08:44 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1412887447">&nbsp;</a></div><pre>Thanks Samir and Mat.

I will leave this open for 24 hours just in case and then resolve it then.

Thanks!
Vince</pre></div><div class='update_description'><i onclick="document.location='22692#1412886838'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-09T20:33:58+00:00">Oct 9, 2014 08:33 PM UTC</time><a class="anchor" name="1412886838">&nbsp;</a></div><pre>Thanks all. It looks like I just found the possible reason, that at first approach does not explain at all the observed behavior. What I forgot to add to the original post is that I would even see this kind of messages in /var/log/messages &#58;

Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; INFO&#58; task java&#58;2929 blocked for more than 120 seconds.
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; &#34;echo 0 &#62; /proc/sys/kernel/hung_task_timeout_secs&#34; disables this message.
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; java          D 0000000000000002     0  2929      1 0x00000000
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; ffff880437ca3d20 0000000000000086 ffff880000030d80 0000001000000000
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; 00000000000e12d0 ffff88000004ac28 0000000000000000 ffffea000ec1d588
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; ffff880435539af8 ffff880437ca3fd8 000000000000fb88 ffff880435539af8
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; Call Trace&#58;
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; [&#60;ffffffff81013863&#62;] ? native_sched_clock+0x13/0x80
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; [&#60;ffffffff8150ea85&#62;] schedule_timeout+0x215/0x2e0
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; [&#60;ffffffff81065905&#62;] ? enqueue_entity+0x125/0x410
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; [&#60;ffffffff8150e703&#62;] wait_for_common+0x123/0x180
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; [&#60;ffffffff81063310&#62;] ? default_wake_function+0x0/0x20
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; [&#60;ffffffff8150e81d&#62;] wait_for_completion+0x1d/0x20
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; [&#60;ffffffff8106d429&#62;] do_fork+0x1c9/0x460
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; [&#60;ffffffff8119f622&#62;] ? alloc_fd+0x92/0x160
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; [&#60;ffffffff8118b455&#62;] ? do_pipe_flags+0xd5/0x140
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; [&#60;ffffffff810140f5&#62;] sys_vfork+0x25/0x30
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; [&#60;ffffffff8100b3d3&#62;] stub_vfork+0x13/0x20
Oct  9 10&#58;07&#58;47 hdfs-headnode-13-1 kernel&#58; [&#60;ffffffff8100b072&#62;] ? system_call_fastpath+0x16/0x1b
Oct  9 10&#58;17&#58;52 hdfs-headnode-13-1 ntpd[1482]&#58; synchronized to 131.215.145.254, stratum 2

Which made it look that the problem could be hadoop itself.

It looks that it was just a sequence of bad timed events. The root cause is that I had this cronjob to delete CSA14 (CMS exercise) files &#58;

for FILE in $(find /mnt/hadoop/store/user/jbalcas -ctime +3 -type f) ; do # bunch of lines that is not worth to send here.

Which was pretty obvious and one of the first things I did today was to find the stuck process trying to do find in the broken /mnt/hadoop. It looks like the autofs daemon process got stuck as well but without apparent signs. Noticed only now when I was debugging something else and &#58;

[root@hdfs-headnode-13-1 ~]# service autofs stop
Stopping automount&#58;                                        [FAILED]

After killing (-9) the autofs process and restarting it to a known state, I was able to start the namenode and it&#39;s working fine - so it looks like autofs was doing something unusual with the fuse plugin and affecting the namenode directly.
<div id='show_794211037' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_794211037'>
I actualy instrumented the init.d script and found that it was doing the right thing - starting a single time the namenode.

Vince &#58; True, that was from a client that is using 0.20, in a server that doesn&#39;t really need the HDFS FUSE mount. I added it as it shows that the namenode was alive in some aspects, but not in all.

Matyas &#58; Thanks, I found that strange too. Fortunately it is in the horizon to enable HA for HDFS namenode, so I will be able to correct this kind of things to the latest versions of everything without risking a major downtime if things go wrong.

Everything is working here and I see many datanodes online. Metadata looks good so I guess that we don&#39;t have a problem anymore &#58;

[root@hdfs-headnode-13-1 ~]# hadoop fs -ls /store/user/samir/
Found 212 items
-rw-rw-r--   3 uscms3090 cms               0 2013-05-16 04&#58;55 /store/user/samir/.deleteme
-rw-rw-r--   3 uscms3090 cms               0 2013-08-29 01&#58;15 /store/user/samir/1.root
drwxrwxr-x   - uscms3090 cms               0 2014-07-04 23&#58;51 /store/user/samir/CrabXrootd
drwxrwxr-x   - uscms3090 cms               0 2014-07-05 00&#58;01 /store/user/samir/CrabXrootd2

Feel free to close the ticket.

Thanks all for the quick action,
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira
</div><script type='text/javascript'>
        $('#show_794211037').click(function() {
            $('#detail_794211037').slideDown("normal");
            $('#show_794211037').hide();
            $('#hide_794211037').show();
        });
        $('#hide_794211037').click(function() {
            $('#detail_794211037').slideUp();
            $('#hide_794211037').hide();
            $('#show_794211037').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='22692#1412886046'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-09T20:20:46+00:00">Oct 9, 2014 08:20 PM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1412886046">&nbsp;</a></div><pre>Hi Samir,

The only things we change in the init script are the chkconfig lines, which only affect which runlevels the service is enabled in by default.

One thing I notice is that you&#39;re running it the Oracle JDK 1.6.  That is not the version we test -- or build -- hadoop on. You might be seeing compatibility issues related to that.
Here&#39;s our page on upgrading to OpenJDK 1.7&#58; <a href='https&#58;//twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallSoftwareWithOpenJDK7' target='_blank' rel='nofollow'>https&#58;//twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallSoftwareWithOpenJDK7</a>

-Mat</pre></div><div class='update_description'><i onclick="document.location='22692#1412885575'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-09T20:12:55+00:00">Oct 9, 2014 08:12 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1412885575">&nbsp;</a></div><pre>HI Samir,

I have increased the priority of this ticket to Critical, as requested.

In the limited research I&#39;ve been able to do so far it appears that this error occurs when there are mismatched Hadoop versions in use.
I just spoke with Kyle who is in touch with Tim who is currently assigning this ticket for review.

Thanks,
Vince</pre></div><div class='update_description'><i onclick="document.location='22692#1412880010'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-09T18:40:10+00:00">Oct 9, 2014 06:40 PM UTC</time><a class="anchor" name="1412880010">&nbsp;</a></div><pre>For the record, our T3 NameNode starts fine with 1 process &#58;

top - 11&#58;29&#58;41 up  4&#58;43,  1 user,  load average&#58; 0.08, 0.08, 0.07
Tasks&#58; 209 total,   1 running, 208 sleeping,   0 stopped,   0 zombie
Cpu(s)&#58;  0.0%us,  0.1%sy,  0.0%ni, 99.9%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st
Mem&#58;  24677028k total,  6736692k used, 17940336k free,   100448k buffers
Swap&#58; 24579320k total,        0k used, 24579320k free,  5218964k cached

PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
7945 hdfs      18   0 12.6g 1.1g  10m S  0.0  4.8   0&#58;52.28 java
4107 sge       15   0  223m  12m 3136 S  0.0  0.1   0&#58;14.17 sge_qmaster

And if this helps, stopping it naturally doesn&#39;t really help much &#58;

[root@hdfs-headnode-13-1 data1]# /etc/init.d/hadoop-hdfs-namenode stop
Stopping Hadoop namenode&#58;                                  [  OK  ]
stopping namenode
namenode did not stop gracefully after 5 seconds&#58; killing with kill -9

[root@hdfs-headnode-13-1 data1]# ps aux | grep java
hdfs      3717  3.3  0.0      0     0 ?        Zl   10&#58;26   2&#58;26 [java] &#60;defunct&#62;
hdfs      3816  0.0 29.5 13201240 4829640 ?    S    10&#58;27   0&#58;00 /usr/java/jdk1.6.0_45/bin/java -Dproc_namenode -Xmx12288m -Dhadoop.log.dir=/var/log/hadoop-hdfs -Dhadoop.log.file=hadoop-hdfs-namenode-hdfs-headnode-13-1.tier2.log -Dhadoop.home.dir=/usr/lib/hadoop -Dhadoop.id.str=hdfs -Dhadoop.root.logger=INFO,RFA -Djava.library.path=/usr/lib/hadoop/lib/native -Dhadoop.policy.file=hadoop-policy.xml -Djava.net.preferIPv4Stack=true -Dhadoop.security.logger=INFO,RFAS org.apache.hadoop.hdfs.server.namenode.NameNode
root      4167  0.0  0.0 103240   860 pts/0    S+   11&#58;39   0&#58;00 grep java

And these 2 guys only stop with kill -9.

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div><div class='update_description'><i onclick="document.location='22692#1412878392'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-09T18:13:12+00:00">Oct 9, 2014 06:13 PM UTC</time><a class="anchor" name="1412878392">&nbsp;</a></div><pre>Hi,

Trying to comply with this &#58;

&#34;If your issues needs action in less than 24 hours as stated in the Ticket Expectations, please contact the GOC at +1-317-278-9699 or by updating this ticket.&#34;

This ticket can be classified as &#34;Critical Service Outage&#34; as specified in the Ticket Expectations. Tried to make it obvious in the title and now updating the ticket here as well.

Thanks,
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div><div class='update_description'><i onclick="document.location='22692#1412877983'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-09T18:06:23+00:00">Oct 9, 2014 06:06 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1412877983">&nbsp;</a></div><pre>Dear OSG Software,

This is a bit urgent as it&#39;s implying in T2_US_Caltech downtime. Since I upgraded hadoop to 2.0 everything worked fine and as far as I remember I didn&#39;t need to restart the namenode for anything. Today we had a longer power cut that brought it down.

After reboot whenever I call the auxiliary script &#58;

/etc/init.d/hadoop-hdfs-namenode start

What I can see is the attached log. The most relevant part is &#58;

2014-10-09 10&#58;27&#58;44,200 INFO org.mortbay.log&#58; Started SelectChannelConnector@hdfs-headnode-13-1&#58;50070
2014-10-09 10&#58;27&#58;44,200 INFO org.apache.hadoop.hdfs.server.namenode.NameNode&#58; Web-server up at&#58; hdfs-headnode-13-1&#58;50070
2014-10-09 10&#58;27&#58;44,200 INFO org.apache.hadoop.ipc.Server&#58; IPC Server Responder&#58; starting
2014-10-09 10&#58;27&#58;44,201 INFO org.apache.hadoop.ipc.Server&#58; IPC Server listener on 9000&#58; starting
2014-10-09 10&#58;27&#58;46,030 INFO org.apache.hadoop.hdfs.server.namenode.NameNode&#58; NameNode up at&#58; hdfs-headnode-13-1.tier2/10.3.10.66&#58;9000
2014-10-09 10&#58;27&#58;46,030 INFO org.apache.hadoop.hdfs.server.namenode.FSNamesystem&#58; Starting services required for active state
2014-10-09 10&#58;27&#58;46,406 INFO org.apache.hadoop.hdfs.StateChange&#58; BLOCK* NameSystem.registerDatanode&#58; node registration from DatanodeRegistration(10.3.10.29, storageID=DS-1946114970-10.3.10.29-50010-1411690331130, infoPort=50075, ipcPort=50020, storageInfo=lv=-40;cid=CID-33be254f-fbe9-459e-a75c-e9f4ff6924b0;nsid=470488115;c=1401986032201) storage DS-1946114970-10.3.10.29-50010-1411690331130
2014-10-09 10&#58;32&#58;18,397 WARN org.apache.hadoop.ipc.Server&#58; Incorrect header or version mismatch from 10.3.10.128&#58;51161 got version 4 expected version 7
2014-10-09 10&#58;32&#58;18,430 WARN org.apache.hadoop.ipc.Server&#58; Incorrect header or version mismatch from 10.3.10.128&#58;51162 got version 4 expected version 7
2014-10-09 10&#58;32&#58;18,462 WARN org.apache.hadoop.ipc.Server&#58; Incorrect header or version mismatch from 10.3.10.128&#58;51163 got version 4 expected version 7
2014-10-09 10&#58;41&#58;39,452 WARN org.apache.hadoop.ipc.Server&#58; Incorrect header or version mismatch from 10.3.10.128&#58;51169 got version 4 expected version 7
2014-10-09 10&#58;41&#58;39,485 WARN org.apache.hadoop.ipc.Server&#58; Incorrect header or version mismatch from 10.3.10.128&#58;51170 got version 4 expected version 7
2014-10-09 10&#58;41&#58;39,517 WARN org.apache.hadoop.ipc.Server&#58; Incorrect header or version mismatch from 10.3.10.128&#58;51171 got version 4 expected version 7

Where we can see that it seems to start, even get/interpret requests from datanodes but both the page &#58;

http&#58;//10.3.10.66&#58;50070/dfshealth.jsp

As [root@hdfs-headnode-13-1 data1]# hadoop dfsadmin -report

Get stuck, and here&#39;s what I see in the system &#58;

headnode-13-1/10.3.10.66&#58;9000]. 42960 millis timeout left.; Host Details &#58; local host is&#58; &#34;hdfs-headnode-13-1.tier2/10.3.10.66&#34;; destination host is&#58; &#34;hdfs-headnode-13-1&#34;&#58;9000;
[root@hdfs-headnode-13-1 data1]# ps aux | grep java
hdfs      3717 30.4 29.3 13191988 4801920 ?    Sl   10&#58;26   2&#58;13 /usr/java/jdk1.6.0_45/bin/java -Dproc_namenode -Xmx12288m -Dhadoop.log.dir=/var/log/hadoop-hdfs -Dhadoop.log.file=hadoop-hdfs-namenode-hdfs-headnode-13-1.tier2.log -Dhadoop.home.dir=/usr/lib/hadoop -Dhadoop.id.str=hdfs -Dhadoop.root.logger=INFO,RFA -Djava.library.path=/usr/lib/hadoop/lib/native -Dhadoop.policy.file=hadoop-policy.xml -Djava.net.preferIPv4Stack=true -Dhadoop.security.logger=INFO,RFAS org.apache.hadoop.hdfs.server.namenode.NameNode
<div id='show_1039043440' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1039043440'>hdfs      3816  0.0 29.3 13191988 4801920 ?    S    10&#58;27   0&#58;00 /usr/java/jdk1.6.0_45/bin/java -Dproc_namenode -Xmx12288m -Dhadoop.log.dir=/var/log/hadoop-hdfs -Dhadoop.log.file=hadoop-hdfs-namenode-hdfs-headnode-13-1.tier2.log -Dhadoop.home.dir=/usr/lib/hadoop -Dhadoop.id.str=hdfs -Dhadoop.root.logger=INFO,RFA -Djava.library.path=/usr/lib/hadoop/lib/native -Dhadoop.policy.file=hadoop-policy.xml -Djava.net.preferIPv4Stack=true -Dhadoop.security.logger=INFO,RFAS org.apache.hadoop.hdfs.server.namenode.NameNode
root      3882  0.0  0.0 103240   860 pts/0    S+   10&#58;33   0&#58;00 grep java

top - 10&#58;34&#58;02 up  3&#58;48,  1 user,  load average&#58; 2.06, 2.07, 1.95
Tasks&#58; 167 total,   1 running, 166 sleeping,   0 stopped,   0 zombie
Cpu(s)&#58;  0.2%us,  0.7%sy,  0.0%ni, 99.1%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st
Mem&#58;  16333852k total, 11482640k used,  4851212k free,   101488k buffers
Swap&#58;  8191992k total,        0k used,  8191992k free,  6149200k cached

PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
3717 hdfs      20   0 12.6g 4.6g  11m S  0.0 29.4   2&#58;13.31 java
3816 hdfs      20   0 12.6g 4.6g  11m S  0.0 29.4   0&#58;00.00 java

So it looks like that it starts the Namenode process twice, for some reason. I see a pattern that it does not happen right away, the first starts, and by the time it is going through the FSIMAGE/EDITS files the second starts.

Any idea of what I could check in the init.d script to instrument it and see how many times it&#39;s starting the namenode? Are these wrapper scripts something OSG specific or the HDFS experts in their user lists would be able to help with that too?

Thanks,
Samir

For the record &#58;

[root@hdfs-headnode-13-1 data1]# time hadoop dfsadmin -report
DEPRECATED&#58; Use of this script to execute hdfs command is deprecated.
Instead use the hdfs command for it.

^Creport&#58; Failed on local exception&#58; java.io.InterruptedIOException&#58; Interruped while waiting for IO on channel java.nio.channels.SocketChannel[connected local=/10.3.10.66&#58;51994 remote=hdfs-headnode-13-1/10.3.10.66&#58;9000]. 1368 millis timeout left.; Host Details &#58; local host is&#58; &#34;hdfs-headnode-13-1.tier2/10.3.10.66&#34;; destination host is&#58; &#34;hdfs-headnode-13-1&#34;&#58;9000;

real	0m59.640s
user	0m1.517s
sys	0m0.095s

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira

</div><script type='text/javascript'>
        $('#show_1039043440').click(function() {
            $('#detail_1039043440').slideDown("normal");
            $('#show_1039043440').hide();
            $('#hide_1039043440').show();
        });
        $('#hide_1039043440').click(function() {
            $('#detail_1039043440').slideUp();
            $('#hide_1039043440').hide();
            $('#show_1039043440').show();
        });
        </script></pre></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F22692">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
