<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[20881] GratiaWeb Outage</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=20881" method="post">
<div class="page-header">
    <h3><span class="muted">20881</span> / GratiaWeb Outage</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">OSG Operations Center</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">OSG Operations Center</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2014-05-12</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Thomas Lee <span class="muted"> / OSG Operations Infrastructure</span></div><div class="assignee" style="width: 60%">Scott Teige <span class="muted"> / OSG Operations Infrastructure</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/20881", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/20881?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/20881?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20GratiaWeb%20Outage%20ISSUE%3D20881%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='20881#1399656064'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-09T17:21:04+00:00">May 9, 2014 05:21 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1399656064">&nbsp;</a></div><pre>further work in 21034, resolving.</pre></div><div class='update_description'><i onclick="document.location='20881#1399584060'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-08T21:21:00+00:00">May 8, 2014 09:21 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1399584060">&nbsp;</a></div><pre>I just noticed that gratiaweb1 is now showing multiple gratia_web processes, although none of them is taking up huge amounts of CPU (at least not yet).</pre></div><div class='update_description'><i onclick="document.location='20881#1399571074'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-08T17:44:34+00:00">May 8, 2014 05:44 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1399571074">&nbsp;</a></div><pre>I just saw an interesting alert from gratiaweb-itb, so I am going to post it here.

From gratiaweb-itb.grid.iu.edu &#60;goc@....&#62;
<font color='#7F7E6F'>&#62; [08/May/2014&#58;15&#58;34&#58;52]  Traceback (most recent call last)&#58;</font>
<font color='#7F7E6F'>&#62; [08/May/2014&#58;17&#58;24&#58;01] HTTP</font>
<font color='#7F7E6F'>&#62; Request Headers&#58;</font>
<font color='#7F7E6F'>&#62;   HOST&#58; localhost&#58;8100</font>
<font color='#7F7E6F'>&#62;   CONNECTION&#58; close</font>
<font color='#7F7E6F'>&#62;   Remote-Addr&#58; 127.0.0.1</font>
<font color='#7F7E6F'>&#62;   USER-AGENT&#58; Python-urllib/2.6</font>
<font color='#7F7E6F'>&#62;   ACCEPT-ENCODING&#58; identity</font>
<font color='#7F7E6F'>&#62; [08/May/2014&#58;17&#58;24&#58;01] HTTP Traceback (most recent call last)&#58;</font>
<font color='#7F7E6F'>&#62;   File &#34;/usr/lib/python2.6/site-packages/cherrypy/_cprequest.py&#34;, line 656, in respond</font>
<font color='#7F7E6F'>&#62;     response.body = self.handler()</font>
<font color='#7F7E6F'>&#62;   File &#34;/usr/lib/python2.6/site-packages/cherrypy/lib/encoding.py&#34;, line 188, in __call__</font>
<font color='#7F7E6F'>&#62;     self.body = self.oldhandler(*args, **kwargs)</font>
<font color='#7F7E6F'>&#62;   File &#34;/usr/lib/python2.6/site-packages/cherrypy/_cpdispatch.py&#34;, line 34, in __call__</font>
<font color='#7F7E6F'>&#62;     return self.callable(*self.args, **self.kwargs)</font>
<font color='#7F7E6F'>&#62;   File &#34;/usr/lib/python2.6/site-packages/graphtool/web/__init__.py&#34;, line 77, in content_func</font>
<font color='#7F7E6F'>&#62;     results = func( *args, **kw )</font>
<font color='#7F7E6F'>&#62;   File &#34;/usr/lib/python2.6/site-packages/graphtool/base/iterator.py&#34;, line 70, in run</font>
<font color='#7F7E6F'>&#62;     return self.handle_results( results, metadata, **kw )</font>
<font color='#7F7E6F'>&#62;   File &#34;/usr/lib/python2.6/site-packages/graphtool/graphs/graph.py&#34;, line 193, in handle_results</font>
<font color='#7F7E6F'>&#62;     return self.do_graph( results, metadata, **kw )</font>
<font color='#7F7E6F'>&#62;   File &#34;/usr/lib/python2.6/site-packages/graphtool/graphs/graph.py&#34;, line 266, in do_graph</font>
<font color='#7F7E6F'>&#62;     (hash_str, str(e), st.getvalue()) )</font>
<font color='#7F7E6F'>&#62; Exception&#58; Error in creating graph, hash_str&#58;Queries object&#58;GratiaBarQueries</font>
<font color='#7F7E6F'>&#62; Query vo_opp_hours_bar2</font>
<font color='#7F7E6F'>&#62; SQL&#58;</font>
<font color='#7F7E6F'>&#62;             SELECT</font>
<font color='#7F7E6F'>&#62;                    S.SiteName   ,</font>
<font color='#7F7E6F'>&#62;                 truncate( unix_timestamp(EndTime) / &#58;span, 0 ) * &#58;span as time,</font>
<font color='#7F7E6F'>&#62;                    sum(Cores*WallDuration)/3600</font>
<font color='#7F7E6F'>&#62;             FROM</font>
<font color='#7F7E6F'>&#62;                 MasterSummaryData R</font>
<div id='show_738002331' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_738002331'><font color='#7F7E6F'>&#62;             JOIN</font>
<font color='#7F7E6F'>&#62;                 Probe P on R.ProbeName = P.probename</font>
<font color='#7F7E6F'>&#62;             JOIN</font>
<font color='#7F7E6F'>&#62;                 Site S on S.siteid = P.siteid</font>
<font color='#7F7E6F'>&#62;             JOIN</font>
<font color='#7F7E6F'>&#62;                 VONameCorrection VC ON (VC.corrid=R.VOcorrid)</font>
<font color='#7F7E6F'>&#62;             JOIN</font>
<font color='#7F7E6F'>&#62;                 VO on (VC.void = VO.void)</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;             WHERE</font>
<font color='#7F7E6F'>&#62;                 R.EndTime &#62;= &#58;starttime AND</font>
<font color='#7F7E6F'>&#62;                 R.EndTime &#60; &#58;endtime AND</font>
<font color='#7F7E6F'>&#62;                 S.SiteName regexp &#58;facility AND</font>
<font color='#7F7E6F'>&#62;                 VO.VOName regexp &#58;vo AND</font>
<font color='#7F7E6F'>&#62;                 VC.VOName regexp &#58;role AND</font>
<font color='#7F7E6F'>&#62;                 (NOT (VC.VOName regexp &#58;exclude-role)) AND</font>
<font color='#7F7E6F'>&#62;                 (R.ResourceType regexp &#58;resource-type or R.ResourceType = &#39;&#39;) AND</font>
<font color='#7F7E6F'>&#62;                 R.CommonName regexp &#58;user AND</font>
<font color='#7F7E6F'>&#62;                 (&#58;includeFailed=&#39;true&#39; OR ApplicationExitCode=0) AND</font>
<font color='#7F7E6F'>&#62;                 (&#58;includeSuccess =&#39;true&#39; OR ApplicationExitCode!=0) AND</font>
<font color='#7F7E6F'>&#62;                 (NOT (S.SiteName regexp &#58;exclude-facility)) AND</font>
<font color='#7F7E6F'>&#62;                 (NOT (R.CommonName regexp &#58;exclude-user)) AND</font>
<font color='#7F7E6F'>&#62;                 (NOT (VO.VOName regexp &#58;exclude-vo)) AND</font>
<font color='#7F7E6F'>&#62;                 R.WallDuration &#60; 1100000000 AND</font>
<font color='#7F7E6F'>&#62;                 R.ProbeName regexp &#58;probe</font>
<font color='#7F7E6F'>&#62;                    AND WallDuration &#62; 0</font>
<font color='#7F7E6F'>&#62;             GROUP BY</font>
<font color='#7F7E6F'>&#62;                    S.SiteName   ,</font>
<font color='#7F7E6F'>&#62;                 time</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;          ,endtime,1399485600,span,604800,starttime,1368036000,vo,nova</font>
<font color='#7F7E6F'>&#62; [Errno 12] Cannot allocate memory</font>
<font color='#7F7E6F'>&#62; Traceback (most recent call last)&#58;</font>
<font color='#7F7E6F'>&#62;   File &#34;/usr/lib/python2.6/site-packages/graphtool/graphs/graph.py&#34;, line 257, in do_graph</font>
<font color='#7F7E6F'>&#62;     results, file, metadata, **kw)</font>
<font color='#7F7E6F'>&#62;   File &#34;/usr/lib/python2.6/site-packages/graphtool/graphs/graph.py&#34;, line 212, in do_multiprocess</font>
<font color='#7F7E6F'>&#62;     p.start()</font>
<font color='#7F7E6F'>&#62;   File &#34;/usr/lib64/python2.6/multiprocessing/process.py&#34;, line 104, in start</font>
<font color='#7F7E6F'>&#62;     self._popen = Popen(self)</font>
<font color='#7F7E6F'>&#62;   File &#34;/usr/lib64/python2.6/multiprocessing/forking.py&#34;, line 94, in __init__</font>
<font color='#7F7E6F'>&#62;     self.pid = os.fork()</font>
<font color='#7F7E6F'>&#62; OSError&#58; [Errno 12] Cannot allocate memory</font>
</div><script type='text/javascript'>
        $('#show_738002331').click(function() {
            $('#detail_738002331').slideDown("normal");
            $('#show_738002331').hide();
            $('#hide_738002331').show();
        });
        $('#hide_738002331').click(function() {
            $('#detail_738002331').slideUp();
            $('#hide_738002331').hide();
            $('#show_738002331').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='20881#1399570643'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-08T17:37:23+00:00">May 8, 2014 05:37 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1399570643">&nbsp;</a></div><pre>Since today&#39;s reboot of gratiaweb1/2 with four times the RAM and double the CPU, the problem hasn&#39;t recurred on gratiaweb1/2 (but the VMs had to be rebooted in order to do this, and the problem takes time to manifest after a restart).  However, the problem is currently happening on gratiaweb-itb.  I&#39;m noticing these things&#58;

/var/run/GratiaWeb.pid mentions only the process ID 2122.
Process 2122 is *not* the process taking up the huge amounts of CPU, however -- although it is taking up quite a bit of memory.
There are currently two other gratia_web processes *not* mentioned in /var/run/GratiaWeb.pid, one of which *is* taking up 100% of CPU most of the time.
I&#39;m not sure where the other gratia_web processes are coming from, as I was told that gratia_web doesn&#39;t fork.
I suspect that &#39;service GratiaWeb stop&#39; (and &#39;service GratiaWeb restart&#39;) stops only the process in /var/run/GratiaWeb.pid, leaving the other gratia_web processes running (and &#39;restart&#39; starts yet another one).  This can&#39;t be where the extra gratia_web processes come from, though, because the process listed in /var/run/GratiaWeb.pid is still running.</pre></div><div class='update_description'><i onclick="document.location='20881#1399569214'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-08T17:13:34+00:00">May 8, 2014 05:13 PM UTC</time> by <b>Thomas Lee</b><a class="anchor" name="1399569214">&nbsp;</a></div><pre>On Monday (2014-05-05), Scott asked me to try to obtain a backtrace on the runaway (near 100% CPU, as is usual when this problem manifests itself) gratia_web process on gratiaweb1.  After obtaining and installing the debuginfo RPMs for python and numerous others that gdb said it needed, I was able to get this&#58;

#0 &#60;built-in method keys of dict object at remote 0x7f5a0006f600&#62;
#2 file &#39;/usr/lib/python2.6/site-packages/graphtool/database/query_handler.py&#39;, in &#39;results_parser&#39;
#7 file &#39;/usr/lib/python2.6/site-packages/graphtool/database/queries.py&#39;, in &#39;_do_multiprocess_child&#39;
#12 file &#39;/usr/lib64/python2.6/multiprocessing/process.py&#39;, in &#39;run&#39;
#15 file &#39;/usr/lib64/python2.6/multiprocessing/process.py&#39;, in &#39;_bootstrap&#39;
#18 file &#39;/usr/lib64/python2.6/multiprocessing/forking.py&#39;, in &#39;__init__&#39;
#29 file &#39;/usr/lib64/python2.6/multiprocessing/process.py&#39;, in &#39;start&#39;
#32 file &#39;/usr/lib/python2.6/site-packages/graphtool/database/queries.py&#39;, in &#39;do_multiprocess&#39;
#35 file &#39;/usr/lib/python2.6/site-packages/graphtool/database/queries.py&#39;, in &#39;query&#39;
#40 file &#39;/usr/lib/python2.6/site-packages/graphtool/database/queries.py&#39;, in &#39;__call__&#39;
#49 file &#39;/usr/lib/python2.6/site-packages/graphtool/base/iterator.py&#39;, in &#39;run&#39;
#54 file &#39;/usr/lib/python2.6/site-packages/graphtool/web/__init__.py&#39;, in &#39;content_func&#39;
#59 file &#39;/usr/lib/python2.6/site-packages/cherrypy/_cpdispatch.py&#39;, in &#39;__call__&#39;
#68 file &#39;/usr/lib/python2.6/site-packages/cherrypy/lib/encoding.py&#39;, in &#39;__call__&#39;
#78 file &#39;/usr/lib/python2.6/site-packages/cherrypy/_cprequest.py&#39;, in &#39;respond&#39;
#81 file &#39;/usr/lib/python2.6/site-packages/cherrypy/_cprequest.py&#39;, in &#39;run&#39;
#84 file &#39;/usr/lib/python2.6/site-packages/cherrypy/_cpwsgi.py&#39;, in &#39;run&#39;
#87 file &#39;/usr/lib/python2.6/site-packages/cherrypy/_cpwsgi.py&#39;, in &#39;__init__&#39;
#98 file &#39;/usr/lib/python2.6/site-packages/cherrypy/_cpwsgi.py&#39;, in &#39;tail&#39;
#101 file &#39;/usr/lib/python2.6/site-packages/cherrypy/_cpwsgi.py&#39;, in &#39;__call__&#39;
#110 file &#39;/usr/lib/python2.6/site-packages/cherrypy/_cpwsgi.py&#39;, in &#39;trap&#39;
#114 file &#39;/usr/lib/python2.6/site-packages/cherrypy/_cpwsgi.py&#39;, in &#39;__init__&#39;
#125 file &#39;/usr/lib/python2.6/site-packages/cherrypy/_cpwsgi.py&#39;, in &#39;__call__&#39;
#135 file &#39;/usr/lib/python2.6/site-packages/cherrypy/_cpwsgi.py&#39;, in &#39;__call__&#39;
#145 file &#39;/usr/lib/python2.6/site-packages/cherrypy/_cptree.py&#39;, in &#39;__call__&#39;
#155 file &#39;/usr/lib/python2.6/site-packages/cherrypy/_cptree.py&#39;, in &#39;__call__&#39;
#165 file &#39;/usr/lib/python2.6/site-packages/cherrypy/wsgiserver/wsgiserver2.py&#39;, in &#39;respond&#39;
#168 file &#39;/usr/lib/python2.6/site-packages/cherrypy/wsgiserver/wsgiserver2.py&#39;, in &#39;respond&#39;
#171 file &#39;/usr/lib/python2.6/site-packages/cherrypy/wsgiserver/wsgiserver2.py&#39;, in &#39;communicate&#39;
#174 file &#39;/usr/lib/python2.6/site-packages/cherrypy/wsgiserver/wsgiserver2.py&#39;, in &#39;run&#39;
#177 file &#39;/usr/lib64/python2.6/threading.py&#39;, in &#39;__bootstrap_inner&#39;
#180 file &#39;/usr/lib64/python2.6/threading.py&#39;, in &#39;__bootstrap&#39;

<div id='show_1189091283' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1189091283'>I have no idea whether this information is helpful, as I&#39;m only passingly familiar with Python and know next to nothing about GratiaWeb itself.
</div><script type='text/javascript'>
        $('#show_1189091283').click(function() {
            $('#detail_1189091283').slideDown("normal");
            $('#show_1189091283').hide();
            $('#hide_1189091283').show();
        });
        $('#hide_1189091283').click(function() {
            $('#detail_1189091283').slideUp();
            $('#hide_1189091283').hide();
            $('#show_1189091283').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='20881#1399567420'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-08T16:43:40+00:00">May 8, 2014 04:43 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1399567420">&nbsp;</a></div><pre>Scott opened this ticket this morning &#62; <a href='https&#58;//ticket.grid.iu.edu/21034' target='_blank' rel='nofollow'>https&#58;//ticket.grid.iu.edu/21034</a></pre></div><div class='update_description'><i onclick="document.location='20881#1399383387'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-06T13:36:27+00:00">May 6, 2014 01:36 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1399383387">&nbsp;</a></div><pre>Pegging CPU correlates exactly with maxing memory. Attempting to figure out what&#39;s up with that now.
S</pre></div><div class='update_description'><i onclick="document.location='20881#1399383304'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-06T13:35:04+00:00">May 6, 2014 01:35 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1399383304">&nbsp;</a></div><pre>It seems that CPU usage on gratiaweb1 has been moving up since the last November. I have attached some munin plots. I wonder if increasing the CPU count to 2 on both gratiaweb1/2 would reduce the occurrence of GratiaWeb going to the hang mode.</pre></div><div class='update_description'><i onclick="document.location='20881#1399326458'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-05T21:47:38+00:00">May 5, 2014 09:47 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1399326458">&nbsp;</a></div><pre>gratiaweb1/2/itb only connects to Fermi DB. My guess is that there are some graphs in GratiaWeb that are obsoleted (and nobody uses) that still tries to use gratia_events DB which no longer exists, but that&#39;s just my guess.

I see a few other error messages in the log
<font color='#7F7E6F'>&#62; ValueError&#58; Unknown connection name regdb</font>
<font color='#7F7E6F'>&#62; Exception&#58; Unknown VO, LBNL_DSD, owns resource LBNL_DSD_ITB, but not in gratia.</font>

The log files doesn&#39;t seems to show why or when exactly the hang occurred last time. I don&#39;t see anything really interesting in the GratiaWeb.out during the last 24 hours. I might be missing something, though... I&#39;ve archived and published the log files here for other to see.
<font color='#7F7E6F'>&#62; <a href='http&#58;//soichi6.grid.iu.edu/public/GratiaWeb.logs.tar.gz' target='_blank' rel='nofollow'>http&#58;//soichi6.grid.iu.edu/public/GratiaWeb.logs.tar.gz</a></font>

Brad,

Can you answer following questions?

<font color='#7F7E6F'>&#62; Is it there a way to increase logging?</font>
and
<font color='#7F7E6F'>&#62; Please send an ssh key and a preferred username to me or Tom Lee and we will give you access to gratiaweb-itb where the problem is known to exist.</font>

Soichi</pre></div><div class='update_description'><i onclick="document.location='20881#1399322246'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-05T20:37:26+00:00">May 5, 2014 08:37 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1399322246">&nbsp;</a></div><pre>About the gratia_events DB, is that connection to the Fermilab server or to UNL?
Any other error in the GratiaWeb log file or in the machine?
Anything else indicating why it is hanging? Is it there a way to increase logging?</pre></div><div class='update_description'><i onclick="document.location='20881#1399314137'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-05T18:22:17+00:00">May 5, 2014 06:22 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1399314137">&nbsp;</a></div><pre>Differences&#58;
- old system&#58; SL5 and MySQL 5
- new system&#58; SL6 and MySQL 5.1, newer hardware (more memory and faster disks)
And the alias resolves to a different address and IP.

Any idea about the connection to the gratia_events DB I mentioned in <a href='https&#58;//jira.opensciencegrid.org/browse/GRATIAWEB-52?' target='_blank' rel='nofollow'>https&#58;//jira.opensciencegrid.org/browse/GRATIAWEB-52?</a>
I think the DB was not there. Was that an error not noticed before? Is it harmless?

Thank you,
Marco</pre></div><div class='update_description'><i onclick="document.location='20881#1399313817'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-05T18:16:57+00:00">May 5, 2014 06:16 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1399313817">&nbsp;</a></div><pre>Hello Brad,
Please send an ssh key and a preferred username to me or Tom Lee and we will give you access to gratiaweb-itb where the problem is known to exist.
Thanks,
Scott</pre></div><div class='update_description'><i onclick="document.location='20881#1399311287'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-05T17:34:47+00:00">May 5, 2014 05:34 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1399311287">&nbsp;</a></div><pre><font color='#7F7E6F'>&#62; Can we identify what is different about how the new database is handling the connectivity and queries?</font>
The database is running on the new OS, and on new MySQL version, and on different network, as far as I know.

<font color='#7F7E6F'>&#62; I am not having any proxy-error issues, so there isn&#39;t a way for me to recreate the problem.</font>
gratiaweb-itb is consistently causing the similar problem. Would you like to have access to gratiaweb-itb.grid.iu.edu where you can diagnose the problem?</pre></div><div class='update_description'><i onclick="document.location='20881#1399059942'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-02T19:45:42+00:00">May 2, 2014 07:45 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1399059942">&nbsp;</a></div><pre>GratiaWeb has been intermittently unresponsive in the last couple of days.
And the load in the Gratia DB has been low and manual queries were returning fairly quickly.
I don&#39;t know what is the cause of the problem. The DB is the component that changed most but it seems to have been up and with little load since Wednesday.

Yesterday gratiaweb1 was hanging, Soichi bounced it and it started to work fine.
Today gratiaweb2 was hanging, Soichi bounced it and it started to work fine.

The alias gratiaweb.grid.iu.edu seems to increase problems instead of increasing reliability&#58;
- yesterday gratiaweb1 was down, gratiaweb2 up, and gratiaweb was giving proxy errors
- today gratiaweb2 is having problems, gratiaweb1 is OK, and gratiaweb is timing out again

Best,
Marco</pre></div><div class='update_description'><i onclick="document.location='20881#1398462094'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-04-25T21:41:34+00:00">Apr 25, 2014 09:41 PM UTC</time><a class="anchor" name="1398462094">&nbsp;</a></div><pre>They have changed several tuning parmeters in the database and it seems to be performing better.  We are watching it on our end.

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Joe Boyd 579</pre></div><div class='update_description'><i onclick="document.location='20881#1398461930'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-04-25T21:38:50+00:00">Apr 25, 2014 09:38 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1398461930">&nbsp;</a></div><pre>grratia_web wasn&#39;t stopping, so I manually killed it, and did &#34;/etc/init.d/GratiaWeb start&#34;. Now gratiaweb seems to be working, but we need to monitor this for a while.</pre></div><div class='update_description'><i onclick="document.location='20881#1398461266'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-04-25T21:27:46+00:00">Apr 25, 2014 09:27 PM UTC</time><a class="anchor" name="1398461266">&nbsp;</a></div><pre>Hello Soichi,

I found that I am having trouble getting results too right now. The proxy error may be closer to the source. I am not sure where the information log jam is occurring.

Best Regards,
Brad Hurst

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=William B Hurst 1156</pre></div><div class='update_description'><i onclick="document.location='20881#1398461099'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-04-25T21:24:59+00:00">Apr 25, 2014 09:24 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1398461099">&nbsp;</a></div><pre>I&#39;ve shutdown gratiaweb-itb, display-itb, and gratiaweb2 and took gratiaweb2 out of GOC LVS for gratiaweb.grid.iu.edu.

processlist on gr-osg-mysql-reports.opensciencegrid.org now shows much smaller list of running process.

I&#39;ve restarted GratiaWeb, but I am still seeing proxy error when I try to access <a href='http&#58;//gratiaweb.grid.iu.edu/gratia/' target='_blank' rel='nofollow'>http&#58;//gratiaweb.grid.iu.edu/gratia/</a>  Should I reboot the machine?</pre></div><div class='update_description'><i onclick="document.location='20881#1398459192'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-04-25T20:53:12+00:00">Apr 25, 2014 08:53 PM UTC</time> by <b>wbhurst@....</b><a class="anchor" name="1398459192">&nbsp;</a></div><pre>Hello,

Just as a check try&#58;

ps aux | grep gratia

and see if there is not 2 gratia processes running. If there are, and
one of them is running at 99%, then kill that process and run&#58;

service GratiaWeb restart

Hope it helps.

Best Regards,
Brad Hurst

On Fri, 2014-04-25 at 20&#58;26 +0000, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='20881#1398457570'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-04-25T20:26:10+00:00">Apr 25, 2014 08:26 PM UTC</time><a class="anchor" name="1398457570">&nbsp;</a></div><pre>Hi,

the DB server (replica DB) is overwhelmed with queries.

Looking at the process list in mysql replica DB I see there are lots of queries queued in the following state&#58;

State&#58; Copying to tmp table

The server has high CPU usage, I think the DB may need some tuning, DBAs are looking into the DB performance right now.

Gerard

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Gerard Bernabeu Altayo 949</pre></div><div class='update_description'><i onclick="document.location='20881#1398454241'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-04-25T19:30:41+00:00">Apr 25, 2014 07:30 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1398454241">&nbsp;</a></div><pre>Adding Brad to this ticket.</pre></div><div class='update_description'><i onclick="document.location='20881#1398454152'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-04-25T19:29:12+00:00">Apr 25, 2014 07:29 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1398454152">&nbsp;</a></div><pre>Gratiaweb isn&#39;t responding currently and we are receiving this error&#58;

Kyle Gross&#58;
Proxy Error

The proxy server received an invalid response from an upstream server.
The proxy server could not handle the request GET /gratia/.

Reason&#58; Error reading from remote server

Apache/2.2.15 (Red Hat) Server at gratiaweb.grid.iu.edu Port 80</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F20881">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 20881});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
