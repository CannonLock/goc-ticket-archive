<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[7946] Managedfork / Gratia issues on NYSGRID-CUNY-GRID</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=7946" method="post">
<div class="page-header">
    <h3><span class="muted">7946</span> / Managedfork / Gratia issues on NYSGRID-CUNY-GRID</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Chris Green</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2010-01-12</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Kyle Gross <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">NYSGRID <span class="muted"> / OSG Support Centers</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/7946", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/7946?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/7946?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Managedfork%20%2F%20Gratia%20issues%20on%20NYSGRID-CUNY-GRID%20ISSUE%3D7946%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='7946#1269630846'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-03-26T19:14:06+00:00">Mar 26, 2010 07:14 PM UTC</time> by <b>Florian Lengyel</b><a class="anchor" name="1269630846">&nbsp;</a></div><pre>Not sure why I am seeing this ticket from January 13 on March 26....

Florian Lengyel, Ph.D.
Director for Research Computing
The Graduate Center CUNY</pre></div><div class='update_description'><i onclick="document.location='7946#1263394376'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-01-13T14:52:56+00:00">Jan 13, 2010 02:52 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1263394376">&nbsp;</a></div><pre>Thank you for informing us that this issue has been resolved. I will close this ticket.

Please submit problems, requests, and questions at&#58;
<a href='http&#58;//oim.grid.iu.edu/gocticket' target='_blank' rel='nofollow'>http&#58;//oim.grid.iu.edu/gocticket</a>

OSG Grid Operations Center
goc@...., 317-278-9699
Visit the OSG Support Page&#58;
<a href='http&#58;//www.opensciencegrid.org/ops' target='_blank' rel='nofollow'>http&#58;//www.opensciencegrid.org/ops</a>
RSS&#58; <a href='http&#58;//www.grid.iu.edu/news' target='_blank' rel='nofollow'>http&#58;//www.grid.iu.edu/news</a></pre></div><div class='update_description'><i onclick="document.location='7946#1263393726'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-01-13T14:42:06+00:00">Jan 13, 2010 02:42 PM UTC</time> by <b>Chris Green</b><a class="anchor" name="1263393726">&nbsp;</a></div><pre>GOC, please resolve and close this ticket, thanks.

Chris.

On 1/13/10 8&#58;24 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='7946#1263393548'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-01-13T14:39:08+00:00">Jan 13, 2010 02:39 PM UTC</time> by <b>Chris Green</b><a class="anchor" name="1263393548">&nbsp;</a></div><pre>Hi Florian,

Everything looks great. Thank you for your time and help.

Chris.

On 1/13/10 8&#58;24 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='7946#1263392648'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-01-13T14:24:08+00:00">Jan 13, 2010 02:24 PM UTC</time> by <b>Florian Lengyel</b><a class="anchor" name="1263392648">&nbsp;</a></div><pre>Faithfully reproduced typo fixed. Now that
these administurbatory labors are behind me,
I can resume research.

FL</pre></div><div class='update_description'><i onclick="document.location='7946#1263390846'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-01-13T13:54:06+00:00">Jan 13, 2010 01:54 PM UTC</time> by <b>Chris Green</b><a class="anchor" name="1263390846">&nbsp;</a></div><pre>Hi Florian,

We&#39;re *almost* there. I&#39;m afraid that you managed to reproduce
faithfully a typo of mine&#58;

PER_JOB_HISTORY_DIR = /opt/grid/graita/var/data

I&#39;d be grateful if you could correct this to&#58;

PER_JOB_HISTORY_DIR = /opt/grid/gratia/var/data

in

/opt/grid/condor/local.&#60;hostname&#62;/condor_config.local

and restart condor once more&#58;

. /opt/grid/setup.sh
vdt-control --off condor
vdt-control --on condor

Once that has been done, I think we&#39;re good to go&#58; your Condor records
are caught up, the default job manager is managedfork and current jobs
are picking up certificate information from Globus / GRAM where appropriate.

Thanks again for your help getting this into shape.

Best,
Chris.

--
Chris Green &#60;greenc@....&#62;, FNAL CD/SCF/GRID; &#39;phone (630) 840-2167.
IRC&#58; greenc@...., ChrisGreen@....;
chissgreen (AIM, Yahoo); chissg@.... (MSNM);
chris.h.green (Google Talk).</pre></div><div class='update_description'><i onclick="document.location='7946#1263344767'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-01-13T01:06:07+00:00">Jan 13, 2010 01:06 AM UTC</time> by <b>Florian Lengyel</b><a class="anchor" name="1263344767">&nbsp;</a></div><pre>In /opt/grid/condor/local.&#60;hostname&#62;/condor_config.local

the following line was added&#58;
PER_JOB_HISTORY_DIR = /opt/grid/graita/var/data

Also,
START_LOCAL_UNIVERSE = TotalLocalJobsRunning &#60; 10 || GridMonitorJob =?= TRUE
was replaced with
START_LOCAL_UNIVERSE = TotalLocalJobsRunning &#60; 20 || GridMonitorJob =?= TRUE

The managed-fork jobscheduler is now the default *fork* (not batch) job manager; the
procedure was&#58;

. /opt/grid/setup.sh
$VDT_LOCATION/vdt/setup/configure_globus_gatekeeper --managed-fork y --server y

condor was restarted with

. /opt/grid/setup.sh
vdt-control --off condor
vdt-control --on condor

I believe everything is now DONE.</pre></div><div class='update_description'><i onclick="document.location='7946#1263343869'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-01-13T00:51:09+00:00">Jan 13, 2010 12:51 AM UTC</time> by <b>Chris Green</b><a class="anchor" name="1263343869">&nbsp;</a></div><pre>Hi Florian,

PER_JOB_HISTORY_DIR should be set in

/opt/grid/condor/local.&#60;hostname&#62;/condor_config.local

viz&#58;

PER_JOB_HISTORY_DIR = /opt/grid/graita/var/data

You would restart the condor service with&#58;

. /opt/grid/setup.sh
vdt-control --off condor
vdt-control --on condor

You would configure managedfork to be the default *fork* jobmanager.
Standard batch job submissions will be unaffected and will head to SGE
like they always have. Setting managedfork to be the default is
advantageous because it allows you to control the number of simultaneous
fork (not batch) jobs running on your gatekeeper to have load / DOS issues.

Configure managedfork to be default with&#58;

. /opt/grid/setup.sh
$VDT_LOCATION/vdt/setup/configure_globus_gatekeeper --managed-fork y --server y

To limit the number of concurrent fork jobs running on your gatekeeper, add&#58;

START_LOCAL_UNIVERSE = TotalLocalJobsRunning &#60; 20 || GridMonitorJob =?= TRUE

to

/opt/grid/condor/local.&#60;hostname&#62;/condor_config.local

<div id='show_599958826' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_599958826'>and restart condor as described above.

Thanks,
Chris.

On 1/12/10 6&#58;27 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_599958826').click(function() {
            $('#detail_599958826').slideDown("normal");
            $('#show_599958826').hide();
            $('#hide_599958826').show();
        });
        $('#hide_599958826').click(function() {
            $('#detail_599958826').slideUp();
            $('#hide_599958826').hide();
            $('#show_599958826').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='7946#1263342605'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-01-13T00:30:05+00:00">Jan 13, 2010 12:30 AM UTC</time> by <b>Florian Lengyel</b><a class="anchor" name="1263342605">&nbsp;</a></div><pre>You&#39;re saying that managed-fork should be the default -- SGE will ordinarily
be specified in any case. Fine. I await instructions. See my previous note that
it is not clear which condor_config file should be modified, or if some other
procedure should be followed to ensure that PER_JOB_HISTORY_DIR is set.</pre></div><div class='update_description'><i onclick="document.location='7946#1263342426'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-01-13T00:27:06+00:00">Jan 13, 2010 12:27 AM UTC</time> by <b>Florian Lengyel</b><a class="anchor" name="1263342426">&nbsp;</a></div><pre>Why do I want managed-fork to be the default?

I wrote that I would do the following&#58;

(01&#58;36&#58;57 PM) Chris Green&#58; Next problem is he doesn&#39;t have
PER_JOB_HISTORY_DIR set to /opt/grid/gratia/var/data in his
condor_config. He needs to do this and restart condor.

Unfortunately I don&#39;t see PER_JOB_HISTORY defined in
/opt/grid/condor/etc/condor_config
or in
/opt/grid/condor-cron/etc/condor_config

Where should this be set? Both locations? Manually or through
a script?

FL</pre></div><div class='update_description'><i onclick="document.location='7946#1263340874'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-01-13T00:01:14+00:00">Jan 13, 2010 12:01 AM UTC</time> by <b>Chris Green</b><a class="anchor" name="1263340874">&nbsp;</a></div><pre>Hi,

Great Florian, thank you. Be aware though, I did not (to my knowledge)
provide instructions on how to make the managedfork jobmanager the
default, only on how to correct the condor configuration. I will defer
to Alain on the latter. Alain, could you respond?

Thanks,
Chris.

On 1/12/10 5&#58;54 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='7946#1263340446'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-01-12T23:54:06+00:00">Jan 12, 2010 11:54 PM UTC</time> by <b>Florian Lengyel</b><a class="anchor" name="1263340446">&nbsp;</a></div><pre>Will bring managed-fork into compliance in that case, following your
instructions in your previous ticket.

On Tue, Jan 12, 2010 at 4&#58;09 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='7946#1263330546'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-01-12T21:09:06+00:00">Jan 12, 2010 09:09 PM UTC</time> by <b>Chris Green</b><a class="anchor" name="1263330546">&nbsp;</a></div><pre>Great, thank you for the prompt reply. The SGE probe is spooling through
your accounting log, and when the job EndTime gets within 3 months of
today the collector will start recording jobs.

Regarding (2), note that any &#34;full job&#34; submitted will run on the SGE
batch system just as you desire. However, every gatekeeper install gives
the facility for some &#34;almost-interactive&#34; commands to run on the
gatekeeper itself -- for instance, to verify the capabilities of a site,
or install software in $OSG_APP (which is not usually writable from
worker nodes). Normally these commands run directly on the gatekeeper
with no queuing, leaving you vulnerable to DOS caused by too many of
these jobs executing simultaneously. However, the &#34;managedfork&#34; system
sets up condor running a &#34;mini-cluster&#34; of which the gatekeeper is the
only member. Incoming fork jobs are put on this queue instead of being
executed immediately, and are managed to avoid too many executing
concurrently and overloading the gatekeeper. They still execute only on
the gatekeeper though -- they are not in competition with your SGE
system. As I said, you already have managedfork configured, but it is
not the default fork queue, so most fork jobs will still run un-queued
and un-accounted. However, because the condor probe is checking in with
Gratia but not reporting any jobs, managedfork should either be brought
into full operation or deactivated completely to avoid false-alarm
trouble reports.

Thanks,
Chris.

On 1/12/10 2&#58;30 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='7946#1263328208'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-01-12T20:30:08+00:00">Jan 12, 2010 08:30 PM UTC</time> by <b>Florian Lengyel</b><a class="anchor" name="1263328208">&nbsp;</a></div><pre>1. You appear to have reset / truncated your SGE accounting file /usr/local/sge/default/common/accounting, possibly over 1 year ago. When this happens, you must remove the state file /opt/grid/gratia/var/tmp/checkpoint. Please do this in order to trigger a catch-up of SGE batch job accounting.

DONE

As for 2) I would prefer that sites use SGE as the job manager, since this is the only distributed resource manager we are running.</pre></div><div class='update_description'><i onclick="document.location='7946#1263327138'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-01-12T20:12:18+00:00">Jan 12, 2010 08:12 PM UTC</time> by <b>Chris Green</b><a class="anchor" name="1263327138">&nbsp;</a></div><pre>[ GOC&#58; please CC&#58; Alain on this ticket at his request. ]

Hi Florian,

I&#39;m afraid that there are still one or two issues on your site, with particular regard to Gratia and related facilities. I have cc&#58;d alain Roy on this ticket so he can help with one or two of the trickier fixes that I don&#39;t have the expertise to advise you on.

1. You appear to have reset / truncated your SGE accounting file /usr/local/sge/default/common/accounting, possibly over 1 year ago. When this happens, you must remove the state file /opt/grid/gratia/var/tmp/checkpoint. Please do this in order to trigger a catch-up of SGE batch job accounting.

2. You appear to have managedfork almost, but not quite, configured. If you weren&#39;t aware, &#34;fork&#34; jobs can be executed on your site and usually run immediately on the gatekeeper node (not the batch system) and are not accounted. If &#34;managedfork&#34; is configured, then condor is set up and run on your gatekeeper to handle fork jobs as if they were batch jobs, but running only on the gatekeeper. These jobs are accounted.

You have managedfork configured to the extent that condor is running, and a command&#58;

globus-job-run cunygrid.gc.cuny.edu/jobmanager-managedfork /usr/bin/id

executes and is accounted for by Gratia, but the default invocation&#58;

globus-job-run cunygrid.gc.cuny.edu /usr/bin/id

runs a standard (non-managed) fork job and is thus not accounted.

In order to avoid being dinged for having a condor probe that never reports any jobs, please either&#58;

a) Configure jobmanager-managedfork to be the default (preferred); or

b) Deactivate the managedfork configuration, including condor and the
Gratia Condor probe.

If you choose (a), for better efficiency you should also add the line&#58;

PER_JOB_HISTORY_DIR = /opt/grid/gratia/var/data

to your *condor_config* file and restart Condor.

This should clear up any remaining problems with your gatekeeper configuration.

<div id='show_1235825677' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1235825677'>If you have any problems doing any of the above or require clarification, please reply on this ticket and either Alain or myself will answer.

Thanks for your help and time,

Chris Green.

</div><script type='text/javascript'>
        $('#show_1235825677').click(function() {
            $('#detail_1235825677').slideDown("normal");
            $('#show_1235825677').hide();
            $('#hide_1235825677').show();
        });
        $('#hide_1235825677').click(function() {
            $('#detail_1235825677').slideUp();
            $('#hide_1235825677').hide();
            $('#show_1235825677').show();
        });
        </script></pre></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F7946">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
