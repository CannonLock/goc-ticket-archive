<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[23636] Gratia Reporting for Resource&#58; OU_OSCER_ATLAS</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=23636" method="post">
<div class="page-header">
    <h3><span class="muted">23636</span> / Gratia Reporting for Resource&#58; OU_OSCER_ATLAS</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Vince Neal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Resource Name</label><div class="controls">OU_OSCER_ATLAS</div></div><div class="control-group"><label class="control-label">Associated VO</label><div class="controls">DOSAR</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Vince Neal</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">USATLAS</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">investigation</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2015-03-26</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">USATLAS (BNL Prod)&nbsp;<a target="_blank" href="https://rt.racf.bnl.gov/rt/Ticket/Display.html?id=25020">25020</a> <span class="muted"> / Ticket Exchange</span></div><div class="assignee" style="width: 60%">Carl Edquist <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/23636", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/23636?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/23636?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Gratia%20Reporting%20for%20Resource%26%2358%3B%20OU_OSCER_ATLAS%20ISSUE%3D23636%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='23636#1427400854'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-26T20:14:14+00:00">Mar 26, 2015 08:14 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1427400854">&nbsp;</a></div><pre>Thanks Marco!

I&#39;m closing this ticket from the RT side.

Cheers, Horst
-- by hs@.... at Thu Mar 26 20&#58;12&#58;17 UTC 2015

GOCTX Source&#58; BNL Ticket&#58; Queue=SWTier2 ID=25020</pre></div><div class='update_description'><i onclick="document.location='23636#1427400333'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-26T20:05:33+00:00">Mar 26, 2015 08:05 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1427400333">&nbsp;</a></div><pre>Horst,
I don&#39;t know if the new LSF probe will substitute the current pbs-lsf, anyway it is available in osg-development&#58;
gratia-probe-lsf.noarch                                                                                        1.14.0-1.osg32.el6                                                                           osg-development

Let me know if you are doing some test.
Thanks,
Marco</pre></div><div class='update_description'><i onclick="document.location='23636#1427400318'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-26T20:05:18+00:00">Mar 26, 2015 08:05 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1427400318">&nbsp;</a></div><pre>Horst,
I don&#39;t know if the new LSF probe will substitute the current pbs-lsf, anyway it is available in osg-development&#58;
gratia-probe-lsf.noarch                                                                                        1.14.0-1.osg32.el6                                                                           osg-development

Let me know if you are doing some test.
Thanks,
Marco</pre></div><div class='update_description'><i onclick="document.location='23636#1427400116'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-26T20:01:56+00:00">Mar 26, 2015 08:01 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1427400116">&nbsp;</a></div><pre>Hi uploaded also the other records (records reprocessed successfully&#58; 106866).
The ticket can be closed.
Marco</pre></div><div class='update_description'><i onclick="document.location='23636#1427210605'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-24T15:23:25+00:00">Mar 24, 2015 03:23 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1427210605">&nbsp;</a></div><pre>Marco,

Any updates here?  We are all at the AHM so we can discuss in person if we need to.

-Kyle</pre></div><div class='update_description'><i onclick="document.location='23636#1426864396'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-20T15:13:16+00:00">Mar 20, 2015 03:13 PM UTC</time> by <b>echism</b><a class="anchor" name="1426864396">&nbsp;</a></div><pre>Hey Marco,

Where are we on this?

Thank you</pre></div><div class='update_description'><i onclick="document.location='23636#1426619994'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-17T19:19:54+00:00">Mar 17, 2015 07:19 PM UTC</time> by <b>echism</b><a class="anchor" name="1426619994">&nbsp;</a></div><pre>Horst,

Yes, sorry. We stopped doing email attachments when we built this interface. I saw that attachments were present and didn&#39;t scrutinize the list.

My mistake!</pre></div><div class='update_description'><i onclick="document.location='23636#1426523658'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-16T16:34:18+00:00">Mar 16, 2015 04:34 PM UTC</time><a class="anchor" name="1426523658">&nbsp;</a></div><pre>Sorry, I meant &#39;I guess not&#39;. &#58;)

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27</pre></div><div class='update_description'><i onclick="document.location='23636#1426523610'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-16T16:33:30+00:00">Mar 16, 2015 04:33 PM UTC</time><a class="anchor" name="1426523610">&nbsp;</a></div><pre>Hi Marco,

sorry about that. I thought attachments are propagated properly via emails to the ticket, but I guess now. I have just attached them by hand to this ticket. I had to add .txt to them, since otherwise it wouldn&#39;t allow me to upload them.

Thanks, Horst

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27</pre></div><div class='update_description'><i onclick="document.location='23636#1426522868'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-16T16:21:08+00:00">Mar 16, 2015 04:21 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1426522868">&nbsp;</a></div><pre>Hi Horst,
the attachment did not come through. You can attache them to the ticket web interface or send me an email.
Marco</pre></div><div class='update_description'><i onclick="document.location='23636#1426104856'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-11T20:14:16+00:00">Mar 11, 2015 08:14 PM UTC</time> by <b>echism</b><a class="anchor" name="1426104856">&nbsp;</a></div><pre>Hey Marco,

Did you have a chance to review the attachments?</pre></div><div class='update_description'><i onclick="document.location='23636#1425928787'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-09T19:19:47+00:00">Mar 9, 2015 07:19 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1425928787">&nbsp;</a></div><pre>Hi Marco,

sorry for the delay, we had a campus wide power outage this morning, and
have just now recovered from that.

I have attached /etc/gratia/pbs-lsf/ProbeConfig and
/var/lib/osg/user-vo-map to this email. Please let me know if there&#39;s
something else we can do to help.

Thanks a lot,

Horst

On 03/09/2015 06&#58;41 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23636#1425901280'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-09T11:41:20+00:00">Mar 9, 2015 11:41 AM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1425901280">&nbsp;</a></div><pre>Hi Horst,
I need to tell the probe how to map the users. I will need your ProbeConfig file and the user-vo-mapfile (in /var/lib/osg).
Thank you,
Marco</pre></div><div class='update_description'><i onclick="document.location='23636#1425747731'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-07T17:02:11+00:00">Mar 7, 2015 05:02 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1425747731">&nbsp;</a></div><pre>Thanks Marco!

Yes, all local users are mapped to DOSAR, so if you can upload these records
as well, that would be great! Let me know if you need more information
about that.

Thanks again,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23636#1425690609'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-07T01:10:09+00:00">Mar 7, 2015 01:10 AM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1425690609">&nbsp;</a></div><pre>Horst, all,
The data for grid users (all the one coming with a certificate that has been recorded in a certinfo file) has been recovered.
The data for local users has been quarantined because I don&#39;t have the mapping of the local users.

New records sent successfully&#58; 102661
New records suppressed&#58; 487190
The number of records are a bit bigger, to be sure not to miss records I extended the time interval and let the Gratia collector discard the duplicate records.

I think the local users are normally all mapped to DOSAR but I&#39;m not sure. Local users are generally not important for OSG or ATLAS statistics. So I think the important data has been recovered and the ticket can be closed.
If local user data is important/used and would like to add them to Gratia, I will need some more files and probably to talk to Horst to make sure that I map them correctly.

Please let me know how to proceed.
Cheers,
Marco

PS I will keep you posted about the new LSF probe.</pre></div><div class='update_description'><i onclick="document.location='23636#1425674124'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-06T20:35:24+00:00">Mar 6, 2015 08:35 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1425674124">&nbsp;</a></div><pre>Thanks Marco!

Sure, we&#39;d love to test this new probe!

We don&#39;t have such a large log file anymore, since the OSCER admins are
now rotating that every day, but I&#39;m sure we can still test the normal
functionality of it!

Thanks a lot,
have a great weekend,

Horst

On 03/06/2015 01&#58;58 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23636#1425671934'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-06T19:58:54+00:00">Mar 6, 2015 07:58 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1425671934">&nbsp;</a></div><pre>I have a probe currently running on fermicloud124 that is sending the records for the missing time interval.
The probe is posing itself as grid1.oscer.ou.edu so the record should be added to the regular OU records.
It will take few hours to complete. I&#39;ll post an update once it is done.

The probe I&#39;m using is a new version of the LSF probe which I developed and tested. It has the same behavior of the previous one but it is all in python.
I already tested it feeding the records in a test collector also on Fermicloud.
Beside python the advantage is that it does not need temporary copies of the log files, so it should work fine also if the log file is huge and there is not much disk space (the problem that started this ticket). I&#39;m running on the full log file provided by Horst (30GB).

Horst,
next week there should be at least a beta RPM of the new probe if you want to test it on a installation with a running LSF.

Cheers,
Marco</pre></div><div class='update_description'><i onclick="document.location='23636#1425658935'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-06T16:22:15+00:00">Mar 6, 2015 04:22 PM UTC</time> by <b>echism</b><a class="anchor" name="1425658935">&nbsp;</a></div><pre>Marco,

Do you have an update?</pre></div><div class='update_description'><i onclick="document.location='23636#1425317025'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-02T17:23:45+00:00">Mar 2, 2015 05:23 PM UTC</time> by <b>echism</b><a class="anchor" name="1425317025">&nbsp;</a></div><pre>Marco,

Do you have an update?</pre></div><div class='update_description'><i onclick="document.location='23636#1424976289'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-26T18:44:49+00:00">Feb 26, 2015 06:44 PM UTC</time> by <b>echism</b><a class="anchor" name="1424976289">&nbsp;</a></div><pre>Hi Marco,

Do you have an update?

Thank you</pre></div><div class='update_description'><i onclick="document.location='23636#1424804798'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-24T19:06:38+00:00">Feb 24, 2015 07:06 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1424804798">&nbsp;</a></div><pre>Thanks Marco!

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23636#1424802005'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-24T18:20:05+00:00">Feb 24, 2015 06:20 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1424802005">&nbsp;</a></div><pre>Sorry, I&#39;m the hold-up on this. I&#39;ve been pulled to other items and it remain behind.
I&#39;ll run over the data provided by Horst to recover the recoverable records.
I&#39;ll send some updates tomorrow.
Marco</pre></div><div class='update_description'><i onclick="document.location='23636#1424798300'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-24T17:18:20+00:00">Feb 24, 2015 05:18 PM UTC</time><a class="anchor" name="1424798300">&nbsp;</a></div><pre>Hi all, I think I&#39;m about ready to close this ticket again, since things seem to be working again, and I&#39;m not terribly concerned with a few days of lost data in the long run. The one thing I&#39;m still not sure about is that we usually end up with about 200-300 &#39;leftover&#39; gratia_certinfo_lsf_* files in /var/lib/gratia/data/ which are a day or two days old, and the logs are still mentioning the  same error about them, &#34;unable to find valid certinfo file for job&#34;. But they eventually disappear, since I don&#39;t find any of them that are older than about a day, so I assume they&#39;re getting processed eventually? If that&#39;s the case, and this is just a transitory error, then I think we&#39;re done here and we can close this ticket again. Thanks, Horst

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27</pre></div><div class='update_description'><i onclick="document.location='23636#1424184426'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-17T14:47:06+00:00">Feb 17, 2015 02:47 PM UTC</time> by <b>echism</b><a class="anchor" name="1424184426">&nbsp;</a></div><pre>Hi Marco,

Can you update this?

Thank you</pre></div><div class='update_description'><i onclick="document.location='23636#1423591153'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-10T17:59:13+00:00">Feb 10, 2015 05:59 PM UTC</time> by <b>echism</b><a class="anchor" name="1423591153">&nbsp;</a></div><pre>Hey Marco,

What happened with this?

Thank you</pre></div><div class='update_description'><i onclick="document.location='23636#1422946391'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-03T06:53:11+00:00">Feb 3, 2015 06:53 AM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1422946391">&nbsp;</a></div><pre>Thanks Marco!

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23636#1422925302'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-03T01:01:42+00:00">Feb 3, 2015 01:01 AM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1422925302">&nbsp;</a></div><pre>Thank you Horst,
I was able to download the files. I&#39;ll do the rest tomorrow.
Marco</pre></div><div class='update_description'><i onclick="document.location='23636#1422907819'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-02T20:10:19+00:00">Feb 2, 2015 08:10 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1422907819">&nbsp;</a></div><pre>Hi Marco,

okay, I tarred them up into two files, and these commands work for me,
so hopefully they work for you, too.

globus-url-copy <a href='gsiftp&#58;//grid1.oscer.ou.edu/home/usatlas1/tmp/lsb.acct.4.gz' target='_blank' rel='nofollow'>gsiftp&#58;//grid1.oscer.ou.edu/home/usatlas1/tmp/lsb.acct.4.gz</a> file&#58;/tmp/lsb.acct.4.gz
globus-url-copy <a href='gsiftp&#58;//grid1.oscer.ou.edu/home/usatlas1/tmp/gratia_certinfo_lsf.tgz' target='_blank' rel='nofollow'>gsiftp&#58;//grid1.oscer.ou.edu/home/usatlas1/tmp/gratia_certinfo_lsf.tgz</a> file&#58;/tmp/gratia_certinfo_lsf.tgz

The first one is the gzipped log file, which is now only 2 GB,
and the second one contains the directory with the 107k gratia records.

We have two of your certificates mapped to existing unix users&#58;

&#34;/DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mambelli/CN=621693/CN=Marco Mambelli&#34; usatlas1
&#34;/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Marco Mambelli&#34; usatlas1

Hopefully you can use one of them. If not, we&#39;ll have to re-map your FNAL cert
to a different account, which we can do, too.

Let me know if this works!
Thanks a lot,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23636#1422902244'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-02T18:37:24+00:00">Feb 2, 2015 06:37 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1422902244">&nbsp;</a></div><pre>Hi Marco,

ah, right, gridftp would be the best choice! I&#39;ll prepare that tomorrow.

Thanks,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23636#1422899951'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-02T17:59:11+00:00">Feb 2, 2015 05:59 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1422899951">&nbsp;</a></div><pre>Hi Horst,
yes, if it works for you I&#39;d like to download the files (ftp/gridftp/http).
If you can also gzip lsb.acct.4 (if it is not already) I think it will shrink a bit and be faster to download.

Thank you,
Marco</pre></div><div class='update_description'><i onclick="document.location='23636#1422895761'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-02T16:49:21+00:00">Feb 2, 2015 04:49 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1422895761">&nbsp;</a></div><pre>Hi Marco,

I think all the info you are looking for is in the 30 GB lsb.acct.4 file
(which has been rotated from lsb.acct to lsb.acct.4 by now),
and then all the 100k gratia_certinfo_lsf_6202318 files.

So if those are what you&#39;d like, I can certainly put them somewhere
where you can download them. But keep in mind that we&#39;re talking
about 35 GB of files altogether. If that&#39;s okay, I&#39;ll copy them
over tomorrow and let you know. I just got to CERN and have been awake
for about 28h or so, so I don&#39;t think I&#39;ll do it tonight. =)

Thanks a lot,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23636#1422893994'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-02T16:19:54+00:00">Feb 2, 2015 04:19 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1422893994">&nbsp;</a></div><pre>Hi Horst,
you are reporting fine now but there is a gap between 2014-12-27 and 2015-01-05.

The LSF accounting files you mentioned and attached (in fragments are) lsb.acct (from 1/12/2015 on) and lsb.acct.1 (from 1/5 to 1/12).
I checked the dates in the fragments you attached (head/tail) and the files are progressive, new job records are appended.

Do you have other accounting files (probably lsb.acct.N)?
I&#39;d be interested in one that cover the time of the gap (neither lsb.acct or lsb.acct.1 mentioned above do).

If you find some more accounting files you can check the dates yourself.
I looked into the format of those files&#58; each line is a job record and the 3rd field in the line, e.g. 1421212175 in (&#34;JOB_FINISH&#34; &#34;7.06&#34; 1421212175 6384094 10178 ...), is the job end time in sec since epoch.

If you find such files I&#39;d need those files and the certinfo files from 12/24/2014 to 1/5/2015. You should put them somewhere where I can download them. I will run the probe on them and fill the gap in Gratia reporting. Alternatively you can run the probe on them yourself, paying attention in setting/resetting correctly the checkpoint.

If you don&#39;t find such file we will not be able to recover the missing data&#58; the certinfo files older than 1/12/2015 can be deleted (only if there is not lsb.acct that we can use) and this ticket should be closed.

Thank you,
Marco</pre></div><div class='update_description'><i onclick="document.location='23636#1422565835'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-29T21:10:35+00:00">Jan 29, 2015 09:10 PM UTC</time> by <b>echism</b><a class="anchor" name="1422565835">&nbsp;</a></div><pre>Hi Marco,

Did you see our previous updates?

Thank you</pre></div><div class='update_description'><i onclick="document.location='23636#1422048042'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-23T21:20:42+00:00">Jan 23, 2015 09:20 PM UTC</time> by <b>echism</b><a class="anchor" name="1422048042">&nbsp;</a></div><pre>Marco,

Can you explain how to test? It&#39;s unclear to me also.

Thank you</pre></div><div class='update_description'><i onclick="document.location='23636#1421958976'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-22T20:36:16+00:00">Jan 22, 2015 08:36 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1421958976">&nbsp;</a></div><pre>Hi Marco,

thanks! I&#39;m not sure how I would need to run this test, but I&#39;d be happy
to try it, if someone gives me detailed instructions on how to do it! &#58;)

Thanks a lot,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23636#1421958508'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-22T20:28:28+00:00">Jan 22, 2015 08:28 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1421958508">&nbsp;</a></div><pre>Carl (or Horst if you&#39;ll be running the test),
I&#39;m running a test collector on fermicloud049.fnal.gov (that I use also for other tests) it is a simple VM but should be enough to see if the record are sent correctly.
Feel free to use it&#58;
&#60;pre&#62;
CollectorHost=&#34;fermicloud049.fnal.gov&#58;8880&#34;
SSLHost=&#34;fermicloud049.fnal.gov&#58;8443&#34;
SSLRegistrationHost=&#34;fermicloud049.fnal.gov&#58;8880&#34;
&#60;/pre&#62;</pre></div><div class='update_description'><i onclick="document.location='23636#1421794034'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-20T22:47:14+00:00">Jan 20, 2015 10:47 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1421794034">&nbsp;</a></div><pre>Hi Tanya and Carl,

thanks for the update!

I uploaded two records to the ticket already, do you want to try to send
those to a test collector? Or I can give you more, or all of them,
whatever you prefer! I&#39;m sure we&#39;ll find a way to copy them over to
wherever they need to go.

Thanks a lot,

Horst

On 01/20/2015 03&#58;49 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23636#1421790576'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-20T21:49:36+00:00">Jan 20, 2015 09:49 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1421790576">&nbsp;</a></div><pre>Hi Carl,
The probe is a disaster. I have been proposing for a long time to rewrite it. I hope you can do it eventually. The right way to test it is to move subset of the log file over and test with a test collector. Sending duplicates to a production collector is ok unless you are resending  hundred thousand of records.

Thanks,
Tanya</pre></div><div class='update_description'><i onclick="document.location='23636#1421790029'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-20T21:40:29+00:00">Jan 20, 2015 09:40 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1421790029">&nbsp;</a></div><pre>Well, it seems like the idea there was to update the timestamp in /var/lib/gratia/tmp/urCollectorBuffer.lsf once all the records were successfully processed, so that afterwards any older files could be disregarded as already processed.  I think most likely there was insufficient error checking later on when the &#39;tac&#39; command was used -- in particular, when it blew up due to the out-of-disk error, it appeared to the calling program as if it was successful and processed everything.  So probably at that point the timestamp was updated in urCollectorBuffer.lsf --as if it had successfully processed everything-- so the logic there is that there&#39;s no reason to look back any further.

What I&#39;m not sure about is whether it would be safe, now, to update the timestamp in urCollectorBuffer.lsf to something older, to get it to process the stuff it skipped over, or if that&#39;s a bad idea and would result in re-sending a bunch of already-processed records.  It may be that we&#39;ll need to manually send the portion that got skipped.  In any case the probe needs some TLC to better catch/handle errors like this in the future.

Carl

PS.  Looks like that &#39;if&#39; block has been there since the script was initially imported into the probes in 2006... Maybe this is just the first time we caught the right error condition to make this mess.</pre></div><div class='update_description'><i onclick="document.location='23636#1421417478'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-16T14:11:18+00:00">Jan 16, 2015 02:11 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1421417478">&nbsp;</a></div><pre>Hi Carl,

thanks for the explanation. Yes, you&#39;re right, the date stamp of lsb.acct.1
is older than what&#39;s in that file&#58;

----
[hs@grid1 ~]$ ls -ao /lsf/work/boomer/logdir/lsb.acct.1
-rw-r--r--. 1 lsfadmin 335218245 Jan 12 11&#58;14 /lsf/work/boomer/logdir/lsb.acct.1
[hs@grid1 ~]$ date -r /lsf/work/boomer/logdir/lsb.acct.1
Mon Jan 12 11&#58;14&#58;58 CST 2015
[hs@grid1 ~]$ date +%s -r /lsf/work/boomer/logdir/lsb.acct.1
1421082898

[hs@grid1 ~]$ ls -ao /var/lib/gratia/tmp/urCollectorBuffer.lsf
-rw-r--r--. 1 root 18 Jan 16 07&#58;48 /var/lib/gratia/tmp/urCollectorBuffer.lsf
[hs@grid1 ~]$ cat /var/lib/gratia/tmp/urCollectorBuffer.lsf
6413001&#58;1421416060[hs@grid1 ~]$
[hs@grid1 ~]$ date
Fri Jan 16 08&#58;02&#58;01 CST 2015
[hs@grid1 ~]$ date +%s
1421416908
----

But I would argue that this &#39;if&#39; block doesn&#39;t make any sense,
since we&#39;re obviously trying to process ALL the records in
/var/lib/gratia/data/, and if there were temporary problems,
then those will definitely be older than the time stamp in
/var/lib/gratia/tmp/urCollectorBuffer.lsf, since that is always
the current time of whenever Gratia ran last, right?

So if this means that Gratia will never process any acct logs
that are older than the current date, then something&#39;s wrong --
or I&#39;m simply not understanding this correctly. ;)

Thanks,
<div id='show_852740294' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_852740294'>
Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_852740294').click(function() {
            $('#detail_852740294').slideDown("normal");
            $('#show_852740294').hide();
            $('#hide_852740294').show();
        });
        $('#hide_852740294').click(function() {
            $('#detail_852740294').slideUp();
            $('#hide_852740294').hide();
            $('#show_852740294').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23636#1421377884'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-16T03:11:24+00:00">Jan 16, 2015 03:11 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1421377884">&nbsp;</a></div><pre>Sorry, I meant&#58;

date +%s -r /lsf/work/boomer/logdir/lsb.acct.1</pre></div><div class='update_description'><i onclick="document.location='23636#1421377665'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-16T03:07:45+00:00">Jan 16, 2015 03:07 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1421377665">&nbsp;</a></div><pre>Ah, sorry if that was confusing.

I was looking at the processLrmsLogs function in urCollector.pl, in particular around lines 369-372 here&#58;

366    while ($keepgoing && $continueProcessing && @sortedLrmsLogFiles) {
367       my $thisLogFile = shift (@sortedLrmsLogFiles);
368
369       if ( $logFMod{$thisLogFile} &#60; $startTimestamp ) {
370          # last modified (appended) _before_ the job we have already
371          # processed hence we stop here!
372          $continueProcessing = 0;
373       }
374       else {
375          print &#34;&#34;.localtime().&#34;&#58; Processing LRMS log file&#58; $thisLogFile; last modified&#58; $logFMod{$thisLogFile}&#92;n&#34;;
376
377          &processLrmsLogFile($thisLogFile, $newestFile,
378          $_[0], $_[1], $_[2], $_[3]);
379          $newestFile = 0;
380          # Call Gratia processing internally now to avoid leaving huge numbers of files unprocessed
381          system(&#34;/usr/share/gratia/pbs-lsf/pbs-lsf_meter.pl 2&#62;&1&#34;);
382          # Note we can&#39;t update the state buffer becuse of the crazy way we
383          # read backwards. That means if we get interrupted and have to
384          # start again, Gratia will get a bunch of duplicates.
385       }
386    }

From what I can tell from the rest of the script, $startTimestamp corresponds to the second number in the last line of urCollectorBuffer.lsf (which apparently is the only line in that file).  And $logFMod{$thisLogFile} is the mtime for the current lsb.acct* file, and @sortedLrmsLogFiles are sorted most-recent-first.

So, the way I read it, your lsb.acct.1 will always trigger that first &#39;if&#39; block and not get processed.  (But, you can verify the timestamps to compare with &#34;date +s -r /lsf/work/boomer/logdir/lsb.acct.1&#34; )

Carl</pre></div><div class='update_description'><i onclick="document.location='23636#1421375172'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-16T02:26:12+00:00">Jan 16, 2015 02:26 AM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1421375172">&nbsp;</a></div><pre>Hi Carl,

hmm, these voi/VOc warnings are still there, so it doesn&#39;t look like
removing the trailing spaces fixed that ...
But as you say, it&#39;s just a warning, so that&#39;s not the problem right now.

I looked at that file, and it only contains one line&#58;

----
[hs@grid1 ~]$ ls -ao /var/lib/gratia/tmp/urCollectorBuffer.lsf
-rw-r--r--. 1 root 18 Jan 15 19&#58;40 /var/lib/gratia/tmp/urCollectorBuffer.lsf
[hs@grid1 ~]$ cat /var/lib/gratia/tmp/urCollectorBuffer.lsf
6402146&#58;1421372416[hs@grid1 ~]$

[wait 20 minutes]

[hs@grid1 ~]$ ls -ao /var/lib/gratia/tmp/urCollectorBuffer.lsf
-rw-r--r--. 1 root 18 Jan 15 20&#58;07 /var/lib/gratia/tmp/urCollectorBuffer.lsf
[hs@grid1 ~]$ cat /var/lib/gratia/tmp/urCollectorBuffer.lsf
6402639&#58;1421374040[hs@grid1 ~]$

[wait 15 minutes]

[hs@grid1 ~]$ ls -ao /var/lib/gratia/tmp/urCollectorBuffer.lsf
-rw-r--r--. 1 root 18 Jan 15 20&#58;19 /var/lib/gratia/tmp/urCollectorBuffer.lsf
[hs@grid1 ~]$ cat /var/lib/gratia/tmp/urCollectorBuffer.lsf
6402771&#58;1421374728[hs@grid1 ~]$

[hs@grid1 ~]$ date +%s
1421374811
----

So that looks like the last LSF job ID processed, and the date stamp
in +%s format, so I&#39;m afraid I don&#39;t quite follow your reasoning
about why Gratia wouldn&#39;t process the older acct file.
<div id='show_463032625' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_463032625'>Could you please elaborate on that?

Thanks,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_463032625').click(function() {
            $('#detail_463032625').slideDown("normal");
            $('#show_463032625').hide();
            $('#hide_463032625').show();
        });
        $('#hide_463032625').click(function() {
            $('#detail_463032625').slideUp();
            $('#hide_463032625').hide();
            $('#show_463032625').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23636#1421371511'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-16T01:25:11+00:00">Jan 16, 2015 01:25 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1421371511">&nbsp;</a></div><pre>Thanks Horst,

It sounds like the trailing space thing was probably harmless then, but removing it should get rid of the warning for now.  (And, after upgrading to the next gratia probe release it won&#39;t produce any warnings for trailing whitespace.)

From the lsb.acct*head.txt files you attached it looks like there isn&#39;t any sort of preamble at the beginning -- so that is good in terms of wanting to replay the data, since it means we won&#39;t need the whole 29G file.

Can you also see if there is a file called&#58; /var/lib/gratia/tmp/urCollectorBuffer.lsf  (or, whatever the &#34;collectorBufferFileName&#34; config value is set to, plus &#34;.lsf&#34;), and if it exists can you save and attach the tail 10 lines of it?  Apparently the timestamp that the lsf probe considers its last timestamp is on the last line of this file.

And actually it looks like there are also lines in the gratia logs like this&#58;

15&#58;31&#58;15 CST Gratia&#58; Reading buffer /var/lib/gratia/tmp/urCollectorBuffer.lsf. First job to analyse&#58; id=6373762; log timestamp=1421097579

which should correspond to that same timestamp from the end of the urCollectorBuffer.lsf file.  In any case, it looks like the lsf probe won&#39;t process any lsb.acct* files that have a modified timestamp that&#39;s _older_ than the last timestamp from that log.  Going of the timestamps in the lsb.acct*tail.txt files you attached, I see 1421082805 (older) in lsb.acct.1 and 1421283534 (newer) in lsb.acct ... So the probe is probably always skipping lsb.acct.1.

We&#39;ll need to find a way to recover from it getting into a bad state like this in general, but in the mean time, if you have a cutoff date for the jobs that still need to be reported, we may be able to use a tail portion of lsb.acct.1 covering the unreported window and submit those from a separate VM.  Marco, do you have any thoughts on this?

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='23636#1421285689'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-15T01:34:49+00:00">Jan 15, 2015 01:34 AM UTC</time><a class="anchor" name="1421285689">&nbsp;</a></div><pre>Hi Carl,

well, there was a single extra white space at the end of the voi and VOc lines, so I removed those.

But those same extra white spaces are on all our other sites, too; but maybe this is a problem specific to the LSF scheduler?
Well, we&#39;ll see if this helps.

No extra white spaces in those lines, I pasted them again here&#58;

----
#voi cdf fermilab atlas atlas atlas mis star cms ligo dzero dzero dosar des glo&#92;
w nanohub geant4 i2u2 osg osgedu nwicg ops gpn compbiogrid engage ilc nysgrid s&#92;
bgrid cigi icecube alice nebiogrid gluex gridunesp dayabay hcc belle csiu surag&#92;
rid nees gcvo gcvo superb.org dream lbne lsst
#VOc CDF FERMILAB ATLAS ATLAS ATLAS MIS STAR CMS LIGO DZERO DZERO DOSAR DES GLO&#92;
W NANOHUB GEANT4 I2U2 OSG OSGEDU nwicg OPS gpn CompBioGrid Engage ILC NYSGRID S&#92;
BGrid CIGI IceCube ALICE NEBioGrid Gluex GridUNESP DayaBay HCC belle csiu SURAG&#92;
rid NEES GCVO GCEDU SuperB DREAM LBNE LSST
----

I also attached the head and tail files of these two accounting files, let me know if that helps, or if there&#39;s anything else I can provide.

Thanks a lot,

Horst

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27</pre></div><div class='update_description'><i onclick="document.location='23636#1421276828'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-14T23:07:08+00:00">Jan 14, 2015 11:07 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1421276828">&nbsp;</a></div><pre>Hi Horst,

Marco and I were looking into this more, and it seems that your warning message&#58;

----
/var/log/gratia/2014-12-12.log&#58;00&#58;03&#58;54 CST Gratia&#58; WARNING&#58; no VOc match for voi &#34;&#34;&#58; not entering in (voi, VOc) table.
----

may be due to extra spaces on the &#34;#voi&#34; line, either just after the &#34;#voi&#34; part or at the end of the line.  I am currently building a gratia-probe-1.13.31-1.1, which is patched to be able to better handle whitespace anomalies like that.  In the mean time, can you ask your admin to check the #voi/#VOc lines and trim any trailing whitespace?

To look into the issue further I think we&#39;ll at least need samples of the accounting logs.  Can you get output like the following?

head -100 /lsf/work/boomer/logdir/lsb.acct &#62; ~/lsb.acct.head.txt
head -100 /lsf/work/boomer/logdir/lsb.acct.1 &#62; ~/lsb.acct.1.head.txt
tail -1000 /lsf/work/boomer/logdir/lsb.acct &#62; ~/lsb.acct.tail.txt
tail -1000 /lsf/work/boomer/logdir/lsb.acct.1 &#62; ~/lsb.acct.1.tail.txt

I want to see the format to try to better understand what the probe looks for when it reads the line backwards (with tac) to see where to stop.  I&#39;m most interested in the tail parts, but the heads might be relevant if there is some kind of preamble that gets written.

I think Marco may also have some ideas / file requests.

Thanks!
Carl</pre></div><div class='update_description'><i onclick="document.location='23636#1421104813'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-12T23:20:13+00:00">Jan 12, 2015 11:20 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1421104813">&nbsp;</a></div><pre>Hi Marco,

hmm, I don&#39;t think our user-vo-map is corrupted, otherwise it wouldn&#39;t
produce any sensible results for current jobs, right?

The problem jobs are the ones between December 27 and January 5. The
first 16 jobs from December 20 and 22 are actually still hung on a hung
compute node, so those should go away once the OSCER admins reboot that
node and the jobs will either get restarted or terminated.

And the jobs from today are processing properly, so you just saw a few
before they got processed yet. The ones to concentrate on are older ones.

I just had another very close look at our user-vo-map, it&#39;s definitely
not corrupted. That partition also never filled up, it was only /tmp/
which filled up, so there&#39;s no reason why that would be corrupted.

That&#39;s just a warning, not an error -- oh, and it was already there a
long time before this problem started&#58;

----
/var/log/gratia/2014-12-12.log&#58;00&#58;03&#58;54 CST Gratia&#58; WARNING&#58; no VOc
match for voi &#34;&#34;&#58; not entering in (voi, VOc) table.
----

The problem didn&#39;t start until the 20th -- or maybe even the 27th, not
sure. So we&#39;re looking at the wrong thing here ...

Thanks,

Horst

On 01/12/2015 04&#58;49 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23636#1421102963'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-12T22:49:23+00:00">Jan 12, 2015 10:49 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1421102963">&nbsp;</a></div><pre>Hirst,
Then looking at the job IDs in the records, the log files and certinfo files I see&#58;
- the file with the job record is 28090 with a end time in 2012.
- the certinfo files are from 6.1 to 6.3 mil (61xxxxx - 63xxxxx)
- the log files mention similar numbers&#58;
00&#58;00&#58;39 CST Gratia&#58; Executing&#58; /usr/share/gratia/pbs-lsf/urCreator -t &#34;2015-01-12T06&#58;00&#58;39Z&#34; -r &#34;grid1.oscer.ou.edu&#58;6365153_1421042331&#34; -g &#34;grid1.oscer.ou.edu&#58;6365153_1421042331&#34; -l &#34;6365153&#34; -u &#34;usatlas1&#34; -x &#34;256&#34; -X &#34;exit status&#34; -w &#34;PT1M38S&#34; -c &#34;PT2S&#34; -e &#34;2015-01-12T06&#58;00&#58;29Z&#34; -s &#34;2015-01-12T05&#58;58&#58;51Z&#34; -m &#34;grid1.oscer.ou.edu&#34; -M &#34;Server&#34; -y &#34;c265&#34; -Y &#34;executing host&#34; -q &#34;hep_killable&#34; -Q &#34;LRMS type&#58; lsf&#34; &#34;Memory=10792,,K,,total,&#34; &#34;Swap=269544,,K,,total,&#34; &#34;Processors=1,,total,&#34; &#34;TimeInstant=2015-01-12T00&#58;00&#58;29Z,LRMS event timestamp,&#34;

If the job record file is recent the checkpoint should be moved to process more recent files.
If it is old then it can be deleted/ignored.

Carl or I will check if the probe can produce a valid record even if user-vo-map is corrupted where there is a certinfo.

I think fixing the user-vo-map is the first step. It may have been corrupted when the machine ran out of space.</pre></div><div class='update_description'><i onclick="document.location='23636#1421102294'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-12T22:38:14+00:00">Jan 12, 2015 10:38 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1421102294">&nbsp;</a></div><pre>Hi Marco,

the VO mapping isn&#39;t the problem, that works fine. We use mkgridmap, and
our user-vo-map looks fine&#58;

----
# User-VO map
# Generated by generate-vo-map
# The voi line is used by MonaLISA, and is the lower-case version of all
VO names
# The VOc line is used by MonaLISA, and is the proper-case version of
all VO names
# Other lines are of the form &#60;account&#62; &#60;VO&#62;

#voi cdf fermilab atlas atlas atlas mis star cms ligo dzero dzero dosar
des glow nanohub geant4 i2u2 osg osgedu nwicg ops gpn compbiogrid engage
ilc nysgrid sbgrid cigi icecube alice nebiogrid gluex gridunesp dayabay
hcc belle csiu suragrid nees gcvo gcvo superb.org dream lbne lsst
#VOc CDF FERMILAB ATLAS ATLAS ATLAS MIS STAR CMS LIGO DZERO DZERO DOSAR
DES GLOW NANOHUB GEANT4 I2U2 OSG OSGEDU nwicg OPS gpn CompBioGrid Engage
ILC NYSGRID SBGrid CIGI IceCube ALICE NEBioGrid Gluex GridUNESP DayaBay
HCC belle csiu SURAGrid NEES GCVO GCEDU SuperB DREAM LBNE LSST

usatlas1 atlas
usatlas3 atlas
usatlas4 atlas
mis mis
samgrid dzero
sam dzero
dosar dosar
glow glow
osg osg
gpn gpn
alice alice
hcc hcc
<div id='show_503481405' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_503481405'>[...]
----

I&#39;m not sure where that warning comes from, it might have to do with the
fact that some of the voi entries are in fact different from the VOc
entries, like superb.org vs. SuperB.

But that&#39;s not the problem, this is just a warning, and it&#39;s got nothing
to do with the actual errors we&#39;re seeing. If you look at

<a href='http&#58;//gratiaweb.grid.iu.edu/gratia/site?facility=OU_OSCER_ATLAS' target='_blank' rel='nofollow'>http&#58;//gratiaweb.grid.iu.edu/gratia/site?facility=OU_OSCER_ATLAS</a>

you can see that our VO mapping works fine ...

Thanks,

Horst

On 01/12/2015 04&#58;24 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_503481405').click(function() {
            $('#detail_503481405').slideDown("normal");
            $('#show_503481405').hide();
            $('#hide_503481405').show();
        });
        $('#hide_503481405').click(function() {
            $('#detail_503481405').slideUp();
            $('#hide_503481405').hide();
            $('#show_503481405').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23636#1421101490'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-12T22:24:50+00:00">Jan 12, 2015 10:24 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1421101490">&nbsp;</a></div><pre>Hi Horst,
user-vo-map us used to map users to VO in case there is the username but not the certificate info.
In the log files I see the warning&#58; 00&#58;00&#58;40 CST Gratia&#58; WARNING&#58; no VOc match for voi &#34;&#34;&#58; not entering in (voi, VOc) table.

Could you attach also your /var/lib/osg/user-vo-map ?
You may have a malformed one (or we may have some error in the parsing)
Do you use mkgridmap or GUMS?

Here is an explanation of how the mapping to a VO works&#58;
<a href='https&#58;//twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingGratiaVO' target='_blank' rel='nofollow'>https&#58;//twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingGratiaVO</a></pre></div><div class='update_description'><i onclick="document.location='23636#1421099703'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-12T21:55:03+00:00">Jan 12, 2015 09:55 PM UTC</time><a class="anchor" name="1421099703">&nbsp;</a></div><pre>Hi Marco,

okay, I just attached the last few log files, the &#39;ls -ao&#39; output of both the data and the quarantine directory, as well as one quarantined job. Please let me know if you need anything else. I had to add a .txt to each of them, since otherwise it wouldn&#39;t accept them for uploading. So you have to remove the .txt from the name, and then gunzip
the ones which have a .gz ending.

As far as backing them up, as I just said, I&#39;m not terribly worried about that, I just want this issue to be over ... ;)

Thanks a lot,

Horst

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27</pre></div><div class='update_description'><i onclick="document.location='23636#1421098888'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-12T21:41:28+00:00">Jan 12, 2015 09:41 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1421098888">&nbsp;</a></div><pre>Hi Marco,

thanks for digging around there!

Yes, the job ID is definitely the LSF job ID. But I don&#39;t understand why
it&#39;s getting those errors.

There are a few files in the quarantine directory, but not very many&#58;

----
[usatlas1@grid1 ~]$ ls -ao
/var/lib/gratia/data/quarantine/subdir.lsf_grid1.oscer.ou.edu_gratia-osg-prod.opensciencegrid.org_80/
total 136
drwxr-xr-x. 2 root 53248 Jan 12 15&#58;31 .
drwxr-xr-x. 3 root  4096 Jul 15 11&#58;21 ..
-rw-------. 1 root  1680 Dec 16 23&#58;20 r.15277.gratia.xml__NOhO3EI28r
-rw-------. 1 root  1682 Jan 12 11&#58;54 r.2520.gratia.xml__QweZguYHUH
-rw-------. 1 root  1630 Jan 12 10&#58;45 r.26434.gratia.xml__4Olyn1IUv9
-rw-------. 1 root  1674 Jan 12 10&#58;45 r.26434.gratia.xml__i08uRRyYAg
-rw-------. 1 root  1674 Jan 12 10&#58;45 r.26434.gratia.xml__iWIDWxjnov
-rw-------. 1 root  1675 Jan 12 10&#58;56 r.30724.gratia.xml__o62uXpwB0P
-rw-------. 1 root  1677 Dec 15 17&#58;07 r.32632.gratia.xml__2jPbYSm7uh
-rw-------. 1 root  1677 Dec 15 17&#58;07 r.32632.gratia.xml__bARpxme1je
-rw-------. 1 root  1688 Jan 12 11&#58;14 r.37523.gratia.xml__51YSbKVOhP
-rw-------. 1 root  1693 Jan 12 13&#58;29 r.37832.gratia.xml__hI9jomVGp1
-rw-------. 1 root  1677 Dec 15 17&#58;35 r.39764.gratia.xml__Vq5v6W1tVY
-rw-------. 1 root  1604 Jan 12 13&#58;39 r.41120.gratia.xml__8k58mHfejN
-rw-------. 1 root  1604 Jan 12 11&#58;41 r.47121.gratia.xml__VWIdGeP2fw
-rw-------. 1 root  1675 Jan 12 11&#58;41 r.47121.gratia.xml__XEKKVAsKBi
-rw-------. 1 root  1679 Jan 12 12&#58;10 r.8703.gratia.xml__PTvLH5bviV
-rw-------. 1 root  1669 Dec 15 15&#58;33 r.9932.gratia.xml__0k6UQ1r3Ku
-rw-------. 1 root  1670 Dec 15 15&#58;33 r.9932.gratia.xml__pWiD36EOMS
-rw-------. 1 root  1669 Dec 15 15&#58;33 r.9932.gratia.xml__sBfl8l9SCp
-rw-------. 1 root  1677 Dec 15 15&#58;33 r.9932.gratia.xml__sKAhkPI5fe
----
<div id='show_1152020388' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1152020388'>
And they&#39;re all older than this problem which started on December 20th.

So at this point, I&#39;m tempted to just delete all files in this
quarantine directory, as well as all these 102700 old records, and see
if that fixes the problem? We&#39;ll lose some gratia data, but at this
point I really don&#39;t care anymore, it&#39;s not THAT big of a deal in the
long run.

So would it be okay if I simply deleted the r.15277.gratia.xml__* and
gratia_certinfo_lsf_* files, or would that cause other problems?

Thanks a lot,

Horst

On 01/12/2015 03&#58;20 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_1152020388').click(function() {
            $('#detail_1152020388').slideDown("normal");
            $('#show_1152020388').hide();
            $('#hide_1152020388').show();
        });
        $('#hide_1152020388').click(function() {
            $('#detail_1152020388').slideUp();
            $('#hide_1152020388').hide();
            $('#show_1152020388').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23636#1421098593'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-12T21:36:33+00:00">Jan 12, 2015 09:36 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1421098593">&nbsp;</a></div><pre>Hi Horst,
could you attach to the ticket the following?

1. The probe log file (in /var/log/gratia) for a couple of days. If the &#34;LogLevel&#34; in ProbeConfig (/etc/gratia/pbs-lsf) is 5 or higher even better.
2. the list of the content of /var/lib/gratia/data (where all the certinfo files are, to see the IDs in the name)
3. If there is some file in  /var/lib/gratia/data/quarantine (and subdirectories) a couple of those files, recent ones, they should be XML files about the jobs

You may also want to save somewhere a backup of the data directory to avoid the deletion of the files (after they are 30 days old, you can change that in the ProbeConfig file)

Thank you,
Marco</pre></div><div class='update_description'><i onclick="document.location='23636#1421097617'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-12T21:20:17+00:00">Jan 12, 2015 09:20 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1421097617">&nbsp;</a></div><pre>1. Some answers to where job IDs come from, etc.

The job ID should be the LSF job ID.
The jobmanager gets this information from GRAM and records it in a certinfo file using
/usr/share/perl5/vendor_perl/Globus/GRAM/JobManagerGratia.pm
from gratia-probe-gram.noarch

The ID is used in both the file name and LocalJobId.

Then when the probe runs it gets the ID from the LSF accounting file and tries to find the certinfo file with the same ID.
If it fails most likely the record is processed and quarantined (you should see something in the quarantine directory and in the log file) because the probe was unable to match the job with a VO (unless the user ID or the VOOverride setting help the probe with that).

Specifically the LSF probe should work with a perl module that processes the accounting file form the checkpoint to the end and creates xml files in the data directory and a python program that either sends or quarantines the xml files.

2 Now the error&#58; &#34;unable to find valid certinfo file for job&#34;

This means that when the python code is processing one of the record from the accounting file, it cannot find a certinfo file with that matching ID.

3 How to troubleshoot
There could be some problem in the files or in the probe so that this match is not working.
The certinfo files, the gratia log files and the files quarantined all are needed to understand better why this happened

Possible problems&#58;
- either the jobmanager or the probe are not parsing correctly the job ID
- there is some format change in the log file
- the certinfo files are purged after a while and if there are too many&#58; the ones in the directory may refer to different jobs. A similar problem may happen if the job ID rotated.
- others I&#39;m missing now

Some actions&#58;
- In the gratia log file there should be, probably some line before also the job ID of the job for which no certinfo was found. Is the corresponding certinfo in the direcotry?
- Are there files in the quarantine directory?

Thanks,
Marco</pre></div><div class='update_description'><i onclick="document.location='23636#1421083379'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-12T17:22:59+00:00">Jan 12, 2015 05:22 PM UTC</time><a class="anchor" name="1421083379">&nbsp;</a></div><pre>Hi Carl,

okay, I just attached the oldest three files to this ticket. I had to rename them to .txt, since otherwise it wouldn&#39;t allow me to upload them.

Please let me know if this helps, or if you need additional information or files as well.

Thanks a lot,

Horst

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27</pre></div><div class='update_description'><i onclick="document.location='23636#1421081973'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-12T16:59:33+00:00">Jan 12, 2015 04:59 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1421081973">&nbsp;</a></div><pre>Hi,

I continued digging into it on Friday, but I haven&#39;t figured out exactly where it&#39;s getting stuck.  Seems likely that it&#39;s happening in the gratia common code after processLrmsLogs in urCollector.pl calls out to it (via pbs-lsf_meter.pl) ... Definitely, having some files to look at would make debugging easier..!

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='23636#1421075782'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-12T15:16:22+00:00">Jan 12, 2015 03:16 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1421075782">&nbsp;</a></div><pre>Hi Tanya,

sure, I can certainly give you access to some of these gratia_certinfo_lsf_*
files if you have a way of testing them on your test node, just let me know.

Thanks a lot,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23636#1421073604'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-12T14:40:04+00:00">Jan 12, 2015 02:40 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1421073604">&nbsp;</a></div><pre>Hi,
Carl and Marco, did you make any progress on debugging this problem? Can you copy some of the files from /var/lib/gratia/data/  to the test node and figure out  how to push  these files to outbox directory?
Thanks,
Tanya</pre></div><div class='update_description'><i onclick="document.location='23636#1420740257'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-08T18:04:17+00:00">Jan 8, 2015 06:04 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1420740257">&nbsp;</a></div><pre>Hi Carl,

hmm, maybe &#39;new&#39; records are processed from /var/lib/gratia/tmp/urCollector/,
but that directory is now empty, so it can&#39;t be processing the ones
it can&#39;t find from there ...

Where else can we look to figure out how to get these 102k records
processed?

Thanks a lot,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23636#1420680829'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-08T01:33:49+00:00">Jan 8, 2015 01:33 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1420680829">&nbsp;</a></div><pre>I&#39;m not really clear on where the job id numbers come from, but the best I can tell from my code sleuthing is the xml files under /var/lib/gratia/tmp/urCollector get processed, and somehow or other that&#39;s where the job ids come from.  Maybe take a look there?   (Marco, can you confirm?)

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='23636#1420646717'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-07T16:05:17+00:00">Jan 7, 2015 04:05 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1420646717">&nbsp;</a></div><pre>Hi Carl,

well, I&#39;m not an admin on that cluster, and I&#39;d rather not ask
the admins to mess with this lsf log file again, since they were
so nice to rotate it for us in the first place ... &#58;)
And, as you say, this may not be our problem in any case ...

So I looked at the latest error&#58;

----
09&#58;42&#58;01 CST Gratia&#58; ERROR&#58; unable to find valid certinfo file for job 6274995
09&#58;42&#58;01 CST Gratia&#58; Saved record to /var/lib/gratia/tmp/gratiafiles/subdir.lsf_grid1.oscer.ou.edu_gratia-osg-prod.opensciencegrid.org_80/outbox/r.36461.gratia.xml__nBgY0IzGuW
----

And you&#39;re right, I cannot find a file
/var/lib/gratia/data/gratia_certinfo_lsf_6274995 --
so why is it trying to process that in the first place?
I.e., what&#39;s the &#39;master list&#39; of records it&#39;s going through?
I assumed that was the files in /var/lib/gratia/data/, but apparently
I&#39;m wrong about that!

I also can&#39;t find the &#39;Saved record&#39; file above, though. I guess those are
just temporary files, since the directory
/var/lib/gratia/tmp/gratiafiles/subdir.lsf_grid1.oscer.ou.edu_gratia-osg-prod.opensciencegrid.org_80/outbox
is completely empty now?

So what shall we try next? There are still 102700 files in
/var/lib/gratia/data/, so we need to get those processed somehow.

Thanks a lot,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<div id='show_1917599595' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1917599595'><font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_1917599595').click(function() {
            $('#detail_1917599595').slideDown("normal");
            $('#show_1917599595').hide();
            $('#hide_1917599595').show();
        });
        $('#hide_1917599595').click(function() {
            $('#detail_1917599595').slideUp();
            $('#hide_1917599595').hide();
            $('#show_1917599595').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23636#1420588032'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-06T23:47:12+00:00">Jan 6, 2015 11:47 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1420588032">&nbsp;</a></div><pre>I guess if you wanted to &#34;un-rotate&#34; the file, you could just do something like&#58;

[stop lsf service]
cd /lsf/work/boomer/logdir
cat lsb.acct.1 lsb.acct &#62;  lsb.acct.all
mv lsb.acct.all lsb.acct
rm lsb.acct.1
[restart lsf service]

that is, if you really wanted to see if lsb.acct.1 is just getting missed.  But I&#39;m not sure that&#39;s the problem...

Horst, can you see if the specific certinfo files the error messages are complaining about are present?

Like, for this&#58;
15&#58;08&#58;02 CST Gratia&#58; ERROR&#58; unable to find valid certinfo file for job 6273594

try&#58;
ls -l /var/lib/gratia/data/6273594

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='23636#1420585514'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-06T23:05:14+00:00">Jan 6, 2015 11:05 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1420585514">&nbsp;</a></div><pre>Hi Carl,

<font color='#7F7E6F'>&#62; I don&#39;t see it documented anywhere, but apparently &#39;tac&#39; respects the</font>
<font color='#7F7E6F'>&#62; TMPDIR variable.  As far as I can tell, tac only gets called from</font>
<font color='#7F7E6F'>&#62; urCollector.pl, which gets called from pbs-lsf_meter.cron.sh, so if</font>
<font color='#7F7E6F'>&#62; you wanted tempfiles to go under /mnt/bigvol/tmp/, you could edit</font>
<font color='#7F7E6F'>&#62; pbs-lsf_meter.cron.sh, around line 107&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; #--- run the probes ----</font>
<font color='#7F7E6F'>&#62; export TMPDIR=/mnt/bigvol/tmp</font>
<font color='#7F7E6F'>&#62; ./urCollector.pl --nodaemon 2&#62;&1 | ${pp_dir}/DebugPrint -c</font>
$probeconfig_loc -l 1

Well, that would&#39;ve been an option before we rotated the file, but now
that doesn&#39;t really help anymore.

Oh wait, unless the probe really IS still looking at lsb.acct.1, but
having the same problem as before, namely running out of space in /tmp/!
I&#39;ll try to watch for that, and we&#39;ll see what&#39;s happening.

Nope, that doesn&#39;t seem to be the case, since I just watched and the
probe exited very quickly again, without filling up /tmp/ at all.

So I think we can conclude from that that it&#39;s not looking at lsb.acct.1
after all. What can we do about that? Unless --

<font color='#7F7E6F'>&#62; I see Horst&#39;s errors are &#34;unable to find valid certinfo file for job&#34;</font>
<font color='#7F7E6F'>&#62; -- it looks like that comes from probe/common/gratia/common/certinfo.py</font>
<font color='#7F7E6F'>&#62; ... are you familiar with that error? Or do you know if that could be</font>
<font color='#7F7E6F'>&#62; related to his lsb.acct / lsb.acct.1 files not getting processed?</font>

Unless we can figure out what this error means, if it&#39;s related to this
log at all ...

Ah, just got Marco&#39;s response&#58;
<div id='show_1996123898' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1996123898'>
<font color='#7F7E6F'>&#62; I&#39;m not familiar with the specifics of the PBS probe. The job probes</font>
<font color='#7F7E6F'>&#62; (via certinfo.py and xml_util.py) all use certinfo files named</font>
certinfo_...
<font color='#7F7E6F'>&#62; These are normally generated by the jobmanager or connected software</font>
<font color='#7F7E6F'>&#62; because they need the information coming from Globus (the certificate).</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Are the certinfo files in the data directory?</font>

Yes, these files are there&#58;
----
[hs@grid1 ~]$ ls -aoF /var/lib/gratia/data/ | head
total 416116
drwxrwxrwt. 3 root     5386240 Jan  6 17&#58;00 ./
drwxr-xr-x. 6 root        4096 Jul 15 11&#58;21 ../
-rw-r--r--. 1 usatlas1     366 Dec 20 01&#58;40 gratia_certinfo_lsf_6028839
-rw-r--r--. 1 usatlas1     371 Dec 20 01&#58;44 gratia_certinfo_lsf_6028872
[...]
----
[hs@grid1 ~]$ cat /var/lib/gratia/data/gratia_certinfo_lsf_6028839
&#60;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&#62;
&#60;GratiaCertInfo&#62;
&#60;BatchManager&#62;lsf&#60;/BatchManager&#62;
&#60;UniqID&#62;16433946788806193251.127035881851830923&#60;/UniqID&#62;
&#60;LocalJobId&#62;6028839&#60;/LocalJobId&#62;
&#60;DN&#62;/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John
Hover 241&#60;/DN&#62;
&#60;VO&#62;atlas&#60;/VO&#62;
&#60;FQAN&#62;/atlas/usatlas/Role=production/Capability=NULL&#60;/FQAN&#62;
&#60;/GratiaCertInfo&#62;
----

102712 of them -- exactly as many as the RSV probe sees. So why aren&#39;t
they being processed?

Thanks a lot,

Horst
</div><script type='text/javascript'>
        $('#show_1996123898').click(function() {
            $('#detail_1996123898').slideDown("normal");
            $('#show_1996123898').hide();
            $('#hide_1996123898').show();
        });
        $('#hide_1996123898').click(function() {
            $('#detail_1996123898').slideUp();
            $('#hide_1996123898').hide();
            $('#show_1996123898').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23636#1420585104'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-06T22:58:24+00:00">Jan 6, 2015 10:58 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1420585104">&nbsp;</a></div><pre>I&#39;m not familiar with the specifics of the PBS probe. The job probes (via certinfo.py and xml_util.py)  all use certinfo files named certinfo_...
These are normally generated by the jobmanager or connected software because they need the information coming from Globus (the certificate).

Are the certinfo files in the data directory?</pre></div><div class='update_description'><i onclick="document.location='23636#1420582010'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-06T22:06:50+00:00">Jan 6, 2015 10:06 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1420582010">&nbsp;</a></div><pre>Marco,

I see Horst&#39;s errors are &#34;unable to find valid certinfo file for job&#34; -- it looks like that comes from probe/common/gratia/common/certinfo.py ... are you familiar with that error?  Or do you know if that could be related to his lsb.acct / lsb.acct.1 files not getting processed?

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='23636#1420575593'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-06T20:19:53+00:00">Jan 6, 2015 08:19 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1420575593">&nbsp;</a></div><pre>By the way, Horst,

<font color='#7F7E6F'>&#62; Is there a way to tell &#39;tac&#39; to write its temporary output somewhere else?</font>

I don&#39;t see it documented anywhere, but apparently &#39;tac&#39; respects the TMPDIR variable.  As far as I can tell, tac only gets called from urCollector.pl, which gets called from pbs-lsf_meter.cron.sh, so if you wanted tempfiles to go under /mnt/bigvol/tmp/, you could edit pbs-lsf_meter.cron.sh, around line 107&#58;

#--- run the probes ----
export TMPDIR=/mnt/bigvol/tmp
./urCollector.pl --nodaemon 2&#62;&1 | ${pp_dir}/DebugPrint -c $probeconfig_loc -l 1

Carl</pre></div><div class='update_description'><i onclick="document.location='23636#1420498820'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-05T23:00:20+00:00">Jan 5, 2015 11:00 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1420498820">&nbsp;</a></div><pre>I&#39;m quoting from urCollector.pl, lines 337-340, which gets called by pbs-lsf_meter.cron.sh.

But, yeah, I&#39;m saying that the way I read it, it should already be processing lsb.acct.1 too  &#58;(

I&#39;m not really sure what the errors mean, but I was wondering whether the logs need to be processed &#34;in order&#34; (vs the unsorted directory order that it looks like it&#39;s doing), or if anything would break if they are processed out of sequence.  If that&#39;s the case, we could try sorting it first, but I&#39;m not sure if that&#39;s actually a problem or not.

Carl</pre></div><div class='update_description'><i onclick="document.location='23636#1420497132'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-05T22:32:12+00:00">Jan 5, 2015 10:32 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1420497132">&nbsp;</a></div><pre>Oh wait --

I guess you&#39;re saying it should already be looking for lsb.acct.1
without hacking it? Then what do those errors mean?

Thanks,

Horst</pre></div><div class='update_description'><i onclick="document.location='23636#1420496951'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-05T22:29:11+00:00">Jan 5, 2015 10:29 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1420496951">&nbsp;</a></div><pre>Hi Carl,

<font color='#7F7E6F'>&#62; It looks like the probe ought to process lsb.acct as well as lsb.acct.N&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; while( defined(my $file = readdir(DIR)) ) {</font>
<font color='#7F7E6F'>&#62; next if ( $file =~ /^&#92;.&#92;.?$/o ); # skip &#39;.&#39; and &#39;..&#39;</font>
<font color='#7F7E6F'>&#62; next if ( $lrmsType eq &#34;pbs&#34; && !($file =~ /^&#92;d{8}(&#92;.(gz|bz2))?$/o) );</font>
<font color='#7F7E6F'>&#62; next if ( $lrmsType eq &#34;lsf&#34; && !($file =~</font>
<font color='#7F7E6F'>&#62; /^lsb&#92;.acct(&#92;.&#92;d*)?(&#92;.(gz|bz2))?$/o) );</font>
<font color='#7F7E6F'>&#62; ...</font>

Sorry, which script are you quoting there? I looked at
/usr/share/gratia/pbs-lsf/pbs-lsf_meter.cron.sh, but that doesn&#39;t seem
to be it.
I&#39;d be happy to try and modify that and see if it helps.

<font color='#7F7E6F'>&#62; But they may not be processed in order (the directory isn&#39;t sorted). Do</font>
<font color='#7F7E6F'>&#62; they need to be processed in a particular order? Could it be messing</font>
<font color='#7F7E6F'>&#62; anything up if they are processed out of sequence?</font>

I think it shouldn&#39;t matter which order they&#39;re processed in, but I&#39;d
like to get confirmation from Tanya or another Gratia expert before
attempting that -- and the name of the script I need to hack. ;)

Thanks a lot,

Horst</pre></div><div class='update_description'><i onclick="document.location='23636#1420496368'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-05T22:19:28+00:00">Jan 5, 2015 10:19 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1420496368">&nbsp;</a></div><pre>Hi Horst,

It looks like the probe ought to process lsb.acct as well as
lsb.acct.N&#58;

while( defined(my $file = readdir(DIR)) ) {
next if ( $file =~ /^&#92;.&#92;.?$/o ); # skip &#39;.&#39; and &#39;..&#39;
next if ( $lrmsType eq &#34;pbs&#34; && !($file =~
/^&#92;d{8}(&#92;.(gz|bz2))?$/o) );
next if ( $lrmsType eq &#34;lsf&#34; && !($file =~
/^lsb&#92;.acct(&#92;.&#92;d*)?(&#92;.(gz|bz2))?$/o) );
...

But they may not be processed in order (the directory isn&#39;t sorted).
Do they need to be processed in a particular order?  Could it be
messing anything up if they are processed out of sequence?

Carl
-- by Carl Edquist at Mon Jan 05 22&#58;18&#58;13 UTC 2015
-- by osg-goc-rest at Mon Jan 05 22&#58;19&#58;10 UTC 2015

GOCTX Source&#58; BNL Ticket&#58; Queue=SWTier2 ID=25020</pre></div><div class='update_description'><i onclick="document.location='23636#1420496293'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-05T22:18:13+00:00">Jan 5, 2015 10:18 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1420496293">&nbsp;</a></div><pre>Hi Horst,

It looks like the probe ought to process lsb.acct as well as lsb.acct.N&#58;

while( defined(my $file = readdir(DIR)) ) {
next if ( $file =~ /^&#92;.&#92;.?$/o ); # skip &#39;.&#39; and &#39;..&#39;
next if ( $lrmsType eq &#34;pbs&#34; && !($file =~ /^&#92;d{8}(&#92;.(gz|bz2))?$/o) );
next if ( $lrmsType eq &#34;lsf&#34; && !($file =~ /^lsb&#92;.acct(&#92;.&#92;d*)?(&#92;.(gz|bz2))?$/o) );
...

But they may not be processed in order (the directory isn&#39;t sorted).  Do they need to be processed in a particular order?  Could it be messing anything up if they are processed out of sequence?

Carl</pre></div><div class='update_description'><i onclick="document.location='23636#1420493589'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-05T21:33:09+00:00">Jan 5, 2015 09:33 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1420493589">&nbsp;</a></div><pre>Hi Carl,

Could you please look at this problem asap?
Thanks,
Tanya</pre></div><div class='update_description'><i onclick="document.location='23636#1420493005'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-05T21:23:25+00:00">Jan 5, 2015 09:23 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1420493005">&nbsp;</a></div><pre>Hi again,

hmm, maybe I spoke too soon, since we&#39;re still seeing a very large back
log of gratia records according to

<a href='https&#58;//grid1.oscer.ou.edu/rsv/grid1.oscer.ou.edu.html#org.osg.gratia.lsf' target='_blank' rel='nofollow'>https&#58;//grid1.oscer.ou.edu/rsv/grid1.oscer.ou.edu.html#org.osg.gratia.lsf</a>

and it&#39;s not going down. It started going down after the log file
rotation, but now it has stopped decreasing more.

I&#39;m also seeing these errors in /var/log/gratia/2015-01-05.log &#58;

----
15&#58;08&#58;01 CST Gratia&#58;
***********************************************************
15&#58;08&#58;01 CST Gratia&#58; ERROR&#58; unable to find valid certinfo file for job
6273594
15&#58;08&#58;01 CST Gratia&#58; Saved record to
/var/lib/gratia/tmp/gratiafiles/subdir.lsf_grid1.oscer.ou.edu_gratia-osg-prod.opensciencegrid.org_80/outbox/r.18437.gratia.xml__3GRT8YwnjC
15&#58;08&#58;01 CST Gratia&#58;
***********************************************************
[...]
15&#58;08&#58;02 CST Gratia&#58; ERROR&#58; unable to find valid certinfo file for job
6273594
15&#58;08&#58;02 CST Gratia&#58; Saved record to
/var/lib/gratia/tmp/gratiafiles/subdir.lsf_grid1.oscer.ou.edu_gratia-osg-prod.opensciencegrid.org_80/outbox/r.18437.gratia.xml__dfrydVM6Bl
15&#58;08&#58;02 CST Gratia&#58;
***********************************************************
15&#58;08&#58;02 CST Gratia&#58; ERROR&#58; unable to find valid certinfo file for job
6273475
15&#58;08&#58;02 CST Gratia&#58; Saved record to
/var/lib/gratia/tmp/gratiafiles/subdir.lsf_grid1.oscer.ou.edu_gratia-osg-prod.opensciencegrid.org_80/outbox/r.18437.gratia.xml__ABOMI4F2Ss
15&#58;08&#58;02 CST Gratia&#58;
***********************************************************
15&#58;08&#58;02 CST Gratia&#58; ERROR&#58; unable to find valid certinfo file for job
<div id='show_38787703' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_38787703'>6273681
15&#58;08&#58;02 CST Gratia&#58; Saved record to
/var/lib/gratia/tmp/gratiafiles/subdir.lsf_grid1.oscer.ou.edu_gratia-osg-prod.opensciencegrid.org_80/outbox/r.18437.gratia.xml__JTMrRC0uoz
----

Could it be that these jobs can&#39;t be verified because the LSF log file
it&#39;s trying to parse, /lsf/work/boomer/logdir/lsb.acct , has been
rotated, and it can&#39;t find the corresponding information about these
jobs anymore?

If so, is there a way to force these files to be processed?
The old log file is still there&#58;

----
-rw-r--r--. 1 lsfadmin    11679574 Jan  5 15&#58;18
/lsf/work/boomer/logdir/lsb.acct
-rw-r--r--. 1 lsfadmin 31147795217 Jan  5 11&#58;02
/lsf/work/boomer/logdir/lsb.acct.1
----

But how do we tell Gratia to look in lsb.acct.1 instead of lsb.acct, if
this is indeed the problem?

Thanks,

Horst
</div><script type='text/javascript'>
        $('#show_38787703').click(function() {
            $('#detail_38787703').slideDown("normal");
            $('#show_38787703').hide();
            $('#hide_38787703').show();
        });
        $('#hide_38787703').click(function() {
            $('#detail_38787703').slideUp();
            $('#hide_38787703').hide();
            $('#show_38787703').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23636#1420486699'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-05T19:38:19+00:00">Jan 5, 2015 07:38 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1420486699">&nbsp;</a></div><pre>Hi all,

okay, the OSCER admins rotated the LSF log file, and now things
are working again!

<a href='http&#58;//gratiaweb.grid.iu.edu/gratia/site?facility=OU_OSCER_ATLAS' target='_blank' rel='nofollow'>http&#58;//gratiaweb.grid.iu.edu/gratia/site?facility=OU_OSCER_ATLAS</a>

So I think we can close this ticket again.

Thanks a lot,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23636#1420062292'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-31T21:44:52+00:00">Dec 31, 2014 09:44 PM UTC</time> by <b>echism</b><a class="anchor" name="1420062292">&nbsp;</a></div><pre>I&#39;m not sure. I&#39;m adding gratia ops to this ticket in the hopes that they can help.

Gratia ops,

Tmp is filling up while gratia runs and it&#39;s causing the reporting to fail. Is there a fix for this?

Thank you,
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='23636#1420054154'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-31T19:29:14+00:00">Dec 31, 2014 07:29 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1420054154">&nbsp;</a></div><pre>Hi Vince,

thanks for the heads up. I just had a look at this, and I think the problem
is that gratia is trying to parse /lsf/work/boomer/logdir/lsb.acct,
which is very large, namely over 29 GB, and during that parsing,
it appears to be copying it to /tmp/, and the /tmp/ file system is less
than 29 GB, therefore it fills up the file system and fails.

At least I see these processes&#58;

----
root     12833  0.0  0.0 157304  1816 ?        S    13&#58;00   0&#58;00  &#92;_ CROND
root     12841  0.0  0.0 106096  1172 ?        Ss   13&#58;00   0&#58;00      &#92;_ /bin/sh -c /usr/share/gratia/common/cron_check  /etc/gratia/pbs-lsf/ProbeConfig  && perl -e &#39;sleep rand 900&#39; && /usr/share/gratia/pbs-lsf/pbs-lsf_meter.cron.sh
root     18297  0.0  0.0 106096  1284 ?        S    13&#58;04   0&#58;00          &#92;_ /bin/bash /usr/share/gratia/pbs-lsf/pbs-lsf_meter.cron.sh
root     18313  0.0  0.0 131464  5108 ?        S    13&#58;04   0&#58;00              &#92;_ /usr/bin/perl -w ./urCollector.pl --nodaemon
root     18320  0.0  0.0 106096  1152 ?        S    13&#58;04   0&#58;00              |   &#92;_ sh -c /usr/bin/less -f /lsf/work/boomer/logdir/lsb.acct | /usr/bin/tac
root     18321 97.9  0.0 105448   848 ?        R    13&#58;04   5&#58;42              |       &#92;_ /usr/bin/less -f /lsf/work/boomer/logdir/lsb.acct
root     18322 27.7  0.0 100988   700 ?        S    13&#58;04   1&#58;37              |       &#92;_ /usr/bin/tac
root     18314  0.0  0.0 203136 10808 ?        S    13&#58;04   0&#58;00              &#92;_ python /usr/share/gratia/common/DebugPrint -c /etc/gratia/pbs-lsf/ProbeConfig -l 1
----

And then I see this in the output of &#39;lsof&#39;&#58;

----
tac       18322      root    3u      REG              253,4 23264092160     698693 /tmp/tacwY130J (deleted)
----

So I assume that&#39;s what&#39;s happening, since I can also see /tmp/ filling up
to 100% while gratia is running, and then go back to 3%, even though
I cannot see this file /tmp/tacwY130J, so that must be hidden somehow ...

What can we do about that? Is there a way to tell &#39;tac&#39; to write
its temporary output somewhere else? We have other local partitions
which would have plenty of space for that.

<div id='show_450887584' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_450887584'>I suppose one way would be to somehow rotate this lsb.acct file,
but that&#39;d be something the OSCER admins would have to do,
so that won&#39;t happen till Monday.

Well, if we&#39;re very lucky, maybe that&#39;ll rotate out tonight at midnight?
I doubt it, though, since there aren&#39;t any other numbered lsb.acct files,
so this is probably something that would have to be done manually ...

Thanks a lot,
happy new year,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_450887584').click(function() {
            $('#detail_450887584').slideDown("normal");
            $('#show_450887584').hide();
            $('#hide_450887584').show();
        });
        $('#hide_450887584').click(function() {
            $('#detail_450887584').slideUp();
            $('#hide_450887584').hide();
            $('#show_450887584').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23636#1420043617'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-12-31T16:33:37+00:00">Dec 31, 2014 04:33 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1420043617">&nbsp;</a></div><pre>Greetings,

We received the following GRATIA report for the above resource.  Please advise

WARNING/ADVISORY&#58; Resource&#58; OU_OSCER_ATLAS in Resource Group&#58; OU_OSCER_ATLAS  missing data for more than 2 days&#58; [&#39;2014-12-28&#39;, &#39;2014-12-29&#39;, &#39;2014-12-30&#39;]

Thank you,</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F23636">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 23636});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
