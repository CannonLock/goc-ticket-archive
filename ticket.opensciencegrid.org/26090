<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="/">
    <title>[26090] WT2 Under Reporting Accounting</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="//netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="https://ticket.opensciencegrid.org/images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="https://ticket.opensciencegrid.org/lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=26090" method="post">
<div class="page-header">
    <h3><span class="muted">26090</span> / WT2 Under Reporting Accounting</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Rob Quick</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Resource Name</label><div class="controls">WT2_CE_2</div></div><div class="control-group"><label class="control-label">Associated VO</label><div class="controls">ATLAS</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Rob Quick</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">USATLAS</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">WIP</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2015-09-22</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">USATLAS (BNL Prod)&nbsp;<a target="_blank" href="https://rt.racf.bnl.gov/rt/Ticket/Display.html?id=25452">25452</a> <span class="muted"> / Ticket Exchange</span></div><div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div><div class="assignee" style="width: 60%">Carl Edquist <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("https://ticket.opensciencegrid.org/attachment/list?id=26090", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="/26090?sort=up&"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="/26090?expandall=true&">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20WT2%20Under%20Reporting%20Accounting%20ISSUE%3D26090%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='26090#1442937396'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-22T15:56:36+00:00">Sep 22, 2015 03:56 PM UTC</time> by <b>marcom@....</b><a class="anchor" name="1442937396">&nbsp;</a></div><pre>Hi,
Thank you for your email. I am on vacation  September 21th - September 30th and unable to respond at this time. I will review your message following my return.
Please contact Glideinwms Support (glideinwms-support@....) or Parag Mhashilkar(parag@....) if you have questions about Glideinwms.
Best regards,
Marco</pre></div><div class='update_description'><i onclick="document.location='26090#1442937277'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-22T15:54:37+00:00">Sep 22, 2015 03:54 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1442937277">&nbsp;</a></div><pre>resolving</pre></div><div class='update_description'><i onclick="document.location='26090#1442613541'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-18T21:59:01+00:00">Sep 18, 2015 09:59 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1442613541">&nbsp;</a></div><pre>Great, thanks Scott.

Rob, is there anything else to be done for this ticket?

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='26090#1442493679'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-17T12:41:19+00:00">Sep 17, 2015 12:41 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1442493679">&nbsp;</a></div><pre>May-Aug have been resent

Scott Teige PhD
Grid Operations Center Manager
Indiana University Research Technologies
steige@....
Office&#58; +1 812 856 7331

On Sep 16, 2015, at 8&#58;20 PM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='26090#1442449217'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-17T00:20:17+00:00">Sep 17, 2015 12:20 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1442449217">&nbsp;</a></div><pre>Hearing no objections, Scott, can we resend May-Aug?

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='26090#1442042735'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-12T07:25:35+00:00">Sep 12, 2015 07:25 AM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1442042735">&nbsp;</a></div><pre>Hi Carl, OK with me. not sure about others.</pre></div><div class='update_description'><i onclick="document.location='26090#1442013832'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-11T23:23:52+00:00">Sep 11, 2015 11:23 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1442013832">&nbsp;</a></div><pre>Not sure what to say for May (although as you said 10.44 and 10.73 are not hugely different).

Should we go ahead and publish these to apel then?

Carl</pre></div><div class='update_description'><i onclick="document.location='26090#1441926036'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-10T23:00:36+00:00">Sep 10, 2015 11:00 PM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1441926036">&nbsp;</a></div><pre>Hi Carl,

I verified the WT2 numbers for May to Aug. June to Aug all matched pretty well. As I said yesterday, for various reasons, the number for May is a little hard to be accurate (but still good enough). The following is the numbers from your URLs and from SLAC LSF. The first column is the raw wall time from your URL without adjusting the processor numbers. The second column is similar but adjusted for those jobs that use 8 cores. The 3rd and 4th are similar but from our LSF. The unit is 10^9 seconds.

APEL                          LSF
walltime    Adj. walltime     walltime    Ajd. walltime
May&#58;  5.89        10.44                6.08          10.73
Jun&#58;   3.19        10.46                3.18          10.46
Jul&#58;    4.89        13.60                4.90          13.65
Aug&#58;  8.59        12.25                8.58          12.23</pre></div><div class='update_description'><i onclick="document.location='26090#1441862246'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-10T05:17:26+00:00">Sep 10, 2015 05:17 AM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1441862246">&nbsp;</a></div><pre>Hi Carl, I will try to verify June to August numbers tomorrow. 05 is a little hard to do some of the LSF accounting data isn&#39;t handy. If possible, I prefer we verify this numbers before we send to APEL.</pre></div><div class='update_description'><i onclick="document.location='26090#1441844290'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-10T00:18:10+00:00">Sep 10, 2015 12:18 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1441844290">&nbsp;</a></div><pre>Also, Scott, are you able to re-send the updated apel reports for May-August?  (links below)

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='26090#1441841047'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-09T23:24:07+00:00">Sep 9, 2015 11:24 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1441841047">&nbsp;</a></div><pre>Thanks Wei,

For the wall time * core count question; yes, I also saw that gratiaweb multiplies by core counts... It makes sense if you&#39;d like to keep it that way so that it matches other reports.  But then I guess we just need to keep in mind then that the apel reports (per John G) will not match the gratiaweb wall time numbers for cores &#62; 1.

I&#39;ve re-run the apel reports for May through August using case-insensitive VO names&#58;

<a href='https&#58;//raw.githubusercontent.com/edquist/apel/reports/send/05_2015.apel' target='_blank' rel='nofollow'>https&#58;//raw.githubusercontent.com/edquist/apel/reports/send/05_2015.apel</a>
<a href='https&#58;//raw.githubusercontent.com/edquist/apel/reports/send/06_2015.apel' target='_blank' rel='nofollow'>https&#58;//raw.githubusercontent.com/edquist/apel/reports/send/06_2015.apel</a>
<a href='https&#58;//raw.githubusercontent.com/edquist/apel/reports/send/07_2015.apel' target='_blank' rel='nofollow'>https&#58;//raw.githubusercontent.com/edquist/apel/reports/send/07_2015.apel</a>
<a href='https&#58;//raw.githubusercontent.com/edquist/apel/reports/send/08_2015.apel' target='_blank' rel='nofollow'>https&#58;//raw.githubusercontent.com/edquist/apel/reports/send/08_2015.apel</a>

Can one of us verify these for WT2 or is it something we need to send out first?
For the June report, I now get 212,282 for the total NumberOfJobs for atlas/WT2, which exactly matches gratiaweb&#39;s Job Count.
I now get 3,191,822,336 sec for total WallDuration, but again that no longer includes the #Cores factor.

And Scott, you can update to the latest version of the script here&#58;
<a href='https&#58;//raw.githubusercontent.com/edquist/apel/master/apel-report.sh' target='_blank' rel='nofollow'>https&#58;//raw.githubusercontent.com/edquist/apel/master/apel-report.sh</a>

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='26090#1441838579'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-09T22:42:59+00:00">Sep 9, 2015 10:42 PM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1441838579">&nbsp;</a></div><pre>Hi Carl,

thanks for looking into this. I will leave the most of the questions to the respective experts. here are two comments from me&#58;

1. PROD_SLAC was dated back 1000 BC&#58;-)  but it looks like it is not flexible to change it. I think anything start with WT2XXXX and SLAC are related to PROD_SLAC.
2. For the APEL interface, John G. may or may not want to expand the wall time by the core counts. But the finally result in reports have to have the wall time * core count. I think I verified that the wall time on the Graita Web page were expand by the core counts, and were within 1% accuracy compare to reports directly obtains from our LSF batch system.</pre></div><div class='update_description'><i onclick="document.location='26090#1441835107'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-09T21:45:07+00:00">Sep 9, 2015 09:45 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1441835107">&nbsp;</a></div><pre>I looked more into the queries that were actually getting run to generate
the for the reference gratiaweb plots (link below [1]).

Two important points&#58;

1. For Wall Time calculation Gratiaweb is doing
&#34;sum(Cores*WallDuration)/3600 as WallHours&#34; -- and we have been using
this as our reference number.  However, John G clarified for us a while
back that this is wrong; Wall Time should not have the #Cores factored
in.  We actually changed this in the apel reporting script as a result.
I think we still need to get everybody on the same page about this
issue; probably the queries in gratiaweb need to be updated to match,
unless there is some reason to keep the old behavior.

2. For matching the VO name (&#39;atlas&#39; for WT2), the apel reporting script
uses VONameCorrection.ReportableVOName, while gratiaweb uses VO.VOName.
(My impression is that for apel reporting, ReportableVOName is indeed
the correct field to use, but if anyone thinks otherwise please let me
know.) Both the apel and gratiaweb queries are case-sensitive, but as
it turns out, there are entries for both &#39;atlas&#39; and &#39;ATLAS&#39; in the
ReportableVOName field while VO.VOName only has &#39;atlas&#39;.  It seems
likely that this is the key problem.  It may be an issue for ALICE and
CMS also, as I see ReportableVOName&#39;s for them as well.

As an immediate fix, I&#39;ll try changing the apel reporting to match
case-insensitively.  But I would also ask, if anyone knows, whether it is
allowed for jobs to have their ReportableVOName in all caps (or, in
general not to match the case of the official VO name), or if that should
be considered an error.

Carl

[1] <a href='http&#58;//gratiaweb.opensciencegrid.org/gratia/bysite?starttime=2015-06-01+00%3A00%3A00&endtime=2015-06-30+00%3A00%3A00&span=86400&relativetime=absolute&facility=' target='_blank' rel='nofollow'>http&#58;//gratiaweb.opensciencegrid.org/gratia/bysite?starttime=2015-06-01+00%3A00%3A00&endtime=2015-06-30+00%3A00%3A00&span=86400&relativetime=absolute&facility=</a>^WT2%24&exclude-facility=&vo=atlas&exclude-vo=&user=&exclude-dn=</pre></div><div class='update_description'><i onclick="document.location='26090#1441834967'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-09T21:42:47+00:00">Sep 9, 2015 09:42 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1441834967">&nbsp;</a></div><pre>Copying in from my email update to Rob&#58;
---
At first I had suspected it might have been from some other anomaly from
Scott&#39;s script that was leaving things out; but after doing some manual
sql queries against the gratia db for atlas/WT2 I was getting the same
numbers.  Somehow we are apparently missing a large chunk of the records
that are showing up on gratiaweb.

I looked into the resource group mapping table; which as I read it says
that PROD_SLAC sites should be counted as WT2; although I didn&#39;t actually
see any records from PROD_SLAC.  Could it be that there are any other
sites that should be counted as WT2?

I&#39;ve been using the June WallClock numbers Wei mentioned in the ticket as
a reference point, which match what&#39;s in the gratiaweb link mentioned
elsewhere in the ticket (after converting to seconds).

It&#39;s not clear whether everybody is on the same page about whether
NumCores gets factored into Wall time.  In the ticket, Wei said &#34;The wall
time of 8-core jobs are expanded by a factor of 8&#34; -- which I think is
what we originally had to do to get the numbers we &#34;were expecting&#34;, but
John G clarified that that was wrong.

But regardless of the wall time question, the apel report is missing a lot
of WT2 records just based on NumJobs, which for June I see ~2k in the apel
script output and in manual sql queries, but ~212k on the gratiaweb
reference page.</pre></div><div class='update_description'><i onclick="document.location='26090#1441832457'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-09T21:00:57+00:00">Sep 9, 2015 09:00 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1441832457">&nbsp;</a></div><pre>Carl,

Do you have another update for this ticket?

-Kyle</pre></div><div class='update_description'><i onclick="document.location='26090#1441204439'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-02T14:33:59+00:00">Sep 2, 2015 02:33 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1441204439">&nbsp;</a></div><pre>Hi All,

Sorry for the delayed reply.

<font color='#7F7E6F'>&#62; WT2 did report correctly the job usage info to the Gratia. The problem</font>
<font color='#7F7E6F'>&#62; is that the WT2&#39;s reports don&#39;t have DN attached. The current software</font>
<font color='#7F7E6F'>&#62; that push accounting data from OSG to WLCG APEL doesn&#39;t work if there</font>
<font color='#7F7E6F'>&#62; is no DN attached. I believe OSG is still working on this</font>

Back on July 10 we updated the script to handle empty DNs, which (reviewing some emails) looks like resolved an issue for Alice but not WT2.  So apparently there was still a separate issue.  ... after some initial investigation my attention given to this ticket dropped off -- sorry about that!  I&#39;m taking another look now...

Carl</pre></div><div class='update_description'><i onclick="document.location='26090#1441121616'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-09-01T15:33:36+00:00">Sep 1, 2015 03:33 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1441121616">&nbsp;</a></div><pre>Need to speak to Rob and see if he was able to touch base with Carl.</pre></div><div class='update_description'><i onclick="document.location='26090#1441026517'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-31T13:08:37+00:00">Aug 31, 2015 01:08 PM UTC</time> by <b>Rob Quick</b><a class="anchor" name="1441026517">&nbsp;</a></div><pre>I&#39;ve been out for a few weeks, I&#39;m not sure if we&#39;ve made any more progress on the WT2 issue. I will ping Carl directly later today to see if he&#39;s investigated any further.</pre></div><div class='update_description'><i onclick="document.location='26090#1440802685'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-28T22:58:05+00:00">Aug 28, 2015 10:58 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1440802685">&nbsp;</a></div><pre>If I understood correctly Wei there are no DNs in the records due to how the jobs are submitted to WT2 and this is not a bug in the probe.
And OSG agreed to change/fix the WLCG APEL scripts to report these records.
So it is up to GOC to fix the problem. They are running and maintaining the WLCG APEL scripts.
Cheers,
Marco</pre></div><div class='update_description'><i onclick="document.location='26090#1440745166'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-28T06:59:26+00:00">Aug 28, 2015 06:59 AM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1440745166">&nbsp;</a></div><pre>Hi Edgar and Marco,

you probably missed Rob Quick and John Gordon&#39;s comments embedded deep in the thread (back to late July). WT2 did report correctly the job usage info to the Gratia. The problem is that the WT2&#39;s reports don&#39;t have DN attached. The current software that push accounting data from OSG to WLCG APEL doesn&#39;t work if there is no DN attached. I believe OSG is still working on this - I haven&#39;t heard back from Rob Quick that this is resolved.

regards,
Wei</pre></div><div class='update_description'><i onclick="document.location='26090#1440735338'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-28T04:15:38+00:00">Aug 28, 2015 04:15 AM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1440735338">&nbsp;</a></div><pre>Hi Edgar,
I read the earlier messages. If I understood correctly the problem is that WT2 is underreporting to Gratia (and therefore WLCG APEL).
Do we know of how much we are off (i.e. any estimate of what could be the correct values)?
There is a mention of an APEL reporting only problem, that has been fixed, correct?

Wei,
could you attach the whole /etc/gratia/pbs-lsf/ProbeConfig to the ticket?
Are there file in the gratia data and quarantine directory?

Thank you,
Marco</pre></div><div class='update_description'><i onclick="document.location='26090#1440607824'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-26T16:50:24+00:00">Aug 26, 2015 04:50 PM UTC</time><a class="anchor" name="1440607824">&nbsp;</a></div><pre>Hi Marco, Carl,

Do you have any idea on what might be going on?

Cheers,
Edgar
OSG Software Support

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Edgar Mauricio Fajardo Hernandez 2020</pre></div><div class='update_description'><i onclick="document.location='26090#1440437921'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-24T17:38:41+00:00">Aug 24, 2015 05:38 PM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1440437921">&nbsp;</a></div><pre>Hi Edgar, we always have this value set to 0

$ grep SuppressNoDNRecords /etc/gratia/pbs-lsf/ProbeConfig
SuppressNoDNRecords=&#34;0&#34;</pre></div><div class='update_description'><i onclick="document.location='26090#1440431433'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-24T15:50:33+00:00">Aug 24, 2015 03:50 PM UTC</time> by <b>catharine.noble@....</b><a class="anchor" name="1440431433">&nbsp;</a></div><pre>I am away from Mon 24 Aug afternoon to return on Mon 31 August. I will have no access to internet during this time.

Contacts during my absence&#58;

*   Data Centre VisitPoint&#58;
*   Reservations - DataCentre-VisitPoint@....
*   Screen problems&#58; CC Operator (s/he can usually resolve and log)
*   Training - none is planned until September
*   WLCG / MoU&#58; ian.bird@.... and/or sue.foffano@....
*   IT website/drupal issues&#58; eduardo.alvarez.fernandez@....
*   Temporary CERN access cards&#58; contact the meeting co-ordinator
*   Keys&#58; go to 28-R-009 and collect directly

Kind regards,
Cath</pre></div><div class='update_description'><i onclick="document.location='26090#1440431385'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-24T15:49:45+00:00">Aug 24, 2015 03:49 PM UTC</time><a class="anchor" name="1440431385">&nbsp;</a></div><pre>Hi Wei,

Make sure in the gratia probe configuration&#58;

SuppressNoDNRecords is set to 0.

Cheers,

Edgar
OSG Software Support

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Edgar Mauricio Fajardo Hernandez 2020</pre></div><div class='update_description'><i onclick="document.location='26090#1440184731'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-21T19:18:51+00:00">Aug 21, 2015 07:18 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1440184731">&nbsp;</a></div><pre>Software was CC&#39;d on this but I thought it might be best to assign them to this as well so it shows up in goc ticket for them too. I have pinged Them in a related ticket.</pre></div><div class='update_description'><i onclick="document.location='26090#1439837715'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-17T18:55:15+00:00">Aug 17, 2015 06:55 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1439837715">&nbsp;</a></div><pre>I have Pinged Carl in another ticket about this.</pre></div><div class='update_description'><i onclick="document.location='26090#1439583081'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-14T20:11:21+00:00">Aug 14, 2015 08:11 PM UTC</time> by <b>catharine.noble@....</b><a class="anchor" name="1439583081">&nbsp;</a></div><pre>I am away from Fri 7 Aug afternoon to return on Mon 17 August. I will have no access to internet during this time.

Contacts during my absence&#58;

*   Data Centre VisitPoint&#58;
*   Reservations - DataCentre-VisitPoint@....
*   Screen problems&#58; CC Operator (s/he can usually resolve and log)
*   Training - none is planned until September
*   WLCG / MoU&#58; ian.bird@.... and/or sue.foffano@....
*   IT website/drupal issues&#58; eduardo.alvarez.fernandez@....
*   Temporary CERN access cards&#58; contact the meeting co-ordinator
*   Keys&#58; go to 28-R-009 and collect directly

Kind regards,
Cath</pre></div><div class='update_description'><i onclick="document.location='26090#1439582973'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-14T20:09:33+00:00">Aug 14, 2015 08:09 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1439582973">&nbsp;</a></div><pre>Hello All,

Does anyone have any new information on this?

Thanks,
Chris</pre></div><div class='update_description'><i onclick="document.location='26090#1439304716'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-11T14:51:56+00:00">Aug 11, 2015 02:51 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1439304716">&nbsp;</a></div><pre>I have emailed Carl for an update.</pre></div><div class='update_description'><i onclick="document.location='26090#1438633387'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-03T20:23:07+00:00">Aug 3, 2015 08:23 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1438633387">&nbsp;</a></div><pre>Hello All,

If anyone has any new information on the status of this ticket, could you please send an update?

Thanks,
Chris</pre></div><div class='update_description'><i onclick="document.location='26090#1438154595'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-29T07:23:15+00:00">Jul 29, 2015 07:23 AM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1438154595">&nbsp;</a></div><pre>Thanks Cath and John for the info. Hopefully this will be resolved soon.</pre></div><div class='update_description'><i onclick="document.location='26090#1438154416'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-29T07:20:16+00:00">Jul 29, 2015 07:20 AM UTC</time> by <b>john.gordon@....</b><a class="anchor" name="1438154416">&nbsp;</a></div><pre>Wei, this is a known problem associated with a change in the way OSG sends its data to APEL. It only affects a few sites and WT2 is one of them. Rob and his team are looking into it and when we think it is fixed we will ask all sites to check their publishing numbers.

Well spotted,

John

From&#58; Catharine Noble [mailto&#58;Catharine.Noble@....]
Sent&#58; Wednesday, July 29, 2015 8&#58;02 AM
To&#58; osg@....
Cc&#58; Gordon, John (STFC,RAL,SC)
Subject&#58; Re&#58; Open Science Grid&#58; WT2 Under Reporting Accounting ISSUE=26090 PROJ=71

Hi Wei,

You need to talk to John Gordon (in copy) who will be able to advise on how to push your data to the APEL accounting portal.

Kind regards,
Cath

On 28 Jul 2015, at 18&#58;48, Open Science Grid FootPrints &#60;osg@....&#60;mailto&#58;osg@....&#62;&#62; wrote&#58;

[Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='26090#1438153512'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-29T07:05:12+00:00">Jul 29, 2015 07:05 AM UTC</time> by <b>catharine.noble@....</b><a class="anchor" name="1438153512">&nbsp;</a></div><pre>Hi Wei,

You need to talk to John Gordon (in copy) who will be able to advise on how to push your data to the APEL accounting portal.

Kind regards,
Cath

On 28 Jul 2015, at 18&#58;48, Open Science Grid FootPrints &#60;osg@....&#60;mailto&#58;osg@....&#62;&#62; wrote&#58;

[Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='26090#1438102084'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-28T16:48:04+00:00">Jul 28, 2015 04:48 PM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1438102084">&nbsp;</a></div><pre>From Gratia web portal, here are the reported wall time usage at WT2&#58;

May&#58;  1.044x10E10
June&#58; 1.046x10E10
5/16-7/15&#58; 2.268x10E10

The unit is second. The wall time of 8-core jobs are expanded by a factor of 8.

How do we get the WLCG APEL portal update?</pre></div><div class='update_description'><i onclick="document.location='26090#1438100812'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-28T16:26:52+00:00">Jul 28, 2015 04:26 PM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1438100812">&nbsp;</a></div><pre>never mind about Gratia web interface being slow. It hangs most of the time from my home, but not from SLAC machines.</pre></div><div class='update_description'><i onclick="document.location='26090#1438013677'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-27T16:14:37+00:00">Jul 27, 2015 04:14 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1438013677">&nbsp;</a></div><pre>Thanks for the last update, Carl. Please let us know more when you have had time to catch up.

Regards,
Chris</pre></div><div class='update_description'><i onclick="document.location='26090#1437595794'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-22T20:09:54+00:00">Jul 22, 2015 08:09 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1437595794">&nbsp;</a></div><pre>Hi Chris,

Sorry I&#39;ve been out since July 13, just got back today and catching up... No updates at the moment.

Carl</pre></div><div class='update_description'><i onclick="document.location='26090#1437490607'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-21T14:56:47+00:00">Jul 21, 2015 02:56 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1437490607">&nbsp;</a></div><pre>HI Carl,

Is there any news on this? I haven&#39;t seen anything new in the jira ticket about this.

Thanks,
Chris</pre></div><div class='update_description'><i onclick="document.location='26090#1437148745'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-17T15:59:05+00:00">Jul 17, 2015 03:59 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1437148745">&nbsp;</a></div><pre>Waiting on Carl to provide more information on this solution.</pre></div><div class='update_description'><i onclick="document.location='26090#1437071467'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-16T18:31:07+00:00">Jul 16, 2015 06:31 PM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1437071467">&nbsp;</a></div><pre>no</pre></div><div class='update_description'><i onclick="document.location='26090#1437054019'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-16T13:40:19+00:00">Jul 16, 2015 01:40 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1437054019">&nbsp;</a></div><pre>Hi Wei,

Have you heard anything from Cath about this?

Thanks,
Chris</pre></div><div class='update_description'><i onclick="document.location='26090#1436896699'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-14T17:58:19+00:00">Jul 14, 2015 05:58 PM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1436896699">&nbsp;</a></div><pre>I just contact Cath Noble of the WLCG Office. Hopefully she knows how (or who) to fix this issue.</pre></div><div class='update_description'><i onclick="document.location='26090#1436890026'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-14T16:07:06+00:00">Jul 14, 2015 04:07 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1436890026">&nbsp;</a></div><pre>Hi Wei,

Rob pointed out this link to me <a href='http&#58;//accounting.egi.eu/country.php?Path=1.64&query=njobs&startYear=2015&startMonth=1&endYear=2015&endMonth=7&yRange=SITE&xRange=DATE&voGroup=all&chart=GRBAR&scale=LIN&localJobs=onlygridjobs' target='_blank' rel='nofollow'>http&#58;//accounting.egi.eu/country.php?Path=1.64&query=njobs&startYear=2015&startMonth=1&endYear=2015&endMonth=7&yRange=SITE&xRange=DATE&voGroup=all&chart=GRBAR&scale=LIN&localJobs=onlygridjobs</a>

It still appears that WT2 is still under reporting. Could you please take a look and get back with us?

Thanks,
Chris</pre></div><div class='update_description'><i onclick="document.location='26090#1436882748'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-14T14:05:48+00:00">Jul 14, 2015 02:05 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1436882748">&nbsp;</a></div><pre>My understanding is that it is now corrected, I will close this. If there are any objections then let me know and I can reopen this.</pre></div><div class='update_description'><i onclick="document.location='26090#1436467669'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-09T18:47:49+00:00">Jul 9, 2015 06:47 PM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1436467669">&nbsp;</a></div><pre>I have rerun the Gratia reporting so that under reporting part from SLAC should have been fixed. I believe the gratia records we reported are all with blank DNs because the reporting host and the CE that actually receive jobs are different.</pre></div><div class='update_description'><i onclick="document.location='26090#1436451628'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-09T14:20:28+00:00">Jul 9, 2015 02:20 PM UTC</time> by <b>Rob Quick</b><a class="anchor" name="1436451628">&nbsp;</a></div><pre>Wei,

Thank you, we are looking into the reporting mechanism. Our current suspicion is that we are not including gratia records with blank DNs when sending to WLCG reports, I know Carl was checking this out.  More to come soon.</pre></div><div class='update_description'><i onclick="document.location='26090#1436368987'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-08T15:23:07+00:00">Jul 8, 2015 03:23 PM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1436368987">&nbsp;</a></div><pre>Hi,

I believe there is a under reporting issue at SLAC but there is also problem between Gratia and EGI accounting.

At SLAC we have several CEs. Only WT2 is responsible for Gratia reporting. The number at EGI accounting is inconsistent with Gratia reporting page&#58;

<a href='http&#58;//gratiaweb.opensciencegrid.org/gratia/bysite?starttime=2015-06-01+00%3A00%3A00&endtime=2015-06-30+00%3A00%3A00&span=86400&relativetime=absolute&facility=%5EWT2%24&exclude-facility=&vo=atlas&exclude-vo=&user=&exclude-dn=' target='_blank' rel='nofollow'>http&#58;//gratiaweb.opensciencegrid.org/gratia/bysite?starttime=2015-06-01+00%3A00%3A00&endtime=2015-06-30+00%3A00%3A00&span=86400&relativetime=absolute&facility=%5EWT2%24&exclude-facility=&vo=atlas&exclude-vo=&user=&exclude-dn=</a>

While I will look at the SLAC issues (it was due to a config change in LSF that I was unaware of, so I need to rerun Gratia from April to July), can someone at OSG help looking at the reporting from OSG to EGI?</pre></div><div class='update_description'><i onclick="document.location='26090#1436308547'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-07T22:35:47+00:00">Jul 7, 2015 10:35 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1436308547">&nbsp;</a></div><pre>Rob, just to answer one of your questions, I think the script currently ignoring the resource_wlcg.interop_accounting flag in OIM.

Carl</pre></div><div class='update_description'><i onclick="document.location='26090#1436292497'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-07T18:08:17+00:00">Jul 7, 2015 06:08 PM UTC</time> by <b>Wei Yang</b><a class="anchor" name="1436292497">&nbsp;</a></div><pre>traveling. will look at is on 7/9.

--
Wei Yang   |   yangw@....  |  650-926-3338(O)</pre></div><div class='update_description'><i onclick="document.location='26090#1436289697'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-07T17:21:37+00:00">Jul 7, 2015 05:21 PM UTC</time> by <b>Rob Quick</b><a class="anchor" name="1436289697">&nbsp;</a></div><pre>WT2 is under reporting, which can be seen at <a href='http&#58;//accounting.egi.eu/tier2.php?SubTier2=1.37&query=njobs&startYear=2015&startMonth=1&endYear=2015&endMonth=7&yRange=SITE&xRange=DATE&voGroup=lhc&chart=GRBAR&scale=LIN&localJobs=onlygridjobs.' target='_blank' rel='nofollow'>http&#58;//accounting.egi.eu/tier2.php?SubTier2=1.37&query=njobs&startYear=2015&startMonth=1&endYear=2015&endMonth=7&yRange=SITE&xRange=DATE&voGroup=lhc&chart=GRBAR&scale=LIN&localJobs=onlygridjobs.</a>

While investigating this I noticed the resource WT2_CE_ 2 (<a href='https&#58;//oim.opensciencegrid.org/oim/resourceedit?id=368' target='_blank' rel='nofollow'>https&#58;//oim.opensciencegrid.org/oim/resourceedit?id=368</a>) does not have the interoperability flag set. Is this a mistake that may lead to under reporting?</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F26090">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="/images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 26090});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
