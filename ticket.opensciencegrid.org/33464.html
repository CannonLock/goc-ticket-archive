<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[33464] Host Certificate Request by Matthew Gyurgyik(Guest)</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=33464" method="post">
<div class="page-header">
    <h3><span class="muted">33464</span> / Host Certificate Request by Matthew Gyurgyik(Guest)</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Matthew Gyurgyik</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">OIM/CertManager(host)</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Matthew Gyurgyik</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Matthew Please Review</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2017-05-02</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Marina Krenz <span class="muted"> / OSG Operations Infrastructure</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/33464", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='33464#1494006252'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-05-05T17:44:12+00:00">May 5, 2017 05:44 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1494006252">&nbsp;</a></div><pre>Closing per this update being in place.</pre></div><div class='update_description'><i onclick="document.location='33464#1493049950'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-24T16:05:50+00:00">Apr 24, 2017 04:05 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1493049950">&nbsp;</a></div><pre>Hi Matthew,

We are updating our CA service on May 1st to resolve the issue you were experiencing regarding &#34;alt_hostname&#34; parameters in your script.
May we assist with anything else?

Thank you,</pre></div><div class='update_description'><i onclick="document.location='33464#1492799476'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-21T18:31:16+00:00">Apr 21, 2017 06:31 PM UTC</time> by <b>Marina Krenz</b><a class="anchor" name="1492799476">&nbsp;</a></div><pre>Terry
I just issued a cert based on the CSR generated by script (make-csr) and it went through without generating any errors. It submitted the request to osg0.cilogon.org.

So your fix took care of the problem.</pre></div><div class='update_description'><i onclick="document.location='33464#1492782492'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-21T13:48:12+00:00">Apr 21, 2017 01:48 PM UTC</time> by <b>Marina Krenz</b><a class="anchor" name="1492782492">&nbsp;</a></div><pre>Terry
I will test it in development.

Thank you!</pre></div><div class='update_description'><i onclick="document.location='33464#1492706655'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-20T16:44:15+00:00">Apr 20, 2017 04:44 PM UTC</time> by <b>tfleury@....</b><a class="anchor" name="1492706655">&nbsp;</a></div><pre>I have pushed a quick fix to osg0.cilogon.org. If you configure your
client to use this OSG test server, you can check to see if the issue
has been addressed.

-Terry

On 2017-04-20 10&#58;41 AM, Terry Fleury wrote&#58;
<font color='#7F7E6F'>&#62; Ah ha! Thank you for the clarification.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; I was able to test this scenario and verified the error&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; &#34;hostname=test.foo.edu email=test@.... alt_hostnames=test.foo.edu&#34;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; gives the error you are seeing.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; The problem is that the server removes the hostname from the</font>
<font color='#7F7E6F'>&#62; alt_hostnames parameter. So if alt_hostnames is passed in with ONLY the</font>
<font color='#7F7E6F'>&#62; host that matches the hostname parameter, alt_hostnames becomes empty.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; So this is a bug on the server side, but it can be mitigated on the</font>
<font color='#7F7E6F'>&#62; client side by checking &#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; if (hostname == alt_hostnames) then don&#39;t pass alt_hostnames at all</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; I&#39;ll file a bug on our side.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Thank you for your patience in working through this issue with me.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; -Terry</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On 2017-04-20 10&#58;01 AM, Open Science Grid FootPrints wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='33464#1492703050'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-20T15:44:10+00:00">Apr 20, 2017 03:44 PM UTC</time> by <b>tfleury@....</b><a class="anchor" name="1492703050">&nbsp;</a></div><pre>Ah ha! Thank you for the clarification.

I was able to test this scenario and verified the error&#58;

&#34;hostname=test.foo.edu email=test@.... alt_hostnames=test.foo.edu&#34;

gives the error you are seeing.

The problem is that the server removes the hostname from the
alt_hostnames parameter. So if alt_hostnames is passed in with ONLY the
host that matches the hostname parameter, alt_hostnames becomes empty.

So this is a bug on the server side, but it can be mitigated on the
client side by checking &#58;

if (hostname == alt_hostnames) then don&#39;t pass alt_hostnames at all

I&#39;ll file a bug on our side.

Thank you for your patience in working through this issue with me.

-Terry

On 2017-04-20 10&#58;01 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='33464#1492700478'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-20T15:01:18+00:00">Apr 20, 2017 03:01 PM UTC</time> by <b>Marina Krenz</b><a class="anchor" name="1492700478">&nbsp;</a></div><pre>Terry
I think there is a confusion.
The one I generated for mvkrenz.grid.iu.edu worked this is the one without alt hostname and I used the command showed as an example on OIM website. The one that is having trouble is the CSR generated with a script (make-csr) and it was for the hostname myproxy1.op.ccs.ornl.gov. This script adds alt hostnames regardless if there are any or not, if there are none then it enters myproxy1.op.ccs.ornl.gov both for subject CN and and alt hostname</pre></div><div class='update_description'><i onclick="document.location='33464#1492697650'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-20T14:14:10+00:00">Apr 20, 2017 02:14 PM UTC</time> by <b>tfleury@....</b><a class="anchor" name="1492697650">&nbsp;</a></div><pre>I was unaware that <a href='https&#58;//oim.grid.iu.edu/oim/certificaterequesthost' target='_blank' rel='nofollow'>https&#58;//oim.grid.iu.edu/oim/certificaterequesthost</a>
supported subjAltNames in the CSR. I have never tested that
functionality. If that is the case, then it&#39;s not working as expected.
Yesterday I learned that a command line client is typically used to get
a host certificate, and this command line client supports extra
hostnames to be put in the subjAltName extension.

On the server side, the issue is that the list of &#34;alt_hostnames&#34; is
empty, e.g, the client is passing&#58;

&#34;hostname=mvkrenz.grid.iu.edu email=mvkrenz@.... alt_hostnames=&#34;

Currently, the MyProxy server requires that if a parameter key is
passed, then there is a corresponding value. I can easily fix this by
ignoring any parameter keys without values. But this would not fix your
issue of the client not passing along the subjAltNames in the
alt_hostnames parameter.

-Terry

On 2017-04-20 8&#58;46 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='33464#1492695977'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-20T13:46:17+00:00">Apr 20, 2017 01:46 PM UTC</time> by <b>Marina Krenz</b><a class="anchor" name="1492695977">&nbsp;</a></div><pre>Terry
I have been troubleshooting the script, so I found that generating the CSR using the script above (make-csr.txt) adds the subject CN as one of the alt hostname. Alt hostname are also required according to the openssl configuration file. Do you think adding CN as one of the alt hostnames is the reason why it generating the errors?  Also <a href='https&#58;//oim.grid.iu.edu/oim/certificaterequesthost' target='_blank' rel='nofollow'>https&#58;//oim.grid.iu.edu/oim/certificaterequesthost</a> does not ask for the alt names  but it gets them from the CSR submitted, and then passes them in a comma delimited format.

I see from the prior communication that the CSRs generated by the script worked before. So could the requirements have changed on CILogon end?

Matthew,
Were the alt names always required? Was that requirement enabled recently?</pre></div><div class='update_description'><i onclick="document.location='33464#1492196482'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-14T19:01:22+00:00">Apr 14, 2017 07:01 PM UTC</time><a class="anchor" name="1492196482">&nbsp;</a></div><pre>The error logs on the server side would probably not be useful to you. The error message indicates that &#34;alt_hostnames=&#34;, meaning that the alt_hostnames parameter was given without a corresponding value.

But I am curious how an end user would specify subjAltHostname values on <a href='https&#58;//oim.grid.iu.edu/oim/certificaterequesthost' target='_blank' rel='nofollow'>https&#58;//oim.grid.iu.edu/oim/certificaterequesthost</a> . The help text for &#34;How can I generate a CSR?&#34; does not give that info, nor is there any form input on that page to accept extra hostnames.

-Terry

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Terry Fleury 3691</pre></div><div class='update_description'><i onclick="document.location='33464#1492196143'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-14T18:55:43+00:00">Apr 14, 2017 06:55 PM UTC</time> by <b>Marina Krenz</b><a class="anchor" name="1492196143">&nbsp;</a></div><pre>Terry
I will take a look.  Could attach error logs it generates on your end?

Thanks</pre></div><div class='update_description'><i onclick="document.location='33464#1492190605'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-14T17:23:25+00:00">Apr 14, 2017 05:23 PM UTC</time><a class="anchor" name="1492190605">&nbsp;</a></div><pre>I think I see the problem. the host certificate request page at <a href='https&#58;//oim.grid.iu.edu/oim/certificate' target='_blank' rel='nofollow'>https&#58;//oim.grid.iu.edu/oim/certificate</a> does not have an extra input field to allow for subjectAltName hosts. So I think that someone from OSG needs to chime in on how to specify the extra hostnames.

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Terry Fleury 3691</pre></div><div class='update_description'><i onclick="document.location='33464#1492190252'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-14T17:17:32+00:00">Apr 14, 2017 05:17 PM UTC</time><a class="anchor" name="1492190252">&nbsp;</a></div><pre>Hi Matthew,

Did you look at the &#34;Testing&#34; section of the API doc (<a href='https&#58;//goo.gl/pxDrsp#heading=h.dul3qmg188rm' target='_blank' rel='nofollow'>https&#58;//goo.gl/pxDrsp#heading=h.dul3qmg188rm</a>)? The first example shows how to get a host certificate with several additional hostnames to be added to the subjectAltName extension. Notice that the CSR&#39;s subject is ignored. Instead, the hostname is specified using the &#34;hostname=...&#34; parameter.

-Terry

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Terry Fleury 3691</pre></div><div class='update_description'><i onclick="document.location='33464#1492189941'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-14T17:12:21+00:00">Apr 14, 2017 05:12 PM UTC</time><a class="anchor" name="1492189941">&nbsp;</a></div><pre>Terry,
You are correct in that &#96;read altnames&#96; was commented out for testing and I forgot to uncomment them before uploading the configs.

Submitting a certificate request (via <a href='https&#58;//oim.grid.iu.edu/oim/certificate' target='_blank' rel='nofollow'>https&#58;//oim.grid.iu.edu/oim/certificate</a>) without a SANs the web form would display a message similar to &#34;Opps something went wrong contact support&#34;.  I commented remove the  basicConstraits and keyUsage and changed my subject from &#34;/C=US/ST=Tennessee/L=Oak Ridge/O=Oak Ridge National Laboratory/CN=${hostname}&#34; to just &#34;/CN=${hostname}&#34;. At that point the web form allowed me to submit the csr. With all that said, that problem is probably unrelated.

Thanks,
Matthew

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Matthew Gyurgyik 2448</pre></div><div class='update_description'><i onclick="document.location='33464#1492189379'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-14T17:02:59+00:00">Apr 14, 2017 05:02 PM UTC</time><a class="anchor" name="1492189379">&nbsp;</a></div><pre>Hi Vince,

I think the answer is that the OSG CA service does not look in the subjectAltName section of the CSR for extra hosts. Any extra hosts to be included in the certificate must be specified via the API request in the &#34;alt_hostnames=&#34; parameter.

-Terry

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Terry Fleury 3691</pre></div><div class='update_description'><i onclick="document.location='33464#1492189150'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-14T16:59:10+00:00">Apr 14, 2017 04:59 PM UTC</time><a class="anchor" name="1492189150">&nbsp;</a></div><pre>Hi Vince,

I&#39;m assuming that the &#34;read altnames&#34; lines of the make-csr script have been commented out for testing purposes.

When i run the make-csr script with &#34;read altnames&#34; uncommented, I can add several hostnames to the subjectAltName extension section of the CSR just fine. I noticed that the &#34;basicConstraints=&#34; and &#34;keyUsage=&#34; lines have been commented out from the &#34;[v3_req]&#34; section of openssl.cnf. It should be okay to put those back into the CSR, but this is probably unrelated to the problems you are seeing.

My question is how does the CSR get transformed into the parameters needed for the &#34;<a href='https&#58;//osg.cilogon.org/gethostcert&#34' target='_blank' rel='nofollow'>https&#58;//osg.cilogon.org/gethostcert&#34</a>; endpoint? Something on the OSG client-side needs to extract the extra hosts from the CSR and put them into the &#34;alt_hostnames=...&#34; parameter. I only have experience with the server side, not the client side. So someone who has worked on the OSG client will need to chime in.

-Terry

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Terry Fleury 3691</pre></div><div class='update_description'><i onclick="document.location='33464#1492187690'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-14T16:34:50+00:00">Apr 14, 2017 04:34 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1492187690">&nbsp;</a></div><pre>Terry,

Thank you for the information and assistance.  In our testing yesterday we discovered that if Matthew excludes &#34;alt_hostnames&#34; the request completes successfully
but using &#34;alt_hostnames&#34; causes the request to fail.  Can you discern if the script that ORNL is using is causing the error in submission or something between OSG and CILogon?

I&#39;ve attached the script files ORNL uses to generate CSR&#39;s for host requests.

Thank you,
Vince</pre></div><div class='update_description'><i onclick="document.location='33464#1492109252'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-13T18:47:32+00:00">Apr 13, 2017 06:47 PM UTC</time><a class="anchor" name="1492109252">&nbsp;</a></div><pre>The error message indicates that the &#34;alt_hostnames&#34; parameter is received as an empty list.

According to the OSG CA Design doc (<a href='https&#58;//goo.gl/pxDrsp' target='_blank' rel='nofollow'>https&#58;//goo.gl/pxDrsp</a>), &#34;alt_hostnames&#34; is optional list of additional fully-qualified hostnames to include in certificate subjectAltName, separated by commas. So the &#34;alt_hostnames&#34; parameter is optional, but if passed to the OSG CA service, it must be a non-empty list of hostnames. According to the error message on the OSG CA service side, the client is sending an empty list, thus causing the error.

Solutions&#58;
(a) Have the client NOT send the &#34;alt_hostnames&#34; parameter at all.
(b) Have the client send the &#34;alt_hostnames&#34; parameter with a list of comma-separated hostnames.

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Terry Fleury 3691</pre></div><div class='update_description'><i onclick="document.location='33464#1492108161'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-13T18:29:21+00:00">Apr 13, 2017 06:29 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1492108161">&nbsp;</a></div><pre>Jim/Terry,

Matthew has created 3 requests for certificates that all return with the same error.  We are able to issue host certificates in our testing and our log files do not indicate any errors of note.
Could you please advise as to what is causing these certificate requests to fail?

Thank you,</pre></div><div class='update_description'><i onclick="document.location='33464#1492102461'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-13T16:54:21+00:00">Apr 13, 2017 04:54 PM UTC</time><a class="anchor" name="1492102461">&nbsp;</a></div><pre>Failed to issue certificate.

Failed to sign certificate -- CertificateProviderException

From CILogon&#58; Unknown status code from cilogon&#58; 500

The alert has been sent to GOC alert for further actions on this issue.</pre></div><div class='update_description'><i onclick="document.location='33464#1492102305'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-13T16:51:45+00:00">Apr 13, 2017 04:51 PM UTC</time><a class="anchor" name="1492102305">&nbsp;</a></div><pre>Dear Matthew Gyurgyik,

Your host certificate request has been approved.

/CN=myproxy1.op.ccs.ornl.gov
To retrieve the certificate please visit <a href='https&#58;//oim.grid.iu.edu/oim/certificatehost?id=9693' target='_blank' rel='nofollow'>https&#58;//oim.grid.iu.edu/oim/certificatehost?id=9693</a> and click on Issue Certificate button.

Or if you are using the command-line&#58; osg-cert-retrieve 9693</pre></div><div class='update_description'><i onclick="document.location='33464#1492101804'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-13T16:43:24+00:00">Apr 13, 2017 04:43 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1492101804">&nbsp;</a></div><pre>Dear GridAdmin; Tom Barron, Ross Miller, Pete Eby,

Host certificate request has been submitted. Please determine this request&#39;s authenticity, and approve / disapprove at <a href='https&#58;//oim.grid.iu.edu/oim/certificatehost?id=9693' target='_blank' rel='nofollow'>https&#58;//oim.grid.iu.edu/oim/certificatehost?id=9693</a>

CNs requested&#58;
/CN=myproxy1.op.ccs.ornl.gov
Requester IP&#58;160.91.203.60</pre></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F33464">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

});
</script>


</body>
