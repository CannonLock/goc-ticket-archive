<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="/">
    <title>[17182] Changed Condor format causes Gratia Probe to report inaccurate job information</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="//netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="https://ticket.opensciencegrid.org/images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="https://ticket.opensciencegrid.org/lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=17182" method="post">
<div class="page-header">
    <h3><span class="muted">17182</span> / Changed Condor format causes Gratia Probe to report inaccurate job information</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Derek Weitzel</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Derek Weitzel</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">GRATIA Dev</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2013-09-24</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">FNAL (Prod)&nbsp;<a target="_blank" href="https://fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000395350">INC000000395350</a> <span class="muted"> / Ticket Exchange</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("https://ticket.opensciencegrid.org/attachment/list?id=17182", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="/17182?sort=up&"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="/17182?expandall=true&">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Changed%20Condor%20format%20causes%20Gratia%20Probe%20to%20report%20inaccurate%20job%20information%20ISSUE%3D17182%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='17182#1380305590'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-27T18:13:10+00:00">Sep 27, 2013 06:13 PM UTC</time> by <b>dweitzel@....</b><a class="anchor" name="1380305590">&nbsp;</a></div><pre>Yes, this ticket may be closed.

-Derek

On Sep 27, 2013, at 1&#58;10 PM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='17182#1380305453'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-27T18:10:53+00:00">Sep 27, 2013 06:10 PM UTC</time><a class="anchor" name="1380305453">&nbsp;</a></div><pre>Derek,

So we should be good on this ticket then?
And you can request it be closes?

John Wegiand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='17182#1380305229'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-27T18:07:09+00:00">Sep 27, 2013 06:07 PM UTC</time> by <b>dweitzel@....</b><a class="anchor" name="1380305229">&nbsp;</a></div><pre>Hi John,

It looks like everything is replicated.  Our local collector is consistent with the OSG collector.

The data seems reasonable as the machine was in downtime for a while during the last month.

-Derek

On Sep 27, 2013, at 12&#58;58 PM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='17182#1380304708'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-27T17:58:28+00:00">Sep 27, 2013 05:58 PM UTC</time><a class="anchor" name="1380304708">&nbsp;</a></div><pre>Derek,

Where are you at in terms of getting the missing data in and replicating
to the Fermi OSG collector?  Is it still in process?

As of right now (9/27 12&#58;54), this is what I am seeing in Gratia here and reportable to WLCG&#58;
Raw Wall&#58; 1,061,097   Raw CPU&#58;  747,689   Job&#58; 459,875

Last month&#58;
Raw Wall&#58; 1,446,475   Raw CPU&#58; 1,236,719  Jobs&#58; 304,250

Do you think we are still in &#34;catch-up&#34; mode on the replicated data here?

John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='17182#1380138347'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-25T19:45:47+00:00">Sep 25, 2013 07:45 PM UTC</time><a class="anchor" name="1380138347">&nbsp;</a></div><pre>Derek,

Based on the stacktrace you just sent up in
<a href='https&#58;//jira.opensciencegrid.org/browse/GRATIA-123' target='_blank' rel='nofollow'>https&#58;//jira.opensciencegrid.org/browse/GRATIA-123</a>
... you may want to look at this hidden piece of doc that
I still think is good... just can&#39;t figure out how to navigate to it.
<a href='https&#58;//twiki.grid.iu.edu/bin/view/Accounting/ProbeDevelopement#DataType' target='_blank' rel='nofollow'>https&#58;//twiki.grid.iu.edu/bin/view/Accounting/ProbeDevelopement#DataType</a>
You may have to convert back somehow.  i don&#39;t think the collector is
going to change.

John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='17182#1380133631'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-25T18:27:11+00:00">Sep 25, 2013 06:27 PM UTC</time> by <b>dweitzel@....</b><a class="anchor" name="1380133631">&nbsp;</a></div><pre>Yes, the regex is the largest most important change in the patch.  Basically I just made the regex recognize when the number has an E at the end, and to convert that number to a float.

My patches affect both using condor_history and using the PER_JOB_HISTORY_DIR.  The same code is actually executed in both cases.  condor_history -l and the history* files have the same format (when not using the -format option to condor_history).

-Derek

On Sep 25, 2013, at 1&#58;20 PM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='17182#1380133234'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-25T18:20:34+00:00">Sep 25, 2013 06:20 PM UTC</time><a class="anchor" name="1380133234">&nbsp;</a></div><pre>Derek,

So in the patch, it was taken care of by this line...
+classad_double_re = re.compile(&#34;(&#92;w{1,255}) = (-?&#92;d{1,30}&#92;.?&#92;d{1,30}E?&#92;+?&#92;d{1,30})&#34;)
which my brain cannot fathom.. generally it goes on overload with regex.

If so, would your patches also be applicable to condor_meter&#39;s use of the history*
files in the PER_JOB_HISTORY_DIR (aka /var/lib/gratia/data) directory.

John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='17182#1380132548'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-25T18:09:08+00:00">Sep 25, 2013 06:09 PM UTC</time> by <b>dweitzel@....</b><a class="anchor" name="1380132548">&nbsp;</a></div><pre>Hi John,

Walltime was affected by the scientific notation bug.  Walltime is not calculated by taking the EndTime - StartTime.  It is calculated using the reported walltime from Condor.  Therefore the walltime (and user cpu and system cpu) where between 1-9 seconds with the bug.  Sending duplicate (but not duplicate) records with the correct walltime does pad the usage, but only by 1-9 seconds.

-Derek

On Sep 25, 2013, at 11&#58;35 AM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='17182#1380126928'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-25T16:35:28+00:00">Sep 25, 2013 04:35 PM UTC</time><a class="anchor" name="1380126928">&nbsp;</a></div><pre>Derek,

you say wall time was not affected and, thus, no changes to the condor_meter for it.

But when you send the duplicates up that are not duplicates due to globaljobid changes,
won&#39;t it send up the same wall time as the original job thus doubling wall.
or
am I totally misunderstanding?

John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='17182#1380122109'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-25T15:15:09+00:00">Sep 25, 2013 03:15 PM UTC</time> by <b>dweitzel@....</b><a class="anchor" name="1380122109">&nbsp;</a></div><pre>Hi John,

Regarding the CompletionDate, that&#39;s probably just an accident on my part.  The patch was a quickly made, and I just started converting things to float.  Looking at our &#39;broken&#39; Condor, the CompletionDate is unaffected.  The EndTime is also unaffected.

It is going to slightly inflate CPU and wall.  The job number will double.  But the CPU and wall will increase between 1 and 9 seconds per job, so it was deemed insignificant in our discussions locally.

-Derek

On Sep 25, 2013, at 10&#58;01 AM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='17182#1380121295'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-25T15:01:35+00:00">Sep 25, 2013 03:01 PM UTC</time><a class="anchor" name="1380121295">&nbsp;</a></div><pre>Derek,
From what I see in the patched condor_meter, it is just not the CPU that is affected,
There appears to be a change in the Completion date as well.
Is this affecting the EndTime in Gratia? ... and Wall time then?

I understand the modification to the GlobalJobId to avoid duplicates, but is this
going to inflate CPU and Wall?  We still have the old data.  And this will look like
new jobs.  Assume job count will be doubled for the period.
If CPU and Wall are inflated, is it significant?

Just trying to understand.

John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='17182#1380059546'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-24T21:52:26+00:00">Sep 24, 2013 09:52 PM UTC</time><a class="anchor" name="1380059546">&nbsp;</a></div><pre>An update&#58;

The probes have been modified with the patch in the previous message.  Everything appears to be functioning properly.

We are just finishing reprocessing the condor usage data.  We currently are sending all data to our local collector and will turn on replication once we confirm that the data appears good.  The steps we took to reprocess&#58;
1. Create a new probe to do the reprocessing.
2. Modify the GlobalJobId creation to avoid duplicate record detection.
3. Modify the call to condor_history to include a constraint to only include records from a specific version of Condor that is known to have the changed format.
4. Call the probe manually with the --history option to force the probe to query the condor_history files.

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Derek Weitzel 605</pre></div><div class='update_description'><i onclick="document.location='17182#1380050036'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-09-24T19:13:56+00:00">Sep 24, 2013 07:13 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1380050036">&nbsp;</a></div><pre>Condor changed the output format for values such as RemoteUserCpu from using a float value to using scientific notation.  For example, it could be&#58;
...
RemoteUserCpu = 5.500000000000000E+01
...

The current gratia probe parses this as 5.5, when it should be 55.  This has caused a the last several weeks of Nebraska Tier 2 usage to be under reported.  Therefore, this ticket is to address 2 things&#58;
1. Update the probe to read the new notation.  The notation has been subsequently fixed, and the format in most cases is back to the original.  But in some cases, it can be the scientific notation format.  A proposed patch that was used at Nebraska, and verified, is here&#58; <a href='https&#58;//gist.github.com/djw8605/6689763' target='_blank' rel='nofollow'>https&#58;//gist.github.com/djw8605/6689763</a>
2. We need to reprocess the last several weeks of data from the Nebraska Tier 2.  What are the steps to do this?

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Derek Weitzel 605</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F17182">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="/images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 17182});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
