<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[34867] LCMAPS voms issues</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=34867" method="post">
<div class="page-header">
    <h3><span class="muted">34867</span> / LCMAPS voms issues</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Patrick McGuigan</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Patrick McGuigan</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Track in JIRA</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2017-10-09</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div><div class="assignee" style="width: 60%">Matyas Selmeci <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/34867", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="https://ticket.opensciencegrid.org/\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="https://ticket.opensciencegrid.org/\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/34867?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/34867?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20LCMAPS%20voms%20issues%20ISSUE%3D34867%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='34867#1507582232'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-09T20:50:32+00:00">Oct 9, 2017 08:50 PM UTC</time> by <b>echism</b><a class="anchor" name="1507582232">&nbsp;</a></div><pre>Closing as advised.</pre></div><div class='update_description'><i onclick="document.location='34867#1507580411'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-09T20:20:11+00:00">Oct 9, 2017 08:20 PM UTC</time> by <b>Patrick McGuigan</b><a class="anchor" name="1507580411">&nbsp;</a></div><pre>Hi Mat,

I have no objection moving this work to JIRA and closing the ticket.

Regards,
Patrick

On 10/09/2017 03&#58;11 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34867#1507579907'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-09T20:11:47+00:00">Oct 9, 2017 08:11 PM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1507579907">&nbsp;</a></div><pre>I created a new JIRA ticket for it&#58; <a href='https&#58;//jira.opensciencegrid.org/browse/SOFTWARE-2932' target='_blank' rel='nofollow'>https&#58;//jira.opensciencegrid.org/browse/SOFTWARE-2932</a>

If everything is working fine for you now, can we close this ticket and track the work in JIRA instead?

-Mat</pre></div><div class='update_description'><i onclick="document.location='34867#1507578611'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-09T19:50:11+00:00">Oct 9, 2017 07:50 PM UTC</time> by <b>Patrick McGuigan</b><a class="anchor" name="1507578611">&nbsp;</a></div><pre>Hi Mat.

The two related options are&#58;
-first-fqan
-all-fqans

The first is the default behavior and the second is what was needed for my testing.

Regards,
Patrick

On 10/09/2017 10&#58;30 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34867#1507563049'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-09T15:30:49+00:00">Oct 9, 2017 03:30 PM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1507563049">&nbsp;</a></div><pre>Good work!

I will create a ticket to update our man page and documentation. Is it &#34;-all-fqans&#34; or &#34;--all-fqans&#34; (one dash or two)? Seems like some of the options use one and some of the options use the other.

-Mat</pre></div><div class='update_description'><i onclick="document.location='34867#1507329851'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-06T22:44:11+00:00">Oct 6, 2017 10:44 PM UTC</time> by <b>Patrick McGuigan</b><a class="anchor" name="1507329851">&nbsp;</a></div><pre>Hi Mat,

I found the reason after pulling the OSG source RPM.

OSG is building from version 1.7.1 of lcmaps-plugins-voms and including two
patches (sw2771 and sw2635).  The former patch implements the first fqan
behavior that I am seeing and can be overridden with a switch of &#34;-all-fqans&#34; in
/etc/lcmaps.db

Unfortunately that patch did not seem to update the man page for the module.

More detective work and the patch is from OSG itself in response to something
Brian Bockelman asked for in&#58;
<a href='https&#58;//jira.opensciencegrid.org/browse/SOFTWARE-2771' target='_blank' rel='nofollow'>https&#58;//jira.opensciencegrid.org/browse/SOFTWARE-2771</a>

With the switch in place, I can continue with my testing.

Regards,

Patrick

On 10/06/2017 04&#58;51 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34867#1507326668'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-06T21:51:08+00:00">Oct 6, 2017 09:51 PM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1507326668">&nbsp;</a></div><pre>Well, it&#39;s not the behavior _I_ expect...

Thanks for the logs. I&#39;ll take a look at why it&#39;s skipping the other FQANs; it shouldn&#39;t be doing that.</pre></div><div class='update_description'><i onclick="document.location='34867#1507323910'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-06T21:05:10+00:00">Oct 6, 2017 09:05 PM UTC</time><a class="anchor" name="1507323910">&nbsp;</a></div><pre>Manually attached log file to ticket

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mcguigan/CN=664979/CN=Patrick Mcguigan</pre></div><div class='update_description'><i onclick="document.location='34867#1507323012'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-06T20:50:12+00:00">Oct 6, 2017 08:50 PM UTC</time> by <b>Patrick McGuigan</b><a class="anchor" name="1507323012">&nbsp;</a></div><pre>Hi Mat,

This is not a CE, it will only be a gridFTP server.

I modified /etc/sysconfig/globus-gridftp-server to include the exports and restarted the the service.

The log (hopefully attached) contains two invocations against the gridftp service.  The first is where I don&#39;t get a mapping despite /etc/grid-security/voms-mapfile containing &#34;/atlas/usatlas/*&#34; usatlas3.  While the second invocation is where the same mapfile contains &#39;&#34;/atlas/*&#34; usatlas4&#39; and does map me to usatlas4.

I looked through the log and on the first invocation I see&#58;
lcmaps[47566]   LOG_DEBUG&#58; 2017-10-06.20&#58;32&#58;04Z&#58; lcmaps_voms_localaccount-plugin_run()&#58; No match for a VOMS localaccount for FQAN 1, &#34;/atlas/Role=NULL/Capability=NULL&#34;
lcmaps[47566]   LOG_DEBUG&#58; 2017-10-06.20&#58;32&#58;04Z&#58; lcmaps_voms_localaccount-plugin_run()&#58; Skipping additional FQAN /atlas/lcg1/Role=NULL/Capability=NULL from VO atlas.
lcmaps[47566]   LOG_DEBUG&#58; 2017-10-06.20&#58;32&#58;04Z&#58; lcmaps_voms_localaccount-plugin_run()&#58; Skipping additional FQAN /atlas/usatlas/Role=NULL/Capability=NULL from VO atlas.
lcmaps[47566]  LOG_NOTICE&#58; 2017-10-06.20&#58;32&#58;04Z&#58; lcmaps_voms_localaccount-plugin_run()&#58; No match for a VOMS localaccount for any of the FQANs, in /etc/grid-security/voms-mapfile

It looks like the code is only looking at the first voms attribute.  Is this the expected behavior?

Regards,

Patrick

On 10/06/2017 11&#58;57 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34867#1507309030'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-06T16:57:10+00:00">Oct 6, 2017 04:57 PM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1507309030">&nbsp;</a></div><pre>This is for your CE, right? Can you put this into /etc/sysconfig/condor-ce&#58;
export LCMAPS_DEBUG_LEVEL=5
export LCMAPS_LOG_FILE=/tmp/lcmaps.log
Then restart condor-ce, try to authenticate again, and send me the resulting /tmp/lcmaps.log? (I don&#39;t think there&#39;s any sensitive information in there, but you should check if you need to sanitize the file before attaching it.)

-Mat</pre></div><div class='update_description'><i onclick="document.location='34867#1507307254'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-06T16:27:34+00:00">Oct 6, 2017 04:27 PM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1507307254">&nbsp;</a></div><pre>OK, I&#39;ll take a look at the code again.</pre></div><div class='update_description'><i onclick="document.location='34867#1507236612'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-05T20:50:12+00:00">Oct 5, 2017 08:50 PM UTC</time> by <b>Patrick McGuigan</b><a class="anchor" name="1507236612">&nbsp;</a></div><pre>Hi Mat,

I am still having problems with the mappings.

I did a complete rebuild of the gridftp server to clean everything up, and created an /etc/grid-security/voms-mapfile that contains&#58;

&#34;/atlas/usatlas/Role=NULL/Capability=NULL&#34; usatlas3
&#34;/atlas/usatlas/*&#34; usatlas3

I then removed the line&#58;

&#34;/atlas/*&#34; usatlas4

from /usr/share/osg/voms-mapfile-default

and my proxy does not receive a mapping from lcmaps even though it looks like&#58;

[mcguigan@gk01 ~]$ voms-proxy-info --all
subject   &#58; /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mcguigan/CN=664979/CN=Patrick Mcguigan/CN=proxy
issuer    &#58; /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mcguigan/CN=664979/CN=Patrick Mcguigan
identity  &#58; /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mcguigan/CN=664979/CN=Patrick Mcguigan
type      &#58; proxy
strength  &#58; 1024 bits
path      &#58; /tmp/x509up_u501
timeleft  &#58; 11&#58;50&#58;02
key usage &#58; Digital Signature, Key Encipherment
=== VO atlas extension information ===
VO        &#58; atlas
subject   &#58; /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mcguigan/CN=664979/CN=Patrick Mcguigan
issuer    &#58; /DC=ch/DC=cern/OU=computers/CN=voms2.cern.ch
attribute &#58; /atlas/Role=NULL/Capability=NULL
attribute &#58; /atlas/lcg1/Role=NULL/Capability=NULL
attribute &#58; /atlas/usatlas/Role=NULL/Capability=NULL
attribute &#58; nickname = mcguigan (atlas)
timeleft  &#58; 11&#58;50&#58;01
<div id='show_1269115052' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1269115052'>uri       &#58; voms2.cern.ch&#58;15001

I turned up the logging on the system and the only relevant information in /var/log/messages is&#58;
Oct  5 15&#58;26&#58;11 gk06 gridftp-server-llgt[149805]&#58; lcmaps&#58; lcmaps_voms_localaccount-plugin_run()&#58; No match for a VOMS localaccount for any of the FQANs, in /etc/grid-security/voms-mapfile
Oct  5 15&#58;26&#58;11 gk06 gridftp-server-llgt[149805]&#58; lcmaps&#58; lcmaps_voms_localaccount-plugin_run()&#58; voms_localaccount plugin failed

I do know that if I add the &#39;&#34;/atlas.*&#34; usatlas4&#39; line to /etc/grid-security/voms-mapfile I will be mapped to usatlas4 so the mapfile is being consulted.

Is there any settings for logging that will make the lcmaps framework even more verbose and dump the attributes that it seeing?

Do you have a gridftp/CE available where you can modify the atlas mappings to what is above and see if I can test against it?

Thanks,

Patrick

On 10/04/2017 10&#58;22 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_1269115052').click(function() {
            $('#detail_1269115052').slideDown("normal");
            $('#show_1269115052').hide();
            $('#hide_1269115052').show();
        });
        $('#hide_1269115052').click(function() {
            $('#detail_1269115052').slideUp();
            $('#hide_1269115052').hide();
            $('#show_1269115052').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='34867#1507130552'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-04T15:22:32+00:00">Oct 4, 2017 03:22 PM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1507130552">&nbsp;</a></div><pre>OK, great. If you come up with a set of stanzas that you think would be appropriate throughout all ATLAS sites in OSG, send them to us and we can modify voms-mapfile-default.

-Mat</pre></div><div class='update_description'><i onclick="document.location='34867#1507098553'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-04T06:29:13+00:00">Oct 4, 2017 06:29 AM UTC</time> by <b>Patrick McGuigan</b><a class="anchor" name="1507098553">&nbsp;</a></div><pre>Hi Mat,

Thanks for the info.  I&#39;ll play with the idea of separating stanzas between
/etc/grid-security/voms-mapfile and /usr/share/osg/voms-mapfile-default.  I will
also discuss this within US-ATLAS since the default behavior of lcmaps differs
from the default behavior of GUMS for our ATLAS proxies.

Patrick

On 10/03/2017 09&#58;18 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34867#1507040307'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-03T14:18:27+00:00">Oct 3, 2017 02:18 PM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1507040307">&nbsp;</a></div><pre>Also, if you want to map that proxy it to usatlas3 _because of_ the third attrib (/atlas/usatlas/Role=NULL/Capability=NULL), then put the
&#34;/atlas/usatlas/Role=NULL/Capability=NULL&#34; usatlas3
rule in /etc/grid-security/voms-mapfile, but do not put any patterns that match any of the previous attributes -- that is, don&#39;t put
&#34;/atlas/*&#34; usatlas4
in voms-mapfile at all.

_All of_ /etc/grid-security/voms-mapfile gets considered before voms-mapfile-default; voms-mapfile-default is only consulted if _none of your attribs_ match _any of the patterns_ in voms-mapfile.

... at least, that&#39;s how it looks like it works from reading the source -- I haven&#39;t actually tested it since I can&#39;t make a valid cert that looks like yours; that&#39;s one of the downsides to this plugin.

-Mat</pre></div><div class='update_description'><i onclick="document.location='34867#1507039919'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-03T14:11:59+00:00">Oct 3, 2017 02:11 PM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1507039919">&nbsp;</a></div><pre>I see the problem&#58;

Your VOMS attribs are

/atlas/Role=NULL/Capability=NULL
/atlas/lcg1/Role=NULL/Capability=NULL
/atlas/usatlas/Role=NULL/Capability=NULL

The LCMAPS plugin goes through the attribs in order until one of them matches one of the patterns in the voms-mapfile. In this case, &#34;/atlas/Role=NULL/Capability=NULL&#34; matches &#34;/atlas/*&#34; at the bottom of the file, leading it to get mapped to usatlas4. Since that attrib matches, the remaining attribs are not considered.

If you want to map it to usatlas3, you should add a line like
&#34;/atlas/Role=NULL/Capability=NULL&#34; usatlas3
to /etc/grid-security/voms-mapfile since /usr/share/osg/voms-mapfile-default gets overwritten on upgrades of vo-client-lcmaps-voms. voms-mapfile also gets considered before voms-mapfile-default so any entries you put in the former will override what&#39;s in the latter.

-Mat</pre></div><div class='update_description'><i onclick="document.location='34867#1506473026'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-27T00:43:46+00:00">Sep 27, 2017 12:43 AM UTC</time><a class="anchor" name="1506473026">&nbsp;</a></div><pre>Attaching files with .txt extensions

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mcguigan/CN=664979/CN=Patrick Mcguigan</pre></div><div class='update_description'><i onclick="document.location='34867#1506471408'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-27T00:16:48+00:00">Sep 27, 2017 12:16 AM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1506471408">&nbsp;</a></div><pre>Hi Patrick,

If you add a .txt extension to the files, the ticket system will accept them.

-Mat</pre></div><div class='update_description'><i onclick="document.location='34867#1506470946'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-27T00:09:06+00:00">Sep 27, 2017 12:09 AM UTC</time> by <b>Patrick McGuigan</b><a class="anchor" name="1506470946">&nbsp;</a></div><pre>Hi Mat,

I tried to attach these directly in the osg ticketing system, but it would not
take them.  I will see if attaching them to this mail will work.

There is no grid-mapfile.  I copied ban-mapfile as grid-mapfile (in case the
missing file was the issue) and retried my proxy, but it still maps as usatlas4.

The voms-mapfile-default has been stripped down to just the ATLAS entries for now.

Regards,

Patrick

On 09/26/2017 10&#58;37 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34867#1506440266'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-26T15:37:46+00:00">Sep 26, 2017 03:37 PM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1506440266">&nbsp;</a></div><pre>Can you also post any files that are mentioned in /etc/lcmaps.db, such as /etc/grid-security/grid-mapfile? (Except certs and *.mod files, we don&#39;t need those.)

-Mat</pre></div><div class='update_description'><i onclick="document.location='34867#1506367275'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-25T19:21:15+00:00">Sep 25, 2017 07:21 PM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1506367275">&nbsp;</a></div><pre>Hi Patrick,

Can you attach /etc/lcmaps.db?

Thanks,
-Mat</pre></div><div class='update_description'><i onclick="document.location='34867#1506110689'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-22T20:04:49+00:00">Sep 22, 2017 08:04 PM UTC</time> by <b>echism</b><a class="anchor" name="1506110689">&nbsp;</a></div><pre>Mat,

What is happening with this?

Thanks</pre></div><div class='update_description'><i onclick="document.location='34867#1505917744'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-20T14:29:04+00:00">Sep 20, 2017 02:29 PM UTC</time> by <b>echism</b><a class="anchor" name="1505917744">&nbsp;</a></div><pre>Is there any news on this?

Thanks</pre></div><div class='update_description'><i onclick="document.location='34867#1505743719'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-18T14:08:39+00:00">Sep 18, 2017 02:08 PM UTC</time> by <b>echism</b><a class="anchor" name="1505743719">&nbsp;</a></div><pre>Is there any news on this?

Thanks</pre></div><div class='update_description'><i onclick="document.location='34867#1505164598'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-11T21:16:38+00:00">Sep 11, 2017 09:16 PM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1505164598">&nbsp;</a></div><pre>Sure, I can do that.</pre></div><div class='update_description'><i onclick="document.location='34867#1505156932'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-11T19:08:52+00:00">Sep 11, 2017 07:08 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1505156932">&nbsp;</a></div><pre>Mat, can you take a look at this?

Thanks,
Brian</pre></div><div class='update_description'><i onclick="document.location='34867#1504899594'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-08T19:39:54+00:00">Sep 8, 2017 07:39 PM UTC</time> by <b>echism</b><a class="anchor" name="1504899594">&nbsp;</a></div><pre>Software,

Has this ticket been assigned?

Thanks</pre></div><div class='update_description'><i onclick="document.location='34867#1504719022'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-06T17:30:22+00:00">Sep 6, 2017 05:30 PM UTC</time> by <b>echism</b><a class="anchor" name="1504719022">&nbsp;</a></div><pre>I&#39;m sending this to software. Sorry, I was out yesterday.</pre></div><div class='update_description'><i onclick="document.location='34867#1504647748'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-09-05T21:42:28+00:00">Sep 5, 2017 09:42 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1504647748">&nbsp;</a></div><pre>Hi,

I am trying to install a new machine that provides only a gridftp server (based on xrootd).  I am trying to use OSG 3.4, as a test, to gain familiarity with lcmaps and the retirement of GUMS based authentications.  I am having issues with how the system is mapping proxies for the ATLAS VO.

If I generate this proxy&#58;
[mcguigan@gk01 ~]$ voms-proxy-info -fqan
/atlas/Role=NULL/Capability=NULL
/atlas/lcg1/Role=NULL/Capability=NULL
/atlas/usatlas/Role=NULL/Capability=NULL
[mcguigan@gk01 ~]$ voms-proxy-info -all
subject   &#58; /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mcguigan/CN=664979/CN=Patrick Mcguigan/CN=proxy
issuer    &#58; /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mcguigan/CN=664979/CN=Patrick Mcguigan
identity  &#58; /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mcguigan/CN=664979/CN=Patrick Mcguigan
type      &#58; proxy
strength  &#58; 1024 bits
path      &#58; /tmp/x509up_u501
timeleft  &#58; 11&#58;57&#58;35
key usage &#58; Digital Signature, Key Encipherment
=== VO atlas extension information ===
VO        &#58; atlas
subject   &#58; /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mcguigan/CN=664979/CN=Patrick Mcguigan
issuer    &#58; /DC=ch/DC=cern/OU=computers/CN=voms2.cern.ch
attribute &#58; /atlas/Role=NULL/Capability=NULL
attribute &#58; /atlas/lcg1/Role=NULL/Capability=NULL
attribute &#58; /atlas/usatlas/Role=NULL/Capability=NULL
attribute &#58; nickname = mcguigan (atlas)
timeleft  &#58; 11&#58;57&#58;34
uri       &#58; voms2.cern.ch&#58;15001

I expect it to be mapped to usatlas3 on the new griddftp server, but it is always mapping to usatlas4.  Worse, when I add a specific line to voms map file to force this to usatlas3, it seems to be ignored.  For testing purposes, the current contents of /usr/share/osg/voms-mapfile-default are&#58;

&#34;/atlas/usatlas/Role=NULL/Capability=NULL&#34; usatlas3
&#34;/atlas/Role=production/Capability=NULL&#34; usatlas1
&#34;/atlas/usatlas/Role=production/Capability=NULL&#34; usatlas1
&#34;/atlas/usatlas/Role=lcgadmin/Capability=NULL&#34; usatlas2
<div id='show_417164879' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_417164879'>&#34;/atlas/usatlas/Role=software/Capability=NULL&#34; usatlas2
&#34;/atlas/usatlas/*&#34; usatlas3
&#34;/atlas/usatlas/Role=NULL/Capability=NULL&#34; usatlas3

How can this be debugged further?

An additional problem is that the stanza in the mapfile for the ATLAS VO are probably incomplete, but that can wait.

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mcguigan/CN=664979/CN=Patrick Mcguigan
</div><script type='text/javascript'>
        $('#show_417164879').click(function() {
            $('#detail_417164879').slideDown("normal");
            $('#show_417164879').hide();
            $('#hide_417164879').show();
        });
        $('#hide_417164879').click(function() {
            $('#detail_417164879').slideUp();
            $('#hide_417164879').hide();
            $('#show_417164879').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F34867">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 34867});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
