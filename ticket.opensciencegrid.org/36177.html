<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[36177] Transitioning UPRM to LCMAPS VOMS authentication</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=36177" method="post">
<div class="page-header">
    <h3><span class="muted">36177</span> / Transitioning UPRM to LCMAPS VOMS authentication</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Brian Lin</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Resource Name</label><div class="controls">uprm-cms-gums</div></div><div class="control-group"><label class="control-label">Associated VO</label><div class="controls">CMS</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Brian Lin</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">USCMS_Tier3</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Scheduling transition</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2018-03-15</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Sarah Schmiechen <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">Sarah Schmiechen <span class="muted"> / OSG Operations Infrastructure</span></div><div class="assignee" style="width: 60%">USCMS_Tier3 <span class="muted"> / OSG Support Centers</span></div><div class="assignee" style="width: 60%">Suchandra Thapa <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/36177", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/36177?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/36177?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Transitioning%20UPRM%20to%20LCMAPS%20VOMS%20authentication%20ISSUE%3D36177%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='36177#1520875322'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-03-12T17:22:02+00:00">Mar 12, 2018 05:22 PM UTC</time> by <b>Suchandra Thapa</b><a class="anchor" name="1520875322">&nbsp;</a></div><pre>Hi Eduardo,

The proxy from osg-flock should be signed correctly and work since I believe it&#39;s being used successfully elsewhere.  However, if it&#39;s working successfully on your site with a manual mapping, I think that&#39;s good enough.

Closing the ticket per your last comment.

Suchandra</pre></div><div class='update_description'><i onclick="document.location='36177#1520873232'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-03-12T16:47:12+00:00">Mar 12, 2018 04:47 PM UTC</time> by <b>juaneduardo.ramirez@....</b><a class="anchor" name="1520873232">&nbsp;</a></div><pre>Hi Suchandra,
My current lcmaps configuration is to use voms (instead of gums).
This is policy 3.
## Policy 3&#58; voms-mapfiles with banfiles, proxy verification and
grid-mapfile
verifyproxynokey -&#62; banfile
banfile -&#62; banvomsfile | bad
banvomsfile -&#62; gridmapfile | bad
gridmapfile -&#62; good | vomsmapfile
vomsmapfile -&#62; good | defaultmapfile
defaultmapfile -&#62; good | bad

In migrating to voms, Brian Lin help me to find why lcmaps was failing to
authtenticate some cases.
In tracking down who was the DN rejected, it ended on this dn
&#34;/DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=pilot/
osg-flock.grid.iu.edu&#34;

Once I added explicitly in my grid-mapfile it was mapped again.
My guessing is that that DN is missing the voms extension. (From the
extract of the log below).

Today, it is working fine. I removed from my grid-mapfile and is mapping to
osg as it should be.

Regards,
Eduardo

PS.I guess now this ticket is completly solved. Can be closed if you want.

...
Warning&#58; VOMS Signature error making it an unverifiable VOMS extension
...

On Mon, Mar 12, 2018 at 12&#58;06 PM, Open Science Grid FootPrints &#60;
<div id='show_305234469' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_305234469'>osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_305234469').click(function() {
            $('#detail_305234469').slideDown("normal");
            $('#show_305234469').hide();
            $('#hide_305234469').show();
        });
        $('#hide_305234469').click(function() {
            $('#detail_305234469').slideUp();
            $('#hide_305234469').hide();
            $('#show_305234469').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='36177#1520870805'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-03-12T16:06:45+00:00">Mar 12, 2018 04:06 PM UTC</time> by <b>Suchandra Thapa</b><a class="anchor" name="1520870805">&nbsp;</a></div><pre>Hi Eduardo,

That DN should be mapped to the OSG vo automatically.  What&#39;s your current lcmaps configuration?

Suchandra</pre></div><div class='update_description'><i onclick="document.location='36177#1520456533'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-03-07T21:02:13+00:00">Mar 7, 2018 09:02 PM UTC</time> by <b>juaneduardo.ramirez@....</b><a class="anchor" name="1520456533">&nbsp;</a></div><pre>Brian,
Finally am able to see why LCMAPS failed.
It turned out that setting &#34;LCMAPS_DEBUG_LEVEL=5&#34; in
/etc/sysconfig/condor-ce
send to much information, that rsyslog drop it.

Mar  4 03&#58;30&#58;40 cms-grid0 rsyslogd-2177&#58; imuxsock lost 229 messages from
pid 3753858 due to rate-limiting
Mar  4 03&#58;30&#58;40 cms-grid0 rsyslogd-2177&#58; imuxsock begins to drop messages
from pid 3753858 due to rate-limiting

For reference I reconfigured rsyslog by dropping a file into /etc/rsyslog.d
like this
<font color='#7F7E6F'>&#62;cat /etc/rsyslog.d/ratelimiting.conf</font>
*.* /var/log/everything.log
$SystemLogRateLimitInterval 5
$SystemLogRateLimitBurst 2000

After this, I found in syslog [1] the failed authentication is from
osg-flock cert. (opportunistic!?).
gums used to be mapped to osg. Now it does not map at at all.
Temporarily, I am adding to gridmap as uscms1000.
Could you confirm this is the opportunistic osg pilot? so I can remap to
osg again.
Should not this get mapped with voms directly?

Eduardo

[1].../var/log/message
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58;
lcmaps_x509_to_voms_fqan
s()&#58; Warning&#58; VOMS Signature error making it an unverifiable VOMS
extension&#58; Can
not verify AC signature!. Hint&#58; check the VOMS directory (default&#58;
/etc/grid-security/vomsdir/) and the .lsc files. Also you could fall back
<div id='show_2101042438' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_2101042438'>on using installed
VOMS host certificates. If the problem persists, contact the user. LCMAPS
will ignore the VOMS extensions in the mapping sequence.
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58;
lcmaps_credential_store_x509_and_sub_elements&#58; No VOMS FQANs found in X509
credentials
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; Starting policy&#58;
authorize_only
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; verify_log&#58; Unable
to get CRL at depth 0.
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; verify_log&#58; Cert at
depth 2 is a root CA&#58; &#34;/DC=org/DC=cilogon/C=US/O=CILogon/CN=CILogon OSG CA
1&#34;
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; verify_log&#58;    Key
strength&#58; 2048
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; verify_log&#58; Cert at
depth 1 is an EEC&#58; &#34;/DC=org/DC=opensciencegrid/O=Open Science
Grid/OU=Services/CN=pilot/osg-flock.grid.iu.edu&#34;
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; verify_log&#58;
signature algorithm&#58; sha256WithRSAEncryption (=1.2.840.113549.1.1.11)
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; verify_log&#58;    Key
strength&#58; 2048
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; verify_log&#58;    CA
hash&#58; 70d35895, serial&#58; 0100006888
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; verify_log&#58;
subjAltName dNSName&#58; osg-flock.grid.iu.edu
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; verify_log&#58;
subjAltName rfc822Name&#58; thomlee@....
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; verify_log&#58;
policy OID&#58; 1.3.6.1.4.1.34998.1.6.2
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; verify_log&#58;
policy OID&#58; 1.2.840.113612.5.2.2.1
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; verify_log&#58; Cert at
depth 0 (proxylevel 0) is a VOMS GT2/old-style Proxy&#58;
&#34;/DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=pilot/
osg-flock.grid.iu.edu/CN=proxy&#34;
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; verify_log&#58;
signature algorithm&#58; sha256WithRSAEncryption (=1.2.840.113549.1.1.11)
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; verify_log&#58;    Key
strength&#58; 1024
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; verify_log&#58; The
verification of the certificate has succeeded.
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; verify_log&#58;
Verification of chain without private key is OK
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58;
lcmaps_plugin_verify_proxy-plugin_run()&#58; verify proxy plugin succeeded
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58;
lcmaps_ban_dn-plugin_run()&#58; ban_dn plugin succeeded
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58;
lcmaps_ban_fqan-plugin_run()&#58; no (valid) VOMS groups found --&#62; no mapping
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58;
lcmaps_ban_fqan-plugin_run()&#58; ban_fqan plugin succeeded
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58;
lcmaps_localaccount-plugin_run()&#58; No match for a localaccount for user
&#34;/DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=pilot/
osg-flock.grid.iu.edu&#34;, in /etc/grid-security/grid-mapfile
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58;
lcmaps_localaccount-plugin_run()&#58; localaccount plugin failed
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58;
lcmaps_voms_localaccount-plugin_run()&#58; no (valid) VOMS groups found --&#62; no
mapping
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58;
lcmaps_voms_localaccount-plugin_run()&#58; voms_localaccount plugin failed
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58;
lcmaps_voms_localaccount-plugin_run()&#58; no (valid) VOMS groups found --&#62; no
mapping
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58;
lcmaps_voms_localaccount-plugin_run()&#58; voms_localaccount plugin failed
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58;
lcmaps_dummy_bad-plugin_run()&#58; bad plugin successfully failed by design
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; LCMAPS CRED FINAL&#58;
DN&#58;&#34;/DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=pilot/
osg-flock.grid.iu.edu&#34;
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; Warning&#58; failed mapping.
LCMAPS returned&#58; 1
Mar  7 15&#58;51&#58;50 cms-grid0 htcondor-ce[3753858]&#58; Execution of LCMAPS failed.
...

On Thu, Mar 1, 2018 at 4&#58;29 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_2101042438').click(function() {
            $('#detail_2101042438').slideDown("normal");
            $('#show_2101042438').hide();
            $('#hide_2101042438').show();
        });
        $('#hide_2101042438').click(function() {
            $('#detail_2101042438').slideUp();
            $('#hide_2101042438').hide();
            $('#show_2101042438').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='36177#1519936157'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-03-01T20:29:17+00:00">Mar 1, 2018 08:29 PM UTC</time> by <b>juaneduardo.ramirez@....</b><a class="anchor" name="1519936157">&nbsp;</a></div><pre>Brian,
Thanks for the link.
It help me to get rid of messages like this&#58;
Mar  1 14&#58;41&#58;05 cms-grid0 htcondor-ce[3216637]&#58; lcmaps&#58;
lcmaps_voms_localaccount-plugin_run()&#58; VOMS plugin requested
but VOMS validation is not enabled.  This is an insecure combination;
failing plugin
Mar  1 14&#58;41&#58;05 cms-grid0 htcondor-ce[3216637]&#58; lcmaps&#58;
lcmaps_voms_localaccount-plugin_run()&#58; VOMS plugin requested
but VOMS validation is not enabled.  This is an insecure combination;
failing plugin
Mar  1 14&#58;41&#58;05 cms-grid0 htcondor-ce[3216637]&#58; Warning&#58; failed mapping.
LCMAPS returned&#58; 1
Mar  1 14&#58;41&#58;05 cms-grid0 htcondor-ce[3216637]&#58; Execution of LCMAPS failed.

by setting
export LLGT_VOMS_ENABLE_CREDENTIAL_CHECK=1
on /etc/sysconfig/condor-ce

also commented policy glexec&#58; on /etc/lcmaps.db to get rid of this.
Mar  1 15&#58;02&#58;24 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58;
/etc/lcmaps.db&#58;161&#58; [warning] expecting rule definitions.
Mar  1 15&#58;02&#58;24 cms-grid0 htcondor-ce[3753858]&#58; lcmaps&#58; /etc/lcmaps.db&#58;161&#58;
[warning] no rules specified for policy&#58;
&#39;glexec&#39; at line 149.

However the &#39;export LCMAPS_DEBUG_LEVEL=5&#39; in /etc/sysconfig/condor-ce does
not show more information, as wanted (see below). But at least I know  the
ip 129.79.53.24 comes from glidein-itb.grid.iu.edu, which is a test server.
Maybe is ok to fail auth!? osg and cms authtenticate fine.

In any case, my CE is already migrated to lcmaps voms. gridftps are already
using lcmaps voms too. Is a matter of turning bestman off to get rid of
gums completely.
Give me a week before closing this ticket. (To check the evolution of the
<div id='show_1074848471' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1074848471'>changes).

Thanks,
Eduardo
-------------------
03/01/18 16&#58;05&#58;15 DC_AUTHENTICATE&#58; authentication of &#60;129.79.53.24&#58;33039&#62;
did not result in a valid mapped user name,
which is required for this command (1112 QMGMT_WRITE_CMD), so aborting.
03/01/18 16&#58;05&#58;21 Command=QMGMT_WRITE_CMD, peer=&#60;169.228.38.36&#58;30260&#62;
03/01/18 16&#58;05&#58;21 AuthMethod=GSI,
AuthId=/DC=ch/DC=cern/OU=computers/CN=cmspilot02/vocms080.cern.ch,/cms/Role=pilot/Capability=NULL,/cms/Role=NULL/Capability=NULL,/cms/dcms/Role=NULL/Capability=NULL,/cms/escms/Role=NULL/Capability=NULL,/cms/itcms/Role=NULL/Capability=NULL,/cms/local/Role=NULL/Capability=NULL,/cms/uscms/Role=NULL/Capability=NULL,
CondorId=uscms3183@....
03/01/18 16&#58;05&#58;21 Number of Active Workers 0
03/01/18 16&#58;05&#58;21 Command=QMGMT_WRITE_CMD, peer=&#60;188.184.86.176&#58;27208&#62;
03/01/18 16&#58;05&#58;21 AuthMethod=GSI,
AuthId=/DC=ch/DC=cern/OU=computers/CN=cmspilot02/vocms080.cern.ch,/cms/Role=pilot/Capability=NULL,/cms/Role=NULL/Capability=NULL,/cms/dcms/Role=NULL/Capability=NULL,/cms/escms/Role=NULL/Capability=NULL,/cms/itcms/Role=NULL/Capability=NULL,/cms/local/Role=NULL/Capability=NULL,/cms/uscms/Role=NULL/Capability=NULL,
CondorId=uscms3183@....
03/01/18 16&#58;05&#58;21 DC_AUTHENTICATE&#58; authentication of &#60;129.79.53.24&#58;1393&#62;
did not result in a valid mapped user name, which is required for this
command (1112 QMGMT_WRITE_CMD), so aborting.
03/01/18 16&#58;05&#58;21 Number of Active Workers 0
03/01/18 16&#58;05&#58;29 Number of Active Workers 0

On Thu, Mar 1, 2018 at 1&#58;23 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_1074848471').click(function() {
            $('#detail_1074848471').slideDown("normal");
            $('#show_1074848471').hide();
            $('#hide_1074848471').show();
        });
        $('#hide_1074848471').click(function() {
            $('#detail_1074848471').slideUp();
            $('#hide_1074848471').hide();
            $('#show_1074848471').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='36177#1519924996'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-03-01T17:23:16+00:00">Mar 1, 2018 05:23 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1519924996">&nbsp;</a></div><pre>Eduardo,

You can check out auth mapping failures using these instructions&#58;
<a href='http&#58;//opensciencegrid.github.io/docs/security/lcmaps-voms-authentication/#troubleshooting-the-lcmaps-voms-plugin' target='_blank' rel='nofollow'>http&#58;//opensciencegrid.github.io/docs/security/lcmaps-voms-authentication/#troubleshooting-the-lcmaps-voms-plugin</a>

- Brian</pre></div><div class='update_description'><i onclick="document.location='36177#1519923376'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-03-01T16:56:16+00:00">Mar 1, 2018 04:56 PM UTC</time> by <b>juaneduardo.ramirez@....</b><a class="anchor" name="1519923376">&nbsp;</a></div><pre>Hi Sara,
I am almost done with  it.
I think, I migrated the CE and gridftps. It does not matter on nodes, but I
need to adjust accordingly just in case.

At this point my SE(bestman) is the &#34;only one&#34; needing gums, Right now, I
am working/testing
my storage.xml phedex configuration before retiring bestman and declare
full migration no lcmaps voms.

On the other hand, I noted in my CE (condor-ce SchedLog)
messages like this
03/01/18 12&#58;46&#58;40 DC_AUTHENTICATE&#58; authentication of &#60;169.228.38.36&#58;16179&#62;
did not result in a valid mapped user name
, which is required for this command (1112 QMGMT_WRITE_CMD), so aborting.

I wonder, If I am missing some mapping here. Is there a way to check
further, who is trying to get in?(ie. grid id who missed authentication?)

Regards,
Eduardo</pre></div><div class='update_description'><i onclick="document.location='36177#1519910055'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-03-01T13:14:15+00:00">Mar 1, 2018 01:14 PM UTC</time> by <b>Sarah Schmiechen</b><a class="anchor" name="1519910055">&nbsp;</a></div><pre>Hello,

Any updates on this?

Thanks,
Sarah</pre></div><div class='update_description'><i onclick="document.location='36177#1519046087'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-02-19T13:14:47+00:00">Feb 19, 2018 01:14 PM UTC</time> by <b>Sarah Schmiechen</b><a class="anchor" name="1519046087">&nbsp;</a></div><pre>Pushing out NAD to March.</pre></div><div class='update_description'><i onclick="document.location='36177#1518811756'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-02-16T20:09:16+00:00">Feb 16, 2018 08:09 PM UTC</time> by <b>juaneduardo.ramirez@....</b><a class="anchor" name="1518811756">&nbsp;</a></div><pre>I have gums.
So two months then.

Thanks
Eduardo

On Fri, Feb 16, 2018 at 3&#58;53 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='36177#1518810782'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-02-16T19:53:02+00:00">Feb 16, 2018 07:53 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1518810782">&nbsp;</a></div><pre>Eduardo,

Doug is correct unless you&#39;re using edg-mkgridmap. In that case you&#39;ll have to follow the transition instructions and I would schedule that to be done by mid-March at the latest. If you update your GUMS, you can delay the full transition but keep in mind that we are retiring GUMS in the OSG at the end of May 2018 (<a href='https&#58;//opensciencegrid.github.io/technology/policy/gums-retire/' target='_blank' rel='nofollow'>https&#58;//opensciencegrid.github.io/technology/policy/gums-retire/</a>).

Thanks,
Brian</pre></div><div class='update_description'><i onclick="document.location='36177#1518807431'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-02-16T18:57:11+00:00">Feb 16, 2018 06:57 PM UTC</time> by <b>douglas.johnson@....</b><a class="anchor" name="1518807431">&nbsp;</a></div><pre>Hi Eduardo,

My understanding is that no one knows when or if CERN will start blocking
VOMS Admin traffic. It could be as soon as March or as late as ???

Please notice the last paragraph of the ticket&#58;

If you are unable to update your GUMS server at this time, you need to
update the lcmaps package (latest OSG 3.3 version is 1.6.6-1.9) for all
clients of your GUMS server (HTCondor-CE, GridFTP, XRootD, dCache, or
BeStMan hosts). This causes lcmaps to perform VOMS attribute verification
instead of GUMS. Note&#58; as VOMS Admin servers are retired, errors will
appear in GUMS when VO member lists are updated. This is OK if you have
updated lcmaps on your clients.

In other words, apply all the latest OSG patches and &#34;should&#34; be able to
avoid the problem.

I hope all is well,
doug

On Fri, Feb 16, 2018 at 7&#58;54 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='36177#1518803651'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-02-16T17:54:11+00:00">Feb 16, 2018 05:54 PM UTC</time> by <b>juaneduardo.ramirez@....</b><a class="anchor" name="1518803651">&nbsp;</a></div><pre>Hi
What is the time frame to perform the migration?
days, months? I mean when is the deadline?

Thanks,
Eduardo

On Fri, Feb 16, 2018 at 1&#58;32 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='36177#1518802326'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2018-02-16T17:32:06+00:00">Feb 16, 2018 05:32 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1518802326">&nbsp;</a></div><pre>As part of the VOMS Admin server retirement (<a href='https&#58;//opensciencegrid.github.io/technology/policy/voms-admin-retire/' target='_blank' rel='nofollow'>https&#58;//opensciencegrid.github.io/technology/policy/voms-admin-retire/</a>), we are encouraging sites using edg-mkgridmap or GUMS to make the transition to LCMAPS VOMS Admin (<a href='http&#58;//opensciencegrid.github.io/docs/security/lcmaps-voms-authentication/' target='_blank' rel='nofollow'>http&#58;//opensciencegrid.github.io/docs/security/lcmaps-voms-authentication/</a>). If you are receiving this e-mail, we&#39;ve identified the following hosts at your site querying VOMS Admin servers in the OSG&#58;

- /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=Services/CN=http/cms-squid0.hep.uprm.edu

For edg-mkgridmap users, you can find specific instructions here&#58;
<a href='http&#58;//opensciencegrid.github.io/docs/security/lcmaps-voms-authentication/#migrating-from-edg-mkgridmap.' target='_blank' rel='nofollow'>http&#58;//opensciencegrid.github.io/docs/security/lcmaps-voms-authentication/#migrating-from-edg-mkgridmap.</a>

For GUMS users, you can find specific instructions here&#58;
<a href='http&#58;//opensciencegrid.github.io/docs/security/lcmaps-voms-authentication/#migrating-from-gums' target='_blank' rel='nofollow'>http&#58;//opensciencegrid.github.io/docs/security/lcmaps-voms-authentication/#migrating-from-gums</a>

If you are unable to update your GUMS server at this time, you need to update the lcmaps package (latest OSG 3.3 version is 1.6.6-1.9) for all clients of your GUMS server (HTCondor-CE, GridFTP, XRootD, dCache, or BeStMan hosts). This causes lcmaps to perform VOMS attribute verification instead of GUMS. Note&#58; as VOMS Admin servers are retired, errors will appear in GUMS when VO member lists are updated. This is OK if you have updated lcmaps on your clients.</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F36177">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
