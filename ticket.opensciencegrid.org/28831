<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[28831] Moving T2_US_MIT to multicore</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=28831" method="post">
<div class="page-header">
    <h3><span class="muted">28831</span> / Moving T2_US_MIT to multicore</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Antonio Perez-Calero</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Associated VO</label><div class="controls">CMS</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GGUS</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Antonio Perez-Calero Yzquierdo</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">USCMS_Tier2</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Elevated</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Max to update</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2016-04-17</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Kyle Gross <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">USCMS Tier 2 <span class="muted"> / OSG Support Centers</span></div><div class="assignee" style="width: 60%">GGUS (Prod)&nbsp;<a target="_blank" href="https://ggus.eu/ws/ticket_info.php?ticket=120100">120100</a> <span class="muted"> / Ticket Exchange</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/28831", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/28831?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/28831?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Moving%20T2_US_MIT%20to%20multicore%20ISSUE%3D28831%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='28831#1460747122'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-04-15T19:05:22+00:00">Apr 15, 2016 07:05 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1460747122">&nbsp;</a></div><pre>-- by Antonio Perez-Calero Yzquierdo at Thu Apr 14 10&#58;11&#58;44 UTC 2016

Thanks Marty.

-- by Antonio Perez-Calero Yzquierdo at Thu Apr 14 10&#58;11&#58;33 UTC 2016

Antonio, Max,

We&#39;ve reverted the GLIDEIN_Max_Walltime to 48 horus as requested. Closing ticket as requested.

Marty Kandes
UCSD Glidein Factory Operationsall requested changes complete; site has been converted for multicore glideins submission only

-- by Marty Kandes at Wed Apr 13 19&#58;08&#58;47 UTC 2016

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a></pre></div><div class='update_description'><i onclick="document.location='28831#1460555532'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-04-13T13:52:12+00:00">Apr 13, 2016 01:52 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1460555532">&nbsp;</a></div><pre>Let&#39;s please conclude and close this ticket asap.

-- by Antonio Perez-Calero Yzquierdo at Wed Apr 13 08&#58;14&#58;20 UTC 2016

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a></pre></div><div class='update_description'><i onclick="document.location='28831#1460555483'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-04-13T13:51:23+00:00">Apr 13, 2016 01:51 PM UTC</time><a class="anchor" name="1460555483">&nbsp;</a></div><pre>We keep it at 48 hours.

-Max

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=maxi/CN=682514/CN=Maxim Goncharov</pre></div><div class='update_description'><i onclick="document.location='28831#1460492921'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-04-12T20:28:41+00:00">Apr 12, 2016 08:28 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1460492921">&nbsp;</a></div><pre>Hi Max,

Do you what would you like set for max walltime?

Thanks,
Chris</pre></div><div class='update_description'><i onclick="document.location='28831#1459886574'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-04-05T20:02:54+00:00">Apr 5, 2016 08:02 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1459886574">&nbsp;</a></div><pre>Sorry Max,

Typo, as we&#39;ve been communicating with all the T2&#39;s.  I meant MIT.

What would you like set for max walltime is 60h ok, or do you prefer back to what you had, 48h?

Thanks,
Jeff

-- by Jeffrey Dost at Tue Apr 05 14&#58;33&#58;45 UTC 2016

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a></pre></div><div class='update_description'><i onclick="document.location='28831#1459865806'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-04-05T14:16:46+00:00">Apr 5, 2016 02:16 PM UTC</time><a class="anchor" name="1459865806">&nbsp;</a></div><pre>I am confused. What does Caltech have to do with our site?

-Max

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=maxi/CN=682514/CN=Maxim Goncharov</pre></div><div class='update_description'><i onclick="document.location='28831#1459790590'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-04-04T17:23:10+00:00">Apr 4, 2016 05:23 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1459790590">&nbsp;</a></div><pre>Hi Max,

Please see Marty&#39;s update#12. It appears that CMS increased the max walltime of the glideins at Caltech to 216000 (60h) without first communicating it to you. The single core entries were set to 48h. I&#39;d just like to be sure you are ok with this change before closing the ticket out.

Thanks,
Jeff Dost
OSG Glidein Factory Operations

-- by Jeffrey Dost at Mon Apr 04 03&#58;05&#58;08 UTC 2016

Hi Marty,

The configuration seems to be correct, and we are ramping up mcore consistently over the last 24 hours, right now at about 2400 cores.

I&#39;d say we are done here, I&#39;m keeping the ticket open for 24h more just in case we see any issues, then close it.

Cheers,

Antonio.

-- by Antonio Perez-Calero Yzquierdo at Thu Mar 31 23&#58;25&#58;32 UTC 2016

Antonio,

Did you still need us to try and prune any idle / held single core glideins? Or has multicore already ramped up sufficiently for you?

Marty Kandes
UCSD Glidein Factory Operations

-- by Marty Kandes at Thu Mar 31 23&#58;01&#58;18 UTC 2016

Thanks, Marty.

-- by Antonio Perez-Calero Yzquierdo at Thu Mar 31 02&#58;33&#58;28 UTC 2016

<div id='show_1088331958' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1088331958'>GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a>
</div><script type='text/javascript'>
        $('#show_1088331958').click(function() {
            $('#detail_1088331958').slideDown("normal");
            $('#show_1088331958').hide();
            $('#hide_1088331958').show();
        });
        $('#hide_1088331958').click(function() {
            $('#detail_1088331958').slideUp();
            $('#hide_1088331958').hide();
            $('#show_1088331958').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='28831#1459790576'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-04-04T17:22:56+00:00">Apr 4, 2016 05:22 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1459790576">&nbsp;</a></div><pre>Update to try and synchronize these tickets.</pre></div><div class='update_description'><i onclick="document.location='28831#1459389888'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-31T02:04:48+00:00">Mar 31, 2016 02:04 AM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1459389888">&nbsp;</a></div><pre>Antonio, Max, Vassil,

I&#39;ve disabled the final single core entry, CMS_T2_US_MIT_ce03, across all production factories.

Marty Kandes
UCSD Glidein Factory Operations

-- by Marty Kandes at Wed Mar 30 18&#58;24&#58;17 UTC 2016

Thanks Vassil for the update.

As Max commented, now all the nodes should be accessible to mcore pilots. So let&#39;s go ahead and disable single core completely at MIT.

Cheers,

Antonio.

-- by Antonio Perez-Calero Yzquierdo at Wed Mar 30 17&#58;49&#58;58 UTC 2016

Hi Max, Antonio,

I changed the maxMemory submit_attr from 20240 to 16000. Now the pilots should request ~ 2Gb/core.

Regards,
Vassil

-- by Vassil Verguilov at Wed Mar 30 14&#58;07&#58;09 UTC 2016

Thanks Max, we&#39;ll check,

Antonio.

-- by Antonio Perez-Calero Yzquierdo at Wed Mar 30 13&#58;53&#58;54 UTC 2016

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a></pre></div><div class='update_description'><i onclick="document.location='28831#1459345571'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-30T13:46:11+00:00">Mar 30, 2016 01:46 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1459345571">&nbsp;</a></div><pre>Thanks Vassil,

Let&#39;s see if we can increase the fraction of resources we take in mcore mode at MIT. Right now, we have about 2k cores&#58;

253 T2_US_MIT Partitionable CMSHTPC_T2_US_MIT_ce01
1345 T2_US_MIT Static CMS_T2_US_MIT_ce01
1483 T2_US_MIT Static CMS_T2_US_MIT_ce02
1632 T2_US_MIT Static CMS_T2_US_MIT_ce03

Cheers,

Antonio.

-- by Antonio Perez-Calero Yzquierdo at Wed Mar 30 12&#58;27&#58;00 UTC 2016

Hi Antonio, Max,

I disabled the single core entries CMS_T2_US_MIT_ce01 and CMS_T2_US_MIT_ce02 and created two multicore entries&#58;
CMSHTPC_T2_US_MIT_ce01 and CMSHTPC_T2_US_MIT_ce02.
These updates are valid for CERN, GOC and SDSC production factories.

Vassil

-- by Vassil Verguilov at Wed Mar 30 12&#58;20&#58;52 UTC 2016

Hi Max,

I don&#39;t understand your question. My point on update#20 was to understand if the machines at MIT have been moved to partitionable slots or not, and if the issue mentioned by Brian had been solved.

We are currently using about 2k cores in multicore.

Factory Ops team,

a) can you please setup multicore entries for the ce02 and ce03 CEs, then add them to the production factories?

<div id='show_1987917997' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1987917997'>b) Also, let&#39;s start disabling single core. Can we please disable
CMS_T2_US_MIT_ce01
CMS_T2_US_MIT_ce02

Let&#39;s keep one single core entry (CMS_T2_US_MIT_ce03) still for a while.

Thanks,

Antonio.

-- by Antonio Perez-Calero Yzquierdo at Wed Mar 30 05&#58;06&#58;02 UTC 2016

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a>
</div><script type='text/javascript'>
        $('#show_1987917997').click(function() {
            $('#detail_1987917997').slideDown("normal");
            $('#show_1987917997').hide();
            $('#hide_1987917997').show();
        });
        $('#hide_1987917997').click(function() {
            $('#detail_1987917997').slideUp();
            $('#hide_1987917997').hide();
            $('#show_1987917997').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='28831#1459345504'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-30T13:45:04+00:00">Mar 30, 2016 01:45 PM UTC</time><a class="anchor" name="1459345504">&nbsp;</a></div><pre>Now all worker nodes are setup for multicore jobs.

However, I think something is not right as I see 8 core jobs asking for 20352 GB memory.
It is even more memory per core than what CMS is asking for single core jobs (2048). The whole idea behind multicore
is to oversubscribe memory, not undersubscribe it, no?

-Max

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=maxi/CN=682514/CN=Maxim Goncharov</pre></div><div class='update_description'><i onclick="document.location='28831#1459258870'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-29T13:41:10+00:00">Mar 29, 2016 01:41 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1459258870">&nbsp;</a></div><pre>Thanks Brian.

As we want most/all of the resources at MIT to be accessed in multicore mode, Max, could you please setup partitionable slots for all the machines?

Thanks,

Antonio.

-- by Antonio Perez-Calero Yzquierdo at Tue Mar 29 01&#58;13&#58;51 UTC 2016

Hi Max,

Still some work from the site side - you still have multicore pilots running in single core slots.  You can see this here&#58;

$ condor_q -name ce01.cmsaf.mit.edu -const &#39;RequestCpus &#62; 1 && !regexp(&#34;slot1@&#34;, RemoteHost)&#39; -run | wc -l
721

That adds an extra 5000 cores to the site - probably not what you mean to.

To fix this, you can either move the rest of the cluster to partitionable slots or you can add (TARGET.RequestCpus =?= 1) to the START expression of your static slots / single core entries.

-- by Brian Bockelman at Tue Mar 29 01&#58;03&#58;09 UTC 2016

Ticket has been tagged &#34;VO specific&#34;.
Thanks for the details, Max,

We are right now running

multicore pilots&#58;
785 T2_US_MIT Partitionable CMSHTPC_T2_US_MIT_ce01

single core&#58;
658 T2_US_MIT Static CMS_T2_US_MIT_ce01
600 T2_US_MIT Static CMS_T2_US_MIT_ce02
649 T2_US_MIT Static CMS_T2_US_MIT_ce03
<div id='show_1744696543' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1744696543'>
Factory Ops team, can you please add the setup the ce02 and ce03 multicore entries for MIT in the production factories?

Thanks,

Antonio.

-- by Antonio Perez-Calero Yzquierdo at Mon Mar 28 23&#58;06&#58;39 UTC 2016

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a>
</div><script type='text/javascript'>
        $('#show_1744696543').click(function() {
            $('#detail_1744696543').slideDown("normal");
            $('#show_1744696543').hide();
            $('#hide_1744696543').show();
        });
        $('#hide_1744696543').click(function() {
            $('#detail_1744696543').slideUp();
            $('#hide_1744696543').hide();
            $('#show_1744696543').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='28831#1459258848'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-29T13:40:48+00:00">Mar 29, 2016 01:40 PM UTC</time><a class="anchor" name="1459258848">&nbsp;</a></div><pre>I see that the updates coming in GGUS ticket but they are not reflected here, what is happening?

-Max

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=maxi/CN=682514/CN=Maxim Goncharov</pre></div><div class='update_description'><i onclick="document.location='28831#1459178497'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-28T15:21:37+00:00">Mar 28, 2016 03:21 PM UTC</time><a class="anchor" name="1459178497">&nbsp;</a></div><pre>Hi, I think we are ready to receive multicore jobs.
What is the command that would show me which worker nodes run this type of jobs?

-Max

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=maxi/CN=682514/CN=Maxim Goncharov</pre></div><div class='update_description'><i onclick="document.location='28831#1459172132'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-28T13:35:32+00:00">Mar 28, 2016 01:35 PM UTC</time><a class="anchor" name="1459172132">&nbsp;</a></div><pre>HI, I will reconfigure the cluster today to accept multicore jobs.
Once we are ready I will update the ticket.

-Max

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=maxi/CN=682514/CN=Maxim Goncharov</pre></div><div class='update_description'><i onclick="document.location='28831#1458933773'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-25T19:22:53+00:00">Mar 25, 2016 07:22 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1458933773">&nbsp;</a></div><pre>I am sorry too, if I misunderstood, Max. We are following the same procedure with all T2 sites. The fact that the tests succeeded pointed us to follow the procedure, and move to real jobs, as we are trying to meet a target date for deployment to T2s (April 1st), as it is urgently needed for the coming production campaigns.

Is it not working? What is still missing from the site side? Anything we can help you with?

Antonio.

-- by Antonio Perez-Calero Yzquierdo at Thu Mar 24 14&#58;25&#58;42 UTC 2016

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a></pre></div><div class='update_description'><i onclick="document.location='28831#1458828215'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-24T14:03:35+00:00">Mar 24, 2016 02:03 PM UTC</time><a class="anchor" name="1458828215">&nbsp;</a></div><pre>I am sorry, did I in any way suggested that our site is ready to receive these type of jobs?

-Max

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=maxi/CN=682514/CN=Maxim Goncharov</pre></div><div class='update_description'><i onclick="document.location='28831#1458822966'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-24T12:36:06+00:00">Mar 24, 2016 12:36 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1458822966">&nbsp;</a></div><pre>Notified CMS Glidein Factory team of this ticket.Hi Marty, Vassil,

Thanks for the changes. I now see&#58;

201 T2_US_MIT Partitionable CMSHTPC_T2_US_MIT_ce01
2141 T2_US_MIT Static CMS_T2_US_MIT_ce01
2423 T2_US_MIT Static CMS_T2_US_MIT_ce02
2466 T2_US_MIT Static CMS_T2_US_MIT_ce03

and a nice ramp up during the last 24h at

<a href='http&#58;//submit-3.t2.ucsd.edu/CSstoragePath/aperez/T2s/multicore_usage_t2s_168h.html' target='_blank' rel='nofollow'>http&#58;//submit-3.t2.ucsd.edu/CSstoragePath/aperez/T2s/multicore_usage_t2s_168h.html</a>

Therefore, I propose we go ahead and add multicore entries also for the ce02 and ce03 to continue expanding the mcore fraction. We can keep them together with single core and see how it goes in the next days. Could you please take care of that?

Thanks,

Antonio.

-- by Antonio Perez-Calero Yzquierdo at Thu Mar 24 12&#58;35&#58;15 UTC 2016

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a></pre></div><div class='update_description'><i onclick="document.location='28831#1458761600'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-23T19:33:20+00:00">Mar 23, 2016 07:33 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1458761600">&nbsp;</a></div><pre>Antonio, Vassil,

I&#39;ve added the submit attributes

&#60;submit_attr name=&#34;+maxMemory&#34; value=&#34;20240&#34;/&#62;
&#60;submit_attr name=&#34;+xcount&#34; value=&#34;8&#34;/&#62;

to the new multicore entry CMSHTPC_T2_US_MIT_ce01 on all factories.

One follow up question&#58; I think I&#39;m starting to see the pattern that you all are setting

&#60;attr name=&#34;GLIDEIN_MaxMemMBs&#34; const=&#34;True&#34; glidein_publish=&#34;False&#34; job_publish=&#34;True&#34; parameter=&#34;True&#34; publish=&#34;True&#34; type=&#34;int&#34; value=&#34;20240&#34;/&#62;
&#60;attr name=&#34;GLIDEIN_Max_Walltime&#34; const=&#34;True&#34; glidein_publish=&#34;False&#34; job_publish=&#34;False&#34; parameter=&#34;True&#34; publish=&#34;True&#34; type=&#34;int&#34; value=&#34;216000&#34;/&#62;

for all of these new T2 multicore entries. Is this the case? And why is it the default? Are we not confirming with the sites? e.g., All of MITs single core entries use GLIDEIN_Max_Walltime = 171000. I&#39;m assuming it won&#39;t change, no?

Marty Kandes
UCSD Glidein Factory Operations

-- by Marty Kandes at Wed Mar 23 19&#58;32&#58;35 UTC 2016

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a></pre></div><div class='update_description'><i onclick="document.location='28831#1458732633'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-23T11:30:33+00:00">Mar 23, 2016 11:30 AM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1458732633">&nbsp;</a></div><pre>Hi Max,

We tested the submission of multicore pilots to MIT successfully in the testbed and therefore added the new entry to the production pilot factories. We are submitting to ce01. For the moment I see multicore pilots pending but none running. In fact the resources in use by CMS are totally taken by single core&#58;

aperez@submit-3 ~/entries$ condor_status -pool cmssrv221.fnal.gov -af GLIDEIN_CMSSite SlotType GLIDEIN_Entry_Name|sort |uniq -c | grep MIT
2223 T2_US_MIT Static CMS_T2_US_MIT_ce01
2408 T2_US_MIT Static CMS_T2_US_MIT_ce02
2319 T2_US_MIT Static CMS_T2_US_MIT_ce03

In order for multicore to start, please assign higher priority to &#34;CMS mcore&#34; compared to &#34;CMS single core&#34;.  Also, could you please confirm that you are using defragmentation?

Thanks,

Antonio.

-- by Antonio Perez-Calero Yzquierdo at Wed Mar 23 11&#58;30&#58;07 UTC 2016

Hi Antonio,

I added CMSHTPC_T2_US_MIT_ce01 to CERN, GOC and SDSC factories.

Vassil

-- by Vassil Verguilov at Wed Mar 23 09&#58;48&#58;50 UTC 2016

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a></pre></div><div class='update_description'><i onclick="document.location='28831#1458709695'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-23T05:08:15+00:00">Mar 23, 2016 05:08 AM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1458709695">&nbsp;</a></div><pre>Notified CMS Glidein Factory team of this ticket.Dear Factory Ops team,

I have submitted some test jobs via the the new multicore entry in the ITB which have completed successfully. Therefore, could you please move

CMSHTPC_T2_US_MIT_ce01

to one of the production factories, see how it goes?

Thanks,

Antonio.
Flushed field &#39;Notify Site&#39;

-- by Antonio Perez-Calero Yzquierdo at Wed Mar 23 05&#58;07&#58;39 UTC 2016

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a></pre></div><div class='update_description'><i onclick="document.location='28831#1458669955'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-22T18:05:55+00:00">Mar 22, 2016 06:05 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1458669955">&nbsp;</a></div><pre>Thanks Vassil.

Max, now that we have a multicore entry setup for the site, we&#39;ll start testing the endpoint you provided, see if multicore pilots can access resources and run there.

In principle, we don&#39;t provide any configurations, as it is the site choice how to configure their side to provide multicore. However, like I said in #3, for condor sites, in general it is a matter of enabling partitionable slots and then start defragmentation by setting up the defrag daemon. Here is some info on the recent tests we have done for the T0, which can provide some hints on how to configure the daemon&#58;

<a href='https&#58;//indico.cern.ch/event/509869/contribution/0/attachments/1245416/1833866/HTCondorDefragT0_SI_20160317.pdf' target='_blank' rel='nofollow'>https&#58;//indico.cern.ch/event/509869/contribution/0/attachments/1245416/1833866/HTCondorDefragT0_SI_20160317.pdf</a>

Cheers,

Antonio.

-- by Antonio Perez-Calero Yzquierdo at Tue Mar 22 18&#58;05&#58;16 UTC 2016

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a></pre></div><div class='update_description'><i onclick="document.location='28831#1458657515'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-22T14:38:35+00:00">Mar 22, 2016 02:38 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1458657515">&nbsp;</a></div><pre>Hi Antonio, Max,

I added a multicore entry (CMSHTPC_T2_US_MIT_ce01) to CERN ITB factory [1].

Regards,
Vassil

[1] <a href='http&#58;//vocms054.cern.ch/monitor/factoryEntryStatusNow.html?entry=CMSHTPC_T2_US_MIT_ce01' target='_blank' rel='nofollow'>http&#58;//vocms054.cern.ch/monitor/factoryEntryStatusNow.html?entry=CMSHTPC_T2_US_MIT_ce01</a>

-- by Vassil Verguilov at Tue Mar 22 14&#58;37&#58;50 UTC 2016

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a></pre></div><div class='update_description'><i onclick="document.location='28831#1458568256'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-21T13:50:56+00:00">Mar 21, 2016 01:50 PM UTC</time><a class="anchor" name="1458568256">&nbsp;</a></div><pre>Hi Antonio,
We will follow the general setup fro CMS sites, hence please provide instructions what needs to be done for the setup.

Thank you, -Max

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=maxi/CN=682514/CN=Maxim Goncharov</pre></div><div class='update_description'><i onclick="document.location='28831#1458565156'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-21T12:59:16+00:00">Mar 21, 2016 12:59 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1458565156">&nbsp;</a></div><pre>Hi Max,

Any news, please?

Cheers,

Antonio.

-- by Antonio Perez-Calero Yzquierdo at Mon Mar 21 12&#58;58&#58;30 UTC 2016

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a></pre></div><div class='update_description'><i onclick="document.location='28831#1458287298'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-18T07:48:18+00:00">Mar 18, 2016 07:48 AM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1458287298">&nbsp;</a></div><pre>Hi Max,

Could you please provide some feedback on the questions in my previous message?

Thanks,

Antonio.

-- by Antonio Perez-Calero Yzquierdo at Fri Mar 18 07&#58;48&#58;08 UTC 2016

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a></pre></div><div class='update_description'><i onclick="document.location='28831#1458054670'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-15T15:11:10+00:00">Mar 15, 2016 03:11 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1458054670">&nbsp;</a></div><pre>Hi Max,

Thanks for the details. With respect to your nodes, do you have them configured as partitionable slots? Also, if you are mixing, or will be mixing, single and multicore jobs, you should have the defrag daemon configured properly to drain, or defrag in HTCondor terms, enough slots in a node to be taken by the multicore requests. How is your setup in that respect? We will be using 8 core pilots, as standard for CMS.

Also, we will setup a test entry and start submitting a few test jobs, see how it goes.

Cheers,

Antonio.

-- by Antonio Perez-Calero Yzquierdo at Tue Mar 15 15&#58;10&#58;22 UTC 2016

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a></pre></div><div class='update_description'><i onclick="document.location='28831#1458049402'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-15T13:43:22+00:00">Mar 15, 2016 01:43 PM UTC</time><a class="anchor" name="1458049402">&nbsp;</a></div><pre>Hi,

lets use ce01.cmsaf.mit.edu for tests
batch - HTCondor + Condor
memory - from 2 GB to 4 GB per slot
cores per ndoe - from 8 to 32

Regards, -Max

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=maxi/CN=682514/CN=Maxim Goncharov</pre></div><div class='update_description'><i onclick="document.location='28831#1457982910'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-14T19:15:10+00:00">Mar 14, 2016 07:15 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1457982910">&nbsp;</a></div><pre>Hi Max,

Have you had time to review this ticket?

Thanks,
Chris</pre></div><div class='update_description'><i onclick="document.location='28831#1457568893'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-03-10T00:14:53+00:00">Mar 10, 2016 12:14 AM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1457568893">&nbsp;</a></div><pre>Dear site admins,

As you may know, CMS requires the deployment of multicore CPU resources at their supporting T2 sites for the upcoming Spring and Summer MC production campaigns. For that, CMS will switch to submitting multi-core pilots to your site, instead of the current single-core.

You can find more information about the project at&#58;
<a href='https&#58;//twiki.cern.ch/twiki/bin/view/CMSPublic/CMSMulticoreSchedulingProject' target='_blank' rel='nofollow'>https&#58;//twiki.cern.ch/twiki/bin/view/CMSPublic/CMSMulticoreSchedulingProject</a>

with specific details to the deployment at T2s at&#58;
<a href='https&#58;//twiki.cern.ch/twiki/bin/view/CMSPublic/MulticoreDeploymentToT2s' target='_blank' rel='nofollow'>https&#58;//twiki.cern.ch/twiki/bin/view/CMSPublic/MulticoreDeploymentToT2s</a>

The proposed plan is to first setup a test multicore entry for your site in the testbed (ITB) glideinWMS pilot factories, submitting a few pilots to verify that the request is correctly passed to the local CE and batch systems. For that, we need that you provide the following information&#58;

-Batch system and CE technologies

-Cores per node in your cluster

-Memory per core in your cluster

-Gatekeeper to be used for multicore pilot submission

Thank you,

Antonio,
CMS Submission Infrastructure team.

[Ticket Origin]
<a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=120100</a>

[Ticket History]
Subject&#58; Moving T2_US_MIT to multicore
Ticket Type&#58; USER
CC&#58; cms-submission-infrastructure@....
-- by Antonio Perez-Calero Yzquierdo at Thu Mar 10 00&#58;14&#58;26 UTC 2016</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F28831">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 28831});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
