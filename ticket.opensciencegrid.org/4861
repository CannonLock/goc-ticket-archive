<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[4861] OSG AGLT2 Failing rsv probes</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=4861" method="post">
<div class="page-header">
    <h3><span class="muted">4861</span> / OSG AGLT2 Failing rsv probes</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Bob Ball</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Closing this ticket - No response from customer but I see issue is resolved</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2008-04-28</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
        <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/4861", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="https://ticket.opensciencegrid.org/\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="https://ticket.opensciencegrid.org/\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/4861?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/4861?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20OSG%20AGLT2%20Failing%20rsv%20probes%20ISSUE%3D4861%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='4861#1209473709'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-29T12:55:09+00:00">Apr 29, 2008 12:55 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1209473709">&nbsp;</a></div><pre>Excellent!

On 4/29/2008 8&#58;52 AM, Open Science Grid FootPrints pondered&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4861#1209473529'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-29T12:52:09+00:00">Apr 29, 2008 12:52 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1209473529">&nbsp;</a></div><pre>Thank you, yes, this should be done.  I got too full-up yesterday to get
to this item.

bob

Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4861#1209473093'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-29T12:44:53+00:00">Apr 29, 2008 12:44 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1209473093">&nbsp;</a></div><pre>Bob,

I notice that now you&#39;re passing the CRL metric with OK status, so the issue you
reported about the RSV probe failing is resolved. Therefore, I am closing this GOC
ticket.

Arvind</pre></div><div class='update_description'><i onclick="document.location='4861#1208965029'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-23T15:37:09+00:00">Apr 23, 2008 03:37 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1208965029">&nbsp;</a></div><pre><font color='#7F7E6F'>&#62;  Late last week I changed the way the certificates were updated in the afs space. I made a sub-directory, certificates-35-1 of the afs rw volume, and pointed the crl-fetch script to that instead. I observed it updating, but did not immediately see the new sub-directory appear in the ro volumes mounted everywhere else.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;  Then I forgot about it until just now with the receipt of your Email. So, I checked on one of the ro volumes, in particular the one on our gatekeeper that is doing the rsv reporting, and found that new directory in place. So, I have now changed the TRUSTED_CA link to point there as of just now. We have one failing rsv probe, and now need to wait for it to update with the new certs. That may not be until 230am tomorrow, unless we force it sooner? Is there a way to force that check?</font>
<font color='#7F7E6F'>&#62; Once I see the probe happy, I&#39;ll ask that the ticket be closed.</font>
<font color='#7F7E6F'>&#62;</font>
Bob, you could try doing this&#58;

. /path/to/CE/setup.sh
cd $VDT_LOCATION/osg-rsv/bin/probes
perl cacert-crl-expiry-probe -u &#60;HOST-you-want-test&#62; --verbose -m
org.osg.certificates.crl-expiry

And see if prints an OK result.
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;  I still believe it is an incredibly bad design decision to base updates on the particular name of the directory at the end of the soft link chain.</font>
I am afraid I don&#39;t know enough about how it&#39;s done, and why it&#39;s done
in a way to comment. &#58;-)

Cheers,
Arvind</pre></div><div class='update_description'><i onclick="document.location='4861#1208963769'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-23T15:16:09+00:00">Apr 23, 2008 03:16 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1208963769">&nbsp;</a></div><pre>Hi, Arvind.

Late last week I changed the way the certificates were updated in the afs space. I made a sub-directory, certificates-35-1 of the afs rw volume, and pointed the crl-fetch script to that instead. I observed it updating, but did not immediately see the new sub-directory appear in the ro volumes mounted everywhere else.

Then I forgot about it until just now with the receipt of your Email. So, I checked on one of the ro volumes, in particular the one on our gatekeeper that is doing the rsv reporting, and found that new directory in place. So, I have now changed the TRUSTED_CA link to point there as of just now. We have one failing rsv probe, and now need to wait for it to update with the new certs. That may not be until 230am tomorrow, unless we force it sooner? Is there a way to force that check?

Once I see the probe happy, I&#39;ll ask that the ticket be closed.

I still believe it is an incredibly bad design decision to base updates on the particular name of the directory at the end of the soft link chain.

Bob

Open Science Grid FootPrints wrote&#58;  [Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='4861#1208963048'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-23T15:04:08+00:00">Apr 23, 2008 03:04 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1208963048">&nbsp;</a></div><pre>Hi Bob,

ok, no problem. Was just checking in ...

Arvind

On 4/23/2008 11&#58;01 AM, Open Science Grid FootPrints pondered&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4861#1208962869'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-23T15:01:09+00:00">Apr 23, 2008 03:01 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1208962869">&nbsp;</a></div><pre>Hi, Arvind,

I have been saturated and haven&#39;t gotten back to it yet.  Today or
tomorrow, with luck.

bob

Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4861#1208962300'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-23T14:51:40+00:00">Apr 23, 2008 02:51 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1208962300">&nbsp;</a></div><pre>Bob,

Are you close to resolving this issue based on Scot&#39;s note from last week? Do you
need further assistance from him or us (GOC)?

Thanks,
Arvind</pre></div><div class='update_description'><i onclick="document.location='4861#1208537529'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-18T16:52:09+00:00">Apr 18, 2008 04:52 PM UTC</time> by <b>Scott Kronenfeld</b><a class="anchor" name="1208537529">&nbsp;</a></div><pre>Well, the persistent directory will be
/afs/atlas.umich.edu/Certficates/certificates, which is obviously a
symlink, but will always point to the right thing.
We back up the previous certificates when vdt-update-certs fetches a
new version, so it is immediately obvious what you have when you are
looking in that directory

e.g. for my site

# ls -l (in globus/share)
lrwxrwxrwx   1 root root    43 Mar 18 05&#58;06 certificates -&#62;
/opt/osg-0.8/globus/share/certificates-35-1
drwxr-xr-x   3 root root 24576 Feb  6 03&#58;26 certificates-34-1.old
drwxr-xr-x   3 root root 24576 Mar 19 03&#58;23 certificates-35-1

On Fri, Apr 18, 2008 at 11&#58;07 AM, Open Science Grid FootPrints
&#60;osg@....&#62; wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4861#1208534829'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-18T16:07:09+00:00">Apr 18, 2008 04:07 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1208534829">&nbsp;</a></div><pre>Close. The actual rw volume location is
lrwxrwxrwx 1 root 32 Apr 4 14&#58;13 certificates -&gt; /afs/atlas.umich.edu/Certficates/
This is released to ro copies like so&#58;
lrwxrwxrwx 1 root 37 Feb 15 17&#58;05 certificates -&gt; /afs/atlas.umich.edu/OSG_certificates/

However, from what you say below, it sounds like I can create a sub-directory of Certificates, namely certificates-35-1, and correct the soft links appropriately so that both the rw and ro volumes will use this instead. Is that correct?

I still consider it a poor design that uses the actual directory name as a key instead of something like an env that can be picked up from a standard set.

bob

Open Science Grid FootPrints wrote&#58;  [Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='4861#1208533569'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-18T15:46:09+00:00">Apr 18, 2008 03:46 PM UTC</time> by <b>Scott Kronenfeld</b><a class="anchor" name="1208533569">&nbsp;</a></div><pre>The certificates updater uses the version named directory to
atomically install certificates.

Am I right in assuming that your AFS rw volume is
/afs/atlas.umich.edu/OSG_certificates?

If so, can you still use the configuration I suggested.  You can
replicate that volume.  Then from all your other machines, the path to
the certs is /afs/atlas.umich.edu/OSG_certificates/certificates (which
is a symlink to
/afs/atlas.umich.edu/OSG_certificates/certificates-vv-v, currently
certificates-35-1)

Will this work, or are there other issues that I&#39;m missing?

On Tue, Apr 15, 2008 at 3&#58;19 PM, Open Science Grid FootPrints
&#60;osg@....&#62; wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4861#1208290749'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-15T20:19:09+00:00">Apr 15, 2008 08:19 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1208290749">&nbsp;</a></div><pre>I think you misunderstand what we are doing here.

We were trying to set up our systems so that, for all the machines running OSG 080 here, there would be one and only one machine that grabbed the certs, and then made them available to all the others.

gate02.grid.umich.edu is the machine designated to grab the certs. It puts them into an afs rw volume. Sometime in the wee hours of the day, this afs rw volume is replicated to some ro copies. The ro copies are accessed by all the other machines. gate01.aglt2.org mounts and uses this ro copy.

So, the certificates-35-1 directory name is never involved in the path at all when the certificates are copied.

If I sent to you the gate01 logs, then you will not find any mention of fetching new certificates, and for this I apologize. So, attached, please find some gate02 logs of the last few days.

Note the following difference between gate02 and gate01
[gate02&#58;grid-security]# cat gsi-authz.conf
globus_mapping /opt/OSG080/prima/lib/libprima_authz_module_gcc64dbg globus_gridmap_callout
[gate01&#58;grid-security]# cat gsi-authz.conf
globus_mapping /opt/OSG080/prima/lib/libprima_authz_module_gcc32dbg globus_gridmap_callout

I don&#39;t know if this is significant or not, but there it is.

bob

Open Science Grid FootPrints wrote&#58;  [Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='4861#1208288769'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-15T19:46:09+00:00">Apr 15, 2008 07:46 PM UTC</time> by <b>Scott Kronenfeld</b><a class="anchor" name="1208288769">&nbsp;</a></div><pre>Hi Bob,
I&#39;m having trouble reproducing your error locally, and unfortunately
the logs that were sent do not show any updates (the logs are rotated
daily, so there must have been no updates in the three days prior to
sending those).

I would like you to try to change your current configuration slightly,
and we can see if that eliminates the problems.  We will be providing
better documentation about moving certificates soon.

Instead of pointing /opt/OSG080/globus/share/certificates/ at your new
certificates directory, point /opt/OSG080/globus/TRUSTED_CA at your
new directory.  For example,

Point globus_TRUSTED_CA -&#62; /afs/atlas.umich.edu/OSG_certificates/certificates
Point /afs/atlas.umich.edu/OSG_certificates/certificates -&#62;
/afs/atlas.umich.edu/OSG_certificates/certificates-35-1 (or whatever
the current version is)
The certs will be held within
/afs/atlas.umich.edu/OSG_certificates/certificates-35-1

You can eliminate the intermediate OSG_certificates if you want.

Let me know if you need any help in restoring the certificates and
getting the latest version.

Thanks,
Scot

On Mon, Apr 14, 2008 at 2&#58;18 PM, Open Science Grid FootPrints
&#60;osg@....&#62; wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4861#1208200733'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-14T19:18:53+00:00">Apr 14, 2008 07:18 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1208200733">&nbsp;</a></div><pre>Scot, can you check out these logs, and let Bob know what he can do?

Thanks,
Arvind</pre></div><div class='update_description'><i onclick="document.location='4861#1208196250'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-14T18:04:10+00:00">Apr 14, 2008 06:04 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1208196250">&nbsp;</a></div><pre>Hi.

Have you come up with anything for me on this issue?

Thanks,
bob

Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4861#1207840389'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-10T15:13:09+00:00">Apr 10, 2008 03:13 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1207840389">&nbsp;</a></div><pre>Thanks. I was just going down that line of thought myself and planning on meeting with Wenjing Wu here today about what she was doing with other machine installs. This was done because we have multiple machines with the OSG080 installation, and wanted to do certs only once for all of them. However, how much of a load is it on a machine to do the certs? It can&#39;t be THAT much, or am I wrong?

So, anyway, log files attached.

bob

Open Science Grid FootPrints wrote&#58;  [Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='4861#1207837688'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-10T14:28:08+00:00">Apr 10, 2008 02:28 PM UTC</time> by <b>Scott Kronenfeld</b><a class="anchor" name="1207837688">&nbsp;</a></div><pre><font color='#7F7E6F'>&#62;  &#62; Certs are in /opt/OSG080/globus/TRUSTED_CA/</font>
<font color='#7F7E6F'>&#62;  &#62; TRUSTED_CA is a soft link to /opt/OSG080/globus/share/certificates/</font>
<font color='#7F7E6F'>&#62;  &#62; share is a real directory</font>
<font color='#7F7E6F'>&#62;  &#62; certificates is a soft link to the ro afs directory</font>
<font color='#7F7E6F'>&#62;  &#62; /afs/atlas.umich.edu/OSG_certificates/</font>

I think this may be the issue here.

In a normal setup, we have the following symlinks in place for local
certificate installs
$VDT_LOCATION/globus/TRUSTED_CA -&#62; $VDT_LOCATION/globus/share/certificates
$VDT_LOCATION/globus/share/certificates -&#62;
$VDT_LOCATION/globus/share/certificates-vv-v (vv--v is the current
version).

The vdt-update-certs script relies on this configuration in order to
atomically install new certificates, and to preserve old certificates.

If I&#39;m reading correctly, it sounds like Bob has the following symlink in place&#58;
$VDT_LOCATION/globus/share/certificates -&#62;
/afs/atlas.umich.edu/OSG_certificates/

Can you send me the log files for the last few days from
$VDT_LOCATION/vdt/var/log?  They get rotated daily, so you may have to
send more than one file.  Once we determine if this is the cause, I
can help Bob with his certs configuration so that this works properly.

Thanks,
Scot</pre></div><div class='update_description'><i onclick="document.location='4861#1207779909'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-09T22:25:09+00:00">Apr 9, 2008 10:25 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1207779909">&nbsp;</a></div><pre>Hi Arvind and Bob,

072fe468 is the old Swiss CA SWITCH CA, which did expire last month,
so you can/should delete these files.

The other one that also expired at the same time was 4aa5ef7d ,
so you should get rid of those files, too.

These should&#39;ve been removed automatically by vdt-update-certs, though.
Not sure why they weren&#39;t.

Hope this helps,

Horst</pre></div><div class='update_description'><i onclick="document.location='4861#1207778649'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-09T22:04:09+00:00">Apr 9, 2008 10:04 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1207778649">&nbsp;</a></div><pre>Hi Bob,

I really don&#39;t know how I can help you here - we&#39;ve exhausted all
possible tests I am aware of, and they all indicate you indeed have
expired CRLs and CAcerts. I&#39;ve CCed the osg-site mailing list in a hope
that someone has seen this type of an issue, and can advise.

<font color='#7F7E6F'>&#62;  # vdt-control --list|grep vdt-update-certs</font>
<font color='#7F7E6F'>&#62;  vdt-update-certs | cron | enable</font>

<font color='#7F7E6F'>&#62;  The machine that updates the certs is gate02.grid.umich.edu, and it</font>
<font color='#7F7E6F'>&#62;  writes to an rw afs volume. In the early AM this afs volume is</font>
released
<font color='#7F7E6F'>&#62;  to the ro copies, and gate01.aglt2.org has the ro copy mounted. I</font>
have
<font color='#7F7E6F'>&#62;  watched this update work since I fixed the mount points a few days</font>
ago.
<font color='#7F7E6F'>&#62;  We went from 25 or 30 failing certs to just these few.</font>

<font color='#7F7E6F'>&#62;  osg-rsv is running on gate01.aglt2.org, and the web page you</font>
specified
<font color='#7F7E6F'>&#62;  using. The firewall is not running on the host. Generally aglt2.org</font>
<font color='#7F7E6F'>&#62;  will route from most any edu or gov domain, but NOT from commercial.</font>
<font color='#7F7E6F'>&#62;  Try a traceroute from your host to gate01.aglt2.org to see if that is</font>
<font color='#7F7E6F'>&#62;  the problem.</font>

<font color='#7F7E6F'>&#62;  Certs are in /opt/OSG080/globus/TRUSTED_CA/</font>
<font color='#7F7E6F'>&#62;  TRUSTED_CA is a soft link to /opt/OSG080/globus/share/certificates/</font>
<font color='#7F7E6F'>&#62;  share is a real directory</font>
<font color='#7F7E6F'>&#62;  certificates is a soft link to the ro afs directory</font>
<font color='#7F7E6F'>&#62;  /afs/atlas.umich.edu/OSG_certificates/</font>

Obviously vdt-update-certs is enabled, and you&#39;ve said it definitely
runs. But again there are indeed CRLs and CAcerts in your
/opt/OSG080/globus/share/certificates/ directory which are what the RSV
<div id='show_1448824608' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1448824608'>probes are reporting. I checked manually, and confirmed this.

1) I ran the latest version of the crl-expiry probe and cacert-expiry
probes (which uses a different test)

ag@dickinson probes % perl cacert-crl-expiry-probe -u gate01.aglt2.org &#60;<a href='http&#58;//gate01.aglt2.org&#62' target='_blank' rel='nofollow'>http&#58;//gate01.aglt2.org&#62</a>; --verbose -m org.osg.certificates.crl-expiry
. . .
summaryData&#58; CRITICAL
detailsData&#58; 5 ERROR(s)!
ERROR&#58;   /opt/OSG080/globus/TRUSTED_CA/072fe468.r0 has expired! (nextUpdate=Mar 23 11&#58;00&#58;13 2008 GMT)
ERROR&#58;   /opt/OSG080/globus/TRUSTED_CA/1d879c6c.r0 has expired! (nextUpdate=Apr  9 20&#58;29&#58;31 2008 GMT)
ERROR&#58;   /opt/OSG080/globus/TRUSTED_CA/67e8acfa.r0 has expired! (nextUpdate=Apr  9 08&#58;00&#58;04 2008 GMT)
ERROR&#58;   /opt/OSG080/globus/TRUSTED_CA/95009ddc.r0 has expired! (nextUpdate=Apr  9 16&#58;00&#58;03 2008 GMT)
EOT

## New CAcerts test.
ag@dickinson probes % perl cacert-crl-expiry-probe -u gate01.aglt2.org &#60;<a href='http&#58;//gate01.aglt2.org&#62' target='_blank' rel='nofollow'>http&#58;//gate01.aglt2.org&#62</a>; --verbose -m org.osg.certificates.cacert-expiry
. . .
detailsData&#58;  CA Certificates appear to be out to date;
Expected version (from GOC URL <a href='http&#58;//vdt.cs.wisc.edu/software/certificates/ca-certs-version' target='_blank' rel='nofollow'>http&#58;//vdt.cs.wisc.edu/software/certificates/ca-certs-version</a>)&#58;
timestamp=20080317T170900 # Time of creation of this file
versiondesc=v35 (includes IGTF 1.20 CAs)
Version found&#58; CA Certificates v34 (includes IGTF 1.19 CAs)
Reporting CRITICAL status since new CA_Certs package is less than 168 hours old.
EOT

Note that under the new CAcert test, we look at vdt-version&#39;s output,
specifically the iGTF distribution version. And this is indicated to be
an older version... [perhaps because you run vdt-cert-update elsewhere,
and not on gate01??? ]

Then I looked for one of the CRLs listed above -- it&#39;s listed to have a
last modified date of April 9 (today).

ag@dickinson probes % RHOST=gate01.aglt2.org &#60;<a href='http&#58;//gate01.aglt2.org&#62' target='_blank' rel='nofollow'>http&#58;//gate01.aglt2.org&#62</a>;; globus-job-run $RHOST /bin/ls -l /opt/OSG080/globus/share/certificates/072fe468.r0
-rw-r--r--  1 anonymous root 15358 Apr  8 02&#58;10 /opt/OSG080/globus/share/certificates/072fe468.r0

Running an openssl check on that file does reveal that it has indeed
expired&#58;

ag@dickinson probes % RHOST=gate01.aglt2.org &#60;<a href='http&#58;//gate01.aglt2.org&#62' target='_blank' rel='nofollow'>http&#58;//gate01.aglt2.org&#62</a>;; globus-job-run
$RHOST /opt/OSG080/globus/bin/openssl crl -in
/opt/OSG080/globus/share/certificates/072fe468.r0 -nextupdate -noout;

*nextUpdate=Mar 23 11&#58;00&#58;13 2008
^^^^^^^NOTE DATE^^^^^
*

Perhaps, not all files are getting updated by the vdt-cert-updater ?? I
don&#39;t have that CRL on my test machine, so I can&#39;t compare. I am not
sure. Anyone on the sites list - have any idea?

<font color='#7F7E6F'>&#62;  below works fine locally. What MIGHT be happening is that aglt2.org</font>
<font color='#7F7E6F'>&#62;  domain does not route everywhere, in particular to the host you were</font>

Yep, that&#39;s exactly what had happened. I could get to your resource&#39;s
RSV webpage (<a href='https&#58;//gate01.aglt2.org&#58;8443/rsv' target='_blank' rel='nofollow'>https&#58;//gate01.aglt2.org&#58;8443/rsv</a>) after I VPNed into
Indiana University&#39;s VPN server. &#58;-)

Cheers,
Arvind
</div><script type='text/javascript'>
        $('#show_1448824608').click(function() {
            $('#detail_1448824608').slideDown("normal");
            $('#show_1448824608').hide();
            $('#hide_1448824608').show();
        });
        $('#hide_1448824608').click(function() {
            $('#detail_1448824608').slideUp();
            $('#hide_1448824608').hide();
            $('#show_1448824608').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='4861#1207775768'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-09T21:16:08+00:00">Apr 9, 2008 09:16 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1207775768">&nbsp;</a></div><pre>[gate02&#58;~]# vdt-control --list|grep vdt-update-certs
vdt-update-certs   | cron   | enable

The machine that updates the certs is gate02.grid.umich.edu, and it
writes to an rw afs volume.  In the early AM this afs volume is released
to the ro copies, and gate01.aglt2.org has the ro copy mounted.  I have
watched this update work since I fixed the mount points a few days ago.
We went from 25 or 30 failing certs to just these few.

osg-rsv is running on gate01.aglt2.org, and the web page you specified
below works fine locally.  What MIGHT be happening is that aglt2.org
domain does not route everywhere, in particular to the host you were
using.  The firewall is not running on the host.  Generally aglt2.org
will route from most any edu or gov domain, but NOT from commercial.
Try a traceroute from your host to gate01.aglt2.org to see if that is
the problem.

Files attached.

Certs are in  /opt/OSG080/globus/TRUSTED_CA/
TRUSTED_CA is a soft link to /opt/OSG080/globus/share/certificates/
share is a real directory
certificates is a soft link to the ro afs directory
/afs/atlas.umich.edu/OSG_certificates/

bob

Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='4861#1207773061'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-09T20:31:01+00:00">Apr 9, 2008 08:31 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1207773061">&nbsp;</a></div><pre>Bob,

Also, run a quick check to be sure it is enabled&#58;

vdt-control --list | grep vdt-update-certs
vdt-update-certs   | cron   | enable

Then check cron to be sure it is running regularly. You can still force an update with the pacman
command. It shouldn&#39;t cause any issues.

Tim</pre></div><div class='update_description'><i onclick="document.location='4861#1207772144'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-09T20:15:44+00:00">Apr 9, 2008 08:15 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1207772144">&nbsp;</a></div><pre>Bob,

I am quite confused now. &#58;-)

Can you send me the following details?

1) Where is OSG-RSV running on?
Note&#58; I ask because I am unable to get to your local status pages -- you either do
not have RSV setup to serve results on the web, or a firewall is blocking me from
accessing <a href='https&#58;//gate01.aglt2.org&#58;8443/rsv' target='_blank' rel='nofollow'>https&#58;//gate01.aglt2.org&#58;8443/rsv</a> -- the node that&#39;s uploading records to
our collector

2) Can you send me the following files on that resource&#58;
$VDT_LOCATION/osg-rsv/logs/probes/&#60;host_name&#62;__cacert-crl-expiry-probe@....
$VDT_LOCATION/osg-rsv/logs/probes/&#60;host_name&#62;__cacert-crl-expiry-probe@....
$VDT_LOCATION/osg-rsv/logs/probes/&#60;host_name&#62;__cacert-expiry-local-probe@....

3) Where are your CAcerts and CRLs located on the host being monitored by RSV (i.e
serviceUri in above files)

Once I look at these, I should have a clearer idea.

Cheers,
Arvind</pre></div><div class='update_description'><i onclick="document.location='4861#1207771628'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-09T20:07:08+00:00">Apr 9, 2008 08:07 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1207771628">&nbsp;</a></div><pre>[gate02&#58;OSG080]# vdt-version|grep IGTF
CA Certificates v35 (includes IGTF 1.20 CAs)

As far as I know, this is running properly.

bob

Open Science Grid FootPrints wrote&#58;  [Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='4861#1207771088'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-09T19:58:08+00:00">Apr 9, 2008 07:58 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1207771088">&nbsp;</a></div><pre><font color='#7F7E6F'>&#62; No, I do not see cacert-updater running, just the vdt-update-certs. In fact, there is no file in our /opt/OSG080 tree that contains the string &#34;cacert-upda&#34; in the file name.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;  So, where to look? What to do?</font>
<font color='#7F7E6F'>&#62;</font>
Sorry Bob, I meant vdt-update-certs. Is it running properly?

Try running
vdt-version | grep IGTF
to see what version of iGTF cert package you have ... it should be v35
(IGTF 1.20 CAs).

Cheers,
Arvind</pre></div><div class='update_description'><i onclick="document.location='4861#1207769649'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-09T19:34:09+00:00">Apr 9, 2008 07:34 PM UTC</time> by <b>Bobby Ball</b><a class="anchor" name="1207769649">&nbsp;</a></div><pre>No, I do not see cacert-updater running, just the vdt-update-certs. In fact, there is no file in our /opt/OSG080 tree that contains the string &#34;cacert-upda&#34; in the file name.

So, where to look? What to do?

bob

Open Science Grid FootPrints wrote&#58;  [Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='4861#1207769262'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-09T19:27:42+00:00">Apr 9, 2008 07:27 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1207769262">&nbsp;</a></div><pre>Hi Bob,

I think Tim has pretty much covered this one. You need to update the CA cert on the
central machine (that distributes those files to others).

<font color='#7F7E6F'>&#62; We update certs daily, and that seems to run fine. They are gathered to a rw volume</font>
<font color='#7F7E6F'>&#62; in afs, and replicated into read-only mount points in afs which are then used by all</font>
<font color='#7F7E6F'>&#62; the rest of the nodes.</font>

Do you have VDT&#39;s cacert-updater script running on that machine to update the CA
certs? Apparently whatever is supposed to update those certs, did not work properly?
Let&#39;s try to debug this if necessary.

Let me or TIm know if you have any more questions!

Cheers,
Arvind</pre></div><div class='update_description'><i onclick="document.location='4861#1207767079'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-09T18:51:19+00:00">Apr 9, 2008 06:51 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1207767079">&nbsp;</a></div><pre>Hi Bob,

Those CAs have expired...

[root@itb-zero grid]# ls -l globus/share/certificates/072fe468.0
-rwxr-xr-x  1 root root 1454 Feb 12 16&#58;19 globus/share/certificates/072fe468.0
[root@itb-zero grid]# openssl x509 -in globus/share/certificates/072fe468.0 -enddate
notAfter=Mar 13 12&#58;41&#58;00 2008 GMT

[root@itb-zero grid]# ls -l globus/share/certificates/4aa5ef7d.0
-rwxr-xr-x  1 root root 1462 Feb 12 16&#58;19 globus/share/certificates/4aa5ef7d.0
[root@itb-zero grid]# openssl x509 -in globus/share/certificates/4aa5ef7d.0 -enddate | head -1
notAfter=Mar 13 12&#58;39&#58;04 2008 GMT

As you can see, I hadn&#39;t updated my ITB node yet, so they were still there. And if I go to the VDT
page listing the CAs I don&#39;t see these two on there any longer...

<a href='http&#58;//vdt.cs.wisc.edu/releases/1.8.1/certificate_authorities.html' target='_blank' rel='nofollow'>http&#58;//vdt.cs.wisc.edu/releases/1.8.1/certificate_authorities.html</a>

I&#39;ve run the pacman update&#58;

pacman -update CA-Certificates

And those expired CAs are no longer on my ITB node. I am adding our RSV expert, Arvind, to the
ticket. He may have more to add.

Thank you,

Tim</pre></div><div class='update_description'><i onclick="document.location='4861#1207766072'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-09T18:34:32+00:00">Apr 9, 2008 06:34 PM UTC</time> by <b>Peter Serguta</b><a class="anchor" name="1207766072">&nbsp;</a></div><pre>From&#58; Bob Ball &#60;ball@....&#62;
To&#58; OSG Operations Center &#60;goc@....&#62;
cc&#58; Bob Ball &#60;ball@....&#62;
Subject&#58; Failing rsv probes at AGLT2
Date-Sent&#58; Wednesday, April 09, 2008 2&#58;09 PM -0400

Hi,

We have 3 rsv probes that are failing here at AGLT2.  All 3 are cert-related.  I&#39;m
hoping you can tell me what to do about these?

We update certs daily, and that seems to run fine.  They are gathered to a rw volume
in afs, and replicated into read-only mount points in afs which are then used by all
the rest of the nodes.

The failing probes are detailed below.  Both failing certs in the second and 3rd
probes are duplicates of those also failing in the first probe.

certificates.crl-expiry

ERROR&#58;   072fe468.r0 has expired! (nextUpdate=Mar 23 11&#58;00&#58;13 2008 GMT)
This shows&#58;  Certificate Revocation List (CRL)&#58;
Version 2 (0x1)
Signature Algorithm&#58; sha1WithRSAEncryption
Issuer&#58; /C=CH/O=SWITCH - Teleinformatikdienste fuer Lehre und
Forschung/CN=SWITCH Server CA/ema
ilAddress=switch.server.ca@....

ERROR&#58;   4aa5ef7d.r0 has expired! (nextUpdate=Mar 23 11&#58;00&#58;12 2008 GMT)
This shows&#58; Certificate Revocation List (CRL)&#58;
Version 2 (0x1)
Signature Algorithm&#58; sha1WithRSAEncryption
Issuer&#58; /C=CH/O=SWITCH - Teleinformatikdienste fuer Lehre und
Forschung/CN=SWITCH Personal CA/e
mailAddress=switch.personal.ca@....
<div id='show_96891574' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_96891574'>
ERROR&#58;   67e8acfa.r0 has expired! (nextUpdate=Apr  9 08&#58;00&#58;04 2008 GMT)
This shows&#58;         Version 2 (0x1)
Signature Algorithm&#58; sha1WithRSAEncryption
Issuer&#58; /CN=Purdue TeraGrid RA/OU=Purdue TeraGrid/O=Purdue
University/ST=Indiana/C=US

local.cacerts-expiry

ERROR&#58;   072fe468.0 has expired! (notAfter=Mar 13 12&#58;41&#58;00 2008 GMT)
ERROR&#58;   4aa5ef7d.0 has expired! (notAfter=Mar 13 12&#58;39&#58;04 2008 GMT)

certificates.cacert-expiry

ERROR&#58;   072fe468.0 has expired! (notAfter=Mar 13 12&#58;41&#58;00 2008 GMT)
ERROR&#58;   4aa5ef7d.0 has expired! (notAfter=Mar 13 12&#58;39&#58;04 2008 GMT)

Can you tell us what to do about these?  We&#39;d rather be green than red.  Is this
possibly a routing issue?  aglt2.org does not route everywhere.  The certs are
gathered from a machine in grid.umich.edu domain, which is more widely accessible.

Thanks,
bob
</div><script type='text/javascript'>
        $('#show_96891574').click(function() {
            $('#detail_96891574').slideDown("normal");
            $('#show_96891574').hide();
            $('#hide_96891574').show();
        });
        $('#hide_96891574').click(function() {
            $('#detail_96891574').slideUp();
            $('#hide_96891574').hide();
            $('#show_96891574').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F4861">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 4861});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
