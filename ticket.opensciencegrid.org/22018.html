<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[22018] T3_US_PuertoRico - Glideins failing due to connection problems</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=22018" method="post">
<div class="page-header">
    <h3><span class="muted">22018</span> / T3_US_PuertoRico - Glideins failing due to connection problems</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Brendan Dennis</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Associated VO</label><div class="controls">CMS</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GGUS</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Brendan Dennis</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">USCMS_Tier3</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Elevated</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">TX Incoming</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2014-08-18</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">USCMS_Tier3 <span class="muted"> / OSG Support Centers</span></div><div class="assignee" style="width: 60%">GGUS (Prod)&nbsp;<a target="_blank" href="https://ggus.eu/ws/ticket_info.php?ticket=107499">107499</a> <span class="muted"> / Ticket Exchange</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/22018", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/22018?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/22018?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20T3_US_PuertoRico%20-%20Glideins%20failing%20due%20to%20connection%20problems%20ISSUE%3D22018%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='22018#1409616148'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-02T00:02:28+00:00">Sep 2, 2014 12:02 AM UTC</time> by <b>USCMS_Tier3</b><a class="anchor" name="1409616148">&nbsp;</a></div><pre>I am offline until September 4 and will reply then.</pre></div><div class='update_description'><i onclick="document.location='22018#1409615996'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-01T23:59:56+00:00">Sep 1, 2014 11:59 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1409615996">&nbsp;</a></div><pre>This ticket was closed automatically. If this issue has not been resolved according your expectations or if you need further information, please submit a new ticket referencing this one.

-- by SYSTEM at Mon Sep 01 23&#58;59&#58;02 UTC 2014

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=107499' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=107499</a></pre></div><div class='update_description'><i onclick="document.location='22018#1408123443'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-15T17:24:03+00:00">Aug 15, 2014 05:24 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1408123443">&nbsp;</a></div><pre>I just went through all of the startd logs for today and it looks like getting rid of that network loop fixed the connectivity issues, I&#39;m not seeing any more failures. I&#39;m going to go ahead and mark this solved. Thanks for the help with this, Eduardo!Fixed.

-- by Brendan Dennis at Fri Aug 15 17&#58;23&#58;32 UTC 2014

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=107499' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=107499</a></pre></div><div class='update_description'><i onclick="document.location='22018#1408033172'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-14T16:19:32+00:00">Aug 14, 2014 04:19 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1408033172">&nbsp;</a></div><pre>Hi Eduardo,

I just checked the startd logs for jobs from today, and they&#39;re definitely looking much improved since the loop was discovered. The few connection errors that remained are likely on our side, as we&#39;ve been having problems with one of the submit hosts for analysis jobs being overloaded and resetting connections. I&#39;d like to let it gather logs for another day though, as there weren&#39;t many to look at in general from today.

As for glideins failing from ITBGOC, that&#39;s nothing to worry about. ITBGOC is a test factory that we use to make sure new versions of software run fine, and so we tend to submit very simple test jobs through it. It sounds like some of those test jobs had an rhel5 requirement, causing the failure. You can ignore the failures in this case.

Brendan Dennis
UCSD Glidein Factory Operations

-- by Brendan Dennis at Thu Aug 14 16&#58;19&#58;12 UTC 2014

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=107499' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=107499</a></pre></div><div class='update_description'><i onclick="document.location='22018#1408032129'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-14T16:02:09+00:00">Aug 14, 2014 04:02 PM UTC</time> by <b>eduardo@....</b><a class="anchor" name="1408032129">&nbsp;</a></div><pre>Hi Brendan,
Yesterday, the IT people found a switch causing &#34;loops&#34; in our
building, maybe this could help with TCP connect that break?

Also Today, I noticed glidens landing from glidein_factory   = &#39;ITBGOC&#39;
but fail on the os test. (see below).

That all I have for today.
Eduardo

---extract from a _condor_stdout---
...
define_OSG_SE&#58; no rule found.. nothing to do
Executing /var/lib/condor/execute/dir_13651/glide_TJXb1p/main/test_os.sh
Requesting RHEL variant &#39;rhel5&#39;
RHEL Linux flavor found
Scientific Linux release 6.5 (Carbon)
Failed OS test for rhel5

On 08/12/2014 11&#58;36 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22018#1407857772'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-12T15:36:12+00:00">Aug 12, 2014 03:36 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1407857772">&nbsp;</a></div><pre>Hi Eduardo,

I am seeing some improvement today (there are no longer any jobs failing to wget the scripts, for instance), but I&#39;m still seeing intermittent network problems in the startd logs. We did realize recently that two of our submit hosts for the UCSD CMS frontend are possibly being overloaded and causing glideins to fail. However, most of the failures at your site aren&#39;t being caused by those two submit hosts, but rather by failures to communicate back to the glidein collectors. As far as we know, there aren&#39;t any problems with the collectors, so it does still look like a problem unique to your site. Unfortunately I don&#39;t have much more in the way of suggestions, I guess we&#39;ll just have to wait and hear what the networking people say.

Brendan Dennis
UCSD Glidein Factory Operations

-- by Brendan Dennis at Tue Aug 12 15&#58;35&#58;34 UTC 2014

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=107499' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=107499</a></pre></div><div class='update_description'><i onclick="document.location='22018#1407849010'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-12T13:10:10+00:00">Aug 12, 2014 01:10 PM UTC</time> by <b>eduardo@....</b><a class="anchor" name="1407849010">&nbsp;</a></div><pre>Hi Jeff,Brendan
Jeff,
I am glad that this problem uncover this proxyurl bug, hopefully is
fixed soon.

Brendan,
I contacted our IT people to help me find out this network problem on
the NAT server, at the moment they are contacting the provider to see if
they have some kind of filter that is triggering the limit on TCP
connections on the NAT.  Also we noted we are not saturating our
bandwidth yet, so is not bandwidth.

At this point, I can only wait for them. Do you have any suggestion?
From your side do you see any improvement?

Eduardo

On 08/08/2014 06&#58;07 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22018#1407535637'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-08T22:07:17+00:00">Aug 8, 2014 10:07 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1407535637">&nbsp;</a></div><pre>Hello Eduardo,

Thank you for reporting the proxy_url=&#34;OSG&#34; issue, you are correct that it should be passed along in the glidein arguments and indeed, they are not respecting our setting!  I have reported this problem to the glideinWMS software developers, it is pretty urgent we get it fixed.

I&#39;ll let you know when we have news on it.

Thanks,
Jeff Dost
OSG Glidein Factory Operations

-- by Jeffrey Dost at Fri Aug 08 22&#58;07&#58;04 UTC 2014

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=107499' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=107499</a></pre></div><div class='update_description'><i onclick="document.location='22018#1407514930'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-08T16:22:10+00:00">Aug 8, 2014 04:22 PM UTC</time> by <b>eduardo@....</b><a class="anchor" name="1407514930">&nbsp;</a></div><pre>Hi Brendan,
the failure of test squid was because our squid went down, due to
filling up /var/log.
I corrected to avoid future filling up. And restarted our frontier
squid. This is not related to setting proxy_url=&#34;OSG&#34;.
The proxy_url=&#34;OSG&#34; is activated when glidens are submitted with option
-proxy &#34;OSG&#34;, but at the moment this is not the case yet (I though such
setting will add option -proxy &#34;OSG&#34;). See for example an output from a
running glidein (pf -ef), not showing proxy option.

23078    10287 10281  0 10&#58;29 ?        00&#58;00&#58;00 /bin/bash
/var/lib/condor/execute/dir_10281/condor_exec.exe -v std -name v1_0
-entry CMS_T3_US_PuertoRico_grid0 -clientname UCSD-v1_0.main -schedd
schedd_glideins7@.... -factory CMS-CERN -web
<a href='http&#58;//vocms0305.cern.ch/glidefactory/stage/glidein_v1_0' target='_blank' rel='nofollow'>http&#58;//vocms0305.cern.ch/glidefactory/stage/glidein_v1_0</a> -sign
4fc49dc8f5a31d25fa1923b9def726936fd35aa2 -signentry
5e836a930fdb6624577f96931f6de785128ac58b -signtype sha1 -descript
description.e81h15.cfg -descriptentry description.e85f0E.cfg -dir Condor
-param_GLIDEIN_Client UCSD-v1_0.main -submitcredid 160364 -slotslayout
fixed -clientweb
<a href='http&#58;//glidein-frontend-2.t2.ucsd.edu&#58;8319/vofrontend/stage/frontend_UCSD-v1_0' target='_blank' rel='nofollow'>http&#58;//glidein-frontend-2.t2.ucsd.edu&#58;8319/vofrontend/stage/frontend_UCSD-v1_0</a>
-clientsign 586cb1b2afec861d203ad802514493af15a3cc01 -clientsigntype
sha1 -clientdescript description.e8797X.cfg -clientgroup main
-clientwebgroup
<a href='http&#58;//glidein-frontend-2.t2.ucsd.edu&#58;8319/vofrontend/stage/frontend_UCSD-v1_0/group_main' target='_blank' rel='nofollow'>http&#58;//glidein-frontend-2.t2.ucsd.edu&#58;8319/vofrontend/stage/frontend_UCSD-v1_0/group_main</a>
-clientsigngroup 08c56fcc31727d0351217045905bce987edd62bf
-clientdescriptgroup description.e5lfKp.cfg -param_CONDOR_VERSION
default -param_GLIDEIN_Glexec_Use OPTIONAL -param_GLIDEIN_Job_Max_Time
34800 -param_GLIDECLIENT_ReqNode vocms0305.dot,cern.dot,ch
-param_CONDOR_OS rhel6 -param_MIN_DISK_GBS 1
-param_GLIDEIN_Monitoring_Enabled False -param_CONDOR_ARCH default
-param_UPDATE_COLLECTOR_WITH_TCP True -param_USE_MATCH_AUTH True
-param_GLIDEIN_Report_Failed NEVER -param_GLIDEIN_Collector
glidein.minus,collector.minus,2.dot,t2.dot,ucsd.dot,edu.colon,9620.minus,10119.semicolon,glidein.minus,collector.dot,t2.dot,ucsd.dot,edu.colon,9620.minus,10119
-cluster 7198 -subcluster 9
<div id='show_1054449406' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1054449406'>
In any case, this is just for speed up (while saving a bandwidth)
glidein&#39;s &#34;wget&#34; downloads for configuration.

The TCP connection problems, as you see, are amplified by my NAT server,
but it is interesting the blocking start around 500 TCP connections just
for transfers!?

Below is a test from a node behind our NAT in which, I see several wgets
stuck.

wget
<a href='http&#58;//gfactory-1.t2.ucsd.edu/glidefactory//stage/glidein_v3_0/after_file_list.e7uaai.lst' target='_blank' rel='nofollow'>http&#58;//gfactory-1.t2.ucsd.edu/glidefactory//stage/glidein_v3_0/after_file_list.e7uaai.lst</a>
--2014-08-08 12&#58;02&#58;20--
<a href='http&#58;//gfactory-1.t2.ucsd.edu/glidefactory//stage/glidein_v3_0/after_file_list.e7uaai.lst' target='_blank' rel='nofollow'>http&#58;//gfactory-1.t2.ucsd.edu/glidefactory//stage/glidein_v3_0/after_file_list.e7uaai.lst</a>
Resolving gfactory-1.t2.ucsd.edu... 169.228.38.36
Connecting to gfactory-1.t2.ucsd.edu|169.228.38.36|&#58;80... ^C
[root@compute-0-4 tmp]# ping 169.228.38.36
PING 169.228.38.36 (169.228.38.36) 56(84) bytes of data.
64 bytes from 169.228.38.36&#58; icmp_seq=1 ttl=52 time=98.3 ms
64 bytes from 169.228.38.36&#58; icmp_seq=2 ttl=52 time=98.4 ms
64 bytes from 169.228.38.36&#58; icmp_seq=3 ttl=52 time=98.5 ms
64 bytes from 169.228.38.36&#58; icmp_seq=4 ttl=52 time=98.4 ms
^C
--- 169.228.38.36 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3316ms
rtt min/avg/max/mdev = 98.375/98.454/98.548/0.319 ms

I made, tests to different perfsonars going out the lab, an looks fine
until outside our campus.
I will find out, if there I am hitting some firewall restriction on
number of connections.
At the time of this test, I haven&#39;t seen connection problems on the
sandy nodes.

Could take some time.
Eduardo

On 08/07/2014 01&#58;13 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_1054449406').click(function() {
            $('#detail_1054449406').slideDown("normal");
            $('#show_1054449406').hide();
            $('#hide_1054449406').show();
        });
        $('#hide_1054449406').click(function() {
            $('#detail_1054449406').slideUp();
            $('#hide_1054449406').hide();
            $('#show_1054449406').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='22018#1407431602'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-07T17:13:22+00:00">Aug 7, 2014 05:13 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1407431602">&nbsp;</a></div><pre>Hi Eduardo,

I&#39;ve taken a look at the jobs from today and things are a little different, but there&#39;s still not much improvement.

First, for the wget validation failures, I&#39;m no longer seeing lots of random files unable to load. I did still see a few jobs fail (12 in total, from 3&#58;41AM-6&#58;29AM AST) due to being unable to load one specific file&#58;
Thu Aug 7 03&#58;41&#58;03 AST 2014 Failed to load file &#39;description.e7uaai.cfg&#39; from &#39;<a href='http&#58;//gfactory-1.t2.ucsd.edu/glidefactory//stage/glidein_v3_0&#39' target='_blank' rel='nofollow'>http&#58;//gfactory-1.t2.ucsd.edu/glidefactory//stage/glidein_v3_0&#39</a>; using proxy &#39;squid-0-0-0.local&#58;3128&#39;.

However, there&#39;s now a significant number of jobs that are failing the test_squid.sh validation script&#58;
test_squid.e5lfKp.tgz&#58; OK
Signature OK for client&#58;test_squid.e5lfKp.tgz.
test_squid.e5lfKp.sh&#58; OK
Signature OK for client&#58;test_squid.e5lfKp.sh.
Found CMS SW in /sharesoft/osg/app/cmssoft/cms
=== Validation error in /var/lib/condor/execute/dir_31612/glide_HzEoPS/client/test_squid.sh ===
Thu Aug 7 09&#58;39&#58;30 AST 2014 Error running &#39;/var/lib/condor/execute/dir_31612/glide_HzEoPS/client/test_squid.sh&#39;

I&#39;m wondering if that could be related to proxy change (setting proxy_url=&#34;OSG&#34;) that Jeff made?

Additionally, one of the original problems of the startd logs being filled with errors like the below are still there, and has not improved as far as I can tell.
08/07/14 11&#58;42&#58;58 (pid&#58;24327) attempt to connect to &#60;169.228.130.23&#58;10035&#62; failed&#58; timed out after 20 seconds.
08/07/14 11&#58;42&#58;58 (pid&#58;24327) ERROR&#58; SECMAN&#58;2003&#58;TCP connection to collector glidein-collector.t2.ucsd.edu&#58;10035 failed.
08/07/14 11&#58;42&#58;58 (pid&#58;24327) Failed to start non-blocking update to &#60;169.228.130.23&#58;10035&#62;.
08/07/14 11&#58;51&#58;28 (pid&#58;24327) attempt to connect to &#60;169.228.130.23&#58;10035&#62; failed&#58; timed out after 20 seconds.
08/07/14 11&#58;51&#58;28 (pid&#58;24327) ERROR&#58; SECMAN&#58;2003&#58;TCP connection to collector glidein-collector.t2.ucsd.edu&#58;10035 failed.
08/07/14 11&#58;51&#58;28 (pid&#58;24327) Failed to start non-blocking update to &#60;169.228.130.23&#58;10035&#62;.
08/07/14 12&#58;09&#58;03 (pid&#58;24327) No resources have been claimed for 1200 seconds

Brendan Dennis
UCSD Glidein Factory Operations

-- by Brendan Dennis at Thu Aug 07 17&#58;12&#58;35 UTC 2014

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=107499' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=107499</a></pre></div><div class='update_description'><i onclick="document.location='22018#1407340870'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-06T16:01:10+00:00">Aug 6, 2014 04:01 PM UTC</time> by <b>eduardo@....</b><a class="anchor" name="1407340870">&nbsp;</a></div><pre>Hi Jeff, Brendan
thanks for enabling squid usage, hopefully this will take effect soon.
About the NAT
kernel setting at NAT server
net.ipv4.tcp_no_metrics_save=1
helped on the connection on the worker nodes, but also the glidein
activity has been reduced.
So it is possible for you to send test jobs? and let me know now the
outcome?
I want to make sure, NAT is fixed.

For the bandwidth issue, this has to wait (december), however to know if
the connection was for bandwidth (as oppose to NAT) the connection
problem has to show on the &#34;sandy&#34; nodes, since those machine have
public ips.

Let if a test is possible.
Eduardo

On 08/05/2014 06&#58;11 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22018#1407276659'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-05T22:10:59+00:00">Aug 5, 2014 10:10 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1407276659">&nbsp;</a></div><pre>Hi Eduardo,

I have enabled squid usage in the glideins (proxy_url=&#34;OSG&#34;) on your request.

Jeff Dost
OSG Glidein Factory Operations

-- by Jeffrey Dost at Tue Aug 05 22&#58;10&#58;00 UTC 2014

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=107499' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=107499</a></pre></div><div class='update_description'><i onclick="document.location='22018#1407275529'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-05T21:52:09+00:00">Aug 5, 2014 09:52 PM UTC</time> by <b>eduardo@....</b><a class="anchor" name="1407275529">&nbsp;</a></div><pre>Hi,
I am investigating if this is a NAT problem or bandwidth.
Validation download can be fixed by setting proxy_url=&#34;OSG&#34;.
Could you do at the factory level?

But for the TCP connection, may take some time to figure out if NAT
tunning or bandwidth.
locally ping to169.228.38.39 works fine, which at the moment I am
inclined to think is NAT tunning problem. However jobs are &#34;streaming&#34; data.

I am working on this.
Eduardo

On 08/05/2014 02&#58;52 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22018#1407264775'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-05T18:52:55+00:00">Aug 5, 2014 06:52 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1407264775">&nbsp;</a></div><pre>Hi,

We&#39;ve noticed that glideins submitted to PuertoRico have begun experiencing a variety of issues due to connection problems at the site.

Some are failing validation by being unable to download the validation script files. The error being displayed in this case is&#58;

Validation failed in wget.
Failed to load file &#39;condor_config.e7uaai&#39; from &#39;<a href='http&#58;//gfactory-1.t2.ucsd.edu/glidefactory//stage/glidein_v3_0&#39' target='_blank' rel='nofollow'>http&#58;//gfactory-1.t2.ucsd.edu/glidefactory//stage/glidein_v3_0&#39</a>;.

However, it&#39;s happening to a variety of files, not just condor_config&#58;

Failed to load file &#39;grid-mapfile.e5lfKp&#39; from &#39;<a href='http&#58;//glidein-frontend-2.t2.ucsd.edu&#58;8319/vofrontend/stage/frontend_UCSD-v1_0&#39' target='_blank' rel='nofollow'>http&#58;//glidein-frontend-2.t2.ucsd.edu&#58;8319/vofrontend/stage/frontend_UCSD-v1_0&#39</a>;.
Failed to load file &#39;cat_consts.d9ufRa.sh&#39; from &#39;<a href='http&#58;//gfactory-1.t2.ucsd.edu/glidefactory//stage/glidein_v3_0&#39' target='_blank' rel='nofollow'>http&#58;//gfactory-1.t2.ucsd.edu/glidefactory//stage/glidein_v3_0&#39</a>;.
Failed to load file &#39;description.e5lfKp.cfg&#39; from &#39;<a href='http&#58;//glidein-frontend-2.t2.ucsd.edu&#58;8319/vofrontend/stage/frontend_UCSD-v1_0&#39' target='_blank' rel='nofollow'>http&#58;//glidein-frontend-2.t2.ucsd.edu&#58;8319/vofrontend/stage/frontend_UCSD-v1_0&#39</a>;.

If glideins manage to get past validation, then they begin throwing the following errors in the startd log&#58;

08/05/14 14&#58;00&#58;25 (pid&#58;17067) attempt to connect to &#60;169.228.38.39&#58;9797&#62; failed&#58; timed out after 20 seconds.
08/05/14 14&#58;00&#58;25 (pid&#58;17067) attempt to connect to &#60;169.228.130.23&#58;9797&#62; failed&#58; timed out after 20 seconds.
08/05/14 14&#58;00&#58;25 (pid&#58;17067) ERROR&#58; SECMAN&#58;2003&#58;TCP connection to collector glidein-collector-2.t2.ucsd.edu&#58;9797 failed.
08/05/14 14&#58;00&#58;25 (pid&#58;17067) Failed to start non-blocking update to &#60;169.228.38.39&#58;9797&#62;.
08/05/14 14&#58;00&#58;25 (pid&#58;17067) ERROR&#58; SECMAN&#58;2003&#58;TCP connection to collector glidein-collector.t2.ucsd.edu&#58;9797 failed.
08/05/14 14&#58;00&#58;25 (pid&#58;17067) Failed to start non-blocking update to &#60;169.228.130.23&#58;9797&#62;.
08/05/14 14&#58;08&#58;30 (pid&#58;17067) attempt to connect to &#60;169.228.38.39&#58;9797&#62; failed&#58; timed out after 20 seconds.
08/05/14 14&#58;08&#58;30 (pid&#58;17067) attempt to connect to &#60;169.228.130.23&#58;9797&#62; failed&#58; timed out after 20 seconds.
08/05/14 14&#58;08&#58;30 (pid&#58;17067) ERROR&#58; SECMAN&#58;2003&#58;TCP connection to collector glidein-collector-2.t2.ucsd.edu&#58;9797 failed.
08/05/14 14&#58;08&#58;30 (pid&#58;17067) Failed to start non-blocking update to &#60;169.228.38.39&#58;9797&#62;.
08/05/14 14&#58;08&#58;30 (pid&#58;17067) ERROR&#58; SECMAN&#58;2003&#58;TCP connection to collector glidein-collector.t2.ucsd.edu&#58;9797 failed.
08/05/14 14&#58;08&#58;30 (pid&#58;17067) Failed to start non-blocking update to &#60;169.228.130.23&#58;9797&#62;.

At this point, they will either not accept any user jobs, or if they do, the condor starter will fail due to connection issues, which causes startd to error out.

Starter Log&#58;
08/05/14 14&#58;20&#58;43 (pid&#58;20675) Communicating with shadow &#60;169.228.130.36&#58;9615?sock=95115_df35_648298&#62;
08/05/14 14&#58;20&#58;43 (pid&#58;20675) Submitting machine is &#34;submit-6.t2.ucsd.edu&#34;
<div id='show_2145583295' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_2145583295'>08/05/14 14&#58;20&#58;43 (pid&#58;20675) setting the orig job name in starter
08/05/14 14&#58;20&#58;43 (pid&#58;20675) setting the orig job iwd in starter
08/05/14 14&#58;20&#58;43 (pid&#58;20675) Done setting resource limits
08/05/14 14&#58;21&#58;13 (pid&#58;20675) attempt to connect to &#60;169.228.130.36&#58;9615&#62; failed&#58; timed out after 30 seconds.
08/05/14 14&#58;21&#58;13 (pid&#58;20675) FileTransfer&#58; Unable to connect to server &#60;169.228.130.36&#58;9615?sock=95115_df35_648298&#62;
08/05/14 14&#58;21&#58;13 (pid&#58;20675) ERROR &#34;Could not initiate file transfer&#34; at line 2024 in file /slots/08/dir_18737/userdir/src/condor_starter.V6.1/jic_shadow.cpp

Which causes this in the startd log&#58;
08/05/14 14&#58;20&#58;21 (pid&#58;17067) attempt to connect to &#60;169.228.130.36&#58;9615&#62; failed&#58; Connection timed out (connect errno = 110).  Will keep trying for 300 total seconds (237 to go).
08/05/14 14&#58;20&#58;21 (pid&#58;17067) DaemonCore&#58; Can&#39;t receive command request from 169.228.130.36 (perhaps a timeout?)
08/05/14 14&#58;21&#58;13 (pid&#58;17067) Starter pid 20675 exited with status 4

Info on the gatekeeper we&#39;re submitting to&#58;
gatekeeper=&#34;cms-grid0.hep.uprm.edu&#58;2119/jobmanager-condor&#34;
gridtype=&#34;gt5&#34;
rsl=&#34;(queue=default)(jobtype=single)&#34;

Could someone please take a look at this? Let us know if you need any more info. Thanks!

Brendan Dennis
UCSD Glidein Factory Operations.

[Ticket Origin]
<a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=107499' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=107499</a>

[Ticket History]
Subject&#58; T3_US_PuertoRico - Glideins failing due to connection problems
Ticket Type&#58; USER
CC&#58; ;cms-comp-ops-site-support-team@....
-- by Brendan Dennis at Tue Aug 05 18&#58;51&#58;50 UTC 2014
</div><script type='text/javascript'>
        $('#show_2145583295').click(function() {
            $('#detail_2145583295').slideDown("normal");
            $('#show_2145583295').hide();
            $('#hide_2145583295').show();
        });
        $('#hide_2145583295').click(function() {
            $('#detail_2145583295').slideUp();
            $('#hide_2145583295').hide();
            $('#show_2145583295').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F22018">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 22018});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
