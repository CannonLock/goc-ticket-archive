<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[7010] dCache - file removal not happening</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=7010" method="post">
<div class="page-header">
    <h3><span class="muted">7010</span> / dCache - file removal not happening</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">neha sharma</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls"></div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2009-12-09</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Neha Sharma <span class="muted"> / OSG Storage Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/7010", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/7010?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/7010?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20dCache%20-%20file%20removal%20not%20happening%20ISSUE%3D7010%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='7010#1260375665'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2009-12-09T16:21:05+00:00">Dec 9, 2009 04:21 PM UTC</time> by <b>Rob Quick</b><a class="anchor" name="1260375665">&nbsp;</a></div><pre>Neha,

Any movement here from DESY?

Thanks
Rob</pre></div><div class='update_description'><i onclick="document.location='7010#1250782245'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2009-08-20T15:30:45+00:00">Aug 20, 2009 03:30 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1250782245">&nbsp;</a></div><pre>ticket assigned to irina of desy now

desy ticket number 4573

Unfortunately the ticket holder was busy and had other priorities so I am
writing my first java patch.

Since its my first ever bug fix in the java of dCache I do not promise it
will be accepted or resolve
the issue.

I will update this ticket with status.

Hi Neha,

I am coming to the end of my top priority dev task and will put a patch
in within the week for the lock
file issue.

Regards</pre></div><div class='update_description'><i onclick="document.location='7010#1245870125'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2009-06-24T19:02:05+00:00">Jun 24, 2009 07:02 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1245870125">&nbsp;</a></div><pre>Hi Owen,

Yeah, the work around is pretty obvious if you know where to look.

The problem is the the log message is obscure and the existence of the lock is not advertised and the name of
the lock file is hidden in the code. So one can not figure out what is wrong without looking into code.
I would wonder how difficult it would be to&#58;
1. publish the location of lock in the log file
2. to add the ERROR indicator to the failure in the log so it could attract some attention

Thanks,
Tanya

----- Original Message -----
From&#58; Owen Synge via RT &#60;support@....&#62;
Date&#58; Thursday, June 11, 2009 8&#58;30 am
Subject&#58; [www.dcache.org #4573] cleaner can not start , log message is obscure
To&#58; tlevshin@....

<font color='#7F7E6F'>&#62; Dear Tanya and Will,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; I have spoken to Tigran, and we should work around this problem.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; First shut down all Java processes and check that they are all stopped</font>
<font color='#7F7E6F'>&#62; with,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; ps aux | grep java</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Once this shut down process completed, delete the &#34;GlobalLock&#34; file</font>
<font color='#7F7E6F'>&#62; then restart the dCache and see if</font>
<font color='#7F7E6F'>&#62; things work.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Unfortunately it is expected, that the lock file is empty</font>
<font color='#7F7E6F'>&#62; unfortunately. This is due to Java philosophy</font>
<font color='#7F7E6F'>&#62; being cross platform and process Id being too much of a UNIX concept,</font>
<div id='show_1217846551' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1217846551'><font color='#7F7E6F'>&#62; it is indeed a bug that the</font>
<font color='#7F7E6F'>&#62; cleaner uses a lock file at all, as this is a UNIX concept and not</font>
<font color='#7F7E6F'>&#62; cross platform.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; We do not expect to resolve the issue as a high priority as the</font>
<font color='#7F7E6F'>&#62; problem does not occur at all (as no</font>
<font color='#7F7E6F'>&#62; lock files are used) in the Chimera cleaner, and the work around is</font>
<font color='#7F7E6F'>&#62; relatively simple.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Regards</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Owen Synge</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
</div><script type='text/javascript'>
        $('#show_1217846551').click(function() {
            $('#detail_1217846551').slideDown("normal");
            $('#show_1217846551').hide();
            $('#hide_1217846551').show();
        });
        $('#hide_1217846551').click(function() {
            $('#detail_1217846551').slideUp();
            $('#hide_1217846551').hide();
            $('#show_1217846551').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='7010#1245869017'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2009-06-24T18:43:37+00:00">Jun 24, 2009 06:43 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1245869017">&nbsp;</a></div><pre>Hi Will,

I am looking at the Cleaner code, and it looks like this file is used as
&#34;cleaner&#34; lock and  is created every time on cleaner start up and deleted
when cleaner finishes.
I will talk with developers, I would assume it should some clean up on
restart that should be able to handle this situation.

Tanya</pre></div><div class='update_description'><i onclick="document.location='7010#1244648992'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2009-06-10T15:49:52+00:00">Jun 10, 2009 03:49 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1244648992">&nbsp;</a></div><pre>Tanya Levshina wrote&#58;
Hi,

1. I assume you have restarted PNFS Manger - correct? So the cleaner doesn&#39;t
work but configuration looks fine
2. Could you please try to change debug level to 3 in pnfs.batch, restart
Pnfs Manager and let us know if you see anything related to cleaner in the
log

Thanks,
Tanya

-----Original Message-----
From&#58; owner-osg-storage@....
[mailto&#58;owner-osg-storage@....] On Behalf Of Will Maier
Sent&#58; Tuesday, June 09, 2009 1&#58;17 PM
To&#58; Tanya Levshina
Cc&#58; osg-storage@....
Subject&#58; Re&#58; dCache doesn&#39;t remove files

Hi Tanya-

On Tue, Jun 09, 2009 at 11&#58;50&#58;34AM -0500, Tanya Levshina wrote&#58;

Does  directory

/opt/pnfsdb/pnfs/trash/2

exist on pnfs node?

Jup. As I mentioned in my message to Vladimir this morning, that
directory exists and contains ~170k files.
These are the files (the pnfsid&#39;s of them and the content of layer 2)
which were supposed to be deleted. When you get cleaner working it will
use these files to remove the files in the pools and will clean them up.
<div id='show_2000450654' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_2000450654'>Does there appear to be a
bug in our cleaner configuration? We&#39;ve tried simply restarting
PNFS, but that didn&#39;t prevent new files from becoming orphaned or
seem to reduce the backlog.

Thanks!
</div><script type='text/javascript'>
        $('#show_2000450654').click(function() {
            $('#detail_2000450654').slideDown("normal");
            $('#show_2000450654').hide();
            $('#hide_2000450654').show();
        });
        $('#hide_2000450654').click(function() {
            $('#detail_2000450654').slideUp();
            $('#hide_2000450654').hide();
            $('#show_2000450654').show();
        });
        </script></pre></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F7010">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
