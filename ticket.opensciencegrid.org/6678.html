<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[6678] excessive managed-fork jobs from usatlas4</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=6678" method="post">
<div class="page-header">
    <h3><span class="muted">6678</span> / excessive managed-fork jobs from usatlas4</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Peter Doherty</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">folllowup</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2009-04-27</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">SBGrid <span class="muted"> / OSG Support Centers</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/6678", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/6678?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/6678?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20excessive%20managed-fork%20jobs%20from%20usatlas4%20ISSUE%3D6678%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='6678#1240505110'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2009-04-23T16:45:10+00:00">Apr 23, 2009 04:45 PM UTC</time> by <b>SBGrid</b><a class="anchor" name="1240505110">&nbsp;</a></div><pre>That&#39;s fine, Elizabeth.  You can close the ticket.

Thanks for your help.

--Peter

On Wed Apr 22 12&#58;26&#58;05 2009, osg@.... wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='6678#1240417531'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2009-04-22T16:25:31+00:00">Apr 22, 2009 04:25 PM UTC</time> by <b>echism</b><a class="anchor" name="1240417531">&nbsp;</a></div><pre>Peter,

This ticket is getting a little confused so let&#39;s do it this way... it seems like the adjustments to your site policy (ie jobs running over an hour) is helping. Let me know if the user continues to misbehave and we&#39;ll pass it on to the abuse team. After all that is settled, we should open a new ticket if you still see RSV managed fork issues.

Thank you,
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='6678#1240401483'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2009-04-22T11:58:03+00:00">Apr 22, 2009 11:58 AM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1240401483">&nbsp;</a></div><pre>E, does not sound like Peter is seeing any RSV/Gratia issues,.. I am not sure why you thought he was... so I am removing myself from this ticket&#39;s CC. The issue he is facing appears to be purely VO-job-submission related. -ag</pre></div><div class='update_description'><i onclick="document.location='6678#1240347251'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2009-04-21T20:54:11+00:00">Apr 21, 2009 08:54 PM UTC</time> by <b>Peter Doherty</b><a class="anchor" name="1240347251">&nbsp;</a></div><pre>I emailed the user directly today, I&#39;ll wait to see if he has any
comments on the problem the jobs are causing.
I can&#39;t actually ban the user DN, because we are running GUMS 1.2,
which doesn&#39;t support this.  So if I get any more problems, I&#39;ll
disable support for the usatlas VO.
I currently have a few jobs running from this user, but they aren&#39;t
using any CPU, and they aren&#39;t completing successfully, but at least
they aren&#39;t causing a load spike on the CE.

--Peter

On Apr 20, 2009, at 12&#58;21 PM, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='6678#1240248077'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2009-04-20T17:21:17+00:00">Apr 20, 2009 05:21 PM UTC</time> by <b>Arvind Gopu</b><a class="anchor" name="1240248077">&nbsp;</a></div><pre>Peter, Elizabeth,

I do not see what the exact rsv/gratia issue you are referring to. I notice Peter said RSV probes were producing critical results (not failing per se but rather not producing OK results) due to the root problem (i.e managed-fork and the CE getting jammed).

Cheers,
Arvind</pre></div><div class='update_description'><i onclick="document.location='6678#1240236959'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2009-04-20T14:15:59+00:00">Apr 20, 2009 02:15 PM UTC</time> by <b>echism</b><a class="anchor" name="1240236959">&nbsp;</a></div><pre>Peter,

I haven&#39;t forgotten about you, I am still waiting for the rsv/gratia issue to reach some resolution.

Thanks for your patience!
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='6678#1239742451'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2009-04-14T20:54:11+00:00">Apr 14, 2009 08:54 PM UTC</time> by <b>Peter Doherty</b><a class="anchor" name="1239742451">&nbsp;</a></div><pre>Elizabeth,

Thanks for getting back to me.  It is true we have occasional workload
problems, and relatively speaking our resources are small.  You are
probably correct that supporting the larger VOs may not be in our best
interest, we&#39;d just like to make our resources available to as many
users as possible.
I haven&#39;t had the opportunity to do full forensics of the jobs that
were causing the problem, but I do wonder if it is that rsv/gratia
probe you mention.
Here&#39;s what I can tell  you.
The jobs were running with the managed-fork jobmanager.  It&#39;s my
understanding that managed fork jobs will always run on the CE.  I&#39;ve
got the CE set up, as suggested by the OSG Twiki, to only run 20
managed-fork jobs at a time, but to always accept gridmonitor jobs.
So, here&#39;s why it&#39;s interesting to me&#58;
1.) Nobody should be submitting anything other than simple jobs to
managed fork.  Compute jobs should go to the condor job manager.  So
the fact that I had well over a hundred managed-fork jobs come in over
the weekend, and they weren&#39;t just simple jobs that ran for a minute
or two and exited, they would run for hours.
2.) I saw more than 20 jobs running on the CE, which tells me they
were probably grid-monitor jobs.  And the output from ps confirmed this.

Anyhow (now I&#39;m the one writing long responses) I&#39;d be interested to
hear if there is a misconfigured rsv/gratia probe that is causing
these jobs to come into our site.  I&#39;ve got the CE offline to
transition it to a new domain name, which I&#39;ve got another ticket open
with Kyle about, and I scheduled the downtime in OIM.  When I bring
things back online, if those jobs are still coming in, I&#39;ll just ban
the User DN, until the bigger issue can be resolved.

Thanks Elizabeth!
--Peter

<div id='show_1662436576' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1662436576'>On Apr 14, 2009, at 1&#58;01 PM, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_1662436576').click(function() {
            $('#detail_1662436576').slideDown("normal");
            $('#show_1662436576').hide();
            $('#hide_1662436576').show();
        });
        $('#hide_1662436576').click(function() {
            $('#detail_1662436576').slideUp();
            $('#hide_1662436576').hide();
            $('#show_1662436576').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='6678#1239728502'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2009-04-14T17:01:42+00:00">Apr 14, 2009 05:01 PM UTC</time> by <b>echism</b><a class="anchor" name="1239728502">&nbsp;</a></div><pre>Peter,

I have noticed that the SBGrid resources experience workload problems with relative frequency. It is my understanding that the resources are relatively small, is that correct? I have given this a lot of thought and wonder if it is in your best interest to support the bigger VOs. That is all at your discretion, but it occurs to me that a smaller resource is bound to face some problems by opening itself to a VO with 2k users. Another recommendation is that you ask current site admins about what policies they find to be most successful in preventing this. The osg-sites list is a good place to ask.

In terms of the USATLAS non-responsivity, I will go ahead and alert some USATLAS personnel. The next step for you would be to contact the security team. For future reference, you are well within your rights to ban a misbehaving user&#39;s DN.

Finally (sorry this is so long), there has been some buzz about a common misconfiguration that makes an rsv/gratia probe cause problems, however there is some debate on whether the fix for that is working, so I will keep an eye on that and update you.

Thank you,
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='6678#1239634332'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2009-04-13T14:52:12+00:00">Apr 13, 2009 02:52 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1239634332">&nbsp;</a></div><pre>Hello.  I noticed Friday morning (April 10th) that starting at 3am the load on the CE for neuroinformatics.harvard.edu had climbed to 100, and the server was barely responsive.  I had about 40 jobs in the queue that had been mapped to the usatlas4 user, all running with the managed-fork job manager.  So they weren&#39;t running on the cluster nodes, all the jobs were running on the headnode.  I used condor_rm to stop the jobs, and after about 45 minutes the jobs started to vacate and the system load came down under 20.  I configured the CE to stop managed-fork jobs that were still running after an hour, and this has been the only thing keeping my CE from falling over, because these jobs have been coming in all weekend.
The user DN submitting the jobs is&#58;
/C=IT/O=INFN/OU=Personal Certificate/L=Roma 1/CN=Alessandro Di Girolamo

Friday morning I contacted the USATLAS Support Center at the email address I found on OIM&#58;
rt-racf-gridservices@....

I have not received a response.  I&#39;m going to have to either ban this user&#39;s DN, or stop supporting the usatlas VO.  Can you make a recommendation how I should handle this situation?  I&#39;ll happily supply any more information you&#39;d like.
At the moment the CE is failing some of it&#39;s RSV probes, because the managed-fork job queue is being clogged by these jobs, and the load is still high enough to cause occasional timeouts when the probes run.

Thank you.

--Peter Doherty

[META Information for OSG GOC Support Staff]
Resource where user is having this issue&#58; SBGrid-Harvard-East(142)
Selecting SBGrid(FP name&#58; SBGrid) for Destination VO since it has the highest resource ownership.
Primary Admin for SBGrid-Harvard-East is Peter Doherty and has been CC&#39;d regarding this ticket.</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F6678">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 6678});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
