<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[13030] strange gratia queries from gratiaweb1.grid.iu.edu</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=13030" method="post">
<div class="page-header">
    <h3><span class="muted">13030</span> / strange gratia queries from gratiaweb1.grid.iu.edu</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Steve Timm</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Steve Timm</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2013-01-31</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Scott Teige <span class="muted"> / OSG Operations Infrastructure</span></div><div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("https://ticket.opensciencegrid.org/attachment/list?id=13030", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="https://ticket.opensciencegrid.org/\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="https://ticket.opensciencegrid.org/\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/13030?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/13030?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20strange%20gratia%20queries%20from%20gratiaweb1.grid.iu.edu%20ISSUE%3D13030%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='13030#1363369781'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-03-15T17:49:41+00:00">Mar 15, 2013 05:49 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1363369781">&nbsp;</a></div><pre>I have not heard that this is still causing problems. Closing, please reopen if appropriate.
Scott</pre></div><div class='update_description'><i onclick="document.location='13030#1363268286'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-03-14T13:38:06+00:00">Mar 14, 2013 01:38 PM UTC</time><a class="anchor" name="1363268286">&nbsp;</a></div><pre>From my perspective there is no need to keep this ticket open or for the software team to get involved.
I didn&#39;t even know it was still open.

Steve

by /DC=org/DC=doegrids/OU=People/CN=Steven Timm 74183</pre></div><div class='update_description'><i onclick="document.location='13030#1362672370'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-03-07T16:06:10+00:00">Mar 7, 2013 04:06 PM UTC</time> by <b>Tim Cartwright</b><a class="anchor" name="1362672370">&nbsp;</a></div><pre>Scott Teige&#58; Please see my comment from a month ago. Does the Software team need to be involved in this ticket? And I might suggest that one of the GOC staff be added to the ticket, so it receives periodic attention.</pre></div><div class='update_description'><i onclick="document.location='13030#1359666149'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-01-31T21:02:29+00:00">Jan 31, 2013 09:02 PM UTC</time> by <b>Tim Cartwright</b><a class="anchor" name="1359666149">&nbsp;</a></div><pre>Is this ticket done? Or at least, is the Software team&#39;s involvement in it complete?</pre></div><div class='update_description'><i onclick="document.location='13030#1355867738'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-12-18T21:55:38+00:00">Dec 18, 2012 09:55 PM UTC</time><a class="anchor" name="1355867738">&nbsp;</a></div><pre>Steve,
These queries are not new; they have been existing earlier than March of 2009.
There was an issue reported and fixed (where I added a force index to optimize the run <a href='https&#58;//github.com/ashuguru/OSG-Measurements-Metrics/commit/7b835b03188f22424c82ff5e7414d3a7ce2324c0' target='_blank' rel='nofollow'>https&#58;//github.com/ashuguru/OSG-Measurements-Metrics/commit/7b835b03188f22424c82ff5e7414d3a7ce2324c0</a>) but this was done a year ago.
Your assumption is correct  that  once the query is requested from the database and even though the client closes the browser the query will continue to run.
Ashu

by /DC=org/DC=doegrids/OU=People/CN=Ashu Guru 897726</pre></div><div class='update_description'><i onclick="document.location='13030#1355781385'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-12-17T21:56:25+00:00">Dec 17, 2012 09:56 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1355781385">&nbsp;</a></div><pre>I am removing myself from this ticket.</pre></div><div class='update_description'><i onclick="document.location='13030#1355321166'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-12-12T14:06:06+00:00">Dec 12, 2012 02:06 PM UTC</time><a class="anchor" name="1355321166">&nbsp;</a></div><pre>I am adding Ashu Guru, Gratiaweb developer, to this ticket.
The strange queries that we saw on the day I submitted the ticket have not recurred, but what I need to know is
the following&#58;  If someone uses the custom query feature of gratiaweb to submit a very big and strange query
(querying 1 year worth of storage data, for instance), then sees that it is never going to come back, and closes their browser,
will the mysql query keep on querying the database back end at Fermilab anyway?  It looks like that&#39;s what happened.
We had to kill all of those queries with commands to kill mysql threads on our end,.

Steve Timm

by /DC=org/DC=doegrids/OU=People/CN=Steven Timm 74183</pre></div><div class='update_description'><i onclick="document.location='13030#1354308557'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-11-30T20:49:17+00:00">Nov 30, 2012 08:49 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1354308557">&nbsp;</a></div><pre>Software Team,

Do you know who can help diagnose / troubleshoot the issue Steve is reporting?

We do following to install GratiaWeb on gratiaweb.grid.iu.edu

<font color='#7F7E6F'>&#62; rpm -i <a href='http&#58;//repo.grid.iu.edu/osg-release-latest.rpm' target='_blank' rel='nofollow'>http&#58;//repo.grid.iu.edu/osg-release-latest.rpm</a></font>
<font color='#7F7E6F'>&#62; yum -y --enablerepo=epel --enablerepo=rpmforge install httpd OSG-Measurements-Metrics-Web OSG-Measurements-Metrics-Db gratiagraph-monitor-rpm</font>

And we do occasional yum update if requested from our stakeholders.

We currently run following versions.

2012-11-30 20&#58;47&#58;42 UTC [hayashis@gratiaweb1&#58;/opt/install/gratiaweb]$ yum list | grep OSG
OSG-Measurements-Metrics-Db.noarch 0.9-3                installed
OSG-Measurements-Metrics-Web.noarch
OSG-Measurements-Metrics-Db.noarch 0.9-6                osg
OSG-Measurements-Metrics-Web.noarch
OSG_Display_Data.noarch            1.0.3-2              osg

Soichi</pre></div><div class='update_description'><i onclick="document.location='13030#1353608567'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-11-22T18:22:47+00:00">Nov 22, 2012 06:22 PM UTC</time><a class="anchor" name="1353608567">&nbsp;</a></div><pre>We killed the crazy queries using the mysql KILL command and then the system came back to normal fairly soon after that.
We are back in normal dual collector/reporter configuration.
Still need to know where these came from and also to followup with the gratiaweb developers.  This was not repeated queries,
it was the same five or six queries that were stuck all day.  Could there be a failure mode in the gratiaweb such that when the user
gives up on his impossible query, that mysql still keeps churning on the query?

by /DC=org/DC=doegrids/OU=People/CN=Steven Timm 74183</pre></div><div class='update_description'><i onclick="document.location='13030#1353555503'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-11-22T03:38:23+00:00">Nov 22, 2012 03:38 AM UTC</time><a class="anchor" name="1353555503">&nbsp;</a></div><pre>I have used our High Availability mechanism to fail the gr-osg-mysql-reports.opensciencegrid.org over to the main database
on gr12x5 instead of the read-only copy on gr13x5.  Hopefully the crazy queries will time out in the next few hours and the replication
will catch up. If not, we&#39;ll attempt to restart mysql which should kill off the crazy queries, which 8 hours later are still the same queries
that I first saw.  The difficulty that makes them take so long is that they are querying on columns that are not indexed and thus the query
is generating huge temporary tables on our end.

Steve Timm

by /DC=org/DC=doegrids/OU=People/CN=Steven Timm 74183</pre></div><div class='update_description'><i onclick="document.location='13030#1353526749'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-11-21T19:39:09+00:00">Nov 21, 2012 07:39 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1353526749">&nbsp;</a></div><pre>Have found another possibility. There are several similar accesses.

200.145.46.207 - - [21/Nov/2012&#58;17&#58;09&#58;51 +0000] &#34;GET /gratia/xml HTTP/1.1&#34; 200 3092 &#34;<a href='http&#58;//gratiaweb.grid.iu.edu/gratia/xml/vo_job_cnt?endtime=2012-11-21+23%3A59%3A59&span=2419200&facility=SPRACE&probe=.*&resource-type=%5EBatch%24&vo=.*&role=.*&user=.*&starttime=2011-11-22+00%3A00%3A00&exclude-facility=NONE%7CGeneric%7CObsolete&exclude-user=NONE&includeSuccess=true&exclude-vo=unknown%7Cother&includeFailed=true&exclude-role=NONE&#34' target='_blank' rel='nofollow'>http&#58;//gratiaweb.grid.iu.edu/gratia/xml/vo_job_cnt?endtime=2012-11-21+23%3A59%3A59&span=2419200&facility=SPRACE&probe=.*&resource-type=%5EBatch%24&vo=.*&role=.*&user=.*&starttime=2011-11-22+00%3A00%3A00&exclude-facility=NONE%7CGeneric%7CObsolete&exclude-user=NONE&includeSuccess=true&exclude-vo=unknown%7Cother&includeFailed=true&exclude-role=NONE&#34</a>; &#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/534.24 (KHTML, like Gecko) Chrome/11.0.696.57 Safari/534.24&#34;

# host 200.145.46.207
207.46.145.200.in-addr.arpa domain name pointer wmsfct.ncc.unesp.br.

looks like SPRACE, support center is CMS</pre></div><div class='update_description'><i onclick="document.location='13030#1353526171'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-11-21T19:29:31+00:00">Nov 21, 2012 07:29 PM UTC</time><a class="anchor" name="1353526171">&nbsp;</a></div><pre>I have removed the graph in question. However, that query has been running for years, so I&#39;m confused on why it suddenly became a problem.

by /DC=org/DC=doegrids/OU=People/CN=Mats Rynge 274484</pre></div><div class='update_description'><i onclick="document.location='13030#1353525708'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-11-21T19:21:48+00:00">Nov 21, 2012 07:21 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1353525708">&nbsp;</a></div><pre>Adding Mats</pre></div><div class='update_description'><i onclick="document.location='13030#1353524867'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-11-21T19:07:47+00:00">Nov 21, 2012 07:07 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1353524867">&nbsp;</a></div><pre>access_log&#58;152.54.1.145 - - [21/Nov/2012&#58;18&#58;42&#58;13 +0000] &#34;GET /gratia/cumulative_graphs/facility_success_cumulative_smry?endtime=2012-11-21%2023&#58;59&#58;59&starttime=2007-03-01%2000&#58;00&#58;00&vo=engage&group=resource_group HTTP/1.0&#34; 200 125323 &#34;-&#34; &#34;Wget/1.11.4 Red Hat modified&#34;

# host 152.54.1.145
145.1.54.152.in-addr.arpa domain name pointer engage-central.</pre></div><div class='update_description'><i onclick="document.location='13030#1353523996'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-11-21T18:53:16+00:00">Nov 21, 2012 06:53 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1353523996">&nbsp;</a></div><pre>Looks like Engage, I&#39;ve contacted Mats.
Scott</pre></div><div class='update_description'><i onclick="document.location='13030#1353523002'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-11-21T18:36:42+00:00">Nov 21, 2012 06:36 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1353523002">&nbsp;</a></div><pre>On the database at Fermilab we are seeing some unusual queries from gratiaweb.grid.iu.edu.
They are unusual because of the large time frame the queries are covering, 1+years of time
and thus take much longer to execute than the normal database queries.   Have any new plots
recently been deployed on the service, or do we have a case where a user is trying to generate
custom plots?  If so, can you tell who is doing it?

The reporting database is several hours behind due to the large volume of the queries.  Any
assistance the gratiaweb developers can give would be appreciated, as well as any help that admin
staff can give as to who is doing the queries in question.

Steve Timm
Gratia Operations

Id&#58; 330852
User&#58; reader
Host&#58; gratiaweb1.grid.iu.edu&#58;44600
db&#58; gratia_osg_transfer
Command&#58; Query
Time&#58; 85708
State&#58; Copying to tmp table
Info&#58; SELECT
SiteName   ,
truncate( unix_timestamp(StartTime) / 86400, 0 ) * 86400 as time,
sum(TransferSize)/pow(1024, 3)
FROM
MasterTransferSummary R FORCE INDEX (index01)
JOIN
Probe P on R.ProbeName = P.probename
JOIN
Site S on S.siteid = P.siteid
JOIN
VONameCorrection VC ON (VC.corrid=R.VOcorrid)
JOIN
VO on (VC.void = VO.void)

<div id='show_1480020880' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1480020880'>WHERE
StartTime &#62;= &#39;2012-01-01 00&#58;00&#58;00&#39; AND
StartTime &#60; &#39;2012-08-18 23&#58;59&#58;59&#39; AND
SiteName regexp &#39;.*&#39; AND
R.Protocol regexp &#39;.*&#39; AND
VO.VOName regexp &#39;.*&#39; AND
(NOT (S.SiteName regexp &#39;NONE|Generic|Obsolete&#39;)) AND
(NOT (VO.VOName regexp &#39;unknown|other&#39;))

GROUP BY
SiteName   ,
time
*************************** 4. row ***************************
Id&#58; 330854
User&#58; reader
Host&#58; gratiaweb1.grid.iu.edu&#58;44603
db&#58; gratia_osg_transfer
Command&#58; Query
Time&#58; 85708
State&#58; Copying to tmp table
Info&#58; SELECT
SiteName   ,
truncate( unix_timestamp(StartTime) / 86400, 0 ) * 86400 as time,
sum(TransferSize)/pow(1024, 3)
FROM
MasterTransferSummary R FORCE INDEX (index01)
JOIN
Probe P on R.ProbeName = P.probename
JOIN
Site S on S.siteid = P.siteid
JOIN
VONameCorrection VC ON (VC.corrid=R.VOcorrid)
JOIN
VO on (VC.void = VO.void)

WHERE
StartTime &#62;= &#39;2011-10-18 00&#58;00&#58;00&#39; AND
StartTime &#60; &#39;2012-10-18 23&#58;59&#58;59&#39; AND
SiteName regexp &#39;UFlorida-HPC|UFlorida-PG&#39; AND
R.Protocol regexp &#39;.*&#39; AND
VO.VOName regexp &#39;.*&#39; AND
(NOT (S.SiteName regexp &#39;NONE|Generic|Obsolete&#39;)) AND
(NOT (VO.VOName regexp &#39;unknown|other&#39;))

GROUP BY
SiteName   ,
time
*************************** 5. row ***************************
Id&#58; 330856
User&#58; reader
Host&#58; gratiaweb1.grid.iu.edu&#58;44605
db&#58; gratia_osg_transfer
Command&#58; Query
Time&#58; 85708
State&#58; Copying to tmp table
Info&#58; SELECT
SiteName   ,
truncate( unix_timestamp(StartTime) / 604800, 0 ) * 604800 as time,
sum(TransferSize)/pow(1024, 3)
FROM
MasterTransferSummary R FORCE INDEX (index01)
JOIN
Probe P on R.ProbeName = P.probename
JOIN
Site S on S.siteid = P.siteid
JOIN
VONameCorrection VC ON (VC.corrid=R.VOcorrid)
JOIN
VO on (VC.void = VO.void)

WHERE
StartTime &#62;= &#39;2011-01-01 00&#58;00&#58;00&#39; AND
StartTime &#60; &#39;2012-09-11 23&#58;59&#58;59&#39; AND
SiteName regexp &#39;UFlorida-HPC|UFlorida-PG|Purdue-RCAC|Purdue-Rossmann|UCSDT2|CIT_CMS_T2|GLOW|MIT_CMS|Nebraska&#39; AND
R.Protocol regexp &#39;.*&#39; AND
VO.VOName regexp &#39;.*&#39; AND
(NOT (S.SiteName regexp &#39;NONE|Generic|Obsolete&#39;)) AND
(NOT (VO.VOName regexp &#39;unknown|other&#39;))

GROUP BY
SiteName   ,
time
*************************** 6. row ***************************
Id&#58; 330886
User&#58; reader
Host&#58; gratiaweb1.grid.iu.edu&#58;44636
db&#58; gratia_osg_transfer
Command&#58; Query
Time&#58; 85637
State&#58; Copying to tmp table
Info&#58; SELECT
SiteName   ,
truncate( unix_timestamp(StartTime) / 604800, 0 ) * 604800 as time,
sum(TransferSize)/pow(1024, 3)
FROM
MasterTransferSummary R FORCE INDEX (index01)
JOIN
Probe P on R.ProbeName = P.probename
JOIN
Site S on S.siteid = P.siteid
JOIN
VONameCorrection VC ON (VC.corrid=R.VOcorrid)
JOIN
VO on (VC.void = VO.void)

WHERE
StartTime &#62;= &#39;2011-09-11 00&#58;00&#58;00&#39; AND
StartTime &#60; &#39;2012-09-11 23&#58;59&#58;59&#39; AND
SiteName regexp &#39;.*&#39; AND
R.Protocol regexp &#39;.*&#39; AND
VO.VOName regexp &#39;.*&#39; AND
(NOT (S.SiteName regexp &#39;NONE|Generic|Obsolete&#39;)) AND
(NOT (VO.VOName regexp &#39;unknown|other&#39;))

GROUP BY
SiteName   ,
time

by /DC=org/DC=doegrids/OU=People/CN=Steven Timm 74183

</div><script type='text/javascript'>
        $('#show_1480020880').click(function() {
            $('#detail_1480020880').slideDown("normal");
            $('#show_1480020880').hide();
            $('#hide_1480020880').show();
        });
        $('#hide_1480020880').click(function() {
            $('#detail_1480020880').slideUp();
            $('#hide_1480020880').hide();
            $('#show_1480020880').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F13030">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 13030});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
