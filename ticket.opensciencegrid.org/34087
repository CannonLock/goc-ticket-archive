<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[34087] New psomd.grid.iu.edu ready; remove perfsonar1.grid.iu.edu from service</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=34087" method="post">
<div class="page-header">
    <h3><span class="muted">34087</span> / New psomd.grid.iu.edu ready; remove perfsonar1.grid.iu.edu from service</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Shawn McKee</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Resource Name</label><div class="controls">perfsonar1</div></div><div class="control-group"><label class="control-label">Associated VO</label><div class="controls">OSG</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Shawn McKee</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">OSG-GOC</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Shawn Please Review</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2017-07-11</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">OSG-GOC <span class="muted"> / OSG Support Centers</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("https://ticket.opensciencegrid.org/attachment/list?id=34087", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="https://ticket.opensciencegrid.org/\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="https://ticket.opensciencegrid.org/\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/34087?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/34087?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20New%20psomd.grid.iu.edu%20ready%3B%20remove%20perfsonar1.grid.iu.edu%20from%20service%20ISSUE%3D34087%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='34087#1500579809'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-07-20T19:43:29+00:00">Jul 20, 2017 07:43 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1500579809">&nbsp;</a></div><pre>Closing per Shawn&#39;s update.

-Kyle</pre></div><div class='update_description'><i onclick="document.location='34087#1500301217'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-07-17T14:20:17+00:00">Jul 17, 2017 02:20 PM UTC</time><a class="anchor" name="1500301217">&nbsp;</a></div><pre>Hi Everyone,

I think I have it fixed now.   I needed to add the following *inside* the etf container&#58;

[root@662603d62c56 /]# cat /etc/httpd/conf.d/redirectetf.conf
# +SPM 17-Jul-2017 Adding Rewrite for old psomd (perfsonar1) location
RedirectMatch 301 ^/WLCGperfSONAR/(.*)$ /etf/$1

The &#39;301&#39; is a permanent redirect.   So now any access to <a href='http&#58;//psomd.grid.iu.edu/WLCGperfSONAR...' target='_blank' rel='nofollow'>http&#58;//psomd.grid.iu.edu/WLCGperfSONAR...</a> redirects to <a href='http&#58;//psomd.grid.iu.edu/etf...' target='_blank' rel='nofollow'>http&#58;//psomd.grid.iu.edu/etf...</a>

(Actually to psetf.grid.iu.edu since psomd is an alias for psetf).

We can close this one.  Thanks,

Shawn

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mckee/CN=500323/CN=Shawn Mc Kee</pre></div><div class='update_description'><i onclick="document.location='34087#1499438562'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-07-07T14:42:42+00:00">Jul 7, 2017 02:42 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1499438562">&nbsp;</a></div><pre>Hi Shawn,

Have you had a chance to check the Apache configs/logs to determine where the redirect is failing?

Vince</pre></div><div class='update_description'><i onclick="document.location='34087#1498927385'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-07-01T16:43:05+00:00">Jul 1, 2017 04:43 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1498927385">&nbsp;</a></div><pre>Looks like the redirect for&#58; <a href='https&#58;//psomd.grid.iu.edu/WLCGperfSONAR/check_mk/' target='_blank' rel='nofollow'>https&#58;//psomd.grid.iu.edu/WLCGperfSONAR/check_mk/</a> is still showing 404. Are there additional changes that are needed?

Thank you,
Vince</pre></div><div class='update_description'><i onclick="document.location='34087#1497898566'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-06-19T18:56:06+00:00">Jun 19, 2017 06:56 PM UTC</time><a class="anchor" name="1497898566">&nbsp;</a></div><pre>The &#34;VIP system&#34; (by which I assume you mean LVS) is not involved with psetf.grid.iu.edu.

I am not an expert at Apache configuration and cannot see why your rewrite rule wouldn&#39;t work as you want it to. Have you tried looking in the Apache logs to see what actual path is requested when you try that URL?

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Tom Lee 472</pre></div><div class='update_description'><i onclick="document.location='34087#1497296886'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-06-12T19:48:06+00:00">Jun 12, 2017 07:48 PM UTC</time><a class="anchor" name="1497296886">&nbsp;</a></div><pre>FYI, I think the rewrite rule may need to go on the VIP system.

I tried adding this to the /etc/check_mk/apache.conf file on psetf.grid.iu.edu but it isn&#39;t redirecting&#58;

# +SPM 12-Jun-2017 Adding Rewrite for old psomd (perfsonar1) location
RewriteRule &#34;^/WLCGperfSONAR/(.*)$&#34; &#34;/etf/$1&#34;

Going to <a href='https&#58;//psomd.grid.iu.edu/WLCGperfSONAR/check_mk/' target='_blank' rel='nofollow'>https&#58;//psomd.grid.iu.edu/WLCGperfSONAR/check_mk/</a> gives&#58;

&#34;Not Found

The requested URL /WLCGperfSONAR/check_mk/ was not found on this server.

Apache/2.4.6 (CentOS) OpenSSL/1.0.1e-fips mod_fcgid/2.3.9 PHP/5.4.16 Server at psomd.grid.iu.edu Port 443&#34;

Shawn

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mckee/CN=500323/CN=Shawn Mc Kee</pre></div><div class='update_description'><i onclick="document.location='34087#1497279626'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-06-12T15:00:26+00:00">Jun 12, 2017 03:00 PM UTC</time> by <b>Shawn McKee</b><a class="anchor" name="1497279626">&nbsp;</a></div><pre>Thanks,

It is working.

I guess we may also need something else?
Tom, users may have bookmarked the previous URL&#58;

<a href='https&#58;//psomd.grid.iu.edu/WLCGperfSONAR/check_mk/' target='_blank' rel='nofollow'>https&#58;//psomd.grid.iu.edu/WLCGperfSONAR/check_mk/</a>

Could you add a redirect for that to?&#58;

<a href='https&#58;//psomd.grid.iu.edu/etf/check_mk/' target='_blank' rel='nofollow'>https&#58;//psomd.grid.iu.edu/etf/check_mk/</a>

If that is working  think we can close the ticket.

Thanks,

Shawn

On Mon, Jun 12, 2017 at 10&#58;48 AM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='34087#1497278921'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-06-12T14:48:41+00:00">Jun 12, 2017 02:48 PM UTC</time><a class="anchor" name="1497278921">&nbsp;</a></div><pre>Evidently the DNS admins did this Friday evening and put it in for Saturday morning at 7 a.m. I&#39;m seeing the psomd change in place in DNS now, pointing to psetf.grid.iu.edu.

I have brought down perfsonar1.grid.iu.edu, now that psomd.grid.iu.edu no longer points to it.

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Tom Lee 472</pre></div><div class='update_description'><i onclick="document.location='34087#1497039241'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-06-09T20:14:01+00:00">Jun 9, 2017 08:14 PM UTC</time><a class="anchor" name="1497039241">&nbsp;</a></div><pre>No response from the IU DNS admins. I&#39;m guessing they&#39;re reluctant to make changes on Friday -- or they&#39;ve gone home. I&#39;ll check again on Monday.

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Tom Lee 472</pre></div><div class='update_description'><i onclick="document.location='34087#1497032522'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-06-09T18:22:02+00:00">Jun 9, 2017 06:22 PM UTC</time><a class="anchor" name="1497032522">&nbsp;</a></div><pre>I have requested that DNS change. Once it&#39;s happened, I&#39;ll bring the perfsonar1 VM down.

I have made the change on the psetf VM giving it 6 virtual CPUs rather than 4.

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Tom Lee 472</pre></div><div class='update_description'><i onclick="document.location='34087#1497032067'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-06-09T18:14:27+00:00">Jun 9, 2017 06:14 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1497032067">&nbsp;</a></div><pre>The new replacement monitoring VM at psetf.grid.iu.edu is ready to go into production as psomd.grid.iu.edu.   The old perfsonar1.grid.iu.edu can be decommissioned and its resources made available for psetf.grid.iu.edu.

Currently the is a DNS alias for perfsonar1.grid.iu.edu as psomd.grid.iu.edu.
*Please change psomd.grid.iu.edu to now point to psetf.grid.iu.edu*
*The perfsonar1.grid.iu.edu VM can be shutdown.*   Please keep the image for the next 3 months, after which it can be deleted.
The psetf.grid.iu.edu VM could use more computing power.  *Please add 2 processors to it after perfsonar1.grid.iu.edu is shutdown.*

Let me know if there are questions about any of this.  Thanks,

Shawn

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mckee/CN=500323/CN=Shawn Mc Kee</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F34087">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 34087});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
