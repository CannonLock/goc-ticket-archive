<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[4397] dCache Low SRM write speed</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=4397" method="post">
<div class="page-header">
    <h3><span class="muted">4397</span> / dCache Low SRM write speed</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Neha Sharma</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Neha will followup/update</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2008-01-30</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Neha Sharma <span class="muted"> / OSG Storage Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/4397", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/4397?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/4397?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20dCache%20Low%20SRM%20write%20speed%20ISSUE%3D4397%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='4397#1200499539'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-01-16T16:05:39+00:00">Jan 16, 2008 04:05 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1200499539">&nbsp;</a></div><pre>No update</pre></div><div class='update_description'><i onclick="document.location='4397#1199833608'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-01-08T23:06:48+00:00">Jan 8, 2008 11:06 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1199833608">&nbsp;</a></div><pre>User didn&#39;t have a chance to try this.
He is looking at the problem at a different direction.</pre></div><div class='update_description'><i onclick="document.location='4397#1199476492'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-01-04T19:54:52+00:00">Jan 4, 2008 07:54 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1199476492">&nbsp;</a></div><pre>Pushing next action date back a day to give Neha time to followup.</pre></div><div class='update_description'><i onclick="document.location='4397#1199308834'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-01-02T21:20:34+00:00">Jan 2, 2008 09:20 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1199308834">&nbsp;</a></div><pre>Pushing next action date back a day to give Neha time to followup.</pre></div><div class='update_description'><i onclick="document.location='4397#1198082050'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2007-12-19T16:34:10+00:00">Dec 19, 2007 04:34 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1198082050">&nbsp;</a></div><pre>Hi Bockjoo,

A local transfer needs 2min30sec to 3min50sec is a little long from my understanding.
I saw this rate generally associated with long-distance WAN transfers. Besides turning
off checksum as Brian suggested, could you please also watch over the load on the
gridftp server? Also, could you please get a base network performance between your
test machine and the gridftp server? It might be good to check with another gridftp door
to see if there are any performance improvement (wn077.ihepa.ufl.edu?), as Brian has
suggested.

Just my two cents.

Regards,
Yujun

Hey Bockjoo,

So, you&#39;re saying what takes the most time is

It wastes its time in calculating &#39;offset&#39; for 1min and 30sec&#58;
debug&#58; data callback, no error, buffer 0xf778d008, length 1048576, offset=2742026240,
eof=false
debug&#58; data callback, no error, buffer 0xf798f008, length 1048576, offset=2746220544,
eof=false
debug&#58; data callback, no error, buffer 0xf788e008, length 4644, offset=2748317696,
eof=true

&#60;right here&#62;

debug&#58; response from <a href='gsiftp&#58;//wn005.ihepa.ufl.edu&#58;2811///cmsdata/test/load_test.dat&#58' target='_blank' rel='nofollow'>gsiftp&#58;//wn005.ihepa.ufl.edu&#58;2811///cmsdata/test/load_test.dat&#58</a>;
226 Transfer complete.

?

The offset stuff is when the actual file transfer is occurring.  If the transfer does
<div id='show_403831839' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_403831839'>pause there, it could be due to checksumming.  Why don&#39;t you try turning off
checksums on just that gridftp node, and see if things speed up?  The checksum
calculation is a bit awkward (as it goes through the file sequentially) and can
heavily thrash disk I/O if you have a TCP stream which is offset from the rest.  You
can see in the logs that there is at least one stream a couple hundred megabytes
behind the others at one point.

Hi Brian,
I checked the g-u-c&#58; (  time globus-url-copy -dbg -vb -p 10 -tcp-bs 4000000
file&#58;///&#96;pwd&#96;/load_test.dat
<a href='gsiftp&#58;//wn005.ihepa.ufl.edu&#58;2811///cmsdata/test/load_test.dat' target='_blank' rel='nofollow'>gsiftp&#58;//wn005.ihepa.ufl.edu&#58;2811///cmsdata/test/load_test.dat</a> &#62; guc.log )
Full log is here&#58; <a href='http&#58;//tier2.ihepa.ufl.edu/t2/operations/guc.log' target='_blank' rel='nofollow'>http&#58;//tier2.ihepa.ufl.edu/t2/operations/guc.log</a>

It wastes its time in calculating &#39;offset&#39; for 1min and 30sec&#58;
debug&#58; data callback, no error, buffer 0xf778d008, length 1048576, offset=2742026240,
eof=false
debug&#58; data callback, no error, buffer 0xf798f008, length 1048576, offset=2746220544,
eof=false
debug&#58; data callback, no error, buffer 0xf788e008, length 4644, offset=2748317696,
eof=true
debug&#58; response from <a href='gsiftp&#58;//wn005.ihepa.ufl.edu&#58;2811///cmsdata/test/load_test.dat&#58' target='_blank' rel='nofollow'>gsiftp&#58;//wn005.ihepa.ufl.edu&#58;2811///cmsdata/test/load_test.dat&#58</a>;
226 Transfer complete.

I must be doing something not normal in our dCache configuration.
Actual file transfer varies between 1min and 2min20sec.
Total time in g-u-c takes between 2min30sec and 3min50sec (info limited by
statistics, though).
Thanks,
Bockjoo

Hey Bockjoo,

I would note that perhaps a better forum for these sort of issues is the OSG-storage
list (osg-storage@....).  CMS funds (to some extent) those folks to
debug precisely these sort of issues.

That said, I think the problem here is the amount of time it takes the GFTP door to
start the transfer.  If this is correct, this can be indicative of several things&#58;

1) Slow response of the PNFS server (GFTP door must look up the file name).
2) Slow response of the PoolManager (GFTP door must ask the PoolManager for a pool
which has this file).
3) Slow response of the pool (Pool must agree to do the transfer and set up the
socket adapter).

I would retry the transfer with globus-url-copy on that specific door.  Turn on the
debug info and send the results out to the list; that we, we will be able to see
exactly which command things hang on.

Brian

On Dec 17, 2007, at 9&#58;24 AM, Bockjoo Kim wrote&#58;

Hi,
I am investigating why our dCache-srm write speed is so low.
In my timed srmcp test between local disk to srm, it takes 4min14sec
for 2.7GB file (See below).
I broke down timing contribution (by manually counting seconds during the operation)&#58;
1 110sec
Between
GridftpClient&#58; parallelism&#58; 10
and
GridftpClient&#58; adler 32 for file java.io.RandomAccessFile@83e96cf is 858159142
2 2sec
Between
GridftpClient&#58; adler 32 for file java.io.RandomAccessFile@83e96cf is 858159142
and
GridftpClient&#58; gridFtpWrite&#58; starting the transfer in emode to
//cmsdata/test/load_test.dat
3 81sec
Between
GridftpClient&#58; gridFtpWrite&#58; starting the transfer in emode to
//cmsdata/test/load_test.dat
and
GridftpClient&#58; DiskDataSink.close() called
4 47sec
Between
GridftpClient&#58; DiskDataSink.close() called
and
stopping copier

5 6sec (systematic error)

I am wondering if the time it took in the interval 1 (110sec) is normal.
How can I improve these contributions?
Thanks,
Bockjoo
</div><script type='text/javascript'>
        $('#show_403831839').click(function() {
            $('#detail_403831839').slideDown("normal");
            $('#show_403831839').hide();
            $('#hide_403831839').show();
        });
        $('#hide_403831839').click(function() {
            $('#detail_403831839').slideUp();
            $('#hide_403831839').hide();
            $('#show_403831839').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F4397">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
