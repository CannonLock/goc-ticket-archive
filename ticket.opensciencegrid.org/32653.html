<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[32653] OSG Production RSV perfSONAR no longer sending messages to CERN AMQ</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=32653" method="post">
<div class="page-header">
    <h3><span class="muted">32653</span> / OSG Production RSV perfSONAR no longer sending messages to CERN AMQ</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Shawn McKee</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Resource Name</label><div class="controls">psds0</div></div><div class="control-group"><label class="control-label">Associated VO</label><div class="controls">Ops</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Shawn McKee</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">OSG-GOC</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Scott to update</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2017-03-06</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Kyle Gross <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">Thomas Lee <span class="muted"> / OSG Operations Infrastructure</span></div><div class="assignee" style="width: 60%">Scott Teige <span class="muted"> / OSG Operations Infrastructure</span></div><div class="assignee" style="width: 60%">OSG-GOC <span class="muted"> / OSG Support Centers</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/32653", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/32653?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/32653?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20OSG%20Production%20RSV%20perfSONAR%20no%20longer%20sending%20messages%20to%20CERN%20AMQ%20ISSUE%3D32653%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='32653#1489683371'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-03-16T16:56:11+00:00">Mar 16, 2017 04:56 PM UTC</time> by <b>Shawn McKee</b><a class="anchor" name="1489683371">&nbsp;</a></div><pre>Hi Edgar,

Yes, we can close it even though I am not sure we really found the root
problem.
If needed we open another ticket.

Thanks,

Shawn

On Thu, Mar 16, 2017 at 12&#58;46 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='32653#1489682783'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-03-16T16:46:23+00:00">Mar 16, 2017 04:46 PM UTC</time><a class="anchor" name="1489682783">&nbsp;</a></div><pre>Hi Shawn,

Since we found the problem of this. Can I close this ticket?

Cheers,

Edgar

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Edgar Mauricio Fajardo Hernandez 2020</pre></div><div class='update_description'><i onclick="document.location='32653#1488228525'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-27T20:48:45+00:00">Feb 27, 2017 08:48 PM UTC</time><a class="anchor" name="1488228525">&nbsp;</a></div><pre>Hi Scott,

The ones running httpd.    Right now I know of psds0, psds-itb1 and perfsonar-itb.    If you use configuration management of the /etc/httpd/conf/httpd.conf file you could just fix it there?

Thanks,

Shawn

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mckee/CN=500323/CN=Shawn Mc Kee</pre></div><div class='update_description'><i onclick="document.location='32653#1488228445'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-27T20:47:25+00:00">Feb 27, 2017 08:47 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1488228445">&nbsp;</a></div><pre>Just to be clear, you asked for this on psds0. Do you want it on other perfsonar components? Which ones?</pre></div><div class='update_description'><i onclick="document.location='32653#1488217912'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-27T17:51:52+00:00">Feb 27, 2017 05:51 PM UTC</time><a class="anchor" name="1488217912">&nbsp;</a></div><pre>Hi Scott,

We do track the status of postgresql and it will cause a problem to show up in the RSV monitoring if it is down&#58;
<a href='https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/check_mk/index.py?start_url=%2FWLCGperfSONAR%2Fcheck_mk%2Fview.py%3Fview_name%3Dhost%26host%3Dpsds0%26site%3D' target='_blank' rel='nofollow'>https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/check_mk/index.py?start_url=%2FWLCGperfSONAR%2Fcheck_mk%2Fview.py%3Fview_name%3Dhost%26host%3Dpsds0%26site%3D</a>

I would rather keep that as is for now unless we are hitting regular problems with postgresql stopping that we can&#39;t find a quick solution for.   I think it is more important to get the monitoring on httpd (apache_status) since that was implicated in the debugging from the problem this last weekend.   All OSG network services running httpd should have /server-status enabled with the ExtendedStatus=on.

Thanks,

Shawn

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mckee/CN=500323/CN=Shawn Mc Kee</pre></div><div class='update_description'><i onclick="document.location='32653#1488216832'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-27T17:33:52+00:00">Feb 27, 2017 05:33 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1488216832">&nbsp;</a></div><pre>Should I turn this back on?

#* * * * * root if ! /sbin/service postgresql-9.4 status &#62;&/dev/null; then /sbin/service postgresql-9.4 restart &#62;&/dev/null; echo &#34;PostgreSQL dead on psds0; restarted&#34; &#62;/dev/stderr; fi

IIRC, it thrashes when there is a problem that prevents postgresql from running correctly.</pre></div><div class='update_description'><i onclick="document.location='32653#1488207845'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-27T15:04:05+00:00">Feb 27, 2017 03:04 PM UTC</time><a class="anchor" name="1488207845">&nbsp;</a></div><pre>For example, on perfsonar-itb I get&#58;

2017-02-27 14&#58;57&#58;37 UTC [root@perfsonar-itb&#58;~]# curl http&#58;//127.0.0.1/server-status
&#60;!DOCTYPE HTML PUBLIC &#34;-//IETF//DTD HTML 2.0//EN&#34;&#62;
&#60;html&#62;&#60;head&#62;
&#60;title&#62;404 Not Found&#60;/title&#62;
&#60;/head&#62;&#60;body&#62;
&#60;h1&#62;Not Found&#60;/h1&#62;
&#60;p&#62;The requested URL /server-status was not found on this server.&#60;/p&#62;
&#60;hr&#62;
&#60;address&#62;Apache/2.2.15 (CentOS) Server at 127.0.0.1 Port 80&#60;/address&#62;
&#60;/body&#62;&#60;/html&#62;

I then edited the /etc/httpd/conf/httpd.conf file and commented out&#58;
ExtendedStatus=on

And commented out/edited
# Change the &#34;.example.com&#34; to match your domain to enable.
#
&#60;Location /server-status&#62;
SetHandler server-status
Order deny,allow
Deny from all
Allow from 127.0.0.1
&#60;/Location&#62;

I did &#39;service httpd reload&#39; and now I get&#58;

2017-02-27 15&#58;03&#58;21 UTC [root@perfsonar-itb&#58;~]# curl http&#58;//127.0.0.1/server-status
&#60;!DOCTYPE HTML PUBLIC &#34;-//W3C//DTD HTML 3.2 Final//EN&#34;&#62;
&#60;html&#62;&#60;head&#62;
&#60;title&#62;Apache Status&#60;/title&#62;
&#60;/head&#62;&#60;body&#62;
&#60;h1&#62;Apache Server Status for 127.0.0.1&#60;/h1&#62;

<div id='show_1834954273' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1834954273'>&#60;dl&#62;&#60;dt&#62;Server Version&#58; Apache/2.2.15 (Unix) DAV/2 mod_fcgid/2.3.9 mod_ssl/2.2.15 OpenSSL/1.0.1e-fips mod_wsgi/3.2 Python/2.7.5 mod_perl/2.0.4 Perl/v5.10.1&#60;/dt&#62;
&#60;dt&#62;Server Built&#58; Jan 12 2017 17&#58;09&#58;39
&#60;/dt&#62;&#60;/dl&#62;&#60;hr /&#62;&#60;dl&#62;
&#60;dt&#62;Current Time&#58; Monday, 27-Feb-2017 15&#58;03&#58;45 UTC&#60;/dt&#62;
&#60;dt&#62;Restart Time&#58; Monday, 27-Feb-2017 15&#58;02&#58;27 UTC&#60;/dt&#62;
&#60;dt&#62;Parent Server Generation&#58; 2&#60;/dt&#62;
&#60;dt&#62;Server uptime&#58;  1 minute 17 seconds&#60;/dt&#62;
&#60;dt&#62;Total accesses&#58; 26 - Total Traffic&#58; 209 kB&#60;/dt&#62;
&#60;dt&#62;CPU Usage&#58; u.18 s.04 cu0 cs0 - .286% CPU load&#60;/dt&#62;
...

Thanks

Shawn

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mckee/CN=500323/CN=Shawn Mc Kee
</div><script type='text/javascript'>
        $('#show_1834954273').click(function() {
            $('#detail_1834954273').slideDown("normal");
            $('#show_1834954273').hide();
            $('#hide_1834954273').show();
        });
        $('#hide_1834954273').click(function() {
            $('#detail_1834954273').slideUp();
            $('#hide_1834954273').hide();
            $('#show_1834954273').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='32653#1488207283'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-27T14:54:43+00:00">Feb 27, 2017 02:54 PM UTC</time><a class="anchor" name="1488207283">&nbsp;</a></div><pre>Hi Scott,

I still don&#39;t see the apache_status check showing up.    Can you verify this works on the nodes (like psds0) where you made sure ExtendedStatus=on?

curl http&#58;//127.0.0.1/server-status

you should get a web page, something like&#58;

[root@omd ~]#  curl http&#58;//127.0.0.1/server-status
&#60;!DOCTYPE HTML PUBLIC &#34;-//W3C//DTD HTML 3.2 Final//EN&#34;&#62;
&#60;html&#62;&#60;head&#62;
&#60;title&#62;Apache Status&#60;/title&#62;
&#60;/head&#62;&#60;body&#62;
&#60;h1&#62;Apache Server Status for 127.0.0.1&#60;/h1&#62;

&#60;dl&#62;&#60;dt&#62;Server Version&#58; Apache/2.2.15 (Unix) DAV/2 mod_fcgid/2.3.9 PHP/5.3.3 mod_python/3.3.1 Python/2.6.6 mod_ssl/2.2.15 OpenSSL/1.0.1e-fips&#60;/dt&#62;
&#60;dt&#62;Server Built&#58; Jul 18 2016 15&#58;12&#58;33
&#60;/dt&#62;&#60;/dl&#62;&#60;hr /&#62;&#60;dl&#62;
&#60;dt&#62;Current Time&#58; Monday, 27-Feb-2017 09&#58;51&#58;35 EST&#60;/dt&#62;
&#60;dt&#62;Restart Time&#58; Sunday, 26-Feb-2017 03&#58;15&#58;11 EST&#60;/dt&#62;
&#60;dt&#62;Parent Server Generation&#58; 36&#60;/dt&#62;
&#60;dt&#62;Server uptime&#58;  1 day 6 hours 36 minutes 24 seconds&#60;/dt&#62;
...

If you get something like this&#58;

[smckee@umt3int01 masterfiles]$ curl http&#58;//127.0.0.1/server-status
curl&#58; (7) couldn&#39;t connect to host

You need to implement the other part of the configuration I sent&#58;

&#60;Location /server-status&#62;
SetHandler server-status
Order deny,allow
Deny from all
<div id='show_1016115340' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1016115340'>Allow from 127.0.0.1
&#60;/Location&#62;

Thanks,

Shawn

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mckee/CN=500323/CN=Shawn Mc Kee
</div><script type='text/javascript'>
        $('#show_1016115340').click(function() {
            $('#detail_1016115340').slideDown("normal");
            $('#show_1016115340').hide();
            $('#hide_1016115340').show();
        });
        $('#hide_1016115340').click(function() {
            $('#detail_1016115340').slideUp();
            $('#hide_1016115340').hide();
            $('#show_1016115340').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='32653#1488205336'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-27T14:22:16+00:00">Feb 27, 2017 02:22 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1488205336">&nbsp;</a></div><pre>ExtendedStatus On was commented out, no clues as to why. Changed it, restarted httpd.</pre></div><div class='update_description'><i onclick="document.location='32653#1488039481'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-25T16:18:01+00:00">Feb 25, 2017 04:18 PM UTC</time><a class="anchor" name="1488039481">&nbsp;</a></div><pre>Further update.  Checking httpd logs shows problems&#58;

[0] 16&#58;14&#58;49 UTC [smckee@jump&#58;httpd]$ cat error_log
[Sat Feb 25 03&#58;34&#58;24 2017] [notice] Digest&#58; generating secret for digest authentication ...
[Sat Feb 25 03&#58;34&#58;24 2017] [notice] Digest&#58; done
[Sat Feb 25 03&#58;34&#58;25 2017] [notice] Apache/2.2.15 (Unix) DAV/2 mod_wsgi/3.2 Python/2.7.5 configured -- resuming normal operations
[Sat Feb 25 03&#58;34&#58;28 2017] [error] path= [&#39;/usr/lib/esmond/esmond&#39;, &#39;/usr/lib/esmond/lib/python2.7&#39;, &#39;/usr/lib/esmond/src/dlnetsnmp/lib&#39;, &#39;/usr/lib/esmond&#39;, &#39;/usr/lib/esmond/esmond_client&#39;, &#39;/usr/lib/esmond/lib64/python27.zip&#39;, &#39;/usr/lib/esmond/lib64/python2.7&#39;, &#39;/usr/lib/esmond/lib64/python2.7/plat-linux2&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-tk&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-old&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-dynload&#39;, &#39;/opt/rh/python27/root/usr/lib64/python2.7&#39;, &#39;/opt/rh/python27/root/usr/lib/python2.7&#39;, &#39;/usr/lib/esmond/lib/python2.7/site-packages&#39;]
[Sat Feb 25 03&#58;34&#58;28 2017] [error] path= [&#39;/usr/lib/esmond/esmond&#39;, &#39;/usr/lib/esmond/lib/python2.7&#39;, &#39;/usr/lib/esmond/src/dlnetsnmp/lib&#39;, &#39;/usr/lib/esmond&#39;, &#39;/usr/lib/esmond/esmond_client&#39;, &#39;/usr/lib/esmond/lib64/python27.zip&#39;, &#39;/usr/lib/esmond/lib64/python2.7&#39;, &#39;/usr/lib/esmond/lib64/python2.7/plat-linux2&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-tk&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-old&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-dynload&#39;, &#39;/opt/rh/python27/root/usr/lib64/python2.7&#39;, &#39;/opt/rh/python27/root/usr/lib/python2.7&#39;, &#39;/usr/lib/esmond/lib/python2.7/site-packages&#39;]
[Sat Feb 25 03&#58;34&#58;28 2017] [error] path= [&#39;/usr/lib/esmond/esmond&#39;, &#39;/usr/lib/esmond/lib/python2.7&#39;, &#39;/usr/lib/esmond/src/dlnetsnmp/lib&#39;, &#39;/usr/lib/esmond&#39;, &#39;/usr/lib/esmond/esmond_client&#39;, &#39;/usr/lib/esmond/lib64/python27.zip&#39;, &#39;/usr/lib/esmond/lib64/python2.7&#39;, &#39;/usr/lib/esmond/lib64/python2.7/plat-linux2&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-tk&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-old&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-dynload&#39;, &#39;/opt/rh/python27/root/usr/lib64/python2.7&#39;, &#39;/opt/rh/python27/root/usr/lib/python2.7&#39;, &#39;/usr/lib/esmond/lib/python2.7/site-packages&#39;]
[Sat Feb 25 03&#58;34&#58;28 2017] [error] path= [&#39;/usr/lib/esmond/esmond&#39;, &#39;/usr/lib/esmond/lib/python2.7&#39;, &#39;/usr/lib/esmond/src/dlnetsnmp/lib&#39;, &#39;/usr/lib/esmond&#39;, &#39;/usr/lib/esmond/esmond_client&#39;, &#39;/usr/lib/esmond/lib64/python27.zip&#39;, &#39;/usr/lib/esmond/lib64/python2.7&#39;, &#39;/usr/lib/esmond/lib64/python2.7/plat-linux2&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-tk&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-old&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-dynload&#39;, &#39;/opt/rh/python27/root/usr/lib64/python2.7&#39;, &#39;/opt/rh/python27/root/usr/lib/python2.7&#39;, &#39;/usr/lib/esmond/lib/python2.7/site-packages&#39;]
[Sat Feb 25 03&#58;34&#58;28 2017] [error] path= [&#39;/usr/lib/esmond/esmond&#39;, &#39;/usr/lib/esmond/lib/python2.7&#39;, &#39;/usr/lib/esmond/src/dlnetsnmp/lib&#39;, &#39;/usr/lib/esmond&#39;, &#39;/usr/lib/esmond/esmond_client&#39;, &#39;/usr/lib/esmond/lib64/python27.zip&#39;, &#39;/usr/lib/esmond/lib64/python2.7&#39;, &#39;/usr/lib/esmond/lib64/python2.7/plat-linux2&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-tk&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-old&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-dynload&#39;, &#39;/opt/rh/python27/root/usr/lib64/python2.7&#39;, &#39;/opt/rh/python27/root/usr/lib/python2.7&#39;, &#39;/usr/lib/esmond/lib/python2.7/site-packages&#39;]
[Sat Feb 25 03&#58;34&#58;28 2017] [error] path= [&#39;/usr/lib/esmond/esmond&#39;, &#39;/usr/lib/esmond/lib/python2.7&#39;, &#39;/usr/lib/esmond/src/dlnetsnmp/lib&#39;, &#39;/usr/lib/esmond&#39;, &#39;/usr/lib/esmond/esmond_client&#39;, &#39;/usr/lib/esmond/lib64/python27.zip&#39;, &#39;/usr/lib/esmond/lib64/python2.7&#39;, &#39;/usr/lib/esmond/lib64/python2.7/plat-linux2&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-tk&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-old&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-dynload&#39;, &#39;/opt/rh/python27/root/usr/lib64/python2.7&#39;, &#39;/opt/rh/python27/root/usr/lib/python2.7&#39;, &#39;/usr/lib/esmond/lib/python2.7/site-packages&#39;]
[Sat Feb 25 03&#58;34&#58;28 2017] [error] path= [&#39;/usr/lib/esmond/esmond&#39;, &#39;/usr/lib/esmond/lib/python2.7&#39;, &#39;/usr/lib/esmond/src/dlnetsnmp/lib&#39;, &#39;/usr/lib/esmond&#39;, &#39;/usr/lib/esmond/esmond_client&#39;, &#39;/usr/lib/esmond/lib64/python27.zip&#39;, &#39;/usr/lib/esmond/lib64/python2.7&#39;, &#39;/usr/lib/esmond/lib64/python2.7/plat-linux2&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-tk&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-old&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-dynload&#39;, &#39;/opt/rh/python27/root/usr/lib64/python2.7&#39;, &#39;/opt/rh/python27/root/usr/lib/python2.7&#39;, &#39;/usr/lib/esmond/lib/python2.7/site-packages&#39;]
[Sat Feb 25 03&#58;34&#58;28 2017] [error] path= [&#39;/usr/lib/esmond/esmond&#39;, &#39;/usr/lib/esmond/lib/python2.7&#39;, &#39;/usr/lib/esmond/src/dlnetsnmp/lib&#39;, &#39;/usr/lib/esmond&#39;, &#39;/usr/lib/esmond/esmond_client&#39;, &#39;/usr/lib/esmond/lib64/python27.zip&#39;, &#39;/usr/lib/esmond/lib64/python2.7&#39;, &#39;/usr/lib/esmond/lib64/python2.7/plat-linux2&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-tk&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-old&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-dynload&#39;, &#39;/opt/rh/python27/root/usr/lib64/python2.7&#39;, &#39;/opt/rh/python27/root/usr/lib/python2.7&#39;, &#39;/usr/lib/esmond/lib/python2.7/site-packages&#39;]
[Sat Feb 25 03&#58;34&#58;29 2017] [error] path= [&#39;/usr/lib/esmond/esmond&#39;, &#39;/usr/lib/esmond/lib/python2.7&#39;, &#39;/usr/lib/esmond/src/dlnetsnmp/lib&#39;, &#39;/usr/lib/esmond&#39;, &#39;/usr/lib/esmond/esmond_client&#39;, &#39;/usr/lib/esmond/lib64/python27.zip&#39;, &#39;/usr/lib/esmond/lib64/python2.7&#39;, &#39;/usr/lib/esmond/lib64/python2.7/plat-linux2&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-tk&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-old&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-dynload&#39;, &#39;/opt/rh/python27/root/usr/lib64/python2.7&#39;, &#39;/opt/rh/python27/root/usr/lib/python2.7&#39;, &#39;/usr/lib/esmond/lib/python2.7/site-packages&#39;]
[Sat Feb 25 03&#58;34&#58;30 2017] [error] path= [&#39;/usr/lib/esmond/esmond&#39;, &#39;/usr/lib/esmond/lib/python2.7&#39;, &#39;/usr/lib/esmond/src/dlnetsnmp/lib&#39;, &#39;/usr/lib/esmond&#39;, &#39;/usr/lib/esmond/esmond_client&#39;, &#39;/usr/lib/esmond/lib64/python27.zip&#39;, &#39;/usr/lib/esmond/lib64/python2.7&#39;, &#39;/usr/lib/esmond/lib64/python2.7/plat-linux2&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-tk&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-old&#39;, &#39;/usr/lib/esmond/lib64/python2.7/lib-dynload&#39;, &#39;/opt/rh/python27/root/usr/lib64/python2.7&#39;, &#39;/opt/rh/python27/root/usr/lib/python2.7&#39;, &#39;/usr/lib/esmond/lib/python2.7/site-packages&#39;]
[Sat Feb 25 03&#58;35&#58;31 2017] [error] [client 127.0.0.1] Script timed out before returning headers&#58; wsgi.py
[Sat Feb 25 03&#58;35&#58;31 2017] [error] [client 127.0.0.1] Script timed out before returning headers&#58; wsgi.py
[Sat Feb 25 03&#58;35&#58;31 2017] [error] [client 127.0.0.1] Script timed out before returning headers&#58; wsgi.py
[Sat Feb 25 03&#58;35&#58;31 2017] [error] [client 127.0.0.1] Script timed out before returning headers&#58; wsgi.py
[Sat Feb 25 03&#58;35&#58;31 2017] [error] [client 127.0.0.1] Script timed out before returning headers&#58; wsgi.py
[Sat Feb 25 03&#58;35&#58;31 2017] [error] [client 127.0.0.1] Script timed out before returning headers&#58; wsgi.py
[Sat Feb 25 03&#58;35&#58;31 2017] [error] [client 127.0.0.1] Script timed out before returning headers&#58; wsgi.py
[Sat Feb 25 03&#58;35&#58;31 2017] [error] [client 127.0.0.1] Script timed out before returning headers&#58; wsgi.py
...
[Sat Feb 25 03&#58;46&#58;23 2017] [error] [client 127.0.0.1] Script timed out before returning headers&#58; wsgi.py
[Sat Feb 25 03&#58;46&#58;32 2017] [error] [client 127.0.0.1] Script timed out before returning headers&#58; wsgi.py
[Sat Feb 25 03&#58;46&#58;51 2017] [error] [client 127.0.0.1] Script timed out before returning headers&#58; wsgi.py
[Sat Feb 25 03&#58;46&#58;58 2017] [error] [client 127.0.0.1] Script timed out before returning headers&#58; wsgi.py
[Sat Feb 25 03&#58;47&#58;01 2017] [error] [client 127.0.0.1] Script timed out before returning headers&#58; wsgi.py
[Sat Feb 25 04&#58;31&#58;33 2017] [error] server reached MaxClients setting, consider raising the MaxClients setting

So the root of the  problem may be an issue in httpd configuration which somehow changes at ~3&#58;20-3&#58;40 AM UTC?

Shawn
<div id='show_1529357577' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1529357577'>
by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mckee/CN=500323/CN=Shawn Mc Kee
</div><script type='text/javascript'>
        $('#show_1529357577').click(function() {
            $('#detail_1529357577').slideDown("normal");
            $('#show_1529357577').hide();
            $('#hide_1529357577').show();
        });
        $('#hide_1529357577').click(function() {
            $('#detail_1529357577').slideUp();
            $('#hide_1529357577').hide();
            $('#show_1529357577').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='32653#1488038629'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-25T16:03:49+00:00">Feb 25, 2017 04:03 PM UTC</time><a class="anchor" name="1488038629">&nbsp;</a></div><pre>The data publication to the message bus again stopped last night (Feb 24 2017) around 22&#58;39 PM Eastern time.   We received the usual email notification from CERN.

Looking around more while it is in this state I find the folllowing&#58;

1) The rsv page is not working <a href='http&#58;//psd0.grid.iu.edu/rsv' target='_blank' rel='nofollow'>http&#58;//psd0.grid.iu.edu/rsv</a>  (the ITB one works but shows a problem <a href='http&#58;//psds-itb1.grid.iu.edu/rsv' target='_blank' rel='nofollow'>http&#58;//psds-itb1.grid.iu.edu/rsv</a>)

Side note&#58;  check_mk is NOT monitoring the apache_status because we need the httpd configuration tweak I sent before to all opening http&#58;//127.0.0.1/&#58;
&#60;Location /server-status&#62;
SetHandler server-status
Order deny,allow
Deny from all
Allow from 127.0.0.1
&#60;/Location&#62;
ExtendedStatus On

2) The number of Postgresql Daemon Sessions dropped to 1 (see <a href='https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/check_mk/index.py?start_url=%2FWLCGperfSONAR%2Fpnp4nagios%2Findex.php%2Fgraph%3Fhost%3Dpsds0%26srv%3DPostgreSQL_Daemon_Sessions%26theme%3Dmultisite%26baseurl%3D..%2Fcheck_mk%2F' target='_blank' rel='nofollow'>https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/check_mk/index.py?start_url=%2FWLCGperfSONAR%2Fpnp4nagios%2Findex.php%2Fgraph%3Fhost%3Dpsds0%26srv%3DPostgreSQL_Daemon_Sessions%26theme%3Dmultisite%26baseurl%3D..%2Fcheck_mk%2F</a> and scroll down to see that it stopped at around 22&#58;39)

3) There are a significant number of ERROR and CRITICAL messages in the files /net/nas01/Public/logs/psds0/rsv/metrics

One ERROR example
uct2-net1.mwt2.org__org.osg.general.perfsonar-simple.err&#58;ERROR&#58; Metric does not exist at /usr/libexec/rsv/metrics/True

Stats&#58;

[0] 15&#58;04&#58;48 UTC [smckee@jump&#58;metrics]$ grep ERROR *.err | wc
253    1771   31172
[0] 15&#58;04&#58;53 UTC [smckee@jump&#58;metrics]$ ls *.err | wc
269     269   16445

One CRITICAL example

[0] 15&#58;26&#58;32 UTC [smckee@jump&#58;metrics]$ grep CRITICAL -A10 uct2-net1.mwt2.org__org.osg.general.perfsonar-simple.out
metricStatus&#58; CRITICAL
serviceType&#58; Perfsonar-Monitor
serviceURI&#58; uct2-net1.mwt2.org
<div id='show_132851999' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_132851999'>gatheredAt&#58; psds0.grid.iu.edu
summaryData&#58; CRITICAL
detailsData&#58; CRITICAL&#58; Failed running the caller
2017-02-25T15&#58;11&#58;49Z
MSG&#58; Last succesfull run at Sat, 25 Feb 2017 06&#58;15&#58;22
MSG&#58;
MSG&#58; ERROR&#58;! Unsuccessful! Exception&#58; &#34;Unable to connect to <a href='https&#58;//uct2-net1.mwt2.org' target='_blank' rel='nofollow'>https&#58;//uct2-net1.mwt2.org</a>, exception was [Errno 336265218] _ssl.c&#58;351&#58; error&#58;140B0002&#58;SSL routines&#58;SSL_CTX_use_PrivateKey_file&#58;system lib, &#34; of type&#58; &#34;&#60;type &#39;exceptions.Exception&#39;&#62;&#34; was thrown! Quitting out.
MSG&#58; Sat, 25 Feb 2017 15&#58;13&#58;36 Unable to connect to <a href='http&#58;//uct2-net1.mwt2.org' target='_blank' rel='nofollow'>http&#58;//uct2-net1.mwt2.org</a>, exception was Unable to post to http&#58;//localhost, because exception &#34;POST connection error&#58; (&#39;Connection aborted.&#39;, error(104, &#39;Connection reset by peer&#39;))&#34;. Check postgresql and cassandra services are up. Then check user and key are ok , trying SSL
MSG&#58; Sat, 25 Feb 2017 15&#58;11&#58;52 Sample of the data being posted {u&#39;packet-count-sent&#39;&#58; 600.0, u&#39;packet-count-lost&#39;&#58; 0.0, u&#39;packet-loss-rate&#39;&#58; 0.0}
MSG&#58; Sat, 25 Feb 2017 15&#58;11&#58;52 For event type packet-loss-rate, 705 new data points
MSG&#58; Sat, 25 Feb 2017 15&#58;11&#58;52 loaded previous time_start 1487992945
MSG&#58; Sat, 25 Feb 2017 15&#58;11&#58;52 For event type failures, 0 new data points
MSG&#58; Sat, 25 Feb 2017 15&#58;11&#58;52 For event type histogram-owdelay, 705 new data points

stats

[0] 15&#58;26&#58;49 UTC [smckee@jump&#58;metrics]$ grep CRITICAL uct2-net1.mwt2.org__org.osg.general.perfsonar-simple.out | wc
3      10      94
[0] 15&#58;27&#58;43 UTC [smckee@jump&#58;metrics]$ grep CRITICAL *.out | wc
718    2364   66327
[0] 15&#58;27&#58;56 UTC [smckee@jump&#58;metrics]$ ls  *.out | wc
269     269   16445
[0] 15&#58;28&#58;03 UTC [smckee@jump&#58;metrics]$

Edgar, can you please have a look?

I can update the check_mk threshold to set CRITICAL when the number of Daemon Sessions falls below 2 on psds0.   The other symptom is that the rsv process CPU drops drastically to less than 1% when it usually runs between 20-50%  <a href='https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/check_mk/index.py?start_url=%2FWLCGperfSONAR%2Fpnp4nagios%2Findex.php%2Fgraph%3Fhost%3Dpsds0%26srv%3Dproc_rsv%26theme%3Dmultisite%26baseurl%3D..%2Fcheck_mk%2F' target='_blank' rel='nofollow'>https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/check_mk/index.py?start_url=%2FWLCGperfSONAR%2Fpnp4nagios%2Findex.php%2Fgraph%3Fhost%3Dpsds0%26srv%3Dproc_rsv%26theme%3Dmultisite%26baseurl%3D..%2Fcheck_mk%2F</a>

Let me know if there are any questions or suggestions.  Thanks,

Shawn

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mckee/CN=500323/CN=Shawn Mc Kee
</div><script type='text/javascript'>
        $('#show_132851999').click(function() {
            $('#detail_132851999').slideDown("normal");
            $('#show_132851999').hide();
            $('#hide_132851999').show();
        });
        $('#hide_132851999').click(function() {
            $('#detail_132851999').slideUp();
            $('#hide_132851999').hide();
            $('#show_132851999').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='32653#1487941991'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-24T13:13:11+00:00">Feb 24, 2017 01:13 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1487941991">&nbsp;</a></div><pre>01 * * * * root run-parts /etc/cron.hourly
45 * * * * root /sbin/service simplevisor restart 1&#62;/dev/null 2&#62;/dev/null
40 * * * * root /bin/find /usr/local/rsv-perfsonar/* -size +10M -delete
*/5 * * * * root /opt/sbin/confsync-dyndns &#62; /dev/null
1,16,31,46 * * * * root rsync /var/log/esmond/* /net/nas01/Public/logs/psds0/esmond 1&#62;/dev/null 2&#62;/dev/null
2,17,32,47 * * * * root rsync /var/log/httpd/* /net/nas01/Public/logs/psds0/httpd
3,18,33,48 * * * * root rsync /var/log/pgsql/* /net/nas01/Public/logs/psds0/pgsql
4,19,34,49 * * * * root rsync /usr/local/pgsql/data/pg_log/* /net/nas01/Public/logs/psds0/pgsql/data
5,20,35,50 * * * * root rsync -r /var/log/rsv/* /net/nas01/Public/logs/psds0/rsv 1&#62;/dev/null 2&#62;/dev/null
5,20,35,50 * * * * root rsync /var/log/publisher-simplevisor.log /net/nas01/Public/logs/psds0/publisher-simplevisor.log
6,21,36,51 * * * * root rsync /var/log/messages /net/nas01/Public/logs/psds0/messages
11 * * * * root chmod -R ugoa+r /net/nas01/Public/logs/psds0
4-59/5 * * * * root /opt/sbin/munin_ip_plugins.py
0 * * * * root (cd /usr/local/pf-socks5 && ./update.sh) &#62;&#62; /var/log/pf-socks5.log
0,30 * * * * root /usr/bin/puppet agent --no-daemonize --onetime &#62;& /dev/null
43 4 * * * root /opt/sbin/security-test
7 23 * * * root /opt/sbin/setup_munin_cert_age.sh &#62; /dev/null
1,16,31,46 * * * * root [[ -x /usr/local/status_stamp/status_stamp.sh ]] && /usr/local/status_stamp/status_stamp.sh
*/10 * * * * root /usr/lib64/sa/sa1 1 1
53 23 * * * root /usr/lib64/sa/sa2 -A</pre></div><div class='update_description'><i onclick="document.location='32653#1487884638'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-23T21:17:18+00:00">Feb 23, 2017 09:17 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1487884638">&nbsp;</a></div><pre>Assigning Scott and Tom back to this ticket as Shawn needs to know what some cron jobs are on psds0.

-Kyle</pre></div><div class='update_description'><i onclick="document.location='32653#1487690592'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-21T15:23:12+00:00">Feb 21, 2017 03:23 PM UTC</time><a class="anchor" name="1487690592">&nbsp;</a></div><pre>OK, I have looked through all the available logs and the only possibly relevant thing I found is below. I am attaching my notes as a text file.

The esmond.log file seems to indicate an issue about when the problem happened.  Can someone verify that the timestamps in all the logs is UTC?   If so, we are missing esmond logging events that happen every other day.
Since I saw the problem happen around 22&#58;25 Eastern on the 18th (and the 11th) I would expect UTC logs around 03&#58;25 on the 19th.   The esmond.log shows&#58;

2017-02-18 00&#58;37&#58;51,505 [INFO] /usr/lib/esmond/lib/python2.7/site-packages/pycassa/logging/pool_logger.py&#58; Connection 140092378904080 (cassandra1.goc&#58;9160) in pool 140092532450256 failed&#58; TimedOutException(acknowledged_by=0, acknowledged_by_batchlog=None)
2017-02-18 03&#58;09&#58;31,643 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Checking/creating column families
2017-02-18 03&#58;09&#58;31,643 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Checking/creating column families
2017-02-18 03&#58;09&#58;31,644 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Checking/creating column families
2017-02-18 03&#58;09&#58;31,644 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Checking/creating column families
2017-02-18 03&#58;09&#58;31,645 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Schema check done
2017-02-18 03&#58;09&#58;31,646 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Checking/creating column families
2017-02-18 03&#58;09&#58;31,647 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Schema check done
2017-02-18 03&#58;09&#58;31,648 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Checking/creating column families
2017-02-18 03&#58;09&#58;31,648 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Checking/creating column families
2017-02-18 03&#58;09&#58;31,649 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Schema check done
2017-02-18 03&#58;09&#58;31,650 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Schema check done
2017-02-18 03&#58;09&#58;31,650 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Checking/creating column families
2017-02-18 03&#58;09&#58;31,651 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Schema check done
2017-02-18 03&#58;09&#58;31,653 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Schema check done
2017-02-18 03&#58;09&#58;31,654 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Schema check done
2017-02-18 03&#58;09&#58;31,655 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Schema check done
2017-02-18 03&#58;09&#58;31,665 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Connected to [&#39;cassandra1.goc&#58;9160&#39;, &#39;cassandra2.goc&#58;9160&#39;]
2017-02-18 03&#58;09&#58;31,671 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Connected to [&#39;cassandra1.goc&#58;9160&#39;, &#39;cassandra2.goc&#58;9160&#39;]
2017-02-18 03&#58;09&#58;31,671 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Connected to [&#39;cassandra1.goc&#58;9160&#39;, &#39;cassandra2.goc&#58;9160&#39;]
2017-02-18 03&#58;09&#58;31,671 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Connected to [&#39;cassandra1.goc&#58;9160&#39;, &#39;cassandra2.goc&#58;9160&#39;]
2017-02-18 03&#58;09&#58;31,673 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Connected to [&#39;cassandra1.goc&#58;9160&#39;, &#39;cassandra2.goc&#58;9160&#39;]
2017-02-18 03&#58;09&#58;31,674 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Connected to [&#39;cassandra1.goc&#58;9160&#39;, &#39;cassandra2.goc&#58;9160&#39;]
2017-02-18 03&#58;09&#58;31,675 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Connected to [&#39;cassandra1.goc&#58;9160&#39;, &#39;cassandra2.goc&#58;9160&#39;]
2017-02-18 03&#58;09&#58;31,684 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Connected to [&#39;cassandra1.goc&#58;9160&#39;, &#39;cassandra2.goc&#58;9160&#39;]
2017-02-18 09&#58;20&#58;50,795 [INFO] /usr/lib/esmond/lib/python2.7/site-packages/pycassa/logging/pool_logger.py&#58; Connection 140092237999120 (cassandra2.goc&#58;9160) in pool 140092530876944 failed&#58; TimedOutException(acknowledged_by=0, acknowledged_by_batchlog=None)
2017-02-20 03&#58;24&#58;23,469 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Checking/creating column families
2017-02-20 03&#58;24&#58;23,470 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Checking/creating column families
2017-02-20 03&#58;24&#58;23,471 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Schema check done
2017-02-20 03&#58;24&#58;23,474 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Checking/creating column families
<div id='show_285926089' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_285926089'>2017-02-20 03&#58;24&#58;23,474 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Schema check done
2017-02-20 03&#58;24&#58;23,473 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Checking/creating column families
2017-02-20 03&#58;24&#58;23,474 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Checking/creating column families
2017-02-20 03&#58;24&#58;23,475 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Checking/creating column families
2017-02-20 03&#58;24&#58;23,476 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Schema check done
2017-02-20 03&#58;24&#58;23,477 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Schema check done
2017-02-20 03&#58;24&#58;23,478 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Schema check done
2017-02-20 03&#58;24&#58;23,478 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Schema check done
2017-02-20 03&#58;24&#58;23,479 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Checking/creating column families
2017-02-20 03&#58;24&#58;23,481 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Schema check done
2017-02-20 03&#58;24&#58;23,492 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Checking/creating column families
2017-02-20 03&#58;24&#58;23,494 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Schema check done
2017-02-20 03&#58;24&#58;23,744 [INFO] /usr/lib/esmond/esmond/cassandra.py&#58; Connected to [&#39;cassandra1.goc&#58;9160&#39;, &#39;cassandra2.goc&#58;9160&#39;]

With nothing on the 19th.  It does seem like something is running around 03 AM UTC (assuming this IS UTC).

Can someone show what cron jobs are scheduled around then on psds0?   Is there a /etc/cron.d/cron-clean_esmond_db  file?  If so, what is the timing of it?

Shawn

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mckee/CN=500323/CN=Shawn Mc Kee
</div><script type='text/javascript'>
        $('#show_285926089').click(function() {
            $('#detail_285926089').slideDown("normal");
            $('#show_285926089').hide();
            $('#hide_285926089').show();
        });
        $('#hide_285926089').click(function() {
            $('#detail_285926089').slideUp();
            $('#hide_285926089').hide();
            $('#show_285926089').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='32653#1487688245'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-21T14:44:05+00:00">Feb 21, 2017 02:44 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1487688245">&nbsp;</a></div><pre>De-assigning self.</pre></div><div class='update_description'><i onclick="document.location='32653#1487687591'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-21T14:33:11+00:00">Feb 21, 2017 02:33 PM UTC</time> by <b>Shawn McKee</b><a class="anchor" name="1487687591">&nbsp;</a></div><pre>Hi Scott,

Here is the tracking graphs for load from psds0&#58;

<a href='https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/check_mk/index.py?start_url=%2FWLCGperfSONAR%2Fpnp4nagios%2Findex.php%2Fgraph%3Fhost%3Dpsds0%26srv%3DCPU_load%26theme%3Dmultisite%26baseurl%3D..%2Fcheck_mk%2F' target='_blank' rel='nofollow'>https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/check_mk/index.py?start_url=%2FWLCGperfSONAR%2Fpnp4nagios%2Findex.php%2Fgraph%3Fhost%3Dpsds0%26srv%3DCPU_load%26theme%3Dmultisite%26baseurl%3D..%2Fcheck_mk%2F</a>

I don&#39;t see the loads it is experiencing as a problem.   If we are
permanently backed up with work either memory, connections or CPU would
eventually lock-up the system.

Shawn

On Mon, Feb 20, 2017 at 2&#58;33 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='32653#1487619201'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-20T19:33:21+00:00">Feb 20, 2017 07:33 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1487619201">&nbsp;</a></div><pre>as of right now, psds0 shows this&#58;
# uptime
19&#58;31&#58;59 up 7 days,  4&#58;16,  1 user,  load average&#58; 14.80, 13.72, 12.97

it has 12 CPUs allocated to it.</pre></div><div class='update_description'><i onclick="document.location='32653#1487618906'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-20T19:28:26+00:00">Feb 20, 2017 07:28 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1487618906">&nbsp;</a></div><pre><a href='http&#58;//blog.scoutapp.com/articles/2009/07/31/understanding-load-averages' target='_blank' rel='nofollow'>http&#58;//blog.scoutapp.com/articles/2009/07/31/understanding-load-averages</a>
IOWAIT is included in the defininition of load I use...</pre></div><div class='update_description'><i onclick="document.location='32653#1487248207'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-16T12:30:07+00:00">Feb 16, 2017 12:30 PM UTC</time><a class="anchor" name="1487248207">&nbsp;</a></div><pre>Thanks Scott,

We have detailed  tracking of the machine (VM) in check_mk at <a href='https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/check_mk/index.py?start_url=%2FWLCGperfSONAR%2Fcheck_mk%2Fview.py%3Fview_name%3Dhost%26host%3Dpsds0%26site%3D' target='_blank' rel='nofollow'>https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/check_mk/index.py?start_url=%2FWLCGperfSONAR%2Fcheck_mk%2Fview.py%3Fview_name%3Dhost%26host%3Dpsds0%26site%3D</a>    In the icons column, the third icon (showing a  graph) is the way to see the history for each metric.  If you hover over it, it will show a thumbnail preview.   I see there is quite a bit of I/O.

CPU&#58;  <a href='https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/pnp4nagios/index.php/graph?host=psds0&srv=CPU_utilization&theme=multisite&baseurl=../check_mk/' target='_blank' rel='nofollow'>https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/pnp4nagios/index.php/graph?host=psds0&srv=CPU_utilization&theme=multisite&baseurl=../check_mk/</a>
Memory&#58; <a href='https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/pnp4nagios/index.php/graph?host=psds0&srv=Memory_used&theme=multisite&baseurl=../check_mk/' target='_blank' rel='nofollow'>https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/pnp4nagios/index.php/graph?host=psds0&srv=Memory_used&theme=multisite&baseurl=../check_mk/</a>
Network&#58; <a href='https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/pnp4nagios/index.php/graph?host=psds0&srv=Interface_2&theme=multisite&baseurl=../check_mk/' target='_blank' rel='nofollow'>https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/pnp4nagios/index.php/graph?host=psds0&srv=Interface_2&theme=multisite&baseurl=../check_mk/</a>

None of those seem to be overloaded.   The I/O shows&#58; <a href='https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/pnp4nagios/index.php/graph?host=psds0&srv=Disk_IO_SUMMARY&theme=multisite&baseurl=../check_mk/' target='_blank' rel='nofollow'>https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/pnp4nagios/index.php/graph?host=psds0&srv=Disk_IO_SUMMARY&theme=multisite&baseurl=../check_mk/</a>

One option may be to move this VMs harddisk to the SSD storage area we have yet to use.   This will need coordination with the disk upgrade (which I haven&#39;t seen any updates on).

Thanks,

Shawn

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mckee/CN=500323/CN=Shawn Mc Kee</pre></div><div class='update_description'><i onclick="document.location='32653#1487242108'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-16T10:48:28+00:00">Feb 16, 2017 10:48 AM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1487242108">&nbsp;</a></div><pre>Sorry, I though I had commented on this earlier.

Step 1 in fixing any problem is to reboot the machine. This either puts it into a standard state
or fails. Either is useful information. In this case, the reboot made the problem go away.

I believe this machine is overloaded, the RSV processes are experiencing pileup. Changing
the definition of the diagnostic does not fix the problem. I don&#39;t know how to fix this but perhaps
spinning off some RSV processes off to another machine will fix it if the bottleneck is CPU.
If the bottleneck is bandwidth, the number of RSV processes must be backed off or moved
elsewhere.</pre></div><div class='update_description'><i onclick="document.location='32653#1487001730'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-13T16:02:10+00:00">Feb 13, 2017 04:02 PM UTC</time> by <b>Shawn McKee</b><a class="anchor" name="1487001730">&nbsp;</a></div><pre>Thanks Scott,

I see events getting to CERN now.  What was the problem?  Did you just
restart psds0?

Shawn

On Mon, Feb 13, 2017 at 10&#58;54 AM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='32653#1487001250'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-13T15:54:10+00:00">Feb 13, 2017 03:54 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1487001250">&nbsp;</a></div><pre>Machine is up and running, waiting for warnings to clear.</pre></div><div class='update_description'><i onclick="document.location='32653#1486997887'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-13T14:58:07+00:00">Feb 13, 2017 02:58 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1486997887">&nbsp;</a></div><pre>Machine rebooted at 9&#58;57, will check back in ~1 hour.</pre></div><div class='update_description'><i onclick="document.location='32653#1486996982'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-13T14:43:02+00:00">Feb 13, 2017 02:43 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1486996982">&nbsp;</a></div><pre>Last night around 22&#58;48 Eastern time, the CERN active message queue reported&#58;

<font color='#7F7E6F'>&#62; There are too few (0 msg/sec) messages received by the netmon brokers</font>
<font color='#7F7E6F'>&#62; for your client perfsonar-summary-packet-loss-rate (/topic/perfsonar.summary.packet-loss-rate), see&#58;</font>
<font color='#7F7E6F'>&#62; <a href='https&#58;//mig-graphite.cern.ch/r/brkclt/received/perfsonar-summary-packet-loss-rate' target='_blank' rel='nofollow'>https&#58;//mig-graphite.cern.ch/r/brkclt/received/perfsonar-summary-packet-loss-rate</a></font>

While the perfsonar-itb monitoring doesn&#39;t show a specific problem we noted a significant drop in TCP connections&#58;  <a href='https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/check_mk/index.py?start_url=%2FWLCGperfSONAR%2Fpnp4nagios%2Findex.php%2Fgraph%3Fhost%3Dpsds0%26srv%3DTCP_Connections%26theme%3Dmultisite%26baseurl%3D..%2Fcheck_mk%2F' target='_blank' rel='nofollow'>https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/check_mk/index.py?start_url=%2FWLCGperfSONAR%2Fpnp4nagios%2Findex.php%2Fgraph%3Fhost%3Dpsds0%26srv%3DTCP_Connections%26theme%3Dmultisite%26baseurl%3D..%2Fcheck_mk%2F</a>

Also RSV doesn&#39;t seem to create new processes&#58;  <a href='https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/check_mk/index.py?start_url=%2FWLCGperfSONAR%2Fpnp4nagios%2Findex.php%2Fgraph%3Fhost%3Dpsds0%26srv%3Dproc_rsv%26theme%3Dmultisite%26baseurl%3D..%2Fcheck_mk%2F' target='_blank' rel='nofollow'>https&#58;//perfsonar-itb.grid.iu.edu/WLCGperfSONAR/check_mk/index.py?start_url=%2FWLCGperfSONAR%2Fpnp4nagios%2Findex.php%2Fgraph%3Fhost%3Dpsds0%26srv%3Dproc_rsv%26theme%3Dmultisite%26baseurl%3D..%2Fcheck_mk%2F</a>

Marian also noted that Munin graphs are empty&#58;  <a href='https&#58;//munin.grid.iu.edu/munin/Production_VMs/psds0/index.html' target='_blank' rel='nofollow'>https&#58;//munin.grid.iu.edu/munin/Production_VMs/psds0/index.html</a>   (Is this intentional?)

I think the problem should be on psds0.grid.iu.edu.     I would like to understand this failure mode to make sure we have some monitoring that would catch it (other than the CERN check on messages).

Shawn

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=mckee/CN=500323/CN=Shawn Mc Kee</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F32653">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 32653});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
