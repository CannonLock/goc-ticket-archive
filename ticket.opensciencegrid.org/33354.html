<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[33354] OSG Display update to EL7</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=33354" method="post">
<div class="page-header">
    <h3><span class="muted">33354</span> / OSG Display update to EL7</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Carl Edquist</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Carl Edquist</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2017-04-14</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
        <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/33354", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/33354?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/33354?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20OSG%20Display%20update%20to%20EL7%20ISSUE%3D33354%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='33354#1492008473'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-12T14:47:53+00:00">Apr 12, 2017 02:47 PM UTC</time> by <b>echism</b><a class="anchor" name="1492008473">&nbsp;</a></div><pre>Closing this one.</pre></div><div class='update_description'><i onclick="document.location='33354#1491854554'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-10T20:02:34+00:00">Apr 10, 2017 08:02 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1491854554">&nbsp;</a></div><pre>Great!  Thanks Scott!

Carl</pre></div><div class='update_description'><i onclick="document.location='33354#1491852833'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-10T19:33:53+00:00">Apr 10, 2017 07:33 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1491852833">&nbsp;</a></div><pre>I believe it is working now, as of about five minutes before I told Elizabeth I was leaving for the day.
It is all ansible-ized and on the air.
Thanks for the Help Carl.</pre></div><div class='update_description'><i onclick="document.location='33354#1491852671'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-10T19:31:11+00:00">Apr 10, 2017 07:31 PM UTC</time> by <b>echism</b><a class="anchor" name="1491852671">&nbsp;</a></div><pre>I believe there has been some movement on this but Scott is out for the day. I&#39;ll send more tomorrow.</pre></div><div class='update_description'><i onclick="document.location='33354#1491601494'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-07T21:44:54+00:00">Apr 7, 2017 09:44 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1491601494">&nbsp;</a></div><pre>Thanks Scott for the updates...

<font color='#7F7E6F'>&#62; It is not clear to me how much of the setting up is done by your stuff</font>
<font color='#7F7E6F'>&#62; and how much is expected from the install script.</font>

OSG Software packages the osg-display-data part (that generates the graphs), but we do not package the osg-display webapp (from Soichi&#39;s github).  The thing i had never figured out was how to make the webapp part work.  (Either way, i&#39;m thinking moving forward we should figure out how to get the whole setup process into the ansible setup.)

Anyway, i did a diff of the attached httpd.conf vs a fresh one for el6 and there are a handful of changes.  I&#39;m not sure if they are all relevant, but this one probably is&#58;

#DocumentRoot &#34;/var/www/html&#34;
DocumentRoot &#34;/usr/local/display&#34;

This matches what the ansible/roles/display/files/disp_tar.sh script is doing&#58; it untars the stuff from the osg-display webapp (that is, display.tar, from Soichi&#39;s github) to /usr/local/display

I think the important thing is that the following three locations match&#58;

1. the location where the files from the osg-display webapp (display.tar) get extracted
2. the DocumentRoot location from /etc/httpd/conf/httpd.conf
3. the &#39;directory&#39; parameter under the [Filenames] section of /etc/osg_display/osg_display.conf

By convention at the goc, apparently that should be /usr/local/display across the board.

It looks like the ansible script is dumping display.tar in the right place (1), so just (2) and (3) need to be fixed.  Can you try updating both of those config values (2 & 3) to /usr/local/display ?

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='33354#1491596018'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-07T20:13:38+00:00">Apr 7, 2017 08:13 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1491596018">&nbsp;</a></div><pre>I tried the new httpd.conf, httpd would not start with it installed.
I&#39;ve rebuilt the itb instance as it stood about an hour ago.

It is not clear to me how much of the setting up is done by your stuff and
how much is expected from the install script.

There is a file, restore.py that will kill the install if it is executed, I suspect
this is where the missing bits are installed. It seems to reference specific
.so objects, these are almost certainly not compatible across an upgrade
from el6 to el7. /tmp/restore.py is the location on display-itb.

So, do we roll back to el6 or get restore.py-like functionality working under el7?

It is after 4&#58;00 on a Friday, I&#39;m out for the day and will get back to this time
permitting on Monday.</pre></div><div class='update_description'><i onclick="document.location='33354#1491594004'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-07T19:40:04+00:00">Apr 7, 2017 07:40 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1491594004">&nbsp;</a></div><pre>httpd.conf  (as httpd.conf.txt) from the production instance is attached.</pre></div><div class='update_description'><i onclick="document.location='33354#1491593109'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-07T19:25:09+00:00">Apr 7, 2017 07:25 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1491593109">&nbsp;</a></div><pre>Yeah when i tried setting it up i just got an apache Testing page too.

Was there maybe anything else tweaked in the configs for display that didn&#39;t make it into the ansible script?  I&#39;d guess something needs to be tweaked with the httpd config.

Can you attach a copy of /etc/httpd/conf/httpd.conf from the prod display instance (1 or 2) ?  Just to compare to the default to see what all might have changed there.

Also I think the stuff from the osg-display webapp (ie, <a href='https&#58;//github.com/soichih/osg-display.git' target='_blank' rel='nofollow'>https&#58;//github.com/soichih/osg-display.git</a>, not osg-display-data) needs to be copied to /var/www/html/ ... it seems like maybe the ansible script is not doing this step.

Carl

PS. my hunch is, even if we try to get the old version (osg-display-data 1.0.9) going on an el6 node, we will run into the same thing we&#39;re seeing now with the test page...

<a href='http&#58;//koji.chtc.wisc.edu/kojifiles/packages/osg-display-data/1.0.9/1.osg33.el6/noarch/osg-display-data-1.0.9-1.osg33.el6.noarch.rpm' target='_blank' rel='nofollow'>http&#58;//koji.chtc.wisc.edu/kojifiles/packages/osg-display-data/1.0.9/1.osg33.el6/noarch/osg-display-data-1.0.9-1.osg33.el6.noarch.rpm</a></pre></div><div class='update_description'><i onclick="document.location='33354#1491590933'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-07T18:48:53+00:00">Apr 7, 2017 06:48 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1491590933">&nbsp;</a></div><pre>That got it through the install script, check out <a href='http&#58;//display-itb.grid.iu.edu/' target='_blank' rel='nofollow'>http&#58;//display-itb.grid.iu.edu/</a>
not so good.</pre></div><div class='update_description'><i onclick="document.location='33354#1491582005'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-07T16:20:05+00:00">Apr 7, 2017 04:20 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1491582005">&nbsp;</a></div><pre>Hi Scott, sorry for the noise with both tickets.  I think for the goc deployment work let&#39;s keep it in this ticket.

I took a look at the errors in the log you attached in the GRACC-18 ticket; I think it is related to SVG output.  To get past that and get it working I had to remove SVG from the &#39;graph_output&#39; setting in osg_display.conf.  Did you try using the one I attached from this ticket?  The change looks like&#58;

--- a/ansible/roles/display/files/osg_display.conf
+++ b/ansible/roles/display/files/osg_display.conf
@@ -2,7 +2,7 @@
[Settings]
timeout=3600
logfile=/var/log/osg_display/osg_display.log
-graph_output=SVG,JPG,PNG
+graph_output=JPG,PNG
font=Arial

Let me know if that gets it going...

Thanks!
Carl</pre></div><div class='update_description'><i onclick="document.location='33354#1491579521'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-07T15:38:41+00:00">Apr 7, 2017 03:38 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1491579521">&nbsp;</a></div><pre>Does not work. How do you want to proceed? This path or the path I started down in Jira GRACC-18?</pre></div><div class='update_description'><i onclick="document.location='33354#1491510030'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-06T20:20:30+00:00">Apr 6, 2017 08:20 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1491510030">&nbsp;</a></div><pre>Hi Scott,

I tried stepping through your ansible config script on a Fermi VM, and I needed to make changes to a couple files to get everything installed properly&#58;

ansible/roles/display/files/osg_display.conf
ansible/roles/display/tasks/main.yaml

I&#39;ve attached copies of the new versions.

As for the OSG Display webapp, apache started up but I only saw a Test Page.  Not sure if anything else is necessary.

Can you spin up an el7 node and try running your ansible setup with my updates?

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='33354#1491418673'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-05T18:57:53+00:00">Apr 5, 2017 06:57 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1491418673">&nbsp;</a></div><pre>Sounds good, will do.  Thanks Scott!

Carl</pre></div><div class='update_description'><i onclick="document.location='33354#1491418617'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-05T18:56:57+00:00">Apr 5, 2017 06:56 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1491418617">&nbsp;</a></div><pre>Just let us know when you are ready to install, we&#39;ll get what you need on the air.
S</pre></div><div class='update_description'><i onclick="document.location='33354#1491416072'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-04-05T18:14:32+00:00">Apr 5, 2017 06:14 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1491416072">&nbsp;</a></div><pre>Hi,

We are updating the osg-display-data package to get it&#39;s data from gracc instead of the gratia db.  The work is nearly complete and hopefully a new rpm will be available sometime this week.  See&#58; <a href='https&#58;//jira.opensciencegrid.org/browse/GRACC-18' target='_blank' rel='nofollow'>https&#58;//jira.opensciencegrid.org/browse/GRACC-18</a>

Importantly, due to the elasticsearch libraries used to access the gracc db, the new version needs to be installed on an EL7 node (as discussed in GRACC-18).  Now may be a good time to convert display-itb to an EL7 node in preparation for this.

Thanks,
Carl</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F33354">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 33354});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
