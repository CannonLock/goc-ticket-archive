<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[35149] Nova jobs getting out of memory errors and being killed</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=35149" method="post">
<div class="page-header">
    <h3><span class="muted">35149</span> / Nova jobs getting out of memory errors and being killed</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Kevin Retzke</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Resource Name</label><div class="controls">NWICG_NDCMS</div></div><div class="control-group"><label class="control-label">Associated VO</label><div class="controls">CMS</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Kevin Retzke</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">NWICG</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2017-11-09</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Kyle Gross <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">NWICG <span class="muted"> / OSG Support Centers</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/35149", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="https://ticket.opensciencegrid.org/\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="https://ticket.opensciencegrid.org/\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/35149?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/35149?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Nova%20jobs%20getting%20out%20of%20memory%20errors%20and%20being%20killed%20ISSUE%3D35149%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='35149#1510256007'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-11-09T19:33:27+00:00">Nov 9, 2017 07:33 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1510256007">&nbsp;</a></div><pre>Closing this as per Kevin&#39;s last update.</pre></div><div class='update_description'><i onclick="document.location='35149#1510152235'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-11-08T14:43:55+00:00">Nov 8, 2017 02:43 PM UTC</time><a class="anchor" name="1510152235">&nbsp;</a></div><pre>My last set of test jobs completed successfully, so I think we can consider this resolved. Thanks!

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Kevin Retzke 3130</pre></div><div class='update_description'><i onclick="document.location='35149#1509730297'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-11-03T17:31:37+00:00">Nov 3, 2017 05:31 PM UTC</time><a class="anchor" name="1509730297">&nbsp;</a></div><pre>Ok, I&#39;ve sent some more test jobs, but I&#39;m a bit concerned about that solution - could that cause a race where all jobs are hung waiting for memory to free up?

/Kevin

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Kevin Retzke 3130</pre></div><div class='update_description'><i onclick="document.location='35149#1509725636'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-11-03T16:13:56+00:00">Nov 3, 2017 04:13 PM UTC</time><a class="anchor" name="1509725636">&nbsp;</a></div><pre>We have changed cgroup configuration and oom_kill_disable.
So instead of killing the jobs should be paused and wait until memory is available.

group htcondor {
cpu {}
cpuacct {}
memory {
memory.oom_control=&#34;1&#34;;
memory.use_hierarchy=&#34;1&#34;;
memory.limit_in_bytes=80000000K;
memory.memsw.limit_in_bytes=90000000K;
}
Could you run jobs one more time ?

-Serguei

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=sfedorov/CN=729766/CN=Serguei Fedorov</pre></div><div class='update_description'><i onclick="document.location='35149#1509722590'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-11-03T15:23:10+00:00">Nov 3, 2017 03:23 PM UTC</time><a class="anchor" name="1509722590">&nbsp;</a></div><pre>That round of tests went better, but I still had a couple jobs killed&#58;

Task in /htcondor/condor_var_condor_execute_slot1_2@.... killed as a result of limit of /htcondor
memory&#58; usage 79997688kB, limit 80000000kB, failcnt 895949
memory+swap&#58; usage 89999944kB, limit 90000000kB, failcnt 9589

I&#39;ve talked to the condor experts here, they said that they had problems getting cgroups working well, so ended up using docker on our cluster since it allows simpler and more granular control over per-jobs limits.

/Kevin

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Kevin Retzke 3130</pre></div><div class='update_description'><i onclick="document.location='35149#1509654456'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-11-02T20:27:36+00:00">Nov 2, 2017 08:27 PM UTC</time><a class="anchor" name="1509654456">&nbsp;</a></div><pre>Yes, I was about to say to you the same. The limit is being applied to the htcondor.
In the condor configuration of each compute host we have&#58;

BASE_CGROUP = htcondor
CGROUP_MEMORY_LIMIT_POLICY = soft

I have changed the limits and restarted compute hosts.

group htcondor {
cpu {}
cpuacct {}
memory {
memory.use_hierarchy=&#34;1&#34;;
memory.limit_in_bytes=80000000K;
memory.memsw.limit_in_bytes=90000000K;
}

Could you test it ?

-Serguei

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=sfedorov/CN=729766/CN=Serguei Fedorov</pre></div><div class='update_description'><i onclick="document.location='35149#1509652849'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-11-02T20:00:49+00:00">Nov 2, 2017 08:00 PM UTC</time><a class="anchor" name="1509652849">&nbsp;</a></div><pre>It looks like the limit is being applied to the base /htcondor group while each slot/glidein has its own subgroup? So that limit is for the total of *all* jobs on the machine? Am I reading that right?

/Kevin

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Kevin Retzke 3130</pre></div><div class='update_description'><i onclick="document.location='35149#1509652459'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-11-02T19:54:19+00:00">Nov 2, 2017 07:54 PM UTC</time><a class="anchor" name="1509652459">&nbsp;</a></div><pre>It looks like it was the kernel that killed the jobs for OOM, I see this in dmesg on d12chas568.crc.nd.edu&#58;

Task in /htcondor/condor_var_condor_execute_slot1_1@.... killed as a result of limit of /htcondor
memory&#58; usage 36000000kB, limit 36000000kB, failcnt 1116495784
memory+swap&#58; usage 36000000kB, limit 40000000kB, failcnt 0
...
Memory cgroup out of memory&#58; Kill process 387 (stress) score 1000 or sacrifice child
Killed process 387, UID 1005003, (stress) total-vm&#58;7819024kB, anon-rss&#58;7740976kB, file-rss&#58;240kB

The cgroup limit looks right, is it possible multiple glideins are getting put into the same cgroup?

/Kevin

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Kevin Retzke 3130</pre></div><div class='update_description'><i onclick="document.location='35149#1509648931'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-11-02T18:55:31+00:00">Nov 2, 2017 06:55 PM UTC</time><a class="anchor" name="1509648931">&nbsp;</a></div><pre>But if it were preemption the glidein would have been killed, right? That particular glidein started around 11&#58;30 EDT and is still running as of 15&#58;00 EST&#58;

GLIDEIN_SiteWMS_JobId = &#34;1996187.0&#34;
GLIDEIN_SiteWMS_Queue = &#34;deepthought.crc.nd.edu&#34;
GLIDEIN_SiteWMS_Slot = &#34;slot1_1@....&#34;

/Kevin

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Kevin Retzke 3130</pre></div><div class='update_description'><i onclick="document.location='35149#1509648236'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-11-02T18:43:56+00:00">Nov 2, 2017 06:43 PM UTC</time><a class="anchor" name="1509648236">&nbsp;</a></div><pre>Hi Kevin,

I do not know why it happened. The jobs probably were preempted by other grid jobs, we allow only 400 grid jobs running.

This is fragment of condor_history (we are in EST zone)&#58;

ID     OWNER          SUBMITTED   RUN_TIME     ST COMPLETED   CMD
996815.0   uscms01        11/2  13&#58;34              X         ???  glidein_startup.sh -v std -name v3_2 -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname CMSG-v1_0.main -schedd schedd_glideins5@
996816.0   uscms01        11/2  13&#58;35              X         ???  glidein_startup.sh -v std -name gfactory_instance -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname CMSG-v1_0.main -schedd sche
996813.0   uscms01        11/2  13&#58;25              X         ???  glidein_startup.sh -v std -name gfactory_instance -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname CMSG-v1_0.main -schedd sche
996809.0   uscms01        11/2  13&#58;17   0+00&#58;10&#58;02 C  11/2  13&#58;28 nagrun.sh -v cms -f /cms/Role=lcgadmin -d /queue/grid.probe.metricOutput.EGEE.etf-cms-prod_cern_ch -b stomp&#58;//oldsam.msg.cern.ch&#58;616
996806.0   uscms01        11/2  13&#58;10   0+00&#58;10&#58;03 C  11/2  13&#58;28 nagrun.sh -v cms -f /cms/Role=lcgadmin -d /queue/grid.probe.metricOutput.EGEE.etf-cms-preprod_cern_ch -b stomp&#58;//oldsam.msg.cern.ch&#58;
996804.0   uscms01        11/2  13&#58;08   0+00&#58;12&#58;41 C  11/2  13&#58;22 glidein_startup.sh -v std -name gfactory_instance -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname CMSG-v1_0.main -schedd sche
996805.0   uscms01        11/2  13&#58;09   0+00&#58;00&#58;06 C  11/2  13&#58;18 nagrun.sh -v cms -f /cms/Role=pilot -d /queue/grid.probe.metricOutput.EGEE.etf-cms-prod_cern_ch -b stomp&#58;//oldsam.msg.cern.ch&#58;6163/
996808.0   uscms01        11/2  13&#58;15   0+00&#58;00&#58;06 C  11/2  13&#58;18 nagrun.sh -v cms -f /cms/Role=pilot -d /queue/grid.probe.metricOutput.EGEE.etf-cms-preprod_cern_ch -b stomp&#58;//oldsam.msg.cern.ch&#58;616
996710.0   uscms01        11/2  11&#58;02   0+02&#58;02&#58;12 C  11/2  13&#58;18 glidein_startup.sh -v std -name gfactory_instance -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname CMSG-v1_0.main -schedd sche
996755.0   uscms01        11/2  11&#58;52   0+01&#58;22&#58;33 C  11/2  13&#58;18 glidein_startup.sh -v std -name gfactory_instance -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname CMSG-v1_0.main -schedd sche
996792.0   uscms01        11/2  12&#58;44   0+00&#58;12&#58;44 C  11/2  13&#58;10 glidein_startup.sh -v std -name v3_2 -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname CMSG-v1_0.main -schedd schedd_glideins5@
996789.0   uscms01        11/2  12&#58;42   0+00&#58;18&#58;22 C  11/2  13&#58;05 glidein_startup.sh -v std -name v3_2 -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname CMSG-v1_0.main -schedd schedd_glideins5@
996801.0   uscms01        11/2  12&#58;51   0+00&#58;13&#58;05 C  11/2  13&#58;04 glidein_startup.sh -v std -name gfactory_instance -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname CMSG-v1_0.local_users -sche
996800.0   uscms01        11/2  12&#58;49   0+00&#58;12&#58;29 C  11/2  13&#58;02 glidein_startup.sh -v std -name gfactory_instance -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname CMSG-v1_0.local_users -sche
996208.0   fermilab       10/30 23&#58;12   0+02&#58;22&#58;16 C  11/2  13&#58;02 glidein_startup.sh -v std -name gfactory_instance -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname gpfrontend01-fnal-gov_gWMSF
996796.0   uscms01        11/2  12&#58;46   0+00&#58;13&#58;13 C  11/2  13&#58;01 glidein_startup.sh -v std -name gfactory_instance -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname CMSG-v1_0.local_users -sche
996743.0   osg            11/2  11&#58;50   0+00&#58;21&#58;15 C  11/2  13&#58;01 glidein_startup.sh -v std -name gfactory_instance -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname osg-flock-grid-iu-edu_OSG_g
996746.0   osg            11/2  11&#58;52   0+00&#58;16&#58;10 C  11/2  13&#58;00 glidein_startup.sh -v std -name gfactory_instance -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname osg-flock-grid-iu-edu_OSG_g
996794.0   uscms01        11/2  12&#58;46   0+00&#58;13&#58;07 C  11/2  13&#58;00 glidein_startup.sh -v std -name v3_2 -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname CMSG-v1_0.local_users -schedd schedd_gli
996803.0   uscms01        11/2  12&#58;55   0+00&#58;01&#58;01 C  11/2  12&#58;58 nagrun.sh -v cms -f /cms/Role=lcgadmin -d /queue/grid.probe.metricOutput.EGEE.etf-cms-preprod_cern_ch -b stomp&#58;//oldsam.msg.cern.ch&#58;
996797.0   uscms01        11/2  12&#58;47   0+00&#58;01&#58;06 C  11/2  12&#58;58 nagrun.sh -v cms -f /cms/Role=lcgadmin -d /queue/grid.probe.metricOutput.EGEE.etf-cms-prod_cern_ch -b stomp&#58;//oldsam.msg.cern.ch&#58;616
996802.0   uscms01        11/2  12&#58;54   0+00&#58;00&#58;06 C  11/2  12&#58;57 nagrun.sh -v cms -f /cms/Role=pilot -d /queue/grid.probe.metricOutput.EGEE.etf-cms-prod_cern_ch -b stomp&#58;//oldsam.msg.cern.ch&#58;6163/
996793.0   uscms01        11/2  12&#58;44   0+00&#58;00&#58;06 C  11/2  12&#58;57 nagrun.sh -v cms -f /cms/Role=pilot -d /queue/grid.probe.metricOutput.EGEE.etf-cms-preprod_cern_ch -b stomp&#58;//oldsam.msg.cern.ch&#58;616
996790.0   uscms01        11/2  12&#58;42   0+00&#58;12&#58;59 C  11/2  12&#58;56 glidein_startup.sh -v std -name v3_2 -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname CMSG-v1_0.local_users -schedd schedd_gli
996791.0   uscms01        11/2  12&#58;44   0+00&#58;12&#58;35 C  11/2  12&#58;57 glidein_startup.sh -v std -name gfactory_instance -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname CMSG-v1_0.local_users -sche
996768.0   fermilab       11/2  12&#58;02   0+00&#58;23&#58;58 C  11/2  12&#58;51 glidein_startup.sh -v std -name gfactory_instance -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname gpfrontend01-fnal-gov_gWMSF
996209.0   fermilab       10/30 23&#58;25   0+02&#58;00&#58;39 C  11/2  12&#58;43 glidein_startup.sh -v std -name gfactory_instance -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname gpfrontend01-fnal-gov_gWMSF
996784.0   uscms01        11/2  12&#58;27   0+00&#58;13&#58;04 C  11/2  12&#58;41 glidein_startup.sh -v std -name v3_2 -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname CMSG-v1_0.main -schedd schedd_glideins5@
<div id='show_1589892251' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1589892251'>996788.0   uscms01        11/2  12&#58;40   0+00&#58;01&#58;09 C  11/2  12&#58;41 nagrun.sh -v cms -f /cms/Role=lcgadmin -d /queue/grid.probe.metricOutput.EGEE.etf-cms-preprod_cern_ch -b stomp&#58;//oldsam.msg.cern.ch&#58;
996761.0   fermilab       11/2  11&#58;56   0+00&#58;22&#58;31 C  11/2  12&#58;40 glidein_startup.sh -v std -name gfactory_instance -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname gpfrontend01-fnal-gov_gWMSF
996786.0   uscms01        11/2  12&#58;32   0+00&#58;00&#58;57 C  11/2  12&#58;39 nagrun.sh -v cms -f /cms/Role=lcgadmin -d /queue/grid.probe.metricOutput.EGEE.etf-cms-prod_cern_ch -b stomp&#58;//oldsam.msg.cern.ch&#58;616
996781.0   uscms01        11/2  12&#58;15   0+00&#58;13&#58;20 C  11/2  12&#58;39 glidein_startup.sh -v std -name gfactory_instance -entry CMSHTPC_T3_US_NotreDame_deepthought -clientname CMSG-v1_0.main -schedd sche

-Serguei

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=sfedorov/CN=729766/CN=Serguei Fedorov
</div><script type='text/javascript'>
        $('#show_1589892251').click(function() {
            $('#detail_1589892251').slideDown("normal");
            $('#show_1589892251').hide();
            $('#hide_1589892251').show();
        });
        $('#hide_1589892251').click(function() {
            $('#detail_1589892251').slideUp();
            $('#hide_1589892251').hide();
            $('#show_1589892251').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='35149#1509647127'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-11-02T18:25:27+00:00">Nov 2, 2017 06:25 PM UTC</time><a class="anchor" name="1509647127">&nbsp;</a></div><pre>Hi Serguei,
I sent a handful of test jobs this afternoon, haven&#39;t had problems with any running into OOM errors. However, I had a bunch SIGKILLed, but the glidein kept running. For instance, a job running in glidein_19611_535996270@.... was killed at 12&#58;23 CDT. 38 out of 50 of that particular test job were killed immediately after starting (within about 20 seconds). The other 12 finished successfully, in the same glidein slots the jobs were killed in.

These jobs all did exactly the same thing&#58; allocate & use 8GB of memory.

Any idea why they might have been killed?

Thanks,
Kevin

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Kevin Retzke 3130</pre></div><div class='update_description'><i onclick="document.location='35149#1509636038'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-11-02T15:20:38+00:00">Nov 2, 2017 03:20 PM UTC</time><a class="anchor" name="1509636038">&nbsp;</a></div><pre>I&#39;m going to send some test jobs today hopefully and see if I can replicate the issue.

/Kevin

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Kevin Retzke 3130</pre></div><div class='update_description'><i onclick="document.location='35149#1509631089'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-11-02T13:58:09+00:00">Nov 2, 2017 01:58 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1509631089">&nbsp;</a></div><pre>Any updates on this?

-Kyle</pre></div><div class='update_description'><i onclick="document.location='35149#1508535597'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-20T21:39:57+00:00">Oct 20, 2017 09:39 PM UTC</time><a class="anchor" name="1508535597">&nbsp;</a></div><pre>I located the eight jobs that were running in that glidein at that time, strangely according to condor their max RSS only sums to 6,662,947,304 bytes.
The job that got OOM was actually right at the beginning, while uncompressing a tarball it transferred in. I profiled that portion of the job, and it only used
about 4 MiB RSS. It did use almost 5 GiB cache, but that should get swapped out as memory usage increases. So I don&#39;t know what could explain the OOM error.

/Kevin

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Kevin Retzke 3130</pre></div><div class='update_description'><i onclick="document.location='35149#1508515479'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-20T16:04:39+00:00">Oct 20, 2017 04:04 PM UTC</time><a class="anchor" name="1508515479">&nbsp;</a></div><pre>Thanks Serguei, that certainly could explain it. I need to be more careful about SI vs IEC units, I see I did write 32 GB when in fact it should have been 32 GiB (34,376,515,584 bytes).

I see at the time of one job getting OOM we had eight jobs in the glidein, six requesting 2 GiB and two requesting 9 GiB&#58;

October 19th 2017, 23&#58;27&#58;35.411	slot1_8@glidein_6541_147596771@....	2,147,483,648
October 19th 2017, 23&#58;27&#58;35.409	slot1_6@glidein_6541_147596771@....	9,529,458,688
October 19th 2017, 23&#58;27&#58;35.409	slot1_7@glidein_6541_147596771@....	2,147,483,648
October 19th 2017, 23&#58;27&#58;35.407	slot1_4@glidein_6541_147596771@....	9,529,458,688
October 19th 2017, 23&#58;27&#58;35.407	slot1_5@glidein_6541_147596771@....	2,147,483,648
October 19th 2017, 23&#58;27&#58;35.406	slot1_3@glidein_6541_147596771@....	2,147,483,648
October 19th 2017, 23&#58;27&#58;35.404	slot1_2@glidein_6541_147596771@....	2,147,483,648
October 19th 2017, 23&#58;27&#58;35.403	slot1_1@glidein_6541_147596771@....	2,147,483,648
October 19th 2017, 23&#58;27&#58;34.842	slot1@glidein_6541_147596771@....	2,432,696,320

But that actually sums to less than 32GB (31,943,819,264), so maybe we do have some jobs going over.
Our batch system has a periodic hold expression that checks for jobs exceeding requested memory, but that
can miss spikes. I will look some more at the jobs.

Thanks,
Kevin

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Kevin Retzke 3130</pre></div><div class='update_description'><i onclick="document.location='35149#1508514325'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-20T15:45:25+00:00">Oct 20, 2017 03:45 PM UTC</time><a class="anchor" name="1508514325">&nbsp;</a></div><pre>Hi Kevin,

The only reasonable explanation that Kenyi found is 32000000K != 32784MB.
So in /etc/cgconfig.conf  I have applied little bit more than 10% tolerance.

group htcondor {
cpu {}
cpuacct {}
memory {
memory.use_hierarchy=&#34;1&#34;;
memory.limit_in_bytes=36000000K;
memory.memsw.limit_in_bytes=40000000K;
}

Please inform us how it works.

If jobs fail again due to lack of memory it means they request much more than  32784 MB, or they grow in the process memory-wise.

-Serguei

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=sfedorov/CN=729766/CN=Serguei Fedorov</pre></div><div class='update_description'><i onclick="document.location='35149#1508506551'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-20T13:35:51+00:00">Oct 20, 2017 01:35 PM UTC</time><a class="anchor" name="1508506551">&nbsp;</a></div><pre>Hi Serguei,
Last night we had another round of jobs failing with out of memory errors on d12chas* hosts, can you please check?

Thanks,
Kevin

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Kevin Retzke 3130</pre></div><div class='update_description'><i onclick="document.location='35149#1508419545'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-19T13:25:45+00:00">Oct 19, 2017 01:25 PM UTC</time><a class="anchor" name="1508419545">&nbsp;</a></div><pre>Thanks Serguei, it looks like our jobs ran fine there overnight. Thanks for the quick response!

/Kevin

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Kevin Retzke 3130</pre></div><div class='update_description'><i onclick="document.location='35149#1508362349'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-18T21:32:29+00:00">Oct 18, 2017 09:32 PM UTC</time><a class="anchor" name="1508362349">&nbsp;</a></div><pre>That probably was the reason.  We have 48 d12chas servers for external grid jobs, each server has 128GB of RAM and 24 cores.
The 15 skynet servers  are dedicated for our local users and local jobs and should be not allowed for external users. It was my mistake that I didn&#39;t restrict fermilab user to run jobs on skynets.

I have checked configuration of d12chas and skynets and I see that we use cgroups to limit memory resources limit.
So d12chas have&#58;

memory.limit_in_bytes=12000000K;
memory.memsw.limit_in_bytes=13000000K;

but as for skynets&#58;

memory.limit_in_bytes=25000000K;
memory.memsw.limit_in_bytes=27000000K;

I am going to change memory usage limit to 32GB as it advertised and restart cgroups.
The access to skynet will closed for fermilab.

Please let me know how  your jobs status in the our changed settings on d12chas.

-Serguei Fedorov

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=sfedorov/CN=729766/CN=Serguei Fedorov</pre></div><div class='update_description'><i onclick="document.location='35149#1508359052'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-10-18T20:37:32+00:00">Oct 18, 2017 08:37 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1508359052">&nbsp;</a></div><pre>Over the past week (and possible longer) we&#39;ve been seeing a lot of Nova jobs starting at NotreDame, then either being killed or exiting with an out of memory error. The former I assume are pre-emptions? The latter is more perplexing. These jobs are from multiple users, and are exiting at different points in the job. Running at other sites we see they are not using more memory than they&#39;ve requested. We see glideins advertising 8 cores and 32 GB memory, is it possible that there is not actually that much memory available? Does the batch system enforce/limit jobs to their requested memory?

This doesn&#39;t appear to be limited to one or a couple hosts, although they all are named d12chasXXX.crc.nd.edu, e.g.&#58;
d12chas566.crc.nd.edu
d12chas563.crc.nd.edu
d12chas572.crc.nd.edu

We don&#39;t seem to seeing the same problems on the skynetXX.crc.nc.edu hosts (far fewer jobs landed on them however).

Thanks,
Kevin Retzke (Fermilab/FIFE support)

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Kevin Retzke 3130</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F35149">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 35149});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
