<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[22099] Squid server not working properly at CIT_CMS_T2</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=22099" method="post">
<div class="page-header">
    <h3><span class="muted">22099</span> / Squid server not working properly at CIT_CMS_T2</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Soichi Hayashi</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Resource Name</label><div class="controls">CIT_CMS_T2</div></div><div class="control-group"><label class="control-label">Associated VO</label><div class="controls">CMS</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Soichi Hayashi</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">USCMS_Tier2</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2014-09-19</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">USCMS Tier 2 <span class="muted"> / OSG Support Centers</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/22099", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/22099?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/22099?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Squid%20server%20not%20working%20properly%20at%20CIT_CMS_T2%20ISSUE%3D22099%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='22099#1411588160'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-24T19:49:20+00:00">Sep 24, 2014 07:49 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1411588160">&nbsp;</a></div><pre>I&#39;ve ran some tests and several jobs went to CIT_CMS_T2, and all jobs completed successfully there.

I am closing this ticket as Resolved now.</pre></div><div class='update_description'><i onclick="document.location='22099#1410440496'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-11T13:01:36+00:00">Sep 11, 2014 01:01 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1410440496">&nbsp;</a></div><pre>I have switched the squid test endpoint to <a href='http&#58;//cern.ch' target='_blank' rel='nofollow'>http&#58;//cern.ch</a>, but I haven&#39;t tested it yet. I am hoping to work on this next week.</pre></div><div class='update_description'><i onclick="document.location='22099#1409839545'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-04T14:05:45+00:00">Sep 4, 2014 02:05 PM UTC</time><a class="anchor" name="1409839545">&nbsp;</a></div><pre>I don&#39;t know. But 2 factors that will help the situation &#58;

* We will be very (un)lucky if all jobs start/send http requests at the same time
* If the proxy is being used, CERN will only see the first request. the others will come from the cache which is perfectly fine.

Cheers,
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div><div class='update_description'><i onclick="document.location='22099#1409838499'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-04T13:48:19+00:00">Sep 4, 2014 01:48 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1409838499">&nbsp;</a></div><pre>Samir,

Thank you for the suggestion! Do you know if www.cern.ch is designed to handle (potentially) thousands of simultaneous access from my jobs? I&#39;d like to make sure that I won&#39;t be blamed for staging DDOS on any of our test target..</pre></div><div class='update_description'><i onclick="document.location='22099#1409783196'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T22:26:36+00:00">Sep 3, 2014 10:26 PM UTC</time><a class="anchor" name="1409783196">&nbsp;</a></div><pre>Hi Soichi,

I&#39;m away with limited time/connectivity, but I can quickly comment that your test is not a good idea in CIT_CMS_T2. The reason is that we can only reach directly research networks. All communication with commercial internet needs to go through a special proxy. We tested that CMS and general glideins usually don&#39;t need this kind of access. So I suggest that you change the target of your test for some GlideInWMS machine or any reachable webserver. www.cern.ch should be fine for example.

I will run some tests when I manage to. But I&#39;m confident that google.com probably wouldn&#39;t work.

Thanks,
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div><div class='update_description'><i onclick="document.location='22099#1409780264'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-03T21:37:44+00:00">Sep 3, 2014 09:37 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1409780264">&nbsp;</a></div><pre>Samir,

Thank you for your feedback. I understand that this is just opportunistic use of CIT_CMT_T2, and I appreciate that you could give me a better squid configuration.

I&#39;ve ran some tests again, but unfortunately none of the jobs went to CIT_CMS_T2. I will try again next week, again.

I&#39;ve looked at my job script more closely, and the error message comes from when it test the configured squid server by downloading content from <a href='http&#58;//google.com.' target='_blank' rel='nofollow'>http&#58;//google.com.</a> If it fails to download within 3 seconds, it gives up and download user data without squid. So, is it possible that CIT_CMS_T2 is configured such that it can not reach google.com from the WN?

Soichi</pre></div><div class='update_description'><i onclick="document.location='22099#1409344475'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-29T20:34:35+00:00">Aug 29, 2014 08:34 PM UTC</time> by <b>echism</b><a class="anchor" name="1409344475">&nbsp;</a></div><pre>I&#39;m reassigning this to Soichi so he can do it on his schedule.</pre></div><div class='update_description'><i onclick="document.location='22099#1408947664'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-25T06:21:04+00:00">Aug 25, 2014 06:21 AM UTC</time><a class="anchor" name="1408947664">&nbsp;</a></div><pre>Hi Soichi,

As you saw in this ticket, the problem was not reproducible even at ~200 HTTP requests per second, if I remember correctly. Using the proxy or not. It looks like your job picks up the right proxy but something fails. We debugged the problem to some extent and changed our proxy settings to try serving your jobs better. If your DB is up to 72 MB it will be cached in the local squid, which wasn&#39;t happening before.

To do anything further I will need directions on how to reproduce the problem. CMS jobs seem to be fine and the problem discussed in the other ticket turned out to be that GlideIns wouldn&#39;t pick up the right setting for the proxy - a fix will be applied soon in their code.Some other cases there seems to be an overload in certain webservers, so nothing we could do at the site side.

Let us know if there is a simple way to reproduce what your job does exactly -- besides wget $DB_FILE, as this was already tried.

A couple of &#34;just in case&#34; questions &#58;

* Does the job tries to write to /tmp/ ? (some OSG jobs do)
* Does the job tries to write to /home/$USER?

Thanks,
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div><div class='update_description'><i onclick="document.location='22099#1408730976'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-22T18:09:36+00:00">Aug 22, 2014 06:09 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1408730976">&nbsp;</a></div><pre>Sorry, I was waiting for any user submitted job that happens to land on CIT_CMS_T2. Only some workflow requires squid server.

I&#39;ve just submitted a test job (which luckily landed on CIT_CMS_T2).

I am seeing following error messages.

----------------------------------stdout------------------------------------------
hostname compute-6-39.tier2
OSG env
GLIDECLIENT_Name=osg-flock-grid-iu-edu_OSG_gWMSFrontend.main
GLIDECLIENT_OSG_VO=OSG
GLIDEIN_Factory=OSGGOC
OSGVO_CMSSW_Path=/raid1/osg-app/cmssoft/cms/
OSGVO_CMSSW_Revision=&#39;1119 - /raid1/osg-app/cmssoft/cms//etc/cms-common/revision&#39;
OSGVO_CPU_MODEL=&#39;AMD Opteron(tm) Processor 6378                 &#39;
OSGVO_Data_EIC1=False
OSGVO_Data_EIC_A1=False
OSGVO_Data_EIC_A40=False
OSGVO_PILOT_DF=280477496
OSG_APP=/raid1/osg-app
OSG_DATA=/raid2/osg-data
OSG_DEFAULT_SE=cit-se.ultralight.org
OSG_GLEXEC_LOCATION=/usr/sbin/glexec
OSG_GLIDEIN_VERSION=44
OSG_GRID=/etc/osg/wn-client/
OSG_HOSTNAME=cit-gatekeeper2.ultralight.org
OSG_JOB_CONTACT=cit-gatekeeper2.ultralight.org/jobmanager-condor
OSG_SITE_NAME=CIT_CMS_T2B
OSG_SITE_READ=/mnt/hadoop/osg
OSG_SITE_WRITE=/mnt/hadoop/osg
OSG_SQUID_LOCATION=10.3.11.62&#58;3128
OSG_STORAGE_ELEMENT=True
OSG_WN_TMP=/wntmp/condor/compute-6-39/execute/dir_25177
VOS_USING_SE_VONAME_LOWERCASE=CMS,GLOW,HCC,NWICG,OSG
_=&#39;OSG env&#39;
<div id='show_2057573791' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_2057573791'>sourcing params.sh
export inputquery=test.fasta
export user_dbpath=<a href='http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230' target='_blank' rel='nofollow'>http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230</a>
export dbname=&#34;blastdb&#34;
export blast=blastn
export blast_opts=&#34;-outfmt 6 -evalue 0.0001 -task megablast   -strand both        -dust yes         &#34;
prevent condor to issue hold event before terminating with any error code
downloading user db from <a href='http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230' target='_blank' rel='nofollow'>http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230</a> - through squid
using squid&#58; 10.3.11.62&#58;3128
wget failed through squid..
</div><script type='text/javascript'>
        $('#show_2057573791').click(function() {
            $('#detail_2057573791').slideDown("normal");
            $('#show_2057573791').hide();
            $('#hide_2057573791').show();
        });
        $('#hide_2057573791').click(function() {
            $('#detail_2057573791').slideUp();
            $('#hide_2057573791').hide();
            $('#show_2057573791').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='22099#1408730834'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-22T18:07:14+00:00">Aug 22, 2014 06:07 PM UTC</time> by <b>echism</b><a class="anchor" name="1408730834">&nbsp;</a></div><pre>Samir,

I&#39;ll ask again that Soichi revisit this on Monday, but if not, I&#39;ll close it.</pre></div><div class='update_description'><i onclick="document.location='22099#1408476296'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-19T19:24:56+00:00">Aug 19, 2014 07:24 PM UTC</time><a class="anchor" name="1408476296">&nbsp;</a></div><pre>Dear GOC,

No updates from the user. The issue looks solved to me. could we close the ticket?

Thanks,
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div><div class='update_description'><i onclick="document.location='22099#1408158463'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-16T03:07:43+00:00">Aug 16, 2014 03:07 AM UTC</time><a class="anchor" name="1408158463">&nbsp;</a></div><pre>Hi,

I checked and your DB is being cached now &#58;

[root@compute-6-20 ~]# /share/apps/scripts/squid-test.sh
--2014-08-15 20&#58;05&#58;22--  <a href='http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230/blastdb.tar.gz' target='_blank' rel='nofollow'>http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230/blastdb.tar.gz</a>
Connecting to 10.3.11.62&#58;3128... connected.
Proxy request sent, awaiting response... 200 OK
Length&#58; 67306772 (64M) [application/x-gzip]
Saving to&#58; “blastdb.tar.gz”

100%[=========================================================================================================================================================================&#62;] 67,306,772  96.3M/s   in 0.7s

2014-08-15 20&#58;05&#58;23 (96.3 MB/s) - “blastdb.tar.gz” saved [67306772/67306772]

--2014-08-15 20&#58;05&#58;23--  <a href='http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230/blastdb.tar.gz' target='_blank' rel='nofollow'>http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230/blastdb.tar.gz</a>
Connecting to 10.3.11.62&#58;3128... connected.
Proxy request sent, awaiting response... 200 OK
Length&#58; 67306772 (64M) [application/x-gzip]
Saving to&#58; “blastdb.tar.gz”

100%[=========================================================================================================================================================================&#62;] 67,306,772   113M/s   in 0.6s

2014-08-15 20&#58;05&#58;23 (113 MB/s) - “blastdb.tar.gz” saved [67306772/67306772]

0

This could change at any moment if I see that the new behavior is having negative effects. But for the moment please report back if you&#39;re still running jobs or not and the outcome. If not I&#39;d ask GOC to close the ticket.

Thanks,
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div><div class='update_description'><i onclick="document.location='22099#1408141148'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-15T22:19:08+00:00">Aug 15, 2014 10:19 PM UTC</time><a class="anchor" name="1408141148">&nbsp;</a></div><pre>I did several tests &#58;

* each of the ~250 worker-nodes will download [1] 30 times using the proxy. This was executed in ~1s. So a pretty high rate on the squid &#58;
[root@compute-6-20 ~]# time /share/apps/scripts/squid-test.sh
real	0m1.335s

- Result - ALL worker-nodes returned 0 (ok status) for ALL threads&#58;

[168] 12&#58;16&#58;04 [SUCCESS] compute-14-22
30 0
[169] 12&#58;16&#58;13 [SUCCESS] compute-14-23
30 0
[170] 12&#58;16&#58;14 [SUCCESS] compute-14-24
30 0

* each of the ~250 worker-nodes will download [1] 30 times NOT using the proxy, to make sure that NAT is fine.
- Result - ALL worker-nodes returned 0 (ok status) for ALL threads&#58;

* each of the ~250 worker-nodes will download [1] 200 times using the proxy.
- Result - ALL worker-nodes returned 0 (ok status) for ALL threads.

Plots from the test showing the spikes of bandwidth generated on Squid&#39;s network interface are attached.

What was curious, is that when I try to download one of the DB files of your job specifically &#58;

wget <a href='http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230/blastdb.tar.gz' target='_blank' rel='nofollow'>http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230/blastdb.tar.gz</a>
2014-08-15 14&#58;49&#58;51 (4.20 MB/s) - “blastdb.tar.gz.4” saved [67306772/67306772]

It wouldn&#39;t ever get cached. Squid says &#58;

10.3.10.83 - - [15/Aug/2014&#58;14&#58;41&#58;43 +0000] &#34;GET <a href='http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230/blastdb.tar.gz' target='_blank' rel='nofollow'>http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230/blastdb.tar.gz</a> HTTP/1.0&#34; 200 67307168 TCP_HIT&#58;NONE 7088 &#34;-&#34; &#34;-&#34; &#34;Wget/1.12 (linux-gnu)&#34;
10.3.10.121 - - [15/Aug/2014&#58;14&#58;41&#58;43 +0000] &#34;GET <a href='http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230/blastdb.tar.gz' target='_blank' rel='nofollow'>http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230/blastdb.tar.gz</a> HTTP/1.0&#34; 200 67307168 TCP_HIT&#58;NONE 7095 &#34;-&#34; &#34;-&#34; &#34;Wget/1.12 (linux-gnu)&#34;

I will try to tune squid to favour your case, but it looks like CMS workflows are being quite successful at the moment, so this falls in a lower priority SLA - our high priority SLA is with the CMS VO.

<div id='show_1843078096' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1843078096'>Thanks,
Samir

[1] - <a href='http&#58;//gfactory-1.t2.ucsd.edu/glidefactory//stage/glidein_v3_0_long/condor_bin_0.da38OL.tgz' target='_blank' rel='nofollow'>http&#58;//gfactory-1.t2.ucsd.edu/glidefactory//stage/glidein_v3_0_long/condor_bin_0.da38OL.tgz</a>

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira
</div><script type='text/javascript'>
        $('#show_1843078096').click(function() {
            $('#detail_1843078096').slideDown("normal");
            $('#show_1843078096').hide();
            $('#hide_1843078096').show();
        });
        $('#hide_1843078096').click(function() {
            $('#detail_1843078096').slideUp();
            $('#hide_1843078096').hide();
            $('#show_1843078096').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='22099#1408127917'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-15T18:38:37+00:00">Aug 15, 2014 06:38 PM UTC</time><a class="anchor" name="1408127917">&nbsp;</a></div><pre>Yes, I was trying to figure out if this was related to a similar problem reported at &#58;

<a href='https&#58;//ticket.grid.iu.edu/22016' target='_blank' rel='nofollow'>https&#58;//ticket.grid.iu.edu/22016</a>

Basically it was between a problem on the actual proxy or the fact that some pilot jobs were not really defining/using the proxy variable and having problems. Detailed description in the other ticket.

We found that the problem is in the proxy and are investigating the cause, which doesn&#39;t look obvious at first. Many requests are succeeding so it&#39;s a bit hard to reproduce the problem. I will start launching stress tests to hopefully reproduce the problem. Will keep you posted.

Thanks,
Samir

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=samir/CN=695732/CN=Samir Cury Siqueira</pre></div><div class='update_description'><i onclick="document.location='22099#1408039078'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-14T17:57:58+00:00">Aug 14, 2014 05:57 PM UTC</time> by <b>echism</b><a class="anchor" name="1408039078">&nbsp;</a></div><pre>Hey Samir,

Do you have any updates on this?

Thank you</pre></div><div class='update_description'><i onclick="document.location='22099#1407933729'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-08-13T12:42:09+00:00">Aug 13, 2014 12:42 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1407933729">&nbsp;</a></div><pre>Hello.

This might be just some transient problem but a lot of my jobs were failing yesterday at CIT_CMS_T2 due to wget not able to download files via $OSG_SQUID_LOCATION specified in the WN ENVs. Could you take a look?

Here is a bit more info. from my job output.

hostname compute-16-14.tier2
OSG env
GLIDECLIENT_Name=osg-flock-grid-iu-edu_OSG_gWMSFrontend.main
GLIDECLIENT_OSG_VO=OSG
GLIDEIN_Factory=OSGGOC
OSGVO_CMSSW_Path=/raid1/osg-app/cmssoft/cms/
OSGVO_CMSSW_Revision=&#39;1118 - /raid1/osg-app/cmssoft/cms//etc/cms-common/revision&#39;
OSGVO_CPU_MODEL=&#39;Intel(R) Xeon(R) CPU           L5520  @ 2.27GHz&#39;
OSGVO_Data_EIC1=False
OSGVO_Data_EIC_A1=False
OSGVO_Data_EIC_A40=False
OSGVO_PILOT_DF=281016796
OSG_APP=/raid1/osg-app
OSG_DATA=/raid2/osg-data
OSG_DEFAULT_SE=cit-se.ultralight.org
OSG_GLEXEC_LOCATION=/usr/sbin/glexec
OSG_GLIDEIN_VERSION=44
OSG_GRID=/etc/osg/wn-client/
OSG_HOSTNAME=cit-gatekeeper.ultralight.org
OSG_JOB_CONTACT=cit-gatekeeper.ultralight.org/jobmanager-condor
OSG_SITE_NAME=CIT_CMS_T2
OSG_SITE_READ=/mnt/hadoop/osg
OSG_SITE_WRITE=/mnt/hadoop/osg
OSG_SQUID_LOCATION=10.3.11.62&#58;3128
OSG_STORAGE_ELEMENT=True
OSG_WN_TMP=/wntmp/condor/compute-16-14/execute/dir_21872
VOS_USING_SE_VONAME_LOWERCASE=CMS,GLOW,HCC,NWICG,OSG
_=&#39;OSG env&#39;
sourcing params.sh
<div id='show_130062840' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_130062840'>export inputquery=input.fasta
export user_dbpath=<a href='http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230' target='_blank' rel='nofollow'>http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230</a>
export dbname=&#34;blastdb&#34;
export blast=blastn
export blast_opts=&#34;-outfmt 6 -evalue 0.0001 -task megablast   -strand both        -dust yes         &#34;
prevent condor to issue hold event before terminating with any error code
downloading user db from <a href='http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230' target='_blank' rel='nofollow'>http&#58;//osg-xsede.grid.iu.edu/scratch/iugalaxy/userdb/6230</a> - through squid
using squid&#58; 10.3.11.62&#58;3128
wget failed through squid..

</div><script type='text/javascript'>
        $('#show_130062840').click(function() {
            $('#detail_130062840').slideDown("normal");
            $('#show_130062840').hide();
            $('#hide_130062840').show();
        });
        $('#hide_130062840').click(function() {
            $('#detail_130062840').slideUp();
            $('#hide_130062840').hide();
            $('#show_130062840').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F22099">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
