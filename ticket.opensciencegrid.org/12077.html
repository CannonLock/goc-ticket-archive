<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[12077] globus-gram-job-manager use huge memory and bring down the machine</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=12077" method="post">
<div class="page-header">
    <h3><span class="muted">12077</span> / globus-gram-job-manager use huge memory and bring down the machine</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Fengping Hu</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Fengping Hu</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">check on upgrade?</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2012-06-22</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/12077", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='12077#1339817782'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-06-16T03:36:22+00:00">Jun 16, 2012 03:36 AM UTC</time> by <b>Alain Roy</b><a class="anchor" name="1339817782">&nbsp;</a></div><pre>That&#39;s fantastic! I&#39;ll close this ticket for now, but feel free to reopen it or start a new one if needed.
-alain
------------------------------------
Alain Roy
OSG Software Support
vdt-support@....</pre></div><div class='update_description'><i onclick="document.location='12077#1339802769'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-06-15T23:26:09+00:00">Jun 15, 2012 11:26 PM UTC</time> by <b>Fengping Hu</b><a class="anchor" name="1339802769">&nbsp;</a></div><pre>Hi Alain,

I&#39;ve updated to the latest release Wednesday. I haven&#39;t seen the issue
since then.

Thanks,
Fengping

On Fri, Jun 15, 2012 at 4&#58;51 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='12077#1339793500'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-06-15T20:51:40+00:00">Jun 15, 2012 08:51 PM UTC</time> by <b>Alain Roy</b><a class="anchor" name="1339793500">&nbsp;</a></div><pre>Fengping&#58; we released the update on Tuesday. You can read about it here&#58;
<a href='https&#58;//twiki.grid.iu.edu/bin/view/Documentation/Release3/Release314' target='_blank' rel='nofollow'>https&#58;//twiki.grid.iu.edu/bin/view/Documentation/Release3/Release314</a>

When you have a chance to try it out, I&#39;d love to hear if it improves the memory usage at your site.

Thanks!
-alain
------------------------------------
Alain Roy
OSG Software Support
vdt-support@....</pre></div><div class='update_description'><i onclick="document.location='12077#1339099507'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-06-07T20:05:07+00:00">Jun 7, 2012 08:05 PM UTC</time> by <b>Fengping Hu</b><a class="anchor" name="1339099507">&nbsp;</a></div><pre>Hi Alain,

Thanks for the updates. The SE has been working pretty stable recently.
Since it&#39;s pretty close to the release date, I will update it once it&#39;s
released and let you know how it works.

Thanks,
Fengping

On Wed, Jun 6, 2012 at 2&#58;24 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='12077#1339007081'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-06-06T18:24:41+00:00">Jun 6, 2012 06:24 PM UTC</time> by <b>Alain Roy</b><a class="anchor" name="1339007081">&nbsp;</a></div><pre>Thanks for prodding, Elizabeth!

Fengping&#58; we have a version of the globus-gram-job-manager that you can try out. We haven&#39;t released it yet, but we&#39;ve done some light testing and it doesn&#39;t make things worse as far as we can tell. It&#39;s supposed to clear up a number of memory leaks, and hopefully they are the leaks that are affecting your site. Are you willing to try it out and see if it helps?

You can do the following command to get the update&#58;

yum update --enablerepo=osg-testing globus-gram-job-manager

If you can try it out, let me know how it works for you.

Thanks!
-alain

------------------------------------
Alain Roy
OSG Software Support
vdt-support@....</pre></div><div class='update_description'><i onclick="document.location='12077#1339001070'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-06-06T16:44:30+00:00">Jun 6, 2012 04:44 PM UTC</time> by <b>echism</b><a class="anchor" name="1339001070">&nbsp;</a></div><pre>Alain,

It looks like the fix from the Globus team just came in yesterday. I&#39;m guessing this is still in progress, right?

Thank you,
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='12077#1338317916'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-29T18:58:36+00:00">May 29, 2012 06:58 PM UTC</time><a class="anchor" name="1338317916">&nbsp;</a></div><pre>Until then, if serious issues redevelop, we can do the same procedure as before&#58; remove all the globus state files.  This should be (relatively) harmless for pilots, but fairly disruptive for glite jobs.  Hence, do it only when necessary...

-- by Brian Bockelman</pre></div><div class='update_description'><i onclick="document.location='12077#1338316989'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-29T18:43:09+00:00">May 29, 2012 06:43 PM UTC</time> by <b>Alain Roy</b><a class="anchor" name="1338316989">&nbsp;</a></div><pre>June 5th is probably approximate. I&#39;m hoping we can test it sooner than that.

There isn&#39;t much to be done before we get a fix from the Globus Team. I&#39;ll certainly ping them this week to see where they are with it.

-alain
--------------------------------------
Alain Roy
Open Science Grid Software Coordinator
roy@....
<a href='http&#58;//opensciencegrid.org' target='_blank' rel='nofollow'>http&#58;//opensciencegrid.org</a></pre></div><div class='update_description'><i onclick="document.location='12077#1338296760'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-29T13:06:00+00:00">May 29, 2012 01:06 PM UTC</time> by <b>echism</b><a class="anchor" name="1338296760">&nbsp;</a></div><pre>Alain,

It looks like right now the Globus release is scheduled for 6/5. Is there anything to do before that time?

Thank you,
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='12077#1337956979'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-25T14:42:59+00:00">May 25, 2012 02:42 PM UTC</time> by <b>Alain Roy</b><a class="anchor" name="1337956979">&nbsp;</a></div><pre>Fengping,

Brian has done some good debugging and gotten details on significant memory leaks. He&#39;s shared them with Joe Bester, the primary GRAM developer, who thinks he understands them. There&#39;s been a ticket made with Globus here&#58;
<a href='http&#58;//jira.globus.org/browse/GT-214' target='_blank' rel='nofollow'>http&#58;//jira.globus.org/browse/GT-214</a>

Between this upcoming fix and some other recently made fixes, I think there&#39;s a good chance that we&#39;ll have fixes for you soon. I&#39;ll keep you informed as we learn more.

-alain
------------------------------------
Alain Roy
OSG Software Support
vdt-support@....</pre></div><div class='update_description'><i onclick="document.location='12077#1337632327'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-21T20:32:07+00:00">May 21, 2012 08:32 PM UTC</time> by <b>Fengping Hu</b><a class="anchor" name="1337632327">&nbsp;</a></div><pre>The problem still exist after we upgraded to osg 3.1.2.
As I stated last time&#58; we&#39;ve had the ulimit setting in place to at least
isolate users and prevent the whole machine melt down when this occurs. But
we are not not sure on&#58;
1) what&#39;s the impact of the ulimit setting, i.e. is the CE working as it
supposed to with the ulimit setting.
2) what&#39;s causing the memory usage surge. -- configuration wise it&#39;s pertty
standard on the osg CE(globus) front. so it&#39;s strange that we are the one
reporting the problem.

Thanks,
Fengping

On Wed, May 16, 2012 at 3&#58;29 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='12077#1337196547'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-16T19:29:07+00:00">May 16, 2012 07:29 PM UTC</time> by <b>Fengping Hu</b><a class="anchor" name="1337196547">&nbsp;</a></div><pre>Hi Alain,

I don&#39;t see the problem recently although no configuration change is made
on the CE side(I still have the ulimit setting in place). So my concern is
that since the root cause seems to be unknown, would this issue strike
again...

I will get the new one installed tomorrow and will monitor it closely.

Thanks,
Fengping

On Wed, May 16, 2012 at 2&#58;48 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='12077#1337194098'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-16T18:48:18+00:00">May 16, 2012 06:48 PM UTC</time> by <b>Alain Roy</b><a class="anchor" name="1337194098">&nbsp;</a></div><pre>Hi Fengping,

Yesterday we released OSG 3.1.2 which addresses a large memory leak in the Globus GRAM job manager. If you have time, give it a try and let me know how it goes.

After talking with Brian yesterday, I was confused about the state of your installation. Are you still actively having problems with GRAM&#39;s memory consumption, or are things looking better at the moment? I see that your RSV results are looking good at the moment.

Thanks,
-alain
------------------------------------
Alain Roy
OSG Software Support
vdt-support@....</pre></div><div class='update_description'><i onclick="document.location='12077#1337016931'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-14T17:35:31+00:00">May 14, 2012 05:35 PM UTC</time> by <b>Alain Roy</b><a class="anchor" name="1337016931">&nbsp;</a></div><pre>OK, the new release should be out tomorrow, but it may be the end of the day before it&#39;s out. I&#39;ll try to remember to ping this ticket and let you know when it&#39;s ready.

-alain
------------------------------------
Alain Roy
OSG Software Support
vdt-support@....</pre></div><div class='update_description'><i onclick="document.location='12077#1337016187'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-14T17:23:07+00:00">May 14, 2012 05:23 PM UTC</time> by <b>Fengping Hu</b><a class="anchor" name="1337016187">&nbsp;</a></div><pre>Hi Alain,

Thanks for looking into this.
As for the updates. I&#39;d like to just wait for the official release(and do
that during our scheduled maintenance(May15-17))as the gatekeeper appears
to be functioning recently.

Thanks,
Fengping

On Mon, May 14, 2012 at 12&#58;14 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='12077#1337012065'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-14T16:14:25+00:00">May 14, 2012 04:14 PM UTC</time> by <b>Alain Roy</b><a class="anchor" name="1337012065">&nbsp;</a></div><pre>Thanks Fengping. I didn&#39;t see any obvious things to blame in the osg-profile.

We do know of memory leaks in the Globus GRAM job manager, though not of the scale that you&#39;ve been seeing. If you&#39;d like to install a couple of new RPMs and restart Globus, you can try them out and see if it helps.

We have not officially released these RPMs, but they are finishing up testing today and we plan to release them tomorrow. I can tell you how to install them today if you&#39;d like to do so.

-alain
------------------------------------
Alain Roy
OSG Software Support
vdt-support@....</pre></div><div class='update_description'><i onclick="document.location='12077#1337003228'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-14T13:47:08+00:00">May 14, 2012 01:47 PM UTC</time> by <b>Fengping Hu</b><a class="anchor" name="1337003228">&nbsp;</a></div><pre>Hi Alain,

Attached is the osg-profile.txt

Thanks,
Fengping

On Fri, May 11, 2012 at 5&#58;40 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='12077#1336772444'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-11T21:40:44+00:00">May 11, 2012 09:40 PM UTC</time> by <b>Alain Roy</b><a class="anchor" name="1336772444">&nbsp;</a></div><pre>Fengping,

First, can you please run the following commands, preferably as root?

cd /tmp
osg-system-profiler

Then mail me the osg-profile.txt or vdt-profile.txt that is created.

Next, we have a couple of updates that will address memory consumption on the gatekeeper. They are not fully addressed and I&#39;m not convinced they are the problem you&#39;re seeing. But if you&#39;re willing to try them out, I&#39;ll tell you how to install them.

-alain
------------------------------------
Alain Roy
OSG Software Support
vdt-support@....</pre></div><div class='update_description'><i onclick="document.location='12077#1336707488'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-11T03:38:08+00:00">May 11, 2012 03:38 AM UTC</time> by <b>Fengping Hu</b><a class="anchor" name="1336707488">&nbsp;</a></div><pre>GLOBUS_TCP_PORT_RANGE and GLOBUS_TCP_SOURCE_RANGE are not set. The
Gatekeeper is not behind a firewall.
On Thu, May 10, 2012 at 5&#58;22 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='12077#1336684975'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-10T21:22:55+00:00">May 10, 2012 09:22 PM UTC</time> by <b>Alain Roy</b><a class="anchor" name="1336684975">&nbsp;</a></div><pre>Hi Fengping,

It&#39;s hard to be sure what the problem is exactly. We have a couple of updates coming out next Tuesday (I hope) that address memory issues, but it&#39;s not clear to me that it&#39;s the same memory issue you&#39;re experiencing.

Brian, how did you come to the conclusion that it was a firewall problem and glideinWMS was submitting too many jobs?  Does 1700 jobs seem like too many? It doesn&#39;t seem like enough to explain the symptoms here.

Fengping, what range of ports did you open up for Globus?

-alain
------------------------------------
Alain Roy
OSG Software Support
vdt-support@....</pre></div><div class='update_description'><i onclick="document.location='12077#1336662667'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-10T15:11:07+00:00">May 10, 2012 03:11 PM UTC</time> by <b>Fengping Hu</b><a class="anchor" name="1336662667">&nbsp;</a></div><pre>Any updates on this issue?

The SAM test against this gatekeepers has been failing for days now.  Also
we are considering upgrade the rest of CEs to osg 3.0 together with our
scheduled maintenance next week if osg 3.0 can work properly.

For now I added &#34;ulimit -Sv 900000&#34; in /etc/init.d/globus-gatekeeper to
restrict the virtual memory to be 900M so that at least it doesnt bring
down the whole machine. But considering the SAM test is failing, this
obviously can not be considered a success workaround for the issue.

Thanks,
Fengping

On Thu, May 3, 2012 at 11&#58;41 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='12077#1336481398'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-08T12:49:58+00:00">May 8, 2012 12:49 PM UTC</time><a class="anchor" name="1336481398">&nbsp;</a></div><pre>Added cc to myself on this one.

John Weigand

-- by John Weigand</pre></div><div class='update_description'><i onclick="document.location='12077#1336102866'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-04T03:41:06+00:00">May 4, 2012 03:41 AM UTC</time> by <b>Fengping Hu</b><a class="anchor" name="1336102866">&nbsp;</a></div><pre>Hi Brian,

Here&#39;s some strace output from the abnormal globus-job-manager process&#58;
#################
select(19, [4 7 10], [], NULL, {0, 0})  = 0 (Timeout)
lseek(9, 8192, SEEK_SET)                = 8192
select(19, [4 7 10], [], NULL, {0, 0})  = 0 (Timeout)
lseek(9, 8192, SEEK_SET)                = 8192
select(19, [4 7 10], [], NULL, {0, 0})  = 0 (Timeout)
lseek(9, 8192, SEEK_SET)                = 8192
select(19, [4 7 10], [], NULL, {0, 0})  = 0 (Timeout)
lseek(9, 8192, SEEK_SET)                = 8192
select(19, [4 7 10], [], NULL, {0, 0})  = 0 (Timeout)
lseek(9, 8192, SEEK_SET)                = 8192
select(19, [4 7 10], [], NULL, {0, 0})  = 0 (Timeout)
lseek(9, 8192, SEEK_SET)                = 8192
select(19, [4 7 10], [], NULL, {0, 0})  = 0 (Timeout)
lseek(9, 8192, SEEK_SET)                = 8192
select(19, [4 7 10], [], NULL, {0, 0})  = 0 (Timeout)
lseek(9, 8192, SEEK_SET)                = 8192
select(19, [4 7 10], [], NULL, {0, 0})  = 0 (Timeout)
lseek(9, 8192, SEEK_SET)                = 8192
select(19, [4 7 10], [], NULL, {0, 0})  = 0 (Timeout)
lseek(9, 8192, SEEK_SET)                = 8192

ls -l /proc/13179/fd
total 0
lr-x------ 1 osgnano osgusers 64 May  3 21&#58;53 0 -&#62; /dev/null
l-wx------ 1 osgnano osgusers 64 May  3 21&#58;53 1 -&#62; /dev/null
lrwx------ 1 osgnano osgusers 64 May  3 21&#58;53 10 -&#62; socket&#58;[48453]
lrwx------ 1 osgnano osgusers 64 May  3 21&#58;53 11 -&#62; socket&#58;[48465]
l-wx------ 1 osgnano osgusers 64 May  3 21&#58;53 12 -&#62;
/var/log/globus/gram_osgnano.log
lrwx------ 1 osgnano osgusers 64 May  3 21&#58;53 13 -&#62; socket&#58;[48474]
lrwx------ 1 osgnano osgusers 64 May  3 21&#58;53 14 -&#62; socket&#58;[48582]
<div id='show_1368851918' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1368851918'>lrwx------ 1 osgnano osgusers 64 May  3 21&#58;53 15 -&#62; socket&#58;[48483]
lr-x------ 1 osgnano osgusers 64 May  3 21&#58;53 17 -&#62; pipe&#58;[48485]
l-wx------ 1 osgnano osgusers 64 May  3 21&#58;53 2 -&#62;
/var/log/globus-gatekeeper.log
l-wx------ 1 osgnano osgusers 64 May  3 21&#58;53 3 -&#62; /dev/null
lr-x------ 1 osgnano osgusers 64 May  3 21&#58;53 4 -&#62; pipe&#58;[48447]
l-wx------ 1 osgnano osgusers 64 May  3 21&#58;53 5 -&#62; pipe&#58;[48447]
l-wx------ 1 osgnano osgusers 64 May  3 21&#58;53 6 -&#62;
/var/log/globus-gatekeeper.log
lrwx------ 1 osgnano osgusers 64 May  3 21&#58;53 7 -&#62; socket&#58;[48448]
lrwx------ 1 osgnano osgusers 64 May  3 21&#58;53 8 -&#62;
/var/lib/globus/gram_job_state/osgnano/lepton/pbs.76dd5e69.lock
lr-x------ 1 osgnano osgusers 64 May  3 21&#58;53 9 -&#62;
/var/lib/globus/globus-seg-pbs/20120503

I killed those abnormal process and the CE looks fine for now.
However I am not sure what is the root cause and thus don&#39;t how to prevent
it from happening again.

Thanks,
Fengping

On Thu, May 3, 2012 at 8&#58;20 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_1368851918').click(function() {
            $('#detail_1368851918').slideDown("normal");
            $('#show_1368851918').hide();
            $('#hide_1368851918').show();
        });
        $('#hide_1368851918').click(function() {
            $('#detail_1368851918').slideUp();
            $('#hide_1368851918').hide();
            $('#show_1368851918').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='12077#1336090807'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-04T00:20:07+00:00">May 4, 2012 12:20 AM UTC</time> by <b>Fengping Hu</b><a class="anchor" name="1336090807">&nbsp;</a></div><pre>Hi Brian,

Here&#39;re the output of the commands&#58;

#find /var/lib/globus/gram_job_state | wc -l
1781

#rpm -q globus-gram-job-manager
globus-gram-job-manager-13.23-0.10.osg.el5

I guess it could be related to the lcmaps log filled up /var/log/messages
then. I enlarged the file system when I noticed var being full, but that
obvious didn&#39;t fix the job manager comsume large men issue?

Thanks,
Fengping

On Thu, May 3, 2012 at 6&#58;31 PM, Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='12077#1336084294'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-03T22:31:34+00:00">May 3, 2012 10:31 PM UTC</time><a class="anchor" name="1336084294">&nbsp;</a></div><pre>Hi Fengping,

It appears that you ran out of network ports in the firewall range and the gWMS went into an infinite loop of submitting jobs.  I suspect your job-managers are of that size because they are trying to manage an inordinate number of jobs.

Can you run the following for me&#58;

find /var/lib/globus/gram_job_state | wc -l

rpm -q globus-gram-job-manager

Thanks,

Brian

-- by Brian Bockelman</pre></div><div class='update_description'><i onclick="document.location='12077#1336058985'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-03T15:29:45+00:00">May 3, 2012 03:29 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1336058985">&nbsp;</a></div><pre>[by Fengping Hu]

Upgraded to osg 3.0.9 a few weeks ago. The local batch system is pbs.

It looks today the gatekeeper is almost broken --due to huge memory consumption by the globes-gram-job-manager consumption. One of the process uses &#62;5G memory. That doesn&#39;t look normal to me at all...

ps faux | grep globus-gram-job-manager  | awk &#39;{print $6;}&#39; | sort -n
560
3440
3688
10016
982148
1173356
1310268
1320452
2158228
2971952
5565696

Thanks for your help.
Fengping</pre></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F12077">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
