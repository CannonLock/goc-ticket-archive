<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[8940] Resource Specific Issue on Nebraska</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=8940" method="post">
<div class="page-header">
    <h3><span class="muted">8940</span> / Resource Specific Issue on Nebraska</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Robert Engel</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Resource Name</label><div class="controls">Nebraska</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2010-07-28</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">USCMS <span class="muted"> / OSG Support Centers</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/8940", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/8940?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/8940?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Resource%20Specific%20Issue%20on%20Nebraska%20ISSUE%3D8940%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='8940#1279819086'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-22T17:18:06+00:00">Jul 22, 2010 05:18 PM UTC</time> by <b>USCMS</b><a class="anchor" name="1279819086">&nbsp;</a></div><pre>The Fermi/Remedy ticket has been resolved with the following solution.  Please resolve your ticket.

Resolution Categorization Tier 1 &#58;
Resolution Categorization Tier 2 &#58;
Resolution Categorization Tier 3 &#58;
Resolution                       &#58; Resolved by GOC
Resolution Method                &#58;

Fermi National Accelerator Laboratory Service DeskService Desk&#58; 630.840.2345</pre></div><div class='update_description'><i onclick="document.location='8940#1279818859'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-22T17:14:19+00:00">Jul 22, 2010 05:14 PM UTC</time> by <b>echism</b><a class="anchor" name="1279818859">&nbsp;</a></div><pre>Thank you. Closing.

Elizabeth</pre></div><div class='update_description'><i onclick="document.location='8940#1279818413'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-22T17:06:53+00:00">Jul 22, 2010 05:06 PM UTC</time><a class="anchor" name="1279818413">&nbsp;</a></div><pre>Good to hear, go ahead and resume normal operations. I&#39;ll keep an eye on our side and let you know if this behavior pops up again.

Elizabeth, go ahead and close this whenever.

- Garhan Attebury</pre></div><div class='update_description'><i onclick="document.location='8940#1279816749'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-22T16:39:09+00:00">Jul 22, 2010 04:39 PM UTC</time> by <b>engel_r@....</b><a class="anchor" name="1279816749">&nbsp;</a></div><pre>Hi Garhan,

the job on gpn-husker runs successfully in $OSG_WN_TMP now&#58;

/scratch/condor/var/lib/condor/execute/dir_26460/ligo/rengel/tasks/44636

the job on red also runs in $OSG_WN_TMP now&#58;

/scratch/condor/var/lib/condor/execute/dir_10812/ligo/rengel/tasks/75756

Both jobs finished and wrote output to $OSG_DATA/ligo/rengel/tasks/.

May I go ahead and resume production runs?

Thanks,
Robert

Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8940#1279816026'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-22T16:27:06+00:00">Jul 22, 2010 04:27 PM UTC</time> by <b>engel_r@....</b><a class="anchor" name="1279816026">&nbsp;</a></div><pre>Garhan.

I just submitted one job each to red and to gpn-husker. Let&#39;s see
how it goes. I have noticed that the misconfiguration existed only on
gpn-husker, but not red.

Robert

Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8940#1279809033'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-22T14:30:33+00:00">Jul 22, 2010 02:30 PM UTC</time><a class="anchor" name="1279809033">&nbsp;</a></div><pre>Yes, go ahead and close the ticket. We will work with Robert directly from this point on this issue.

- Garhan Attebury</pre></div><div class='update_description'><i onclick="document.location='8940#1279808139'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-22T14:15:39+00:00">Jul 22, 2010 02:15 PM UTC</time> by <b>echism</b><a class="anchor" name="1279808139">&nbsp;</a></div><pre>Robert,

This sounds resolved to me. May I close this ticket?

Thank you,
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='8940#1279744387'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-21T20:33:07+00:00">Jul 21, 2010 08:33 PM UTC</time> by <b>Carl Lundstedt</b><a class="anchor" name="1279744387">&nbsp;</a></div><pre>Hey Robert,
This sounds reasonable.  I&#39;ll un-ban your account.

Carl
On Wed, 2010-07-21 at 20&#58;18 +0000, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8940#1279743486'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-21T20:18:06+00:00">Jul 21, 2010 08:18 PM UTC</time> by <b>engel_r@....</b><a class="anchor" name="1279743486">&nbsp;</a></div><pre>Hey Garhan,

the issue seems to be caused by the boinc client trying to create
its runtime directory on the NFS partition. This clearly is a
misconfiguration on our scheduler site. Here is what I did&#58;

* I switched off the scheduler to submit jobs to red.unl.edu and
gpn-husker.unl.edu
* I killed all jobs in my condor queue targeted for both machines

Here is what I propose&#58;

* I&#39;ll not start submitting new jobs to either machine.
* I would like to deploy the latest version of our code and the correct
configuration on red.unl.edu and gpn-husker.unl.edu
* I&#39;ll enable debugging in E@H and do some small test runs on both
machines and keep you informed about the result.

I would also like to continue production runs on&#58;

* ff-grid.unl.edu
* ff-grid2.unl.edu
* ff-grid3.unl.edu
* pf-grid.unl.edu

If you do not object, could you please enable my account again?

Thanks,
Robert

Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='8940#1279731967'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-21T17:06:07+00:00">Jul 21, 2010 05:06 PM UTC</time><a class="anchor" name="1279731967">&nbsp;</a></div><pre>Robert - we purposely banned ligo yesterday afternoon (not completely, but that&#39;s another story) from UNL resources. The reason stems from what appears to be badly behaving BOINC processes. We actually noticed these over a week ago and removed all ligo jobs from the red/gpn-husker CEs at that time. I had hoped it was an isolated incident, but apparently something is still broken as for the last week we have seen the same problem. I&#39;m not a software engineer, but here&#39;s my best description of the issue&#58;

Some of your jobs (perhaps others are doing this as well, but the ones I tried to debug came back under your name) seemed to be getting stuck in an endless loop of doing NFS mkdir requests on stale file handels. Here&#39;s one process I saw for example&#58;

ligo     11433  0.2  0.0   5620  3600 ?        TN   Jun24  54&#58;34      |           &#92;_ /opt/osg/data/ligo/rengel/GEO600-1.4.x/build/boinc_5.9.11_i686-pc-linux-gnu/boinc -no_gui_rpc -redirectio -return_results_immediately -dir /mnt/nfs04/opt/data/ligo/rengel/GEO600-1.4.x/tasks/34444 --exit_after_app_start 72000

... which attaching strace to gave&#58;

# strace -p 11433
Process 11433 attached - interrupt to quit
--- SIGSTOP (Stopped (signal)) @ 0 (0) ---
--- SIGSTOP (Stopped (signal)) @ 0 (0) ---
[ Process PID=11433 runs in 32 bit mode. ]
umask(0)                                = 022
mkdir(&#34;slots&#34;, 0771)                    = -1 ESTALE (Stale NFS file handle)
umask(022)                              = 0
stat64(&#34;slots/29986291&#34;, 0xff99c4f0)    = -1 ESTALE (Stale NFS file handle)
umask(0)                                = 022
mkdir(&#34;slots/29986291&#34;, 0771)           = -1 ESTALE (Stale NFS file handle)
umask(022)                              = 0

That&#39;s just a small example -- these processes all seemed to be doing this continuously as fast as possible. In fact overall we had upwards of 60,000 NFS accesses from these jobs alone hitting our NFS server per second (!). Thankfully this didn&#39;t completely bog everything down, but it is noticeable and these small access packets alone were eating up 100+Mb/sec of bandwidth overall to our main nfs server. Key point being that a process stuck in that state is obviously very broken, and the best solution for us at this immediate time was an outright ban (which we put in place as we were walking out the door last night, apologies for not mailing at that point in time).

Have you seen this behavior anywhere else or been asked about it before? It&#39;s quite possible there&#39;s some incompatibility / misconfiguration that is only affecting our red/gpn-husker cluster in this way. We&#39;re fully willing to help debug this further in a controlled manner. Not that I expect it to be of great interest, but the longest strace for once of these bad processes I captured is available at <a href='http&#58;//t2.unl.edu/store/ligo-strace.txt' target='_blank' rel='nofollow'>http&#58;//t2.unl.edu/store/ligo-strace.txt</a> should you wish it.

Let us know how you&#39;d like to proceed on this.

- Garhan Attebury</pre></div><div class='update_description'><i onclick="document.location='8940#1279722201'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2010-07-21T14:23:21+00:00">Jul 21, 2010 02:23 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1279722201">&nbsp;</a></div><pre>Hello,

I cannot authenticate to any machine in the unl.edu domain using my grid-proxy. I checked that my grid-proxy is valid and that I can authenticate with other resources successfully.

The problem started 07/20/10 5&#58;25pm.

[robert@osg-ldg ~]$ grid-proxy-info
subject  &#58; /DC=org/DC=doegrids/OU=People/CN=Robert Engel 392994/CN=1363406754
issuer   &#58; /DC=org/DC=doegrids/OU=People/CN=Robert Engel 392994
identity &#58; /DC=org/DC=doegrids/OU=People/CN=Robert Engel 392994
type     &#58; Proxy draft (pre-RFC) compliant impersonation proxy
strength &#58; 512 bits
path     &#58; /tmp/x509up_u500
timeleft &#58; 395&#58;36&#58;04  (16.5 days)

Thanks,
Robert</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F8940">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 8940});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
