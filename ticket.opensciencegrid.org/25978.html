<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[25978] mismatch between running ID and environment variables</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=25978" method="post">
<div class="page-header">
    <h3><span class="muted">25978</span> / mismatch between running ID and environment variables</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Jose Caballero</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Resource Name</label><div class="controls">UCSDT2-C</div></div><div class="control-group"><label class="control-label">Associated VO</label><div class="controls">CMS</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Jose Caballero</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">USCMS_Tier2</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2015-06-25</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">USCMS Tier 2 <span class="muted"> / OSG Support Centers</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/25978", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='25978#1435236604'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-25T12:50:04+00:00">Jun 25, 2015 12:50 PM UTC</time> by <b>echism</b><a class="anchor" name="1435236604">&nbsp;</a></div><pre>Closing as requested.</pre></div><div class='update_description'><i onclick="document.location='25978#1435189691'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-24T23:48:11+00:00">Jun 24, 2015 11:48 PM UTC</time> by <b>Jose Caballero</b><a class="anchor" name="1435189691">&nbsp;</a></div><pre>makes sense.
I think this particular ticket can be closed.

Thanks
Jose

On Jun 24, 2015, at 7&#58;12 PM, Open Science Grid FootPrints wrote&#58;

[Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='25978#1435187531'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-24T23:12:11+00:00">Jun 24, 2015 11:12 PM UTC</time> by <b>Terrence Martin</b><a class="anchor" name="1435187531">&nbsp;</a></div><pre>There is no relevant .bashrc, but you should set $HOME, if the software
really wants it, to pwd.

eg.

export HOME=&#96;pwd&#96;

Do not just write stuff in the any HOME directory that is static. It is
both dangerous since you could leave stuff behind that is not stuff you
want any other user to grab (proxies) and it is just leaving stuff
around and using up disk after you leave.

I have a node here that is happily running a job as cuser3, but there is
no job related files in /home/cuser3 at all. I do not clean that
directory, jobs are just well behaved enough not to write there.

At UCSD you should only write files in a directory like...

/data1/condor_local/execute/dir_221118/

Where the integer is a random one for your specific job and will be
deleted after you leave.

Terrence

On 6/24/2015 2&#58;39 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='25978#1435181988'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-24T21:39:48+00:00">Jun 24, 2015 09:39 PM UTC</time><a class="anchor" name="1435181988">&nbsp;</a></div><pre>I totally agree with the statement&#58;
&#34;&#34;&#34;
You certainly should never use a HOME variable either. That will
invariably set itself to some static area that may or may not even be
writable by that user. You need to write where you land and create your
structure there, assuming that the site gave you the space required.  If
you need to download stuff, download to pwd(1).
&#34;&#34;&#34;

So I have a follow up question. Is there any .bashrc or .bash_profile or similar in /home/usatlas1 that is not in the home of the cuserXY account? Assuming that they have home directories, which may not be true.
I don&#39;t control myself the ATLAS software, but I know some piece of it tries to write under the $HOME directory.
So I am wondering if changing myself HOME to cuser20 instead of usatlas1 would help. Or would that create a big mess?

Jose

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Jose Caballero 649</pre></div><div class='update_description'><i onclick="document.location='25978#1435181602'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-24T21:33:22+00:00">Jun 24, 2015 09:33 PM UTC</time> by <b>Terrence Martin</b><a class="anchor" name="1435181602">&nbsp;</a></div><pre>The LOGNAME is set by the CE in the environment. It is the name you
logged into the site as true. However it will not be the user you will
run as, you never really log into that node so I guess that makes sense.

You certainly should never use a HOME variable either. That will
invariably set itself to some static area that may or may not even be
writable by that user. You need to write where you land and create your
structure there, assuming that the site gave you the space required.  If
you need to download stuff, download to pwd(1).

btw which CE are you using? It is probably best to do any tests through
osg-gw-4.t2.ucsd.edu if you can choose. That is the HT-Condor CE and
will give you the best view of what will be the way things will be
moving forward. That might clear up that bit of environment weirdness
too, not sure.

Terrence

On 6/24/2015 2&#58;21 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='25978#1435180913'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-24T21:21:53+00:00">Jun 24, 2015 09:21 PM UTC</time><a class="anchor" name="1435180913">&nbsp;</a></div><pre>Oh, oh. Sorry about that. I am having the same issue on 2 different sites, and I had the brilliant idea of opening 2 tickets, with the same subject !!
So I think I mixed them a little bit.
Coming back to real UCSDT2...

$ hostname
cabinet-5-5-10.t2.ucsd.edu

$ id
uid=36066(cuser20) gid=36066(cuser20) groups=36066(cuser20)

$ echo $LOGNAME
usatlas1

So I am still a little bit puzzled. Why LOGNAME is set to &#34;usatlas1&#34; when the process on the WN is running under account &#34;cuser20&#34;? Shouldn&#39;t LOGNAME be &#34;cuser20&#34; too?

Jose

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Jose Caballero 649</pre></div><div class='update_description'><i onclick="document.location='25978#1435177151'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-24T20:19:11+00:00">Jun 24, 2015 08:19 PM UTC</time> by <b>Terrence Martin</b><a class="anchor" name="1435177151">&nbsp;</a></div><pre>Where are you running Jose? That is not UCSD.

$ hostname
compute-20-22.tier2

That is some other place.

UCSD hostnames are

cabinet-4-4-2.t2.ucsd.edu

The original email with cuserX is pretty good chance is UCSD, that is the users I use for my slots, but that host, no idea. No domain either, which leads me to believe that is probably some site with a private network, UCSD has all public IP addresses.

Hostname will always return the domain

# hostname
cabinet-4-4-2.t2.ucsd.edu</pre></div><div class='update_description'><i onclick="document.location='25978#1435177146'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-24T20:19:06+00:00">Jun 24, 2015 08:19 PM UTC</time> by <b>Terrence Martin</b><a class="anchor" name="1435177146">&nbsp;</a></div><pre>$ hostname
compute-20-22.tier2

That is not a machine at UCSD, so all bets are off. &#58;)

My nodes have names like

cabinet-4-4-0.t2.ucsd.edu

Terrence

On 6/24/2015 3&#58;20 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='25978#1435141216'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-24T10:20:16+00:00">Jun 24, 2015 10:20 AM UTC</time> by <b>Jose Caballero</b><a class="anchor" name="1435141216">&nbsp;</a></div><pre>Hi Terrence,

I agree with you, one shouldn&#39;t expect to get on the WN the same account than on the CE.
But the behavior I have described is what is happening on the WNs&#58;

$ hostname
compute-20-22.tier2

$ id
uid=99(nobody) gid=99(nobody) groups=99(nobody) context=unconfined_u&#58;system_r&#58;condor_startd_t&#58;s0

$ echo $LOGNAME
usatlas1

I never seen before jobs running on the WNs as &#34;nobody&#34;

Cheers,
Jose

On Jun 23, 2015, at 4&#58;13 PM, Open Science Grid FootPrints wrote&#58;

[Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='25978#1435090405'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-23T20:13:25+00:00">Jun 23, 2015 08:13 PM UTC</time> by <b>Terrence Martin</b><a class="anchor" name="1435090405">&nbsp;</a></div><pre>Hmm, its a feature...

-  The user that you get mapped to on the CE is in no way guaranteed to
be the user you will ultimately run as on a worker node. These systems
are effectively disconnected since there is no requirement that they
share the same user space, or file space. This has been this way for a
very long time.

- Related to that the home directory of the user on the CE will never be
the same on the WN. Not only are your jobs not writing to directories to
which they have no permissions, those directories do not even exist on
worker nodes. In fact where you land is correctly a randomly generated
area that is completely removed after your job exits so as not to
clutter file systems with old files from old jobs, or cause problems
overwriting files that other jobs are modifying.

For example with CMS they use glexec and pilots so the user you are
running as on the node is further removed from the CE.

Your jobs should check who they are running as

whoami(1) or id(1)

They should check where they can write by running pwd(1).

Write where you land.

Terrence

On 06/23/2015 12&#58;44 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='25978#1435088684'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-23T19:44:44+00:00">Jun 23, 2015 07:44 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1435088684">&nbsp;</a></div><pre>Running ATLAS jobs at the site, I noticed that the running UNIX ID is &#34;cuserXY&#34; (from a pool) whereas the environment variable LOGNAME is set to &#34;usatlas1&#34; and HOME is set to &#34;/osgusers/2/usatlas1&#34;. This is giving our jobs problems, as they try to write into directories they have no permissions.
It happens because some parts of the ATLAS code, when it tries to find out the running user or the running user home directory makes use of tools that look into LOGNAME instead of the actual running ID. For example, the python function getpass.getuser().

Is this mismatch between ID and LOGNAME a bug or a feature?

Thanks,
Jose

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Jose Caballero 649</pre></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F25978">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

});
</script>


</body>
