<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[11321] Possible DOS attack on FNAL_FERMIGRID</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=11321" method="post">
<div class="page-header">
    <h3><span class="muted">11321</span> / Possible DOS attack on FNAL_FERMIGRID</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Steve Timm</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/vo</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Steve Timm</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Check for updates</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2011-12-23</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">OSG RA <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">Security Team <span class="muted"> / OSG Support Centers</span></div><div class="assignee" style="width: 60%">OSG-GOC <span class="muted"> / OSG Support Centers</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("https://ticket.opensciencegrid.org/attachment/list?id=11321", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="https://ticket.opensciencegrid.org/\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="https://ticket.opensciencegrid.org/\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/11321?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/11321?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Possible%20DOS%20attack%20on%20FNAL_FERMIGRID%20ISSUE%3D11321%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='11321#1324956127'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-27T03:22:07+00:00">Dec 27, 2011 03:22 AM UTC</time><a class="anchor" name="1324956127">&nbsp;</a></div><pre>We have not seen any further problematic jobs from the HCC VO
and we have also implemented configuration changes to our clusters such
that if they do come we will be ready for them.  I believe this
ticket can be closed.

Steve Timm

-- by Steve Timm</pre></div><div class='update_description'><i onclick="document.location='11321#1323142749'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-06T03:39:09+00:00">Dec 6, 2011 03:39 AM UTC</time><a class="anchor" name="1323142749">&nbsp;</a></div><pre>I have opened GOC ticket 11325 to track the problem of high memory usage by
the initial stage of the glidein.  The glideins from several VO&#39;s seem to
use a lot of memory whether they have a lot of authorizations or not.
Igor--WRT the condor retry, there are some fields such as NumJobMatches or
NumShadowStarts which increment on every failure and which could be used as PeriodicRemove or SystemPeriodicRemove
requirements on the frontend to detect a large number of authentication failures.
In this case the pathological case of Nebraska using a CA (cilogon-basic) that is not supported
by most other OSG sites led to a hard diagnostic process and an unusual failure mode
where the glexec client never presents the proxy to GUMS or SAZ.

-- by Steve Timm</pre></div><div class='update_description'><i onclick="document.location='11321#1323118080'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T20:48:00+00:00">Dec 5, 2011 08:48 PM UTC</time><a class="anchor" name="1323118080">&nbsp;</a></div><pre>It is a known that Condor does not like receiving a no from glexec,
and will stubbornly retry forever.

7.7.X has a &#34;fix&#34; that holds jobs when glexec fails, so they will not be rematched.
But we are still on the production release.

My 2c,
Igor

-- by Igor Sfiligoi</pre></div><div class='update_description'><i onclick="document.location='11321#1323115439'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T20:03:59+00:00">Dec 5, 2011 08:03 PM UTC</time><a class="anchor" name="1323115439">&nbsp;</a></div><pre>Hi,

As an update we discussed this on the OSG Ops call today and I believe we concluded the glideins were properly confured to use glexec and they properly prevented the user jobs from running as expected.  However either the memory footprint of the glidein itself increased or condor got confused in reporting it as the user jobs were constantly trying to match with the glidein and failing glexec authentication.

Perhaps this is something glideins can be smarter about detecting, I&#39;ll bring it up with the glideinWMS developers.

Jeff

-- by Jeffrey Michael Dost</pre></div><div class='update_description'><i onclick="document.location='11321#1323107828'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T17:57:08+00:00">Dec 5, 2011 05:57 PM UTC</time><a class="anchor" name="1323107828">&nbsp;</a></div><pre>Hi Mine,

This student is allowed to submit to the OSG, although we encourage folks to only use HCC resources to reduce the number of issues they run across for new workflows; I think you might have simplified what Derek originally said.  Sorry for the miscommunication.

We have been in contact with the OSG Security team about the use of CILogon-basic.  A priori, I don&#39;t think there&#39;s anything wrong with using a CA that isn&#39;t uniformly supported across all OSG sites, although this incident shows there&#39;s perhaps some intricacies here (perhaps a bug, perhaps a policy that isn&#39;t accurately reflected in the current software implementation).

As usual, we are more than happy to work with FermiGrid once deficiencies are identified, and apologize they occurred in the first place.

Once we have identified an issue with any user&#39;s jobs - be it student or researcher - we have simple manual controls to remove their ability to submit jobs.  If they are a login user, we remove their login abilities and remove the jobs.  If they are a flocking / remote-submission user, we remove their write privileges into the pool&#39;s collector (typically via mapping the schedd&#39;s or user&#39;s certificate to &#34;anonymous&#34; in the condor_mapfile).

Toward preventing the memory issue from recurring, I admit I&#39;m surprised that neither HCC nor FermiGrid&#39;s condor configuration caught the job and killed it if it used too much memory.  We will look into this.  [I&#39;m looking forward to SL6, where memory limits are enforced in-kernel to put these issues to rest once-and-for-all.]

Brian

-- by Brian Bockelman</pre></div><div class='update_description'><i onclick="document.location='11321#1323107048'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T17:44:08+00:00">Dec 5, 2011 05:44 PM UTC</time> by <b>Steven Timm</b><a class="anchor" name="1323107048">&nbsp;</a></div><pre>It&#39;s not clear that the user job _did_ continue to run, or
in fact that it ever ran at all.  We are not to the bottom
of this problem yet and it is complicated because we had
two VO&#39;s dumping us with high-memory jobs at once (see GOC 11322).

On the one node I&#39;ve looked at so far, what we saw is a large
number of subdirectories of form execute/dir_&#60;nnnnn&#62;.condor
with the initial executable and the user proxy there, there were 40-50
of these created at the rate of one or two a minute.  There
was no directory of the form dir_&#60;nnnnn&#62; which is where the user
output and working area would most probably be.

I am not sure how the memory count got up so high.  I was not able to
catch a user job in the act, partly because they were dying quickly and
partly because so many of our nodes went unpingable.
I saw some glideins
from a different VO just come into our site from UCSD using 10GB and they
hadn&#39;t even attempted to start a user job yet.

Steve Timm

On Mon, 5 Dec 2011, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='11321#1323106164'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T17:29:24+00:00">Dec 5, 2011 05:29 PM UTC</time> by <b>Mine Altunay</b><a class="anchor" name="1323106164">&nbsp;</a></div><pre>Steve,
it seems like this is a security vulnerability in our software. if the authentication failed, why then this user job continued to run? A user can attempt to use any certificate they have. It is the responsibility of resource to fail authentication when untrusted certificates are encountered. I do not think HCC did anything wrong here in terms of using CIlogon basic ca certs.</pre></div><div class='update_description'><i onclick="document.location='11321#1323106085'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T17:28:05+00:00">Dec 5, 2011 05:28 PM UTC</time><a class="anchor" name="1323106085">&nbsp;</a></div><pre>Also, why did glexec execute a job after it failed the lcmaps &#34;verify proxy&#34;?  It seems that glexec failed to do it&#39;s job there?

I will let Brian or Garhan answer the question as to whether he was suppose to submit to the OSG.  He has a certificate (albeit from odd CA) and he&#39;s in our voms.

-- by Derek Weitzel</pre></div><div class='update_description'><i onclick="document.location='11321#1323105795'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T17:23:15+00:00">Dec 5, 2011 05:23 PM UTC</time> by <b>Mine Altunay</b><a class="anchor" name="1323105795">&nbsp;</a></div><pre>This ticket is not an operational security ticket anymore. It is an operational ticket, but requires no security response. there is no malice or compromise.

I have two long-term items this ticket brought to light&#58; how does a factory ensure that they are configured to invoke glexec on a site that requires glexec? The second issue which controls does HCC, or any submit node, have in place to forbid this student to submit to OSG. Derek said this student was not supposed to submit to OSG.
Finally glidein factory operations should have a security contact with emergency phone numbers listed in OIM. I could not find one for Jeff Dost. We will open a separate ticket to fix this.</pre></div><div class='update_description'><i onclick="document.location='11321#1323105565'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T17:19:25+00:00">Dec 5, 2011 05:19 PM UTC</time><a class="anchor" name="1323105565">&nbsp;</a></div><pre>I spoke on the phone to Mine Altunay..after further looking in the logs, it
appears that the HCC VO glideins did attempt to invoke glexec on this
user (Christopher Stevenson) but the &#34;verify proxy&#34; function of lcmaps rejected
his certificate and did not even get as far as sending it to gums because
it has a CA that Fermilab does not recognize, namely  CILogon-basic.

The OSG is not a testing ground for things like this.. the controls at U Nebraska
need to be much better understood and documented before this is tried again.

-- by Steve Timm</pre></div><div class='update_description'><i onclick="document.location='11321#1323105525'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T17:18:45+00:00">Dec 5, 2011 05:18 PM UTC</time> by <b>Mine Altunay</b><a class="anchor" name="1323105525">&nbsp;</a></div><pre>I called GOC and UCSD folks to understand why glexec was not invoked. Jeff Dost and Igor are both unavailable and GOC staff did not know the details. Perhaps the factory invoked the glexec but maybe it failed to execute on fnal site???</pre></div><div class='update_description'><i onclick="document.location='11321#1323105274'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T17:14:34+00:00">Dec 5, 2011 05:14 PM UTC</time><a class="anchor" name="1323105274">&nbsp;</a></div><pre>Adding new CC to ticket

-- by Keith Chadwick</pre></div><div class='update_description'><i onclick="document.location='11321#1323104827'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T17:07:07+00:00">Dec 5, 2011 05:07 PM UTC</time><a class="anchor" name="1323104827">&nbsp;</a></div><pre>Hi,

Someone should bring glideinWMS operations into the loop.  I was under the impression that the factory is responsible for making sure glexec is invoked on sites whose policies require glexec.  I&#39;m curious as to what went wrong here.  AFAICT, the payload jobs brought in a valid usercert, which .

The executable name &#34;dieharder&#34; comes from the &#34;diehard tests&#34; (<a href='http&#58;//en.wikipedia.org/wiki/Diehard_tests' target='_blank' rel='nofollow'>http&#58;//en.wikipedia.org/wiki/Diehard_tests</a>) for studying the quality of random number generators.

Brian

-- by Brian Bockelman</pre></div><div class='update_description'><i onclick="document.location='11321#1323104347'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T16:59:07+00:00">Dec 5, 2011 04:59 PM UTC</time> by <b>dweitzel@....</b><a class="anchor" name="1323104347">&nbsp;</a></div><pre>Hi Steve,

Yes, there are other legitimate jobs from hcc running right now, mine (for class project as well) and a NEES researcher.

Though, we&#39;re only getting ~40 slots on fermigrid right now, so no big loss if we are banned/removed.

-Derek

On Dec 5, 2011, at 10&#58;53 AM, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='11321#1323103988'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T16:53:08+00:00">Dec 5, 2011 04:53 PM UTC</time> by <b>Steven Timm</b><a class="anchor" name="1323103988">&nbsp;</a></div><pre>Derek,
Are there any other legitimate jobs from any other hcc users running
at FNAL_FERMIGRID right now or can I just go ahead and
remove all hcc glideins currently submited to FNAL_FERMIGRID?

Steve Timm

On Mon, 5 Dec 2011, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='11321#1323103365'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T16:42:45+00:00">Dec 5, 2011 04:42 PM UTC</time><a class="anchor" name="1323103365">&nbsp;</a></div><pre>Hello,

I can confirm that this is a legitimate user, running legitimate jobs (hashing algorithm) with a very poorly named tarball/executable.  He is a member of our cluster & grid computing class working on his final project.  It looks like he underestimated how much ram his jobs would require.

Yes, the jobs are from the HCC Glidein Frontend.  I have banned him from the frontend, which should stop his (new?) jobs.

As for the glexec issue brought up by Steve, we run GlideinWMS, which means we have no control over whether we run glexec or not, that&#39;s controlled from the UCSD factory (or goc factory, we use both).  Since he brought the cert along with the job, it seems the he expected to use glexec?  Though it CILogin certificate, which I doubt fnal has installed?

I believe the students where suppose to stay on HCC resources, so he&#39;s already breaking that.

-- by Derek Weitzel</pre></div><div class='update_description'><i onclick="document.location='11321#1323103031'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T16:37:11+00:00">Dec 5, 2011 04:37 PM UTC</time><a class="anchor" name="1323103031">&nbsp;</a></div><pre>all the glideins came from 169.228.130.10 glidein-1.t2.ucsd.edu.
via the ucsd glidein factory and
129.79.14.134 (wuncler.uits.indiana.edu)

-- by Steve Timm</pre></div><div class='update_description'><i onclick="document.location='11321#1323102651'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T16:30:51+00:00">Dec 5, 2011 04:30 PM UTC</time><a class="anchor" name="1323102651">&nbsp;</a></div><pre>-- by Derek Weitzel</pre></div><div class='update_description'><i onclick="document.location='11321#1323102462'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T16:27:42+00:00">Dec 5, 2011 04:27 PM UTC</time><a class="anchor" name="1323102462">&nbsp;</a></div><pre>It is very confusing because the certificate payload shows Christopher
Stevenson as the user but his DN never shows up
in our glexec records, meaning that these jobs are not doing glexec,
a violation of Fermi policy.

The only hcc authentications we see in our gums server, presumably
from the glideins, are Derek Weitzel (thus he is copied).

05 Dec 2011 10&#58;13&#58;49,362 [INFO ]&#58;
GridID[/DC=org/DC=doegrids/OU=Services/CN=ferm
igridosg1.fnal.gov] - Mapped on host
&#39;/DC=org/DC=doegrids/OU=Services/CN=fermigr
idosg1.fnal.gov&#39; the user &#39;/DC=org/DC=doegrids/OU=People/CN=Derek Weitzel
285345
&#39; / &#39;/hcc/Role=NULL/Capability=NULL&#39; to &#39;hcc&#39;

We are still investigating and at the same time trying
to recover our cluster which has lost more than 500 of its slots
due to this DOS attack.

Steve Timm

-- by Steve Timm</pre></div><div class='update_description'><i onclick="document.location='11321#1323101870'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T16:17:50+00:00">Dec 5, 2011 04:17 PM UTC</time> by <b>Mine Altunay</b><a class="anchor" name="1323101870">&nbsp;</a></div><pre>Steve,
is this jobs submitted form HCC GlideinWMS Frontend (glidein.unl.edu)? The security contact for this resource is Garhan Attebury; I am adding him to this ticket. Do you see the offensive jobs only under a single user&#39;s account?

Garhan -- can you please check the glidein machine and report if there are anything out of the ordinary? Especially for this user&#39;s account.
Also, which other resources do you usually submit jobs to? We can ask those if they experience anything suspicious.</pre></div><div class='update_description'><i onclick="document.location='11321#1323101248'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T16:07:28+00:00">Dec 5, 2011 04:07 PM UTC</time> by <b>Mine Altunay</b><a class="anchor" name="1323101248">&nbsp;</a></div><pre>I acknowledge the receipt of this ticket. I am adding osg-security team to this ticket.</pre></div><div class='update_description'><i onclick="document.location='11321#1323101088'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T16:04:48+00:00">Dec 5, 2011 04:04 PM UTC</time><a class="anchor" name="1323101088">&nbsp;</a></div><pre>Adding Mine Altunay of OSG Security to this ticket, due to the name of
the executable we are considering this as a possible security/DOS attack.

-- by Steve Timm</pre></div><div class='update_description'><i onclick="document.location='11321#1323100999'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-12-05T16:03:19+00:00">Dec 5, 2011 04:03 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1323100999">&nbsp;</a></div><pre>[by Steve Timm]

We are seeing a large number of jobs coming from HCC that are using a
large amount of RAM and crashing our cluster.  We have not investigated
fully yet but we see one job with the following payload

[root@fnpc3073 dir_30772.condor]# ls -l
total 1188
-rwxr-xr-x 1 hcc hcc     700 Dec  5 09&#58;46 condor_exec.exe
-rw-rw-r-- 1 hcc hcc 1200001 Dec  5 09&#58;46 dieharder.tgz
-rw------- 1 hcc hcc    6893 Dec  5 09&#58;46 x509up_u501

[root@fnpc3073 dir_30772.condor]# openssl x509 -in ./x509up_u501  -noout -subject
subject= /DC=org/DC=cilogon/C=US/O=University of Nebraska-Lincoln/CN=Christopher Stevenson A796/CN=proxy/CN=limited proxy

We are going to ban Christopher Stevenson immediately but it
could be more than this, we are still looking.

Steve Timm</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F11321">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 11321});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
