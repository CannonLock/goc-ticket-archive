<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[22569] FileReadErrors for jobs running at FNAL accessing a file at FNAL</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=22569" method="post">
<div class="page-header">
    <h3><span class="muted">22569</span> / FileReadErrors for jobs running at FNAL accessing a file at FNAL</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Levin </div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Associated VO</label><div class="controls">CMS</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GGUS</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Levin</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">USCMS</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls"></div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Elevated</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">TX Incoming</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2014-10-14</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">FNAL (Prod)&nbsp;<a target="_blank" href="https://fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000453430">INC000000453430</a> <span class="muted"> / Ticket Exchange</span></div><div class="assignee" style="width: 60%">GGUS (Prod)&nbsp;<a target="_blank" href="https://ggus.eu/ws/ticket_info.php?ticket=108981">108981</a> <span class="muted"> / Ticket Exchange</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("https://ticket.opensciencegrid.org/attachment/list?id=22569", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="https://ticket.opensciencegrid.org/\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="https://ticket.opensciencegrid.org/\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/22569?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/22569?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20FileReadErrors%20for%20jobs%20running%20at%20FNAL%20accessing%20a%20file%20at%20FNAL%20ISSUE%3D22569%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='22569#1413304915'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-14T16:41:55+00:00">Oct 14, 2014 04:41 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1413304915">&nbsp;</a></div><pre>trewe

-- by Levin at Wed Oct 08 15&#58;34&#58;30 UTC 2014

Pull request is in for 6_2_X_SLHC (#5742).

The backport is also trivial for 5_3_X if it is ever needed there.

On Oct 8, 2014, at 8&#58;36 AM, David Lange &#60;David.Lange@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; Hi Brian</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; It looks like we already accepted the patch in our 73x branch.  Since its most urgent in the SLHC release, that is also a natural place to test it in production (where we will soon do another round of requests).</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Can you make a PR there (Mark, the 73x PR is <a href='https&#58;//github.com/cms-sw/cmssw/pull/5714' target='_blank' rel='nofollow'>https&#58;//github.com/cms-sw/cmssw/pull/5714</a>)?</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Cheers-</font>
<font color='#7F7E6F'>&#62; David</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On Oct 8, 2014, at 3&#58;02 PM, Brian Bockelman &#60;brian.bockelman@....&#62;</font>
<font color='#7F7E6F'>&#62; wrote&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; I am really confused. XRD_TRANSACTIONTIMEOUT seems like it should control the amount of time to wait for reading a single chunk of the file. But the problem we have is that the job reads thousands of events successfully and 8 hours after it starts it fails.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; Can someone explain what this environment variable really controls?</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; That&#39;s precisely the bug.  The transaction timeout wasn&#39;t reset at the beginning of the ReadV call - only the Read call.  So, workflows that go &#62;8hrs without a Read call will hit the timeout.  It seems like that would be a rare occurrence, but it seems you have proved us wrong!</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; Also, if it requires a patch in cmssw to fix, then we need to also patch some other releases. In particular, the workflows that experience this problem are in the 62XSLHC*  branch.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; The patch just went in to 7_3_X.  Can you provide the list of branches you would like for me to put in pull requests?</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<div id='show_1364839082' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1364839082'><font color='#7F7E6F'>&#62;&#62; I&#39;m adding David Lange to the email in case he has input on the subject.  Dave - this bug causes ReadV calls to fail reliably on some subset of workflows.  AFAICT, it is present in all release branches (except for 7_3_X, which was fixed with <a href='https&#58;//github.com/cms-sw/cmssw/pull/5714' target='_blank' rel='nofollow'>https&#58;//github.com/cms-sw/cmssw/pull/5714</a>).  I purposely squashed the fix to a single commit so it would be easy to backport to any branch.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; PS Burt - the pull request causes Xrootd to honor the (fixed) timeout set in the site-local-config.xml in case if you prefer it to be shorter than 8 hours.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; *********************************************************************************</font>
<font color='#7F7E6F'>&#62;&#62;&#62; This is an automated mail. When replying don&#39;t change the subject line!</font>
<font color='#7F7E6F'>&#62;&#62;&#62; Type your text above this box and S T R I P  P R E V I O U S  M A I L S please!!</font>
<font color='#7F7E6F'>&#62;&#62;&#62; *********************************************************************************</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;</font>

-- by Brian Bockelman at Wed Oct 08 14&#58;20&#58;41 UTC 2014

Hi Brian

It looks like we already accepted the patch in our 73x branch.  Since its most urgent in the SLHC release, that is also a natural place to test it in production (where we will soon do another round of requests).

Can you make a PR there (Mark, the 73x PR is <a href='https&#58;//github.com/cms-sw/cmssw/pull/5714' target='_blank' rel='nofollow'>https&#58;//github.com/cms-sw/cmssw/pull/5714</a>)?

Cheers-
David

On Oct 8, 2014, at 3&#58;02 PM, Brian Bockelman &#60;brian.bockelman@....&#62;
wrote&#58;

<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62; I am really confused. XRD_TRANSACTIONTIMEOUT seems like it should control the amount of time to wait for reading a single chunk of the file. But the problem we have is that the job reads thousands of events successfully and 8 hours after it starts it fails.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; Can someone explain what this environment variable really controls?</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; That&#39;s precisely the bug.  The transaction timeout wasn&#39;t reset at the beginning of the ReadV call - only the Read call.  So, workflows that go &#62;8hrs without a Read call will hit the timeout.  It seems like that would be a rare occurrence, but it seems you have proved us wrong!</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62; Also, if it requires a patch in cmssw to fix, then we need to also patch some other releases. In particular, the workflows that experience this problem are in the 62XSLHC*  branch.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; The patch just went in to 7_3_X.  Can you provide the list of branches you would like for me to put in pull requests?</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; I&#39;m adding David Lange to the email in case he has input on the subject.  Dave - this bug causes ReadV calls to fail reliably on some subset of workflows.  AFAICT, it is present in all release branches (except for 7_3_X, which was fixed with <a href='https&#58;//github.com/cms-sw/cmssw/pull/5714' target='_blank' rel='nofollow'>https&#58;//github.com/cms-sw/cmssw/pull/5714</a>).  I purposely squashed the fix to a single commit so it would be easy to backport to any branch.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; PS Burt - the pull request causes Xrootd to honor the (fixed) timeout set in the site-local-config.xml in case if you prefer it to be shorter than 8 hours.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; *********************************************************************************</font>
<font color='#7F7E6F'>&#62;&#62; This is an automated mail. When replying don&#39;t change the subject line!</font>
<font color='#7F7E6F'>&#62;&#62; Type your text above this box and S T R I P  P R E V I O U S  M A I L S please!!</font>
<font color='#7F7E6F'>&#62;&#62; *********************************************************************************</font>
<font color='#7F7E6F'>&#62;</font>

-- by David Lange at Wed Oct 08 13&#58;37&#58;01 UTC 2014

<font color='#7F7E6F'>&#62; I am really confused. XRD_TRANSACTIONTIMEOUT seems like it should control the amount of time to wait for reading a single chunk of the file. But the problem we have is that the job reads thousands of events successfully and 8 hours after it starts it fails.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Can someone explain what this environment variable really controls?</font>
<font color='#7F7E6F'>&#62;</font>

That&#39;s precisely the bug.  The transaction timeout wasn&#39;t reset at the beginning of the ReadV call - only the Read call.  So, workflows that go &#62;8hrs without a Read call will hit the timeout.  It seems like that would be a rare occurrence, but it seems you have proved us wrong!

<font color='#7F7E6F'>&#62; Also, if it requires a patch in cmssw to fix, then we need to also patch some other releases. In particular, the workflows that experience this problem are in the 62XSLHC*  branch.</font>

The patch just went in to 7_3_X.  Can you provide the list of branches you would like for me to put in pull requests?

I&#39;m adding David Lange to the email in case he has input on the subject.  Dave - this bug causes ReadV calls to fail reliably on some subset of workflows.  AFAICT, it is present in all release branches (except for 7_3_X, which was fixed with <a href='https&#58;//github.com/cms-sw/cmssw/pull/5714' target='_blank' rel='nofollow'>https&#58;//github.com/cms-sw/cmssw/pull/5714</a>).  I purposely squashed the fix to a single commit so it would be easy to backport to any branch.

PS Burt - the pull request causes Xrootd to honor the (fixed) timeout set in the site-local-config.xml in case if you prefer it to be shorter than 8 hours.

<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; *********************************************************************************</font>
<font color='#7F7E6F'>&#62; This is an automated mail. When replying don&#39;t change the subject line!</font>
<font color='#7F7E6F'>&#62; Type your text above this box and S T R I P  P R E V I O U S  M A I L S please!!</font>
<font color='#7F7E6F'>&#62; *********************************************************************************</font>

-- by Brian Bockelman at Wed Oct 08 13&#58;03&#58;09 UTC 2014

I am really confused. XRD_TRANSACTIONTIMEOUT seems like it should control the amount of time to wait for reading a single chunk of the file. But the problem we have is that the job reads thousands of events successfully and 8 hours after it starts it fails.

Can someone explain what this environment variable really controls?

Also, if it requires a patch in cmssw to fix, then we need to also patch some other releases. In particular, the workflows that experience this problem are in the 62XSLHC*  branch.

-- by Levin at Wed Oct 08 12&#58;24&#58;21 UTC 2014

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=108981' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=108981</a>
-- by OSG-GOC at Thu Oct 09 16&#58;12&#58;30 UTC 2014
-- by cd-srv-goc-ops at Thu Oct 09 16&#58;12&#58;56 UTC 2014

GOCTX Source&#58; <a href='https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000453430' target='_blank' rel='nofollow'>https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000453430</a>
</div><script type='text/javascript'>
        $('#show_1364839082').click(function() {
            $('#detail_1364839082').slideDown("normal");
            $('#show_1364839082').hide();
            $('#hide_1364839082').show();
        });
        $('#hide_1364839082').click(function() {
            $('#detail_1364839082').slideUp();
            $('#hide_1364839082').hide();
            $('#show_1364839082').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='22569#1412871150'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-09T16:12:30+00:00">Oct 9, 2014 04:12 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1412871150">&nbsp;</a></div><pre>trewe

-- by Levin at Wed Oct 08 15&#58;34&#58;30 UTC 2014

Pull request is in for 6_2_X_SLHC (#5742).

The backport is also trivial for 5_3_X if it is ever needed there.

On Oct 8, 2014, at 8&#58;36 AM, David Lange &#60;David.Lange@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; Hi Brian</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; It looks like we already accepted the patch in our 73x branch.  Since its most urgent in the SLHC release, that is also a natural place to test it in production (where we will soon do another round of requests).</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Can you make a PR there (Mark, the 73x PR is <a href='https&#58;//github.com/cms-sw/cmssw/pull/5714' target='_blank' rel='nofollow'>https&#58;//github.com/cms-sw/cmssw/pull/5714</a>)?</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Cheers-</font>
<font color='#7F7E6F'>&#62; David</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On Oct 8, 2014, at 3&#58;02 PM, Brian Bockelman &#60;brian.bockelman@....&#62;</font>
<font color='#7F7E6F'>&#62; wrote&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; I am really confused. XRD_TRANSACTIONTIMEOUT seems like it should control the amount of time to wait for reading a single chunk of the file. But the problem we have is that the job reads thousands of events successfully and 8 hours after it starts it fails.</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; Can someone explain what this environment variable really controls?</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; That&#39;s precisely the bug.  The transaction timeout wasn&#39;t reset at the beginning of the ReadV call - only the Read call.  So, workflows that go &#62;8hrs without a Read call will hit the timeout.  It seems like that would be a rare occurrence, but it seems you have proved us wrong!</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; Also, if it requires a patch in cmssw to fix, then we need to also patch some other releases. In particular, the workflows that experience this problem are in the 62XSLHC*  branch.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; The patch just went in to 7_3_X.  Can you provide the list of branches you would like for me to put in pull requests?</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<div id='show_590582304' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_590582304'><font color='#7F7E6F'>&#62;&#62; I&#39;m adding David Lange to the email in case he has input on the subject.  Dave - this bug causes ReadV calls to fail reliably on some subset of workflows.  AFAICT, it is present in all release branches (except for 7_3_X, which was fixed with <a href='https&#58;//github.com/cms-sw/cmssw/pull/5714' target='_blank' rel='nofollow'>https&#58;//github.com/cms-sw/cmssw/pull/5714</a>).  I purposely squashed the fix to a single commit so it would be easy to backport to any branch.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; PS Burt - the pull request causes Xrootd to honor the (fixed) timeout set in the site-local-config.xml in case if you prefer it to be shorter than 8 hours.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; *********************************************************************************</font>
<font color='#7F7E6F'>&#62;&#62;&#62; This is an automated mail. When replying don&#39;t change the subject line!</font>
<font color='#7F7E6F'>&#62;&#62;&#62; Type your text above this box and S T R I P  P R E V I O U S  M A I L S please!!</font>
<font color='#7F7E6F'>&#62;&#62;&#62; *********************************************************************************</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;</font>

-- by Brian Bockelman at Wed Oct 08 14&#58;20&#58;41 UTC 2014

Hi Brian

It looks like we already accepted the patch in our 73x branch.  Since its most urgent in the SLHC release, that is also a natural place to test it in production (where we will soon do another round of requests).

Can you make a PR there (Mark, the 73x PR is <a href='https&#58;//github.com/cms-sw/cmssw/pull/5714' target='_blank' rel='nofollow'>https&#58;//github.com/cms-sw/cmssw/pull/5714</a>)?

Cheers-
David

On Oct 8, 2014, at 3&#58;02 PM, Brian Bockelman &#60;brian.bockelman@....&#62;
wrote&#58;

<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62; I am really confused. XRD_TRANSACTIONTIMEOUT seems like it should control the amount of time to wait for reading a single chunk of the file. But the problem we have is that the job reads thousands of events successfully and 8 hours after it starts it fails.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; Can someone explain what this environment variable really controls?</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; That&#39;s precisely the bug.  The transaction timeout wasn&#39;t reset at the beginning of the ReadV call - only the Read call.  So, workflows that go &#62;8hrs without a Read call will hit the timeout.  It seems like that would be a rare occurrence, but it seems you have proved us wrong!</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62; Also, if it requires a patch in cmssw to fix, then we need to also patch some other releases. In particular, the workflows that experience this problem are in the 62XSLHC*  branch.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; The patch just went in to 7_3_X.  Can you provide the list of branches you would like for me to put in pull requests?</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; I&#39;m adding David Lange to the email in case he has input on the subject.  Dave - this bug causes ReadV calls to fail reliably on some subset of workflows.  AFAICT, it is present in all release branches (except for 7_3_X, which was fixed with <a href='https&#58;//github.com/cms-sw/cmssw/pull/5714' target='_blank' rel='nofollow'>https&#58;//github.com/cms-sw/cmssw/pull/5714</a>).  I purposely squashed the fix to a single commit so it would be easy to backport to any branch.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; PS Burt - the pull request causes Xrootd to honor the (fixed) timeout set in the site-local-config.xml in case if you prefer it to be shorter than 8 hours.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; *********************************************************************************</font>
<font color='#7F7E6F'>&#62;&#62; This is an automated mail. When replying don&#39;t change the subject line!</font>
<font color='#7F7E6F'>&#62;&#62; Type your text above this box and S T R I P  P R E V I O U S  M A I L S please!!</font>
<font color='#7F7E6F'>&#62;&#62; *********************************************************************************</font>
<font color='#7F7E6F'>&#62;</font>

-- by David Lange at Wed Oct 08 13&#58;37&#58;01 UTC 2014

<font color='#7F7E6F'>&#62; I am really confused. XRD_TRANSACTIONTIMEOUT seems like it should control the amount of time to wait for reading a single chunk of the file. But the problem we have is that the job reads thousands of events successfully and 8 hours after it starts it fails.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Can someone explain what this environment variable really controls?</font>
<font color='#7F7E6F'>&#62;</font>

That&#39;s precisely the bug.  The transaction timeout wasn&#39;t reset at the beginning of the ReadV call - only the Read call.  So, workflows that go &#62;8hrs without a Read call will hit the timeout.  It seems like that would be a rare occurrence, but it seems you have proved us wrong!

<font color='#7F7E6F'>&#62; Also, if it requires a patch in cmssw to fix, then we need to also patch some other releases. In particular, the workflows that experience this problem are in the 62XSLHC*  branch.</font>

The patch just went in to 7_3_X.  Can you provide the list of branches you would like for me to put in pull requests?

I&#39;m adding David Lange to the email in case he has input on the subject.  Dave - this bug causes ReadV calls to fail reliably on some subset of workflows.  AFAICT, it is present in all release branches (except for 7_3_X, which was fixed with <a href='https&#58;//github.com/cms-sw/cmssw/pull/5714' target='_blank' rel='nofollow'>https&#58;//github.com/cms-sw/cmssw/pull/5714</a>).  I purposely squashed the fix to a single commit so it would be easy to backport to any branch.

PS Burt - the pull request causes Xrootd to honor the (fixed) timeout set in the site-local-config.xml in case if you prefer it to be shorter than 8 hours.

<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; *********************************************************************************</font>
<font color='#7F7E6F'>&#62; This is an automated mail. When replying don&#39;t change the subject line!</font>
<font color='#7F7E6F'>&#62; Type your text above this box and S T R I P  P R E V I O U S  M A I L S please!!</font>
<font color='#7F7E6F'>&#62; *********************************************************************************</font>

-- by Brian Bockelman at Wed Oct 08 13&#58;03&#58;09 UTC 2014

I am really confused. XRD_TRANSACTIONTIMEOUT seems like it should control the amount of time to wait for reading a single chunk of the file. But the problem we have is that the job reads thousands of events successfully and 8 hours after it starts it fails.

Can someone explain what this environment variable really controls?

Also, if it requires a patch in cmssw to fix, then we need to also patch some other releases. In particular, the workflows that experience this problem are in the 62XSLHC*  branch.

-- by Levin at Wed Oct 08 12&#58;24&#58;21 UTC 2014

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=108981' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=108981</a>
</div><script type='text/javascript'>
        $('#show_590582304').click(function() {
            $('#detail_590582304').slideDown("normal");
            $('#show_590582304').hide();
            $('#hide_590582304').show();
        });
        $('#hide_590582304').click(function() {
            $('#detail_590582304').slideUp();
            $('#hide_590582304').hide();
            $('#show_590582304').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='22569#1412711683'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-07T19:54:43+00:00">Oct 7, 2014 07:54 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1412711683">&nbsp;</a></div><pre>I confirm that setting

export XRD_TRANSACTIONTIMEOUT=86400

makes my test job finish successfully.

-- by Levin at Tue Oct 07 04&#58;39&#58;10 UTC 2014

Hi,

I submitted a patch to CMSSW_7_3_X to allow timeouts to be controlled via the pset and site-local-config.xml&#58;

<a href='https&#58;//github.com/cms-sw/cmssw/pull/5714' target='_blank' rel='nofollow'>https&#58;//github.com/cms-sw/cmssw/pull/5714</a>

(Note - this changes the default to 10 minutes)

However, I&#39;d recommend going the other way - if a server doesn&#39;t respond in the default of 8 hours, then I doubt a 24 hour timeout is going to change things.  The best thing we can do right now is fail faster.

Brian

<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; *********************************************************************************</font>
<font color='#7F7E6F'>&#62; This is an automated mail. When replying don&#39;t change the subject line!</font>
<font color='#7F7E6F'>&#62; Type your text above this box and S T R I P  P R E V I O U S  M A I L S please!!</font>
<font color='#7F7E6F'>&#62; *********************************************************************************</font>

-- by Brian Bockelman at Tue Oct 07 03&#58;09&#58;01 UTC 2014

The errors have not cleared. I am trying Burt&#39;s last suggestion now.

-- by Levin at Mon Oct 06 20&#58;57&#58;58 UTC 2014

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=108981' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=108981</a></pre></div><div class='update_description'><i onclick="document.location='22569#1412621971'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-06T18:59:31+00:00">Oct 6, 2014 06:59 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1412621971">&nbsp;</a></div><pre>Hey Brian -- I asked Chris, who seemed to think you were the current CMSSW expert in this area.

Andrew&#58; Can you try instead

export XRD_TRANSACTIONTIMEOUT=86400

in your job&#39;s environment? I think I&#39;m reading the xrootd source correctly..

- B

-- by Burt Holzman at Mon Oct 06 14&#58;10&#58;35 UTC 2014

Won&#39;t work.  .rootrc is not used by cmssw.  Figuring out the right env variable for the Xrootd client may do the trick.

As this isn&#39;t a AAA issue, someone may want to open a ticket for the CMSSW team.

Brian

Sent from my iPhone

<font color='#7F7E6F'>&#62; On Oct 6, 2014, at 8&#58;11 AM, &#60;helpdesk@....&#62; &#60;helpdesk@....&#62; wrote&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; GGUS ticket #108981 was updated.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; REFERENCE LINK&#58; <a href='https&#58;//ggus.eu/index.php?mode=ticket_info&ticket_id=108981' target='_blank' rel='nofollow'>https&#58;//ggus.eu/index.php?mode=ticket_info&ticket_id=108981</a></font>
<font color='#7F7E6F'>&#62; SUBJECT&#58; FileReadErrors for jobs running at FNAL accessing a file at FNAL</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; =====================</font>
<font color='#7F7E6F'>&#62; LATEST MODIFICATIONS&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; LAST MODIFIER -&#62; Burt Holzman</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; PUBLIC DIARY -&#62;</font>
<font color='#7F7E6F'>&#62; Ok, now we are making progress. This timeout is on the client side, not the server side, so there&#39;s not anything FNAL can do.</font>
<div id='show_1360683609' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1360683609'><font color='#7F7E6F'>&#62; Can you try setting</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; XNet.TransactionTimeout&#58; 86400</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; in your .rootrc (I think I&#39;ve got that right)?  That should set the timeout to 1 day..</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; - B</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; *********************************************************************************</font>
<font color='#7F7E6F'>&#62; This is an automated mail. When replying don&#39;t change the subject line!</font>
<font color='#7F7E6F'>&#62; Type your text above this box and S T R I P  P R E V I O U S  M A I L S please!!</font>
<font color='#7F7E6F'>&#62; *********************************************************************************</font>

-- by Brian Bockelman at Mon Oct 06 13&#58;29&#58;52 UTC 2014

Ok, now we are making progress. This timeout is on the client side, not the server side, so there&#39;s not anything FNAL can do.
Can you try setting

XNet.TransactionTimeout&#58; 86400

in your .rootrc (I think I&#39;ve got that right)?  That should set the timeout to 1 day..

- B

-- by Burt Holzman at Mon Oct 06 13&#58;11&#58;42 UTC 2014

I have run over the ...-1.root file and found that the same failure occurs&#58;

Begin processing the 4338th record. Run 1, Event 6338, LumiSection 13 at 05-Oct-2014 12&#58;31&#58;58.906 CDT
141005 12&#58;32&#58;05 6944 Xrd&#58; SendGenCommand&#58; Max time limit elapsed for request  kXR_readv. Aborting command.
----- Begin Fatal Exception 05-Oct-2014 12&#58;32&#58;05 CDT-----------------------
An exception of category &#39;FileReadError&#39; occurred while
[0] Calling InputSource&#58;&#58;getNextItemType
[1] Reading branch EventAuxiliary
Additional Info&#58;
[a] Fatal Root Error&#58; @SUB=TBranchElement&#58;&#58;GetBasket
File&#58; root&#58;//cmsxrootd-site.fnal.gov//store/relval/CMSSW_6_2_0_SLHC18/RelValSingleMuPt100Extended/GEN-SIM/DES23_62_V1_UPGHGCalV4-v1/00000/9A1D3BEF-4D49-E411-9D59-0025905A608C-1.root at byte&#58;256382087, branch&#58;EventAuxiliary, entry&#58;4338, badread=1, nerrors=1, basketnumber=18

----- End Fatal Exception -------------------------------------------------

It is approximately 8 hours after the job started running&#58;

05-Oct-2014 04&#58;26&#58;44 CDT  Initiating request to open file root&#58;//cmsxrootd-site.fnal.gov//store/relval/CMSSW_6_2_0_SLHC18/RelValSingleMuPt100Extended/GEN-SIM/DES23_62_V1_UPGHGCalV4-v1/00000/9A1D3BEF-4D49-E411-9D59-0025905A608C-1.root

-- by Levin at Sun Oct 05 19&#58;11&#58;25 UTC 2014

So this is interesting -- looking at the xrootd source, it appears that there&#39;s a timeout of 28800s per transaction, and this gets set on the client side (I think).
Was this job running for exactly 8h?

-- by Burt Holzman at Sun Oct 05 15&#58;00&#58;25 UTC 2014

Also, I am running over the ...-1.root copy on the FNAL eos (sorry I misunderstood what you wrote before).

-- by Levin at Sun Oct 05 09&#58;27&#58;35 UTC 2014

Here is the output of the job when I increase the xrootd debug level&#58;

<a href='http&#58;//cms-project-relval.web.cern.ch/cms-project-relval/forGGUSticket05Oct2014/high_xrootd_debug_level.txt' target='_blank' rel='nofollow'>http&#58;//cms-project-relval.web.cern.ch/cms-project-relval/forGGUSticket05Oct2014/high_xrootd_debug_level.txt</a>

I will try to run the job at CERN now.

-- by Levin at Sun Oct 05 09&#58;02&#58;19 UTC 2014

I am running on a cmslpc-sl6 machine.

-- by Levin at Sat Oct 04 17&#58;44&#58;43 UTC 2014

One more question, where do you run this one job? At FNAL?

Now, I have made a copy of this file on FNAL EOS, at&#58;
/store/relval/CMSSW_6_2_0_SLHC18/RelValSingleMuPt100Extended/GEN-SIM/DES23_62_V1_UPGHGCalV4-v1/00000/9A1D3BEF-4D49-E411-9D59-0025905A608C-1.root
(root&#58;//cmsxrootd-site.fnal.gov//store/relval/CMSSW_6_2_0_SLHC18/RelValSingleMuPt100Extended/GEN-SIM/DES23_62_V1_UPGHGCalV4-v1/00000/9A1D3BEF-4D49-E411-9D59-0025905A608C-1.root)

Could you please try using this replica instead and let us know of the outcome?

On Oct 4, 2014, at 11&#58;25 AM, helpdesk@.... wrote&#58;

<font color='#7F7E6F'>&#62; GGUS ticket #108981 was updated.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; REFERENCE LINK&#58; <a href='https&#58;//ggus.eu/index.php?mode=ticket_info&ticket_id=108981' target='_blank' rel='nofollow'>https&#58;//ggus.eu/index.php?mode=ticket_info&ticket_id=108981</a></font>
<font color='#7F7E6F'>&#62; SUBJECT&#58; FileReadErrors for jobs running at FNAL accessing a file at FNAL</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; =====================</font>
<font color='#7F7E6F'>&#62; LATEST MODIFICATIONS&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; LAST MODIFIER -&#62; Catalin Dumitrescu</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; PUBLIC DIARY -&#62;</font>
<font color='#7F7E6F'>&#62; Hi</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;  Thanks for the update. Do you have any statistics about the error rates before</font>
<font color='#7F7E6F'>&#62; and after the timeout changes?  Is it 1% of completed jobs, 10% or more?</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;  Also, where are the jobs actually pulling the data from?</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On Oct 4, 2014, at 10&#58;37 AM, &#60;helpdesk@....&#62; &#60;helpdesk@....&#62; wrote&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62; GGUS ticket #108981 was updated.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; REFERENCE LINK&#58; <a href='https&#58;//ggus.eu/index.php?mode=ticket_info&ticket_id=108981' target='_blank' rel='nofollow'>https&#58;//ggus.eu/index.php?mode=ticket_info&ticket_id=108981</a></font>
<font color='#7F7E6F'>&#62;&#62; SUBJECT&#58; FileReadErrors for jobs running at FNAL accessing a file at FNAL</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; =====================</font>
<font color='#7F7E6F'>&#62;&#62; LATEST MODIFICATIONS&#58;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; LAST MODIFIER -&#62; Levin</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; PUBLIC DIARY -&#62;</font>
<font color='#7F7E6F'>&#62;&#62; Here is an example from today&#58;</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; Begin processing the 4338th record. Run 1, Event 6338, LumiSection 13 at 04-Oct-2014 02&#58;21&#58;54.522 CDT</font>
<font color='#7F7E6F'>&#62;&#62; 141004 02&#58;22&#58;01 31276 Xrd&#58; SendGenCommand&#58; Max time limit elapsed for request  kXR_readv. Aborting command.</font>
<font color='#7F7E6F'>&#62;&#62; ----- Begin Fatal Exception 04-Oct-2014 02&#58;22&#58;01 CDT-----------------------</font>
<font color='#7F7E6F'>&#62;&#62; An exception of category &#39;FileReadError&#39; occurred while</font>
<font color='#7F7E6F'>&#62;&#62;  [0] Calling InputSource&#58;&#58;getNextItemType</font>
<font color='#7F7E6F'>&#62;&#62;  [1] Reading branch EventAuxiliary</font>
<font color='#7F7E6F'>&#62;&#62;  Additional Info&#58;</font>
<font color='#7F7E6F'>&#62;&#62;     [a] Fatal Root Error&#58; @SUB=TBranchElement&#58;&#58;GetBasket</font>
<font color='#7F7E6F'>&#62;&#62; File&#58; root&#58;//cmsxrootd-site.fnal.gov//store/relval/CMSSW_6_2_0_SLHC18/RelValSingleMuPt100Extended/GEN-SIM/DES23_62_V1_UPGHGCalV4-v1/00000/9A1D3BEF-4D49-E411-9D59-0025905A608C.root at byte&#58;256382087, branch&#58;EventAuxiliary, entry&#58;4338, badread=1, nerrors=1, basketnumber=18</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; ----- End Fatal Exception -------------------------------------------------</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; *********************************************************************************</font>
<font color='#7F7E6F'>&#62;&#62; This is an automated mail. When replying don&#39;t change the subject line!</font>
<font color='#7F7E6F'>&#62;&#62; Type your text above this box and S T R I P  P R E V I O U S  M A I L S please!!</font>
<font color='#7F7E6F'>&#62;&#62; *********************************************************************************</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; ---</font>
<font color='#7F7E6F'>&#62; Regards, Catalin</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; *********************************************************************************</font>
<font color='#7F7E6F'>&#62; This is an automated mail. When replying don&#39;t change the subject line!</font>
<font color='#7F7E6F'>&#62; Type your text above this box and S T R I P  P R E V I O U S  M A I L S please!!</font>
<font color='#7F7E6F'>&#62; *********************************************************************************</font>

---
Regards, Catalin

-- by Catalin Dumitrescu at Sat Oct 04 16&#58;58&#58;18 UTC 2014

I don&#39;t have those statistics, sorry. The workflows are finished (they have failed), but I am just running one job over and over interactively, and it fails every time, although you can see it processes thousands of events usually before it fails. The jobs are pulling the data from FNAL. I have increased the xrootd debug level in order to get more information next time it fails.

-- by Levin at Sat Oct 04 16&#58;30&#58;20 UTC 2014

Hi

Thanks for the update. Do you have any statistics about the error rates before
and after the timeout changes?  Is it 1% of completed jobs, 10% or more?

Also, where are the jobs actually pulling the data from?

On Oct 4, 2014, at 10&#58;37 AM, &#60;helpdesk@....&#62; &#60;helpdesk@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; GGUS ticket #108981 was updated.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; REFERENCE LINK&#58; <a href='https&#58;//ggus.eu/index.php?mode=ticket_info&ticket_id=108981' target='_blank' rel='nofollow'>https&#58;//ggus.eu/index.php?mode=ticket_info&ticket_id=108981</a></font>
<font color='#7F7E6F'>&#62; SUBJECT&#58; FileReadErrors for jobs running at FNAL accessing a file at FNAL</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; =====================</font>
<font color='#7F7E6F'>&#62; LATEST MODIFICATIONS&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; LAST MODIFIER -&#62; Levin</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; PUBLIC DIARY -&#62;</font>
<font color='#7F7E6F'>&#62; Here is an example from today&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Begin processing the 4338th record. Run 1, Event 6338, LumiSection 13 at 04-Oct-2014 02&#58;21&#58;54.522 CDT</font>
<font color='#7F7E6F'>&#62; 141004 02&#58;22&#58;01 31276 Xrd&#58; SendGenCommand&#58; Max time limit elapsed for request  kXR_readv. Aborting command.</font>
<font color='#7F7E6F'>&#62; ----- Begin Fatal Exception 04-Oct-2014 02&#58;22&#58;01 CDT-----------------------</font>
<font color='#7F7E6F'>&#62; An exception of category &#39;FileReadError&#39; occurred while</font>
<font color='#7F7E6F'>&#62;   [0] Calling InputSource&#58;&#58;getNextItemType</font>
<font color='#7F7E6F'>&#62;   [1] Reading branch EventAuxiliary</font>
<font color='#7F7E6F'>&#62;   Additional Info&#58;</font>
<font color='#7F7E6F'>&#62;      [a] Fatal Root Error&#58; @SUB=TBranchElement&#58;&#58;GetBasket</font>
<font color='#7F7E6F'>&#62; File&#58; root&#58;//cmsxrootd-site.fnal.gov//store/relval/CMSSW_6_2_0_SLHC18/RelValSingleMuPt100Extended/GEN-SIM/DES23_62_V1_UPGHGCalV4-v1/00000/9A1D3BEF-4D49-E411-9D59-0025905A608C.root at byte&#58;256382087, branch&#58;EventAuxiliary, entry&#58;4338, badread=1, nerrors=1, basketnumber=18</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; ----- End Fatal Exception -------------------------------------------------</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; *********************************************************************************</font>
<font color='#7F7E6F'>&#62; This is an automated mail. When replying don&#39;t change the subject line!</font>
<font color='#7F7E6F'>&#62; Type your text above this box and S T R I P  P R E V I O U S  M A I L S please!!</font>
<font color='#7F7E6F'>&#62; *********************************************************************************</font>

---
Regards, Catalin

-- by Catalin Dumitrescu at Sat Oct 04 16&#58;25&#58;07 UTC 2014

Here is an example from today&#58;

Begin processing the 4338th record. Run 1, Event 6338, LumiSection 13 at 04-Oct-2014 02&#58;21&#58;54.522 CDT
141004 02&#58;22&#58;01 31276 Xrd&#58; SendGenCommand&#58; Max time limit elapsed for request  kXR_readv. Aborting command.
----- Begin Fatal Exception 04-Oct-2014 02&#58;22&#58;01 CDT-----------------------
An exception of category &#39;FileReadError&#39; occurred while
[0] Calling InputSource&#58;&#58;getNextItemType
[1] Reading branch EventAuxiliary
Additional Info&#58;
[a] Fatal Root Error&#58; @SUB=TBranchElement&#58;&#58;GetBasket
File&#58; root&#58;//cmsxrootd-site.fnal.gov//store/relval/CMSSW_6_2_0_SLHC18/RelValSingleMuPt100Extended/GEN-SIM/DES23_62_V1_UPGHGCalV4-v1/00000/9A1D3BEF-4D49-E411-9D59-0025905A608C.root at byte&#58;256382087, branch&#58;EventAuxiliary, entry&#58;4338, badread=1, nerrors=1, basketnumber=18

----- End Fatal Exception -------------------------------------------------

-- by Levin at Sat Oct 04 15&#58;37&#58;42 UTC 2014

Hi

The change applied to jobs started afterwards. Please let me know if anything has changed in terms of success rate by tomorrow...

Regards,
Catalin

helpdesk@.... wrote&#58;

GGUS ticket #108981 was updated.

REFERENCE LINK&#58; <a href='https&#58;//ggus.eu/index.php?mode=ticket_info&ticket_id=108981' target='_blank' rel='nofollow'>https&#58;//ggus.eu/index.php?mode=ticket_info&ticket_id=108981</a>
SUBJECT&#58; FileReadErrors for jobs running at FNAL accessing a file at FNAL

=====================
LATEST MODIFICATIONS&#58;

LAST MODIFIER -&#62; Levin

PUBLIC DIARY -&#62;
I saw this just a few hours ago&#58;

Begin processing the 4615th record. Run 1, Event 7615, LumiSection 16 at 03-Oct-2014 13&#58;58&#58;23.622 CDT
141003 13&#58;58&#58;30 8007 Xrd&#58; SendGenCommand&#58; Max time limit elapsed for request  kXR_readv. Aborting command.
----- Begin Fatal Exception 03-Oct-2014 13&#58;58&#58;30 CDT-----------------------
An exception of category &#39;FileReadError&#39; occurred while
[0] Processing run&#58; 1 lumi&#58; 16 event&#58; 7615
[1] Running path &#39;FEVTDEBUGHLToutput_step&#39;
[2] Calling event method for module PoolOutputModule/&#39;FEVTDEBUGHLToutput&#39;
[3] Reading branch edmRandomEngineStates_randomEngineStateProducer__SIM.
Additional Info&#58;
[a] Fatal Root Error&#58; @SUB=TBranchElement&#58;&#58;GetBasket
File&#58; root&#58;//cmsxrootd-site.fnal.gov//store/relval/CMSSW_6_2_0_SLHC18/RelValSingleMuPt100Extended/GEN-SIM/DES23_62_V1_UPGHGCalV4-v1/00000/9A1D3BEF-4D49-E411-9D59-0025905A608C.root at byte&#58;261719287, branch&#58;edmRandomEngineStates_randomEngineStateProducer__SIM.obj, entry&#58;4614, badread=1, nerrors=1, basketnumber=1120

----- End Fatal Exception -------------------------------------------------
Low level caching info&#58;

*********************************************************************************
This is an automated mail. When replying don&#39;t change the subject line!
Type your text above this box and S T R I P  P R E V I O U S  M A I L S please!!
*********************************************************************************

-- by Catalin Dumitrescu at Fri Oct 03 23&#58;37&#58;00 UTC 2014

I saw this just a few hours ago&#58;

Begin processing the 4615th record. Run 1, Event 7615, LumiSection 16 at 03-Oct-2014 13&#58;58&#58;23.622 CDT
141003 13&#58;58&#58;30 8007 Xrd&#58; SendGenCommand&#58; Max time limit elapsed for request  kXR_readv. Aborting command.
----- Begin Fatal Exception 03-Oct-2014 13&#58;58&#58;30 CDT-----------------------
An exception of category &#39;FileReadError&#39; occurred while
[0] Processing run&#58; 1 lumi&#58; 16 event&#58; 7615
[1] Running path &#39;FEVTDEBUGHLToutput_step&#39;
[2] Calling event method for module PoolOutputModule/&#39;FEVTDEBUGHLToutput&#39;
[3] Reading branch edmRandomEngineStates_randomEngineStateProducer__SIM.
Additional Info&#58;
[a] Fatal Root Error&#58; @SUB=TBranchElement&#58;&#58;GetBasket
File&#58; root&#58;//cmsxrootd-site.fnal.gov//store/relval/CMSSW_6_2_0_SLHC18/RelValSingleMuPt100Extended/GEN-SIM/DES23_62_V1_UPGHGCalV4-v1/00000/9A1D3BEF-4D49-E411-9D59-0025905A608C.root at byte&#58;261719287, branch&#58;edmRandomEngineStates_randomEngineStateProducer__SIM.obj, entry&#58;4614, badread=1, nerrors=1, basketnumber=1120

----- End Fatal Exception -------------------------------------------------
Low level caching info&#58;

-- by Levin at Fri Oct 03 23&#58;04&#58;13 UTC 2014

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=108981' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=108981</a>
</div><script type='text/javascript'>
        $('#show_1360683609').click(function() {
            $('#detail_1360683609').slideDown("normal");
            $('#show_1360683609').hide();
            $('#hide_1360683609').show();
        });
        $('#hide_1360683609').click(function() {
            $('#detail_1360683609').slideUp();
            $('#hide_1360683609').hide();
            $('#show_1360683609').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='22569#1412621921'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-06T18:58:41+00:00">Oct 6, 2014 06:58 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1412621921">&nbsp;</a></div><pre>Hello Andrew,

Can you tell us whether or not the errors have cleared?

Thanks,
Chris</pre></div><div class='update_description'><i onclick="document.location='22569#1412375174'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-03T22:26:14+00:00">Oct 3, 2014 10:26 PM UTC</time> by <b>catalind@....</b><a class="anchor" name="1412375174">&nbsp;</a></div><pre>Hi,
After the timeout increase our local tests complete - please let us know if the
errors have vanished in the production jobs as well.

On Oct 3, 2014, at 8&#58;01 AM, Catalin Dumitrescu &#60;catalind@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; Hi,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;   Thanks, the problem is most likely due to the dcache xrootd timeouts. Tests on using input files from</font>
<font color='#7F7E6F'>&#62; EOS xrootd completed successfully - we have increased for now the timeouts in the dCache xrootd</font>
<font color='#7F7E6F'>&#62; and also started verifying with the developers for possible bugs.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;   For now, one quick workaround would be to duplicate any smaller datasets from T1_US_FNAL_Disk to</font>
<font color='#7F7E6F'>&#62; T3_US_FNALLPC - if the new timeout in the dcache xrootd does not fix the problem.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;   These jobs are long running ones _ we will run the tests again ..</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On Oct 3, 2014, at 3&#58;11 AM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22569#1412341335'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-03T13:02:15+00:00">Oct 3, 2014 01:02 PM UTC</time> by <b>catalind@....</b><a class="anchor" name="1412341335">&nbsp;</a></div><pre>Hi,

Thanks, the problem is most likely due to the dcache xrootd timeouts. Tests on using input files from
EOS xrootd completed successfully - we have increased for now the timeouts in the dCache xrootd
and also started verifying with the developers for possible bugs.

For now, one quick workaround would be to duplicate any smaller datasets from T1_US_FNAL_Disk to
T3_US_FNALLPC - if the new timeout in the dcache xrootd does not fix the problem.

These jobs are long running ones _ we will run the tests again ..

On Oct 3, 2014, at 3&#58;11 AM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22569#1412323879'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-03T08:11:19+00:00">Oct 3, 2014 08:11 AM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1412323879">&nbsp;</a></div><pre>Notified CMS AAA - WAN Access team of this ticket.I have copied the file to a local disk and found that the job finishes successfully. So, it seems to be a problem with xrootd. Does it help anyone if we increase the xrootd debug level?

-- by Levin at Fri Oct 03 08&#58;10&#58;29 UTC 2014

GOCTX Source&#58; <a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=108981' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=108981</a></pre></div><div class='update_description'><i onclick="document.location='22569#1412252410'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-02T12:20:10+00:00">Oct 2, 2014 12:20 PM UTC</time> by <b>catalind@....</b><a class="anchor" name="1412252410">&nbsp;</a></div><pre>Hi,

The CRC verification on the data matches namespace’s values.  I recommend as a first step to
remove the xrootd infrastructure from the debugging environment (xrdcp the file to a local disk).
We were informed of some threading issues within cmssw (+xrootd) that might occur at times.

Afterwards based on the error occurrence I would debug the problem with the either cmssw or
xrootd groups.

On Oct 2, 2014, at 4&#58;09 AM, Open Science Grid FootPrints &#60;osg@....&#60;mailto&#58;osg@....&#62;&#62; wrote&#58;

[Duplicate message snipped]</pre></div><div class='update_description'><i onclick="document.location='22569#1412240980'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-10-02T09:09:40+00:00">Oct 2, 2014 09:09 AM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1412240980">&nbsp;</a></div><pre>Hi,

Jobs are having trouble accessing these files at FNAL&#58;

/store/relval/CMSSW_6_2_0_SLHC18/RelValSingleMuPt100Extended/GEN-SIM/DES23_62_V1_UPGHGCalV4-v1/00000/969FD30A-4E49-E411-B9FB-0025905A6092.root
/store/relval/CMSSW_6_2_0_SLHC18/RelValSingleMuPt100Extended/GEN-SIM/DES23_62_V1_UPGHGCalV4-v1/00000/9A1D3BEF-4D49-E411-9D59-0025905A608C.root

Here is the error&#58;

Begin processing the 2410th record. Run 1, Event 3910, LumiSection 8 at 01-Oct-2014 21&#58;16&#58;55.155 CDT
141001 21&#58;17&#58;00 64078 Xrd&#58; DumpPhyConn&#58; Phyconn entry, key=&#39;cmsprod@....&#58;22675&#39;, LogCnt=1 Valid
141001 21&#58;17&#58;06 62895 Xrd&#58; SendGenCommand&#58; Max time limit elapsed for request  kXR_readv. Aborting command.
----- Begin Fatal Exception 01-Oct-2014 21&#58;17&#58;06 CDT-----------------------
An exception of category &#39;FileReadError&#39; occurred while
[0] Calling InputSource&#58;&#58;getNextItemType
[1] Reading branch EventAuxiliary
Additional Info&#58;
[a] Fatal Root Error&#58; @SUB=TBranchElement&#58;&#58;GetBasket
File&#58; root&#58;//cmsxrootd-site.fnal.gov//store/relval/CMSSW_6_2_0_SLHC18/RelValSingleMuPt100Extended/GEN-SIM/DES23_62_V1_UPGHGCalV4-v1/00000/9A1D3BEF-4D49-E411-9D59-0025905A608C.root at byte&#58;142420118, branch&#58;EventAuxiliary, entry&#58;2410, badread=1, nerrors=1, basketnumber=10

----- End Fatal Exception -------------------------------------------------

which does not always occur on the same event, but which I have reproduced when running the job interactively.

Here are four examples where the job has failed&#58;

<a href='http&#58;//cms-project-relval.web.cern.ch/cms-project-relval/failures/CMSSW_6_2_0_SLHC18/01Oct2014/625d104e-494e-11e4-a61f-003048c9c3fe-0-0-logArchive.tar.gz' target='_blank' rel='nofollow'>http&#58;//cms-project-relval.web.cern.ch/cms-project-relval/failures/CMSSW_6_2_0_SLHC18/01Oct2014/625d104e-494e-11e4-a61f-003048c9c3fe-0-0-logArchive.tar.gz</a>
<a href='http&#58;//cms-project-relval.web.cern.ch/cms-project-relval/failures/CMSSW_6_2_0_SLHC18/01Oct2014/625d104e-494e-11e4-a61f-003048c9c3fe-0-1-logArchive.tar.gz' target='_blank' rel='nofollow'>http&#58;//cms-project-relval.web.cern.ch/cms-project-relval/failures/CMSSW_6_2_0_SLHC18/01Oct2014/625d104e-494e-11e4-a61f-003048c9c3fe-0-1-logArchive.tar.gz</a>
<a href='http&#58;//cms-project-relval.web.cern.ch/cms-project-relval/failures/CMSSW_6_2_0_SLHC18/01Oct2014/625d104e-494e-11e4-a61f-003048c9c3fe-1-0-logArchive.tar.gz' target='_blank' rel='nofollow'>http&#58;//cms-project-relval.web.cern.ch/cms-project-relval/failures/CMSSW_6_2_0_SLHC18/01Oct2014/625d104e-494e-11e4-a61f-003048c9c3fe-1-0-logArchive.tar.gz</a>
<a href='http&#58;//cms-project-relval.web.cern.ch/cms-project-relval/failures/CMSSW_6_2_0_SLHC18/01Oct2014/625d104e-494e-11e4-a61f-003048c9c3fe-0-1-logArchive.tar.gz' target='_blank' rel='nofollow'>http&#58;//cms-project-relval.web.cern.ch/cms-project-relval/failures/CMSSW_6_2_0_SLHC18/01Oct2014/625d104e-494e-11e4-a61f-003048c9c3fe-0-1-logArchive.tar.gz</a>

How can we debug this?

Thanks.

<div id='show_1152193852' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1152193852'>Andrew

[Ticket Origin]
<a href='https&#58;//ggus.eu/ws/ticket_info.php?ticket=108981' target='_blank' rel='nofollow'>https&#58;//ggus.eu/ws/ticket_info.php?ticket=108981</a>

[Ticket History]
Subject&#58; FileReadErrors for jobs running at FNAL accessing a file at FNAL
Ticket Type&#58; USER
CC&#58; ;cms-comp-ops-workflow-team@....
-- by Levin at Thu Oct 02 09&#58;08&#58;10 UTC 2014
</div><script type='text/javascript'>
        $('#show_1152193852').click(function() {
            $('#detail_1152193852').slideDown("normal");
            $('#show_1152193852').hide();
            $('#hide_1152193852').show();
        });
        $('#hide_1152193852').click(function() {
            $('#detail_1152193852').slideUp();
            $('#hide_1152193852').hide();
            $('#show_1152193852').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F22569">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 22569});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
