<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[23879] voms-proxy-init Error during SSL handshake</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=23879" method="post">
<div class="page-header">
    <h3><span class="muted">23879</span> / voms-proxy-init Error during SSL handshake</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Andrew Dale Touchet</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Andrew Dale Touchet</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Resolved</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2015-08-13</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Kyle Gross <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">Dave Dykstra <span class="muted"> / OSG Security Coordinators</span></div><div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div><div class="assignee" style="width: 60%">Tim Cartwright <span class="muted"> / OSG Software Team</span></div><div class="assignee" style="width: 60%">Carl Edquist <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/23879", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/23879?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/23879?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20voms-proxy-init%20Error%20during%20SSL%20handshake%20ISSUE%3D23879%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='23879#1439407842'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-12T19:30:42+00:00">Aug 12, 2015 07:30 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1439407842">&nbsp;</a></div><pre>Thanks to all for the assistance/persistence.</pre></div><div class='update_description'><i onclick="document.location='23879#1439406900'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-12T19:15:00+00:00">Aug 12, 2015 07:15 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1439406900">&nbsp;</a></div><pre>Hi Tim,

thanks; I&#39;ll have to think about the Firefox 39/40 workaround,
since the instructions seem to be linux specific, so I&#39;ll have
to dig around to find the corresponding files on the Mac.

Wait, this is server side, not client side, so I&#39;m sure I can figure it out
on the VOMS server! In fact, I just did, and it seems to be still working
for Firefox 38, so tonight I&#39;ll try it with Firefox 40 on my Macbook again,
and hopefully it&#39;ll work there again, too, then!

And yes, we can definitely close this ticket, we&#39;ve worked on it
for long enough! &#58;)

Thanks again,

Horst</pre></div><div class='update_description'><i onclick="document.location='23879#1439403830'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-12T18:23:50+00:00">Aug 12, 2015 06:23 PM UTC</time> by <b>Tim Cartwright</b><a class="anchor" name="1439403830">&nbsp;</a></div><pre>Minor issues aside, it seems like the core issue of this ticket has been resolved. Horst, are you ready for us to close the ticket?</pre></div><div class='update_description'><i onclick="document.location='23879#1439403747'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-12T18:22:27+00:00">Aug 12, 2015 06:22 PM UTC</time> by <b>Tim Cartwright</b><a class="anchor" name="1439403747">&nbsp;</a></div><pre>Horst&#58; Here is a copy of the announcement we sent about Firefox 39(+)&#58;

We have received reports that the latest version of Firefox (39.0) keeps
users from being able to access the web UIs of GUMS, Gratia, or
VOMS-Admin.  Attempts to access will result in this error&#58;

SSL received a weak ephemeral Diffie-Hellman key in Server Key Exchange handshake message. (Error code&#58; ssl_error_weak_server_ephemeral_dh_key)

This affects all known versions of OpenJDK 1.7.0.

The recommended workaround for this is server-side&#58;

1. Find the file
&#96;/usr/lib/jvm/java-1.7.0-openjdk-1.7.0-*/jre/lib/security/java.security&#96;
2. Find the setting called &#96;jdk.tls.disabledAlgorithms&#96; (or add it if
missing)
3. If not already present, add &#96;SSLv3&#96; and &#96;DHE&#96; to the list
4. If using EL5, run &#96;service tomcat5 restart&#96;
If using EL6, run &#96;service tomcat6 restart&#96;

This will cause the webapp to use a different algorithm, which Firefox
will not complain about.

We do not have an ETA for when a future version of OpenJDK 1.7.0 will
contain a fix.  OpenJDK 1.8.0 does not have this problem, but since we
have not verified that it works with OSG software, we do not recommend
switching to that yet.</pre></div><div class='update_description'><i onclick="document.location='23879#1439403484'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-12T18:18:04+00:00">Aug 12, 2015 06:18 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1439403484">&nbsp;</a></div><pre>Hi Carl and Tim,

ah -- I&#39;m only seeing this error on Firefox 39 on my Macbook --
oh wait, 40 now, I upgraded this morning -- but not on Firefox 38 on RHEL6.
So this is clearly some Firefox specific issue, and I do remember reading
about some SSL related issue that requires you to go into about&#58;config
and mess with some variable to work around some SSL related error,
but I can&#39;t remember the details about that now. Does anyone remember?

Anyway, it looks like we got our VOMS server working again,
so I&#39;m definitely NOT about to generate another certificate,
especially if that were to require me to change /etc/vomses again! &#58;)

Thanks a lot,

Horst</pre></div><div class='update_description'><i onclick="document.location='23879#1439401692'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-12T17:48:12+00:00">Aug 12, 2015 05:48 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1439401692">&nbsp;</a></div><pre>Horst, are you still seeing that error message trying to connect to <a href='https&#58;//voms.dosar.org&#58;8443/voms/dosar' target='_blank' rel='nofollow'>https&#58;//voms.dosar.org&#58;8443/voms/dosar</a> ?  (I ask because I don&#39;t get any errors when I try to connect.)

To answer your question though; No, I don&#39;t think voms requires a service cert.  When we do testing we cheat and use a copy of the host cert.

And in fact the last working cert for dosar (the one &#34;on the books&#34; in the vo-client package) was technically not a service cert anyway, as I see CN=voms.dosar.org instead of CN=voms/voms.dosar.org ... The reason I mention this is, if you do the proper thing now and request a service cert (and, I don&#39;t mean to discourage doing that, but just a heads-up if you do,) you should be aware that that may again break voms-proxy-init which will expect to see a different DN (the CN part anyway) for your voms cert...

At that point you&#39;d need to either manually fix /etc/grid-security/vomsdir/dosar/voms.dosar.org.lsc to match the new DN (or run osg-make-vomsdir to fetch it automatically), and we&#39;ll have to update the vo-client package to reflect the change for everybody else.

Carl</pre></div><div class='update_description'><i onclick="document.location='23879#1439400528'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-12T17:28:48+00:00">Aug 12, 2015 05:28 PM UTC</time> by <b>Tim Cartwright</b><a class="anchor" name="1439400528">&nbsp;</a></div><pre>Horst, you’ve been around long enough! Certs are a pain. My advice is to get a new service cert and see if that works.</pre></div><div class='update_description'><i onclick="document.location='23879#1439400100'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-12T17:21:40+00:00">Aug 12, 2015 05:21 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1439400100">&nbsp;</a></div><pre>Hi Carl,

yes, you were right, the vomskey definitely doesn&#39;t match the cert!
Sorry I didn&#39;t catch that earlier, but I wasn&#39;t the one who replaced them. &#58;)

Since I don&#39;t know where the original key is kept (or maybe it has been
accidentally overwritten), as a test I made copies of the hostcert and key
files as vomscert and key, and restarted the VOMS service, and now
voms-proxy-init works!

But now the VOMS server web page isn&#39;t working anymore&#58;

<a href='https&#58;//voms.dosar.org&#58;8443/voms/dosar' target='_blank' rel='nofollow'>https&#58;//voms.dosar.org&#58;8443/voms/dosar</a>
----
Secure Connection Failed

An error occurred during a connection to voms.dosar.org&#58;8443. SSL received a weak ephemeral Diffie-Hellman key in Server Key Exchange handshake message. (Error code&#58; ssl_error_weak_server_ephemeral_dh_key)

The page you are trying to view cannot be shown because the authenticity of the received data could not be verified.
Please contact the website owners to inform them of this problem.
----

Is this because the web interface insists on a VOMS service certificate
and won&#39;t work with a copy of a host cert (voms-proxy-init doesn&#39;t seem
to care), or is this related to some Firefox issue I read about a while
ago, but can&#39;t remember the details anymore now?

The http cert and key seem to be still okay, but I don&#39;t know exactly
how the VOMS web interface uses the http cert and/or the voms cert.

I can certainly generate a new and proper VOMS service cert and put that
in place, but I thought I&#39;d first ask for clarification about this
new SSL error before blindly generating new certs.

Thanks a lot,
<div id='show_1655648746' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1655648746'>
Horst
</div><script type='text/javascript'>
        $('#show_1655648746').click(function() {
            $('#detail_1655648746').slideDown("normal");
            $('#show_1655648746').hide();
            $('#hide_1655648746').show();
        });
        $('#hide_1655648746').click(function() {
            $('#detail_1655648746').slideUp();
            $('#hide_1655648746').hide();
            $('#show_1655648746').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23879#1439348973'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-12T03:09:33+00:00">Aug 12, 2015 03:09 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1439348973">&nbsp;</a></div><pre>Oh look!  This is pretty suspicious&#58;

133771    4 -r--------   1 root     root         1702 Aug 30  2013 ./hostkey.pem.old
135034    4 -r--------   1 voms     voms         1702 Aug 30  2013 ./voms/vomskey.pem

Maybe the pem files got copied/moved around not quite right...</pre></div><div class='update_description'><i onclick="document.location='23879#1439344025'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-12T01:47:05+00:00">Aug 12, 2015 01:47 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1439344025">&nbsp;</a></div><pre>Ah, I see my netstat question was answered earlier&#58;

<font color='#7F7E6F'>&#62; Which port should voms and tomcat be listening to then?  Voms is running on</font>
<font color='#7F7E6F'>&#62; 15000, which can be seen using netstat and java is currently waiting 8443.</font>

Horst, about your earlier question&#58;

<font color='#7F7E6F'>&#62; So we need to figure out why tomcat -- I assume this is</font>
<font color='#7F7E6F'>&#62; tomcat? -- is listening and responding for https on port 8443 just fine,</font>
<font color='#7F7E6F'>&#62; but not on port 15000? Where in the configs would that be?</font>

So in case it&#39;s not already clear, tomcat listens on 8443 but voms listens on 15000, which is the case even if you stop the tomcat service.

Also, I missed this comment earlier but it also suggests that vomskey.pem / vomscert.pem are mismatched&#58;

<font color='#7F7E6F'>&#62; When running the command below, I get two different numbers.  So do we have</font>
<font color='#7F7E6F'>&#62; matching key and cert, or am I misunderstanding this?</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; (openssl x509 -noout -modulus -in vomscert.pem | openssl md5 ;</font>
<font color='#7F7E6F'>&#62; openssl rsa -noout -modulus -in vomskey.pem | openssl md5) | uniq</font>

(which is perhaps also evidenced by their file timestamps?)

Anyway, do you have a way to re-retrieve the voms pem files?

Carl</pre></div><div class='update_description'><i onclick="document.location='23879#1439334078'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-11T23:01:18+00:00">Aug 11, 2015 11:01 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1439334078">&nbsp;</a></div><pre>Also, just curious, can you give the output of &#34;netstat -anp | grep voms&#34; run from voms.dosar.org as root?

I&#39;d expect to see exactly one tcp LISTEN line on &#58;15000, but if it&#39;s otherwise that would certainly be interesting...

Carl</pre></div><div class='update_description'><i onclick="document.location='23879#1439333652'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-11T22:54:12+00:00">Aug 11, 2015 10:54 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1439333652">&nbsp;</a></div><pre>Ok, thanks Horst!

I get the same error when I try a &#34;voms-proxy-init -voms dosar&#34;.  (Not that I&#39;m a member of dosar, but I get the weird SSL handshake error.)

<font color='#7F7E6F'>&#62;&#62; It&#39;s like SSL isn&#39;t enabled at all.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; but where in the configs could that be set, and how do we fix it?</font>

No idea if it&#39;s even possible to set this up without SSL enabled.  And as has been pointed out, the issue seems to be with voms, not voms-admin or tomcat, so all the stuff with configuration for those might just be a distraction.

A couple things&#58;

132749    4 drwxr-xr-x   2 root     root         4096 Jan  2  2015 ./voms
135034    4 -r--------   1 voms     voms         1702 Aug 30  2013 ./voms/vomskey.pem
135033    4 -r--r--r--   1 voms     voms         1854 Nov 17  2014 ./voms/vomscert.pem

this might not matter but I think the docs say to make /etc/grid-security/voms owned by voms (chown voms&#58;voms /etc/grid-security/voms).

I found a similar error here&#58;
<a href='https&#58;//www.jiscmail.ac.uk/cgi-bin/webadmin?A2=LCG-ROLLOUT' target='_blank' rel='nofollow'>https&#58;//www.jiscmail.ac.uk/cgi-bin/webadmin?A2=LCG-ROLLOUT</a>;3727db44.1404
and they suggested checking the ownership and permissions of server key and certificate.

Also, does your vomskey.pem really match the vomscert.pem?  Maybe that&#39;s a silly question but i was just noticing the 2013 timestamp for vomskey.pem and 2014 for vomscert.pem ... And from osg-profile.log, the validity should be&#58;

Validity
Not Before&#58; Oct 24 00&#58;00&#58;00 2014 GMT
Not After &#58; Nov 29 12&#58;00&#58;00 2015 GMT
Subject&#58; DC=com, DC=DigiCert-Grid, O=Open Science Grid, OU=Services, CN=voms.dosar.org

Note the client-side message about the server&#58; &#34;no peer certificate available&#34; ... all sounds to me like there&#39;s a problem with the voms cert/key...

Carl</pre></div><div class='update_description'><i onclick="document.location='23879#1439324428'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-11T20:20:28+00:00">Aug 11, 2015 08:20 PM UTC</time><a class="anchor" name="1439324428">&nbsp;</a></div><pre>Hi Carl,

well, I updated all vo*, osg*, and emi* RPMs to the latest osg-3.2 version and restarted both tomcat6 and voms, but the error still remains&#58;

----
Your identity&#58; /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27
Creating temporary proxy ................................................................................... Done
Contacting  voms.dosar.org&#58;15000 [/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=voms.dosar.org] &#34;dosar&#34; Failed

Error&#58; Error during SSL handshake&#58;error&#58;14094410&#58;SSL routines&#58;SSL3_READ_BYTES&#58;sslv3 alert handshake failure&#58;s3_pkt.c&#58;1259SSL alert number 40
sslv3 alert handshake failureSSL alert number 40
Function&#58; SSL3_READ_BYTES
----

What else can we try? I think that Dave D&#39;s observation about 3 weeks ago is still the most promising one; it&#39;s in the ticket below, but here it is again for simplicity&#58;

====
The problem is not on port 8443, it&#39;s on the voms port 15000.  If I do the same openssl s_client command to voms.fnal.gov&#58;15001 from el6, it succeeds, but voms.dosar.org&#58;15000 says
CONNECTED(00000003)
139824908924744&#58;error&#58;14077410&#58;SSL routines&#58;SSL23_GET_SERVER_HELLO&#58;sslv3 alert handshake failure&#58;s23_clnt.c&#58;744&#58;
---
no peer certificate available
---
No client certificate CA names sent
---
SSL handshake has read 7 bytes and written 249 bytes
---
New, (NONE), Cipher is (NONE)
Secure Renegotiation IS NOT supported
Compression&#58; NONE
Expansion&#58; NONE
---

It&#39;s like SSL isn&#39;t enabled at all.
====
<div id='show_1455281225' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1455281225'>
but where in the configs could that be set, and how do we fix it?

Thanks,

Horst

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27
</div><script type='text/javascript'>
        $('#show_1455281225').click(function() {
            $('#detail_1455281225').slideDown("normal");
            $('#show_1455281225').hide();
            $('#hide_1455281225').show();
        });
        $('#hide_1455281225').click(function() {
            $('#detail_1455281225').slideUp();
            $('#hide_1455281225').hide();
            $('#show_1455281225').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23879#1439252810'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-11T00:26:50+00:00">Aug 11, 2015 12:26 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1439252810">&nbsp;</a></div><pre>Hi Horst,

Based on the &#34;osg-profile.txt&#34;, some of the packages look a bit out of date&#58;

[osgver]
3.2.21  voms-2.0.12-1.osg32.el6.x86_64
3.2.21  voms-clients-2.0.12-1.osg32.el6.x86_64
3.2.21  voms-server-2.0.12-1.osg32.el6.x86_64
3.2.17  emi-trustmanager-3.0.3-5.osg.el6.noarch
3.2.7   voms-admin-server-2.7.0-1.5.osg.el6.noarch
3.2.3   osg-ca-certs-1.36-1.osg32.el6.noarch
3.2.3   vo-client-50-2.osg32.el6.noarch

Maybe the vo-client is the most important to update, since it has the updated list of voms server names & ports in /etc/vomses...

Carl</pre></div><div class='update_description'><i onclick="document.location='23879#1438968390'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-07T17:26:30+00:00">Aug 7, 2015 05:26 PM UTC</time><a class="anchor" name="1438968390">&nbsp;</a></div><pre>Hi Tim and Carl,

okay, I&#39;ve attached all the requested files, let us know what that tells you! &#58;)

Thanks a lot,

Horst

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27</pre></div><div class='update_description'><i onclick="document.location='23879#1438956238'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-07T14:03:58+00:00">Aug 7, 2015 02:03 PM UTC</time> by <b>Tim Cartwright</b><a class="anchor" name="1438956238">&nbsp;</a></div><pre>Sorry, folks, we have been a little understaffed this week. I have assigned this ticket to Carl Edquist and I believe that he will have time to look into it later today.

In the meantime, could we get osg-system-profiler output from the VOMS server host into the ticket? It is always good to review the complete set-up of the machine. Also, I think it would be a good idea to do a “find /etc/grid-security -ls”, so that we can see all of the host and service certificates; then, if you could run “openssl x509 -in CERTFILE -noout -text” for each “*cert.pem” file that you find there, replacing CERTFILE with the actual certificate file path.

Just to clarify/summarize, this problem almost certainly is related to the VOMS server running on port 15000 (which is the default) and not Tomcat and VOMS Admin server running on port 8443. Keeping the VOMS Admin server running is still a Good Thing, but most likely not directly connected to the issues herein.</pre></div><div class='update_description'><i onclick="document.location='23879#1438714044'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-04T18:47:24+00:00">Aug 4, 2015 06:47 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1438714044">&nbsp;</a></div><pre>Hi Kyle,

oh -- looks like our emails just crossed. Well, now osg-software got an
extra reminder. &#58;)

Thanks a lot,

Horst

On 08/04/2015 01&#58;42 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23879#1438713736'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-04T18:42:16+00:00">Aug 4, 2015 06:42 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1438713736">&nbsp;</a></div><pre>Dave,

Software Support was already assigned on this ticket.  They might not have chimed in because they were quite busy last week.

Software Support,

Can you perhaps help with this issue?

-Kyle</pre></div><div class='update_description'><i onclick="document.location='23879#1438712545'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-04T18:22:25+00:00">Aug 4, 2015 06:22 PM UTC</time> by <b>Dave Dykstra</b><a class="anchor" name="1438712545">&nbsp;</a></div><pre>I don&#39;t think we have the voms experts copied on this ticket.  I suggest asking the osg-software mailing list.</pre></div><div class='update_description'><i onclick="document.location='23879#1438710506'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-08-04T17:48:26+00:00">Aug 4, 2015 05:48 PM UTC</time><a class="anchor" name="1438710506">&nbsp;</a></div><pre>Hi all,

did anyone have a chance to look at Andrew&#39;s questions below? We&#39;d really like to get this working again!

Thanks a lot,

Horst

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27</pre></div><div class='update_description'><i onclick="document.location='23879#1438046245'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-28T01:17:25+00:00">Jul 28, 2015 01:17 AM UTC</time> by <b>adt027@....</b><a class="anchor" name="1438046245">&nbsp;</a></div><pre>Which port should voms and tomcat be listening to then?  Voms is running on
15000, which can be seen using netstat and java is currently waiting 8443.

What certs should be in /etc/ssl/certs?  We only have the ca-bundle.crt and
ca-bundle.trust.crt which expire Aug 22 2015.

I see &#34;Peer not authenticated&#34; and &#34;no shared cipher&#34; errors in
catalina-2015-07-13.log

I found the following advice to check the certs on the server&#58;
<a href='https&#58;//kb.wisc.edu/middleware/page.php?id=4064' target='_blank' rel='nofollow'>https&#58;//kb.wisc.edu/middleware/page.php?id=4064</a>
When running the command below, I get two different numbers.  So do we have
matching key and cert, or am I misunderstanding this?

(openssl x509 -noout -modulus -in vomscert.pem | openssl md5 ;
openssl rsa -noout -modulus -in vomskey.pem | openssl md5) | uniq

On Tue, Jul 21, 2015 at 2&#58;43 PM Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62;  [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23879#1437514938'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-21T21:42:18+00:00">Jul 21, 2015 09:42 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1437514938">&nbsp;</a></div><pre>Hi Dave,

ah, I see. So we need to figure out why tomcat -- I assume this is
tomcat? -- is listening and responding for https on port 8443 just fine,
but not on port 15000? Where in the configs would that be?

Thanks,

Horst</pre></div><div class='update_description'><i onclick="document.location='23879#1437514480'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-21T21:34:40+00:00">Jul 21, 2015 09:34 PM UTC</time> by <b>Dave Dykstra</b><a class="anchor" name="1437514480">&nbsp;</a></div><pre>I don&#39;t know what to tell you about the voms server configuration, but if you add -CApath /etc/grid-security/certificates to the command for voms.grid.iu.edu&#58;15003 it succeeds.

The response from voms.dosar.org&#58;15000 is the same as when connecting to some port that has no SSL (e.g. an http-only web server), so SSL isn&#39;t functioning at all.</pre></div><div class='update_description'><i onclick="document.location='23879#1437513679'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-21T21:21:19+00:00">Jul 21, 2015 09:21 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1437513679">&nbsp;</a></div><pre>Hi Dave,

ah, right -- port 15000, of course, not 8443!

You&#39;re right, those commands return different errors&#58;

========
[hs@osgitb1 ~]$ openssl s_client -connect voms.dosar.org&#58;15000
CONNECTED(00000003)
140121903925064&#58;error&#58;14077410&#58;SSL routines&#58;SSL23_GET_SERVER_HELLO&#58;sslv3
alert handshake failure&#58;s23_clnt.c&#58;744&#58;
---
no peer certificate available
[...]
========
[hs@osgitb1 ~]$ openssl s_client -connect voms.grid.iu.edu&#58;15003
CONNECTED(00000003)
depth=2 DC = com, DC = DigiCert-Grid, O = DigiCert Grid, CN = DigiCert
Grid Root CA
verify error&#58;num=19&#58;self signed certificate in certificate chain
verify return&#58;0
139707881932616&#58;error&#58;14094410&#58;SSL routines&#58;SSL3_READ_BYTES&#58;sslv3 alert
handshake failure&#58;s3_pkt.c&#58;1259&#58;SSL alert number 40
139707881932616&#58;error&#58;140790E5&#58;SSL routines&#58;SSL23_WRITE&#58;ssl handshake
failure&#58;s23_lib.c&#58;184&#58;
---
Certificate chain
[...]
========

So what does this tell us now, and how do we fix it?

I still don&#39;t understand why the web interface works fine, but
voms-proxy-init does not. I guess port 15000 uses a different ssl
authentication than 8443? But they&#39;re both &#39;served&#39; by tomcat? Then
<div id='show_2035715067' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_2035715067'>where in the tomcat config settings do we need to look for the problem?

It&#39;s definitely not a client side problem, because I can get an OSGEDU
voms-proxy from the same client just fine. Only the DOSAR VOMS server
gives this error.

Thanks a lot,

Horst
</div><script type='text/javascript'>
        $('#show_2035715067').click(function() {
            $('#detail_2035715067').slideDown("normal");
            $('#show_2035715067').hide();
            $('#hide_2035715067').show();
        });
        $('#hide_2035715067').click(function() {
            $('#detail_2035715067').slideUp();
            $('#hide_2035715067').hide();
            $('#show_2035715067').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23879#1437511055'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-21T20:37:35+00:00">Jul 21, 2015 08:37 PM UTC</time> by <b>Dave Dykstra</b><a class="anchor" name="1437511055">&nbsp;</a></div><pre>The problem is not on port 8443, it&#39;s on the voms port 15000.  If I do the same openssl s_client command to voms.fnal.gov&#58;15001 from el6, it succeeds, but voms.dosar.org&#58;15000 says
CONNECTED(00000003)
139824908924744&#58;error&#58;14077410&#58;SSL routines&#58;SSL23_GET_SERVER_HELLO&#58;sslv3 alert handshake failure&#58;s23_clnt.c&#58;744&#58;
---
no peer certificate available
---
No client certificate CA names sent
---
SSL handshake has read 7 bytes and written 249 bytes
---
New, (NONE), Cipher is (NONE)
Secure Renegotiation IS NOT supported
Compression&#58; NONE
Expansion&#58; NONE
---

It&#39;s like SSL isn&#39;t enabled at all.

Dave</pre></div><div class='update_description'><i onclick="document.location='23879#1437510515'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-21T20:28:35+00:00">Jul 21, 2015 08:28 PM UTC</time> by <b>Dave Dykstra</b><a class="anchor" name="1437510515">&nbsp;</a></div><pre>Horst,

You&#39;re right, my bad.  I should have run it on an el6 machine.    if I connect on an el6 machine with up-to-date certificates, I even get an OK&#58;
$ openssl s_client -CApath /etc/grid-security/certificates -connect voms.dosar.org&#58;8443
..... lots of stuff ...
New, TLSv1/SSLv3, Cipher is DHE-RSA-AES256-SHA256
Server public key is 2048 bit
Secure Renegotiation IS supported
Compression&#58; NONE
Expansion&#58; NONE
SSL-Session&#58;
Protocol  &#58; TLSv1.2
Cipher    &#58; DHE-RSA-AES256-SHA256
Session-ID&#58; 55AEAACB3495A8DD302E01771BC350185239991E979E74EF1A781C735E962DB5
Session-ID-ctx&#58;
Master-Key&#58; C6139F5C1CCB29C9E72747C041BCC78B46A0A9E2B9DC2DBB1298DDC4B056B0128EBCC0438F1674A276F58D9269DC9BA6
Key-Arg   &#58; None
Krb5 Principal&#58; None
PSK identity&#58; None
PSK identity hint&#58; None
Start Time&#58; 1437510347
Timeout   &#58; 300 (sec)
Verify return code&#58; 0 (ok)
---

So maybe it&#39;s a client side problem after all.

Dave</pre></div><div class='update_description'><i onclick="document.location='23879#1437507742'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-21T19:42:22+00:00">Jul 21, 2015 07:42 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1437507742">&nbsp;</a></div><pre>Hi Dave,

yes, we definitely need an expert in voms server administration, no
question about that! &#58;)

I think your openssl errors were caused by you running from a RHEL5/SLF5
machine with openssl 0.9.8e, though, right? At least I&#39;m getting the
same error when I run from our last remaining RHEL5 machine. When I run
this from a RHEL6 machine with openssl 1.0.1e installed, then I get
different errors&#58;

----
[hs@osgitb1 ~]$ openssl s_client -connect voms.dosar.org&#58;8443 &#62; /dev/null
depth=0 DC = com, DC = DigiCert-Grid, O = Open Science Grid, OU =
Services, CN = http/voms.dosar.org
verify error&#58;num=20&#58;unable to get local issuer certificate
verify return&#58;1
depth=0 DC = com, DC = DigiCert-Grid, O = Open Science Grid, OU =
Services, CN = http/voms.dosar.org
verify error&#58;num=27&#58;certificate not trusted
verify return&#58;1
depth=0 DC = com, DC = DigiCert-Grid, O = Open Science Grid, OU =
Services, CN = http/voms.dosar.org
verify error&#58;num=21&#58;unable to verify the first certificate
verify return&#58;1
140716037592904&#58;error&#58;14094412&#58;SSL routines&#58;SSL3_READ_BYTES&#58;sslv3 alert
bad certificate&#58;s3_pkt.c&#58;1259&#58;SSL alert number 42
140716037592904&#58;error&#58;140790E5&#58;SSL routines&#58;SSL23_WRITE&#58;ssl handshake
failure&#58;s23_lib.c&#58;184&#58;
----

But they&#39;re not fatal, I get lots of output afterwards. And when I run
the same command against the OSGEDU VOMS server, which does work fine --
i.e., I can get myself a voms-proxy from it without errors -- I&#39;m
getting the exact same non-fatal errors&#58;
<div id='show_407660923' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_407660923'>
----
[hs@osgitb1 ~]$ openssl s_client -connect voms.grid.iu.edu&#58;8443 &#62; /dev/null
depth=0 DC = com, DC = DigiCert-Grid, O = Open Science Grid, OU =
Services, CN = http/voms.grid.iu.edu
verify error&#58;num=20&#58;unable to get local issuer certificate
verify return&#58;1
depth=0 DC = com, DC = DigiCert-Grid, O = Open Science Grid, OU =
Services, CN = http/voms.grid.iu.edu
verify error&#58;num=27&#58;certificate not trusted
verify return&#58;1
depth=0 DC = com, DC = DigiCert-Grid, O = Open Science Grid, OU =
Services, CN = http/voms.grid.iu.edu
verify error&#58;num=21&#58;unable to verify the first certificate
verify return&#58;1
139977126045512&#58;error&#58;14094412&#58;SSL routines&#58;SSL3_READ_BYTES&#58;sslv3 alert
bad certificate&#58;s3_pkt.c&#58;1259&#58;SSL alert number 42
139977126045512&#58;error&#58;140790E5&#58;SSL routines&#58;SSL23_WRITE&#58;ssl handshake
failure&#58;s23_lib.c&#58;184&#58;
----

And I&#39;m getting the equivalent output afterwards there, too. So I don&#39;t
think this particular test is getting us anywhere -- but we need to find
one that does!

Wait -- I just tried these same tests from our RHEL5 machine, and the
results there are different between the two VOMS servers. They both
fail, but against the OSGEDU server, I get a little further before it exits&#58;

----
[hs@ouhep5 ~]$ openssl s_client -connect voms.dosar.org&#58;8443
CONNECTED(00000003)
3144&#58;error&#58;14077410&#58;SSL routines&#58;SSL23_GET_SERVER_HELLO&#58;sslv3 alert
handshake failure&#58;s23_clnt.c&#58;586&#58;
----
[hs@ouhep5 ~]$ openssl s_client -connect voms.grid.iu.edu&#58;8443
CONNECTED(00000003)
depth=0 /DC=com/DC=DigiCert-Grid/O=Open Science
Grid/OU=Services/CN=http/voms.grid.iu.edu
verify error&#58;num=20&#58;unable to get local issuer certificate
verify return&#58;1
depth=0 /DC=com/DC=DigiCert-Grid/O=Open Science
Grid/OU=Services/CN=http/voms.grid.iu.edu
verify error&#58;num=27&#58;certificate not trusted
verify return&#58;1
depth=0 /DC=com/DC=DigiCert-Grid/O=Open Science
Grid/OU=Services/CN=http/voms.grid.iu.edu
verify error&#58;num=21&#58;unable to verify the first certificate
verify return&#58;1
3146&#58;error&#58;14094412&#58;SSL routines&#58;SSL3_READ_BYTES&#58;sslv3 alert bad
certificate&#58;s3_pkt.c&#58;1092&#58;SSL alert number 42
3146&#58;error&#58;140790E5&#58;SSL routines&#58;SSL23_WRITE&#58;ssl handshake
failure&#58;s23_lib.c&#58;188&#58;
----

Does this tell anyone anything?

Thanks a lot,

Horst
</div><script type='text/javascript'>
        $('#show_407660923').click(function() {
            $('#detail_407660923').slideDown("normal");
            $('#show_407660923').hide();
            $('#hide_407660923').show();
        });
        $('#hide_407660923').click(function() {
            $('#detail_407660923').slideUp();
            $('#hide_407660923').hide();
            $('#show_407660923').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23879#1437505091'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-21T18:58:11+00:00">Jul 21, 2015 06:58 PM UTC</time> by <b>Dave Dykstra</b><a class="anchor" name="1437505091">&nbsp;</a></div><pre>It&#39;s clearly something on the server side configuration and unfortunately I don&#39;t know much about the server side.  It may be a little helpful to try these client commands&#58;
$ openssl s_client -connect voms.dosar.org&#58;8443
CONNECTED(00000003)
2918&#58;error&#58;14077410&#58;SSL routines&#58;SSL23_GET_SERVER_HELLO&#58;sslv3 alert handshake failure&#58;s23_clnt.c&#58;586&#58;
$ openssl s_client -ssl3 -connect voms.dosar.org&#58;8443
CONNECTED(00000003)
2951&#58;error&#58;1408F10B&#58;SSL routines&#58;SSL3_GET_RECORD&#58;wrong version number&#58;s3_pkt.c&#58;281&#58;
$ openssl s_client -tls1 -connect voms.dosar.org&#58;8443
CONNECTED(00000003)
3636&#58;error&#58;14094410&#58;SSL routines&#58;SSL3_READ_BYTES&#58;sslv3 alert handshake failure&#58;s3_pkt.c&#58;1092&#58;SSL alert number 40
3636&#58;error&#58;1409E0E5&#58;SSL routines&#58;SSL3_WRITE_BYTES&#58;ssl handshake failure&#58;s3_pkt.c&#58;536&#58;

I suggest consulting somebody familiar with voms server administration, maybe ask on osg-software.</pre></div><div class='update_description'><i onclick="document.location='23879#1437500186'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-21T17:36:26+00:00">Jul 21, 2015 05:36 PM UTC</time> by <b>Suchandra Thapa</b><a class="anchor" name="1437500186">&nbsp;</a></div><pre>Adding Dave,

Dave, do you have any suggestions or hints for this?

Suchandra</pre></div><div class='update_description'><i onclick="document.location='23879#1437423858'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-20T20:24:18+00:00">Jul 20, 2015 08:24 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1437423858">&nbsp;</a></div><pre>Hi Suchandra,

okay, I looked, and the fetch-crl service is running, and I even ran it
again just for good measure, and as expected, that didn&#39;t change the error.

So I&#39;m afraid we need to bump this up to the experts who know how to
debug such an obscure SSL error.

Thanks,

Horst</pre></div><div class='update_description'><i onclick="document.location='23879#1437414369'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-20T17:46:09+00:00">Jul 20, 2015 05:46 PM UTC</time> by <b>Suchandra Thapa</b><a class="anchor" name="1437414369">&nbsp;</a></div><pre>If you don&#39;t have CRLs or expired CRLs, you&#39;ll sometimes get handshake issues since the client or server can&#39;t verify that the certs it&#39;s getting aren&#39;t authentic.

Suchandra</pre></div><div class='update_description'><i onclick="document.location='23879#1437409356'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-20T16:22:36+00:00">Jul 20, 2015 04:22 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1437409356">&nbsp;</a></div><pre>Hi Suchandra,

I&#39;ll try that this afternoon, but I very much doubt that any kind of
CA or CRL issue would cause such SSL errors. That would cause obvious
expiration errors, wouldn&#39;t you think?

Thanks,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23879#1437408429'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-20T16:07:09+00:00">Jul 20, 2015 04:07 PM UTC</time> by <b>Suchandra Thapa</b><a class="anchor" name="1437408429">&nbsp;</a></div><pre>Hi,

Do you have up to date CRLs on both machines?  If not or if you&#39;re unsure, can you try running fetch-crl on both machines and then try this again?

Suchandra</pre></div><div class='update_description'><i onclick="document.location='23879#1437145129'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-17T14:58:49+00:00">Jul 17, 2015 02:58 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1437145129">&nbsp;</a></div><pre>Reaching out to the software team.</pre></div><div class='update_description'><i onclick="document.location='23879#1436816413'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-13T19:40:13+00:00">Jul 13, 2015 07:40 PM UTC</time><a class="anchor" name="1436816413">&nbsp;</a></div><pre>Hi Vince,
well, I added the &#39;sslEnabledProtocols=&#34;TLSv1&#34;&#39; and restarted both tomcat6 and voms, but that didn&#39;t seem to make a difference, I&#39;m still getting the same error on voms-proxy-init&#58;

----
Contacting  voms.dosar.org&#58;15000 [/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=voms.dosar.org] &#34;dosar&#34; Failed

Error&#58; Error during SSL handshake&#58;error&#58;14094410&#58;SSL routines&#58;SSL3_READ_BYTES&#58;sslv3 alert handshake failure&#58;s3_pkt.c&#58;1259SSL alert number 40
sslv3 alert handshake failureSSL alert number 40
Function&#58; SSL3_READ_BYTES
----

What else can we look at? Here are the versions we are currently running, just in case that makes a difference&#58;

osg-voms-3.0.0-2
voms-2.0.12-1
voms-admin-client-2.0.17-1
voms-admin-server-2.7.0-1.5
voms-clients-2.0.12-1
voms-mysql-plugin-3.1.6-1.1
voms-server-2.0.12-1
emi-trustmanager-tomcat-3.0.0-8
tomcat6-6.0.24-62
tomcat6-el-2.1-api-6.0.24-62
tomcat6-jsp-2.1-api-6.0.24-62
tomcat6-lib-6.0.24-62
tomcat6-servlet-2.5-api-6.0.24-62
openssl-1.0.1e-30.el6.8
openssl-devel-1.0.1e-30.el6.8
pyOpenSSL-0.10-2

Thanks,

Horst

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27</pre></div><div class='update_description'><i onclick="document.location='23879#1436805498'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-13T16:38:18+00:00">Jul 13, 2015 04:38 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1436805498">&nbsp;</a></div><pre>Hi Vince,

okay, I&#39;ll try that this afternoon!

Thanks,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23879#1436801732'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-13T15:35:32+00:00">Jul 13, 2015 03:35 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1436801732">&nbsp;</a></div><pre>Horst,

There only difference I have noted in the configuration files is in the tomcat configuration file&#58; server.xml
The DOSAR configuration file is&#58;
clientAuth=&#34;true&#34; sslProtocol=&#34;TLS&#34;

and documentation says it should be&#58;
clientAuth=&#34;true&#34; sslProtocol=&#34;TLS&#34; sslEnabledProtocols=&#34;TLSv1&#34;

In the log file voms.dosar I see a lot of&#58;
Fri Jul 10 09&#58;26&#58;10 2015&#58;voms.dosar.org&#58;vomsd[20481]&#58; msg=&#34;LOG_INFO&#58;REQUEST&#58;AcceptGSIAuthentication (Server.cpp&#58;431)&#58;Error enstabilishing SSL context.&#34;
Fri Jul 10 09&#58;26&#58;10 2015&#58;voms.dosar.org&#58;vomsd[20481]&#58; msg=&#34;LOG_INFO&#58;REQUEST&#58;Run (vomsd.cc&#58;788)&#58;Failed to authenticate peer.&#34;
Fri Jul 10 09&#58;26&#58;10 2015&#58;voms.dosar.org&#58;vomsd[20481]&#58; msg=&#34;LOG_INFO&#58;REQUEST&#58;Run (vomsd.cc&#58;789)&#58;Error&#58; SSL Handshake error&#58;error&#58;1408A0C1&#58;SSL routines&#58;SSL3_GET_CLIENT_HELLO&#58;no shared cipher&#34;

Please let me know if you can make the change for server.xml

Thanks!
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1436559342'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-10T20:15:42+00:00">Jul 10, 2015 08:15 PM UTC</time><a class="anchor" name="1436559342">&nbsp;</a></div><pre>Okay,

I uploaded the other files.

Thanks,

Horst

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27</pre></div><div class='update_description'><i onclick="document.location='23879#1436539670'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-10T14:47:50+00:00">Jul 10, 2015 02:47 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1436539670">&nbsp;</a></div><pre>Thanks, Horst,

You are correct, error 40 is definitely the major issue.  I&#39;m afraid I am short on answers for now but must request a few more log files.

/var/log/tomcat6/trustmanager.log
/var/log/tomcat6/voms-admin-VO_NAME.log
/var/log/tomcat6/catalina.out
/var/log/voms/voms.VO_NAME
/etc/voms-admin/VO_NAME/logback.runtime.xml

----
Error&#58; Error during SSL handshake&#58;error&#58;14094410&#58;SSL routines&#58;SSL3_READ_BYTES&#58;sslv3 alert handshake failure&#58;s3_pkt.c&#58;1259SSL alert number 40
sslv3 alert handshake failureSSL alert number 40
Function&#58; SSL3_READ_BYTES
----

Thank you very much,
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1436471523'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-09T19:52:03+00:00">Jul 9, 2015 07:52 PM UTC</time><a class="anchor" name="1436471523">&nbsp;</a></div><pre>Hi Vince,

okay, I just attached server.xml. It says

sslProtocol=&#34;TLS&#34;
protocols=&#34;TLSv1.1,TLSv1.2&#34;

Does that help?

Thanks a lot,

Horst

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27</pre></div><div class='update_description'><i onclick="document.location='23879#1436456147'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-09T15:35:47+00:00">Jul 9, 2015 03:35 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1436456147">&nbsp;</a></div><pre>Thanks, Horst.

I&#39;m still looking into your questions below.  The Tomcat file I&#39;m looking for is&#58;  /etc/tomcat[56]/server.xml
This will let me check if SSL3 is disabled/bypassed.

Thank you,
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1436382466'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-08T19:07:46+00:00">Jul 8, 2015 07:07 PM UTC</time><a class="anchor" name="1436382466">&nbsp;</a></div><pre>Hi Vince,

okay, I just went into virtmanager and restarted the mysql, tomcat6, and voms services on voms.dosar.org, and now the web interface seems to be working again&#58;

<a href='https&#58;//voms.dosar.org&#58;8443/voms/dosar/' target='_blank' rel='nofollow'>https&#58;//voms.dosar.org&#58;8443/voms/dosar/</a>

The VOMSAdmin link,

<a href='https&#58;//voms.dosar.org&#58;8443/voms/dosar/services/VOMSAdmin' target='_blank' rel='nofollow'>https&#58;//voms.dosar.org&#58;8443/voms/dosar/services/VOMSAdmin</a>

gives me some text about AXIS, but no error, so I take it that&#39;s okay as well? Or is that supposed to return something else?

I&#39;m pretty sure the DOSAR VO Package Information is correct, since that hasn&#39;t changed in a very long time. Unless some RPM package updates recently required this info to change?

However, running edg-mkgridmap by hand, I&#39;m getting this error in /var/log/edg-mkgridmap.log&#58;

voms search(<a href='https&#58;//voms.dosar.org&#58;8443/voms/dosar/services/VOMSCompatibility?method=getGridmapUsers' target='_blank' rel='nofollow'>https&#58;//voms.dosar.org&#58;8443/voms/dosar/services/VOMSCompatibility?method=getGridmapUsers</a>)&#58; Not Found

What does that mean? Is there a way to dial up the verbosity of this error, so we can figure out if it&#39;s related to the same error we&#39;re getting with voms-proxy-init?
That&#39;s now the same SSL handshake error again as it was before&#58;

----
Error&#58; Error during SSL handshake&#58;error&#58;14094410&#58;SSL routines&#58;SSL3_READ_BYTES&#58;sslv3 alert handshake failure&#58;s3_pkt.c&#58;1259SSL alert number 40
sslv3 alert handshake failureSSL alert number 40
Function&#58; SSL3_READ_BYTES
----

So I think that&#39;s the real problem we need to address ... but how?

I still don&#39;t understand why the web interface seems to be working just fine, but voms-proxy-init and edg-mkgridmap are throwing errors. Does anyone know what&#39;s different about these?

I have attached most of the conf files you requested to this ticket. What files exactly would you like in /etc/tomcat6/? There are quite a few ...

I&#39;ll let Andrew answer about the tests, since I&#39;m not familiar with the voms commands at all, so I&#39;d rather not mess something up here ...

<div id='show_2072975051' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_2072975051'>Thanks a lot,

Horst

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27
</div><script type='text/javascript'>
        $('#show_2072975051').click(function() {
            $('#detail_2072975051').slideDown("normal");
            $('#show_2072975051').hide();
            $('#hide_2072975051').show();
        });
        $('#hide_2072975051').click(function() {
            $('#detail_2072975051').slideUp();
            $('#hide_2072975051').hide();
            $('#show_2072975051').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23879#1436372499'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-08T16:21:39+00:00">Jul 8, 2015 04:21 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1436372499">&nbsp;</a></div><pre>Andrew,

Additionally, here are some tests for verification you can run locally to determine the status of various VOMS services/components.
<a href='https&#58;//twiki.opensciencegrid.org/bin/view/Documentation/Release3/UpgradeVomsService#Test' target='_blank' rel='nofollow'>https&#58;//twiki.opensciencegrid.org/bin/view/Documentation/Release3/UpgradeVomsService#Test</a>

Thank you,
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1436372285'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-08T16:18:05+00:00">Jul 8, 2015 04:18 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1436372285">&nbsp;</a></div><pre>Good afternoon,

I would also like to verify the VO Package Information for DOSAR&#58;

VOMSDIR&#58;
voms.dosar.org.lsc
/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=voms.dosar.org
/DC=com/DC=DigiCert-Grid/O=DigiCert Grid/CN=DigiCert Grid CA-1

edg-mkgridmap.config
#-------------------
# USER-VO-MAP dosar DOSAR -- 14 -- Horst Severini (hs@....)
group vomss&#58;//voms.dosar.org&#58;8443/voms/dosar dosar
#-------------------

gums.template
&#60;!-- 14 DOSAR --&#62;
&#60;groupMapping name=&#39;dosar&#39; accountingVo=&#39;dosar&#39; accountingDesc=&#39;DOSAR&#39;&#62;
&#60;userGroup className=&#39;gov.bnl.gums.VOMSGroup&#39;
url=&#39;<a href='https&#58;//voms.dosar.org&#58;8443/voms/dosar/services/VOMSAdmin&#39' target='_blank' rel='nofollow'>https&#58;//voms.dosar.org&#58;8443/voms/dosar/services/VOMSAdmin&#39</a>;
persistenceFactory=&#39;mysql&#39;
name=&#39;dosar&#39;
voGroup=&#34;/dosar&#34;
sslCertfile=&#39;/etc/grid-security/http/httpcert.pem&#39;
sslKey=&#39;/etc/grid-security/http/httpkey.pem&#39;
matchFQAN=&#34;vo&#34; acceptProxyWithoutFQAN=&#39;true&#39; /&#62;
&#60;accountMapping className=&#39;gov.bnl.gums.GroupAccountMapper&#39; groupName=&#39;dosar&#39; /&#62;
&#60;/groupMapping&#62;

VOMSES
&#34;dosar&#34; &#34;voms.dosar.org&#34; &#34;15000&#34; &#34;/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=voms.dosar.org&#34; &#34;dosar&#34;

Could you provide the contents of the following log files and attach them to the ticket?
voms
/etc/voms/VO_NAME/voms.conf
<div id='show_444010165' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_444010165'>
voms-admin
/etc/voms-admin/VO_NAME/voms-admin-dosar.xml
/etc/voms-admin/VO_NAME/voms.service.properties

MYSQL
/etc/my.cnf

Tomcat Configuration&#58;
EL5&#58; /etc/tomcat5/
ELG6&#58; /etc/tomcat6/

Thanks!
Vince
</div><script type='text/javascript'>
        $('#show_444010165').click(function() {
            $('#detail_444010165').slideDown("normal");
            $('#show_444010165').hide();
            $('#hide_444010165').show();
        });
        $('#hide_444010165').click(function() {
            $('#detail_444010165').slideUp();
            $('#hide_444010165').hide();
            $('#show_444010165').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23879#1436370478'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-08T15:47:58+00:00">Jul 8, 2015 03:47 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1436370478">&nbsp;</a></div><pre>Andrew/Horst,

Can you take a look at the VOMS portal when you get a moment?  It appears the Membership Services (VOMS) URL is unresponsive (or maybe incorrect?)

<a href='https&#58;//voms.dosar.org&#58;8443/voms/dosar/services/VOMSAdmin' target='_blank' rel='nofollow'>https&#58;//voms.dosar.org&#58;8443/voms/dosar/services/VOMSAdmin</a>

<a href='https&#58;//oim.grid.iu.edu/oim/voedit?id=6' target='_blank' rel='nofollow'>https&#58;//oim.grid.iu.edu/oim/voedit?id=6</a>

Thanks!
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1436275880'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-07T13:31:20+00:00">Jul 7, 2015 01:31 PM UTC</time><a class="anchor" name="1436275880">&nbsp;</a></div><pre>Hi Kyle,

ah, I see. I guess I should update our osg-client tarball ... &#58;)

The question is, why is it now giving me the same SSL error as the DOSAR VOMS server -- i.e., is it because of the same condition, or because of some other (possibly permission denied) reason related to the fact that it&#39;s been retired for ATLAS ...

I think it&#39;s at least worth looking into, just in case it&#39;s the same error and we can figure out how to fix it by comparing the two ...

Thanks a lot,

Horst

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27</pre></div><div class='update_description'><i onclick="document.location='23879#1436272896'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-07T12:41:36+00:00">Jul 7, 2015 12:41 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1436272896">&nbsp;</a></div><pre>Horst,

vo.racf.bnl.gov is only used for the Star VO now.  It was removed from the vomses file for ATLAS in May.

-Kyle</pre></div><div class='update_description'><i onclick="document.location='23879#1436199139'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-06T16:12:19+00:00">Jul 6, 2015 04:12 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1436199139">&nbsp;</a></div><pre>Hi Kyle,

well, I can tell you that the error is still there. &#58;)

I noticed earlier today that the BNL ATLAS VOMS server reports
the same error, so I&#39;m wondering if it has the same issue,
or if it&#39;s just a coincidence?

----
Contacting  voms.dosar.org&#58;15000 [/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=voms.dosar.org] &#34;dosar&#34; Failed
Error&#58; Error during SSL handshake&#58;

None of the contacted servers for dosar were capable
of returning a valid AC for the user.
----
Contacting  vo.racf.bnl.gov&#58;15003 [/DC=org/DC=doegrids/OU=Services/CN=vo.racf.bnl.gov] &#34;atlas&#34; Failed
Error&#58; Error during SSL handshake&#58;

Trying next server for atlas.
Creating temporary proxy to /tmp/tmp_x509up_u1502_27850 ............++++++
.....................++++++
Done
Contacting  lcg-voms2.cern.ch&#58;15001 [/DC=ch/DC=cern/OU=computers/CN=lcg-voms2.cern.ch] &#34;atlas&#34; Done
Creating proxy to /tmp/x509up_u1502 ........................++++++
..........++++++
Done
----

John, do you know more about this? Or is vo.racf.bnl.gov not even
supposed to be active anymore, and should be removed from /etc/vomses?

Thanks,

Horst

<div id='show_102697549' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_102697549'>Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_102697549').click(function() {
            $('#detail_102697549').slideDown("normal");
            $('#show_102697549').hide();
            $('#hide_102697549').show();
        });
        $('#hide_102697549').click(function() {
            $('#detail_102697549').slideUp();
            $('#hide_102697549').hide();
            $('#show_102697549').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23879#1436198335'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-07-06T15:58:55+00:00">Jul 6, 2015 03:58 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1436198335">&nbsp;</a></div><pre>Andrew,

Are there any updates with regards to this?

-Kyle</pre></div><div class='update_description'><i onclick="document.location='23879#1435697424'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-30T20:50:24+00:00">Jun 30, 2015 08:50 PM UTC</time> by <b>adt027@....</b><a class="anchor" name="1435697424">&nbsp;</a></div><pre>I&#39;ve only recently started working again, so no.

However I will be continuing this task and will take a look and send an
update tomorrow morning.
On Tue, Jun 30, 2015 at 15&#58;43 Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62;  [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23879#1435696969'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-30T20:42:49+00:00">Jun 30, 2015 08:42 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1435696969">&nbsp;</a></div><pre>Andrew,

Have you had a chance to look at this?

-Kyle</pre></div><div class='update_description'><i onclick="document.location='23879#1433976973'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-10T22:56:13+00:00">Jun 10, 2015 10:56 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1433976973">&nbsp;</a></div><pre>Hi Vince,

I&#39;m on vacation in England till the 22nd, but hopefully Andrew will have
some time, since you&#39;re right, we really need to get this resolved.

Thanks a lot,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23879#1433969426'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-10T20:50:26+00:00">Jun 10, 2015 08:50 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1433969426">&nbsp;</a></div><pre>Hi Andrew,

Have you had an opportunity to review this issue further?
If it would help we can join a conference call or video chat to try to resolve this.
Please advise.

Thanks!
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1433261234'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-02T16:07:14+00:00">Jun 2, 2015 04:07 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1433261234">&nbsp;</a></div><pre>Hi Elizabeth,

ah, thanks. Well, I&#39;m in this workshop all week, so I don&#39;t think
I&#39;ll have time to look at this at the moment.

Hopefully Andrew will find some time.

Thanks,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23879#1433258932'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-02T15:28:52+00:00">Jun 2, 2015 03:28 PM UTC</time> by <b>echism</b><a class="anchor" name="1433258932">&nbsp;</a></div><pre>Hey Horst,

Catalina.out is generally the noisiest and most useful log for VOMS stuff. Did you already look there?

Thank you</pre></div><div class='update_description'><i onclick="document.location='23879#1432330297'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-05-22T21:31:37+00:00">May 22, 2015 09:31 PM UTC</time><a class="anchor" name="1432330297">&nbsp;</a></div><pre>Hi Vince,

I think Andrew is in the middle of his finals and graduation right now. He gave me root access to the virtual host voms.dosar.org, and I had a look around, but it&#39;s not entirely clear to me what&#39;s going on, since I wasn&#39;t involved in the setup of that machine, nor have I ever dealt with any VOMS installation at all.

I can see that the service voms is stopped, so I tried to start it, but I got a mysql error, and starting mysql wasn&#39;t working because it claimed it was already running.

Okay, I went back through Andrew&#39;s command line history, and he deleted the mysql.sock file, so I did that, too, and then I could start that, and then voms, and then I restarted tomcat6, since the web interface was still not working, and now that&#39;s working again, too -- but we&#39;re still getting this SSL handshake&#58;error.

I&#39;m not sure where to look next. I verified that the vomses file is okay, as well as our edg-mkgridmap.conf -- although I don&#39;t think that matters right now, since I don&#39;t believe that&#39;s involved in getting me a voms-proxy, right? Neither would the GUMS config, or would it? GUMS and gridmap would only come into play once we start running something on a CE with a valid proxy, right? But first we need to get a valid proxy ...

Where can we look for more clues as to why we&#39;re getting this SSL error? Would that be coming from tomcat6, or voms, or ...? The fact that the VOMS web interface seems to be perfectly fine again now that I managed to restart it makes me think that the problem isn&#39;t in VOMS per se, but in the SSL auth part, right?

Thanks,

Horst

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27</pre></div><div class='update_description'><i onclick="document.location='23879#1431704022'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-05-15T15:33:42+00:00">May 15, 2015 03:33 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1431704022">&nbsp;</a></div><pre>Hi Andrew,

Have you had an opportunity to check on the information that Horst provided below.
Please let me know if I can assist.

Thanks!
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1431092535'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-05-08T13:42:15+00:00">May 8, 2015 01:42 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1431092535">&nbsp;</a></div><pre>Hi Elizabeth,

yes, it&#39;s still not working&#58;

<a href='https&#58;//voms.dosar.org&#58;8443/voms/dosar' target='_blank' rel='nofollow'>https&#58;//voms.dosar.org&#58;8443/voms/dosar</a>

Andrew changed something last week, which broke the web interface,
and didn&#39;t help voms-proxy-init, either. &#58;)

Andrew, could you please have another look at this?

Thanks a lot,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23879#1431092070'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-05-08T13:34:30+00:00">May 8, 2015 01:34 PM UTC</time> by <b>echism</b><a class="anchor" name="1431092070">&nbsp;</a></div><pre>Hey all,

The web interface for voms still seems to be down unless I&#39;m going to the wrong place. Please check out your tomcat logs for clues when you are able. If you see anything mysterious in there, we&#39;ll be happy to parse through it with you.</pre></div><div class='update_description'><i onclick="document.location='23879#1429590430'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-04-21T04:27:10+00:00">Apr 21, 2015 04:27 AM UTC</time> by <b>adt027@....</b><a class="anchor" name="1429590430">&nbsp;</a></div><pre>The file vomses contains the line below&#58;

&#34;dosar&#34; &#34;voms.dosar.org&#34; &#34;15000&#34; &#34;/DC=com/DC=DigiCert-Grid/O=Open Science
Grid/OU=Services/CN=http/voms.dosar.org&#34; &#34;dosar&#34;

On Fri, Apr 17, 2015 at 9&#58;45 AM Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62;  [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23879#1429281858'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-04-17T14:44:18+00:00">Apr 17, 2015 02:44 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1429281858">&nbsp;</a></div><pre>Hi Andrew,

Have you had an opportunity to review the request from Horst?
Please let me know if I can assist.

Thank you,
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1428933656'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-04-13T14:00:56+00:00">Apr 13, 2015 02:00 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1428933656">&nbsp;</a></div><pre>Hi Andrew,

thanks. I don&#39;t think attachments make it through the ticketing system,
though, so if you can&#39;t cut and paste, could you please go to

<a href='23879.html' target='_blank' rel='nofollow'>https&#58;//ticket.opensciencegrid.org/23879</a>

and attach the pictures there?

Thanks a lot,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23879#1428931631'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-04-13T13:27:11+00:00">Apr 13, 2015 01:27 PM UTC</time> by <b>adt027@....</b><a class="anchor" name="1428931631">&nbsp;</a></div><pre>This is from vomses on voms-dosar
I&#39;m using virt-manager to access our VOMS server so I can&#39;t copy/paste. I
hope you don&#39;t mind photos....

gums.config.template on gums.hpc.latech.edu&#58;
There is no gums information on voms-dosar
*                &#60;vomsUserGroup*
*                        name=&#39;dosar&#39;*
*                        access=&#39;read self&#39;*
*                        description=&#39;&#39;*
*                        vomsServer=&#39;dosar&#39;*
*                        matchFQAN=&#39;vo&#39;*
*                        acceptProxyWithoutFQAN=&#39;true&#39;*
*                        voGroup=&#39;/dosar&#39;/&#62;*

From&#58; edg-mkgridmap.config&#58;

I don&#39;t know where this is, however there exist no
/etc/edg-mkgridmap.config on voms-dosar.

On Thu, Apr 9, 2015 at 1&#58;40 PM Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62;  [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23879#1428343995'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-04-06T18:13:15+00:00">Apr 6, 2015 06:13 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1428343995">&nbsp;</a></div><pre>Hi Vance,

thanks for the suggestions. Andrew, Dilip, Chris, could you please look
at the VOMS server settings and verify that this is indeed all set the
way it should be?

I tried to ssh into voms.dosar.org, but I can&#39;t. Do I have a login
there? If so, can you please remind me of the correct procedure to log
in there?

By the way&#58; the web interface,

<a href='https&#58;//voms.dosar.org&#58;8443/voms/dosar' target='_blank' rel='nofollow'>https&#58;//voms.dosar.org&#58;8443/voms/dosar</a>

now seems to be working again, which didn&#39;t a few days ago, it gave me
some apache error. So we&#39;re definitely making progress! Now all we need
to do is to solve this openssl error! &#58;)

Thanks a lot,

Horst

On 04/06/2015 11&#58;47 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23879#1428338832'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-04-06T16:47:12+00:00">Apr 6, 2015 04:47 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1428338832">&nbsp;</a></div><pre>Greetings,

I would like to verify some configuration/settings.  Can anyone verify the following?

From&#58; edg-mkgridmap.config
# USER-VO-MAP dosar DOSAR -- 14 -- Horst Severini (hs@....)
group vomss&#58;//voms.dosar.org&#58;8443/voms/dosar dosar

From OIM&#58; (Membership Services (VOMS) URL)
<a href='https&#58;//voms.dosar.org&#58;8443/voms/dosar/services/VOMSAdmin' target='_blank' rel='nofollow'>https&#58;//voms.dosar.org&#58;8443/voms/dosar/services/VOMSAdmin</a>

From GUMS template&#58;
&#60;!-- 14 DOSAR --&#62;
&#60;groupMapping name=&#39;dosar&#39; accountingVo=&#39;dosar&#39; accountingDesc=&#39;DOSAR&#39;&#62;
&#60;userGroup className=&#39;gov.bnl.gums.VOMSGroup&#39;
url=&#39;<a href='https&#58;//voms.dosar.org&#58;8443/voms/dosar/services/VOMSAdmin&#39' target='_blank' rel='nofollow'>https&#58;//voms.dosar.org&#58;8443/voms/dosar/services/VOMSAdmin&#39</a>;
persistenceFactory=&#39;mysql&#39;
name=&#39;dosar&#39;
voGroup=&#34;/dosar&#34;
sslCertfile=&#39;/etc/grid-security/http/httpcert.pem&#39;
sslKey=&#39;/etc/grid-security/http/httpkey.pem&#39;
matchFQAN=&#34;vo&#34; acceptProxyWithoutFQAN=&#39;true&#39; /&#62;
&#60;accountMapping className=&#39;gov.bnl.gums.GroupAccountMapper&#39; groupName=&#39;dosar&#39; /&#62;
&#60;/groupMapping&#62;

from vomeses&#58;
&#34;dosar&#34; &#34;voms.dosar.org&#34; &#34;15000&#34; &#34;/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=voms.dosar.org&#34; &#34;dosar&#34;

Thanks!
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1428093623'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-04-03T20:40:23+00:00">Apr 3, 2015 08:40 PM UTC</time><a class="anchor" name="1428093623">&nbsp;</a></div><pre>Hi all,

we are still having problems with the DOSAR VOMS server, even after disabling SSL3 and updating to the latest version, so we&#39;d like to re-open this ticket to get this solved finally. We&#39;re still seeing the following error&#58;

----
[hs@ouhep6 ~]$ voms-proxy-init -voms dosar
Enter GRID pass phrase&#58;
Your identity&#58; /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27
Creating temporary proxy ........................................... Done
Contacting  voms.dosar.org&#58;15000 [/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=voms.dosar.org] &#34;dosar&#34; Failed

Error&#58; Error during SSL handshake&#58;error&#58;14094410&#58;SSL routines&#58;SSL3_READ_BYTES&#58;sslv3 alert handshake failure&#58;s3_pkt.c&#58;1259SSL alert number 40
sslv3 alert handshake failureSSL alert number 40
Function&#58; SSL3_READ_BYTES
None of the contacted servers for dosar were capable
of returning a valid AC for the user.
----

What can we do to figure this out?

Thanks a lot,

Horst

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Horst Severini 27</pre></div><div class='update_description'><i onclick="document.location='23879#1427220599'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-24T18:09:59+00:00">Mar 24, 2015 06:09 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1427220599">&nbsp;</a></div><pre>Closing as abandoned.</pre></div><div class='update_description'><i onclick="document.location='23879#1426615361'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-17T18:02:41+00:00">Mar 17, 2015 06:02 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1426615361">&nbsp;</a></div><pre>Good afternoon,

Checking in to see if this issue is still active or has been abandoned.  Please advise.

Thanks!
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1425911199'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-09T14:26:39+00:00">Mar 9, 2015 02:26 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1425911199">&nbsp;</a></div><pre>Good morning,

Checking in to see if I can assist with this ticket.  If I can assist please let me know.

Thanks!
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1425316389'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-03-02T17:13:09+00:00">Mar 2, 2015 05:13 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1425316389">&nbsp;</a></div><pre>Good morning,

Checking in to see if I can assist with this ticket.  If I can assist please let me know.

Thanks!
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1424721461'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-23T19:57:41+00:00">Feb 23, 2015 07:57 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1424721461">&nbsp;</a></div><pre>Hi Andrew,

Have you had a chance to look into this issue further.
If I can assist please let me know.

Thanks!
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1424187098'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-17T15:31:38+00:00">Feb 17, 2015 03:31 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1424187098">&nbsp;</a></div><pre>Hi Andrew,

Just checking in to see if you have had time to look into this or if I can provide any assistance.
Please let me know if I can assist.

Thanks!
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1423674622'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-11T17:10:22+00:00">Feb 11, 2015 05:10 PM UTC</time> by <b>adt027@....</b><a class="anchor" name="1423674622">&nbsp;</a></div><pre>Sorry, I had set this task aside due to recent trips. I will try
incorporating the fix and get back to you.
On Wed, Feb 11, 2015 at 4&#58;30 PM Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62;  [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23879#1423515896'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-09T21:04:56+00:00">Feb 9, 2015 09:04 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1423515896">&nbsp;</a></div><pre>Hi Andrew,

Any update on this issue?  If I can assist please let me know.

Thank you,
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1422905739'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-02-02T19:35:39+00:00">Feb 2, 2015 07:35 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1422905739">&nbsp;</a></div><pre>Hi Andrew,

The GOC made some changes to disable the use of SSL3 due to the Poodle Vulnerability (<a href='https&#58;//www.us-cert.gov/ncas/alerts/TA14-290A' target='_blank' rel='nofollow'>https&#58;//www.us-cert.gov/ncas/alerts/TA14-290A</a>)

You will most likely need to update your VOMS installation and follow the section in the below document to disable SSL3 in Tomcat.
<a href='https&#58;//twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallVoms' target='_blank' rel='nofollow'>https&#58;//twiki.grid.iu.edu/bin/view/Documentation/Release3/InstallVoms</a>

Please let me know if I can assist.

Thanks,
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1422627014'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-30T14:10:14+00:00">Jan 30, 2015 02:10 PM UTC</time> by <b>adt027@....</b><a class="anchor" name="1422627014">&nbsp;</a></div><pre>Hi Vince,

I am the contact for DOSAR, however I&#39;m inexperienced with VOMS software
and SSL.

Thanks,

Andrew Touchet
On Thu Jan 29 2015 at 4&#58;35&#58;03 PM Open Science Grid FootPrints &#60;
osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62;  [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23879#1422570844'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-29T22:34:04+00:00">Jan 29, 2015 10:34 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1422570844">&nbsp;</a></div><pre>Hi Andrew,

To my knowledge the DOSAR VOMS is down.  You should reach out to your contact there to inquire about the status.
Please let me know if I can assist.

Thank you,
Vince</pre></div><div class='update_description'><i onclick="document.location='23879#1422474456'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-01-28T19:47:36+00:00">Jan 28, 2015 07:47 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1422474456">&nbsp;</a></div><pre>Hello all,

I have recently renewed the http cert/key, host cert/key, and voms cert/key for the DOSAR voms. Currently when attempting to create a voms proxy, users receive the error below. I am not familiar with SSL, so I hope someone here can help!

bash $ voms-proxy-init -voms dosar
Enter GRID pass phrase for this identity&#58;
Your identity&#58; /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Andrew Touchet 1560
Creating temporary proxy .......................................................................... Done
Contacting  voms.dosar.org&#58;15000 [/DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=voms.dosar.org] &#34;dosar&#34; Failed

Error&#58; Error during SSL handshake&#58;error&#58;14094410&#58;SSL routines&#58;SSL3_READ_BYTES&#58;sslv3 alert handshake failure&#58;s3_pkt.c&#58;1257SSL alert number 40
sslv3 alert handshake failureSSL alert number 40
Function&#58; SSL3_READ_BYTES

None of the contacted servers for dosar were capable
of returning a valid AC for the user.

#####################

Thank you,
Andrew Touchet</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F23879">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 23879});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
