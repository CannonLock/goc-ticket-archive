<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[2289] Nagios alerts showing intermittent failures for iGOC machines</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=2289" method="post">
<div class="page-header">
    <h3><span class="muted">2289</span> / Nagios alerts showing intermittent failures for iGOC machines</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Tim Silvers</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2006-10-03</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
        <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/2289", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/2289?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/2289?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Nagios%20alerts%20showing%20intermittent%20failures%20for%20iGOC%20machines%20ISSUE%3D2289%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='2289#1159885843'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-10-03T14:30:43+00:00">Oct 3, 2006 02:30 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1159885843">&nbsp;</a></div><pre>There has not been a single monitoring failure on funafuti since the IP tables change
was made.

Finally, this ticket can be closed.</pre></div><div class='update_description'><i onclick="document.location='2289#1159281577'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-09-26T14:39:37+00:00">Sep 26, 2006 02:39 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1159281577">&nbsp;</a></div><pre>Forgot to update next action date.</pre></div><div class='update_description'><i onclick="document.location='2289#1159275367'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-09-26T12:56:07+00:00">Sep 26, 2006 12:56 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1159275367">&nbsp;</a></div><pre>Since the last change to nukufetau there has been no failures from that machine.
I&#39;ll make the same changes to funafuti today and if it becomes and stays failure free
for a week I&#39;ll close the ticket.
John</pre></div><div class='update_description'><i onclick="document.location='2289#1158762848'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-09-20T14:34:08+00:00">Sep 20, 2006 02:34 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1158762848">&nbsp;</a></div><pre>It looks like a fix has been found.  This was applied to nui last week and nukufetau
this weekend and neither machine has alarmed since.  There is more documentation to
add to this ticket plus I&#39;d like to monitor for a few more days before closing.</pre></div><div class='update_description'><i onclick="document.location='2289#1158582400'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-09-18T12:26:40+00:00">Sep 18, 2006 12:26 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1158582400">&nbsp;</a></div><pre>John, I&#39;m not sure why this ticket was closed. I reopened it since investigation is ongoing. --Tim</pre></div><div class='update_description'><i onclick="document.location='2289#1158582273'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-09-18T12:24:33+00:00">Sep 18, 2006 12:24 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1158582273">&nbsp;</a></div><pre>**An update was made to this Ticket based on an update made to dynamically-linked Issue #336 in Project System Support**

From&#58; 	  jrosheck@....
Subject&#58; 	meeting on nagios alerts / network issues
Date&#58; 	September 12, 2006 4&#58;28&#58;52 PM EDT
To&#58; 	  leighg@....
Cc&#58; 	  tsilver@....

Hello,

I&#39;d better do this right away before I forget.  There was a lot of ground
covered.  Tim was at the meeting too and will add anything I missed.

Met in 136A at 1&#58;30pm - Luke and Chris were exactly on time.  Got Steve
Peck, Tom Wang, Tim Silvers and John Stigall on the call using the phone
bridge.  Camille joined us later as Steve left.  John was only there until
2pm.

In the first half hour we covered a lot of the same ground covered in my
data.  Compare and contrast the two Nagios failure logs.  I believe we
covered pretty much all the intracacies while John was still there - i.e.
funafuti alerts a lot on both, went away on both when cable swapped with
pacman, pacman cable not in institutional firewall, nui and nukufetau
alert a lot on their Nagios but not on ours.  grid01 and grid03 have
nearly identical hardware and go through the institutional firewall but
don&#39;t alert at all (maybe once a week if that and then only once,
non-critical).

I learned that they (Luke etal) do have a box down here in B&#39;ton that
they monitor up there that also alarms a lot and is also behind the
firewall.  *No* machines not behind the firewall alarm like those (ours
and the one they mentioned, I think).

John seemed to be interested in the problem and I felt that I communicated
the non-deterministic nature of what we were seeing accurately.  We had
<div id='show_1383865074' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1383865074'>Camille get on the call since she was someone who had often seen the
alerts come up and could say whether they appeared in isolation or with
other alerts.  She maintained that they were completely isolated and that
she saw no correlation with other alerts, events, time of day, etc.  Luke
and Chris poked around looking for correlations too but none jumped out to
them.  I&#39;d gone through that before so I didn&#39;t even try -- just poked
holes in the ones they brought up using what I&#39;ve already learned.

Chris repeatedly did telnet&#39;s to the ssh port and eventually got a
connection refused.  That also showed up in funafuti&#39;s logs.  They talked
me into temporarily (about 5 minutes) switching out the iptables and tried
some more - no refusals.  But they kept trying when I reenabled our full
fw ruleset and couldn&#39;t get it to fail again either.  In some way, I tried
to convey that that wasn&#39;t really good enough anyway since we want both
firewalls there.  Also, I explained that while there is usually a logged
entry from iptables when the nagios test fails that isn&#39;t always the case.
I showed them one of the previous runs I had made with tcpdump that
illistrated that point.

We were bounced out of the room right at 2&#58;30pm.  I walked with Chris
and Luke back towards telecomm and talked some more.  I re-iterated the
point that you are very concerned about this, that we have new machines
coming and don&#39;t want to see this continue, that you don&#39;t want me to be
spending a lot of time on it, that I don&#39;t want to see the ops people
desensitized since this is a critical, the most critical, machine.  Also,
that I didn&#39;t want to be experimenting with funafuti in particular.  I
compromised a bit with them in that I offered to set up tcpdump on nui and
that I&#39;d record full packets there and they would set up tcpdump on their
end with full packets logged going to/from nui.  Chris had some ideas
about possible iptables state problems and specific changes to iptables
to test it.  I agreed but now I&#39;m not so happy that I did.  At least, I&#39;m
going to have him write up the rules he wants to test for me.  Pfilter
produces an intermediary file of explicit iptables commands where I can
easily insert the changes he&#39;d like while still keeping everything else
the same.  Let me know if that&#39;s ok with you.

In the end, I think the three of us agreed that there probably isn&#39;t one
specific thing thats wrong but that we&#39;re probably seeing the cumulative
effect of multiple items.  They seemed quite sincere in wanting to solve
it.

But concerning funafuti, I really think we should switch the cables with
pacman again.  The firewall is properly configured for pacman (finally)
and we really shouldn&#39;t have funafuti alarming like it is.  One refused
email could be a multi-hour delay in something quite important and the
ops people should feel confident about jumping to it when it alarms.

John
</div><script type='text/javascript'>
        $('#show_1383865074').click(function() {
            $('#detail_1383865074').slideDown("normal");
            $('#show_1383865074').hide();
            $('#hide_1383865074').show();
        });
        $('#hide_1383865074').click(function() {
            $('#detail_1383865074').slideUp();
            $('#hide_1383865074').hide();
            $('#show_1383865074').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='2289#1156344087'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T14:41:27+00:00">Aug 23, 2006 02:41 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156344087">&nbsp;</a></div><pre>I just checked nagios today and there still have been no failures at all since the
15th of August.  Since its been over a week without any failures, down from a peak of
36 in one day, and lacking any obvious lines of inquiry I think its time to close
this ticket.  There was never any specific problem found.  The one thing
that was done that seems to have had some measurable effect was the bypassing of the
institutional firewall but even that was a mixed result with the failures reduced by
half but still occurring for several days before tapering to none.</pre></div><div class='update_description'><i onclick="document.location='2289#1156343134'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T14:25:34+00:00">Aug 23, 2006 02:25 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156343134">&nbsp;</a></div><pre>Date&#58; Fri, 18 Aug 2006 12&#58;39&#58;02 -0400 (EDT)
From&#58; jrosheck@....
To&#58; Leigh Grundhoefer &#60;leighg@....&#62;
Subject&#58; Re&#58; OSG mail service

Hello,

On Fri, 18 Aug 2006 leighg@.... wrote&#58;

<font color='#7F7E6F'>&#62;    We have been testing and working with Hans to try to identify the</font>
<font color='#7F7E6F'>&#62;    source of the alarms. As a test we have switched the ethernet cable with</font>
<font color='#7F7E6F'>&#62;    a known stable host.  Since that time we have not logged any problems</font>
<font color='#7F7E6F'>&#62;    and it does seem like the problem followed the wire although it may</font>
<font color='#7F7E6F'>&#62;    be too soon to tell.</font>

When I read that, I had to disagree with the use of &#34;not logged any&#34; -
because I know I&#39;ve seen some.  So on to the quantization &#58;

Fails  SMTP        SSH
Date    S   H       S   H
08/05   6   0       0   0
08/06  24   0       0   0
08/07  22   0       2   0
08/08  30   2       5   0
08/09  28   2       5   0
08/10  36   5       4   0
08/11  19   1       1   0   (cable swap, precisely 2&#58;16EDT)
08/12  13   0       4   0
08/13  15   0       4   0
08/14  14   0       2   0
08/15   2   1       0   0   (a single event from 11&#58;39 to 11&#58;43EDT)
08/16   0   0       0   0
08/17   0   0       0   0
08/18   0   0       0   0

<div id='show_258945830' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_258945830'>Don&#39;t quote me on the exact number since I had to count it by hand.  But
it sure does look like there was a big change on the 11th.  And then
there&#39;s pacman that got that cable, it hasn&#39;t passed ssh since.

John
</div><script type='text/javascript'>
        $('#show_258945830').click(function() {
            $('#detail_258945830').slideDown("normal");
            $('#show_258945830').hide();
            $('#hide_258945830').show();
        });
        $('#hide_258945830').click(function() {
            $('#detail_258945830').slideUp();
            $('#hide_258945830').hide();
            $('#show_258945830').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='2289#1156342844'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T14:20:44+00:00">Aug 23, 2006 02:20 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156342844">&nbsp;</a></div><pre>Date&#58; Wed, 16 Aug 2006 15&#58;11&#58;46 -0400 (EDT)
From&#58; jrosheck@....
To&#58; Hans Addleman &#60;addlema@....&#62;
Subject&#58; Re&#58; FW&#58; System Support&#58; Nagios alerts showing intermittent
failures for iGOC machines ISSUE=336 PROJ=15

Hello,

I&#39;ve had tcpdump running with full packet capture since yesterday - not
one single failure in over 24 hours.  The alerts seem to be fewer and
farther in between all the time.  If there is something more irritating
than random, intermittent failures, its having them slowly improve over
time for no good reason.  I&#39;ll keep monitoring it but it does look more
and more like its internal to the machine.

Should I find something definitive I&#39;ll let you know.  Thanks for the
help.

John</pre></div><div class='update_description'><i onclick="document.location='2289#1156342756'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T14:19:16+00:00">Aug 23, 2006 02:19 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156342756">&nbsp;</a></div><pre>Date&#58; Wed, 16 Aug 2006 14&#58;53&#58;41 -0400
From&#58; Hans Addleman &#60;addlema@....&#62;
To&#58; &#34;Rosheck Jr, John B&#34; &#60;jrosheck@....&#62;
Subject&#58; FW&#58; System Support&#58; Nagios alerts showing intermittent failures
for iGOC machines ISSUE=336 PROJ=15
Parts/Attachments&#58;
1   OK    ~136 lines  Text
2 Shown   ~147 lines  Text
----------------------------------------

The following message is from one of our global noc engineers who also
works with Nagios regularly. He agrees that this is most likely a problem
with the host (funafuti).
------ Forwarded Message
From&#58; Chris Small &#60;chsmall@....&#62;
Date&#58; Wed, 16 Aug 2006 10&#58;47&#58;23 -0400
To&#58; &#60;addlema@....&#62;
Cc&#58; &#60;systems-support@....&#62;
Subject&#58; Re&#58; System Support&#58; Nagios alerts showing intermittent failures
for iGOC machines ISSUE=336 PROJ=15

Nagios has SSH and SNMP plugins that attempt a connection to the relevant
port.��There are also ICMP tests (Nagios &#34;host tests&#34;) for every host as
well. We are not seeing any problems for the ICMP test. Nagios should run
the plugins every 3 minutes.
�
We are seeing failed connections on average about once an hour. SMTP is
showing more &#34;connection refused&#34; than SSH.

The ICMP tests aren&#39;t really aggressive enough to detect loss ( 5 packets
per test) but I haven&#39;t seen any lost packets at all with our tests

Also the outages don&#39;t seem to correspond to any other network issue. We
have a number of other machines behind the Blmt firewall and we conduct
the same tests with no problems. We also are very aware when the Firewall
<div id='show_1296202785' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1296202785'>has issues and these do not correspond to the problems with funafuti.

From the logs in this ticket it seems that this is an issue with filters
on the server.

--chris

Logs for the last day

Service Ok[08-15-2006 12&#58;57&#58;07] SERVICE ALERT&#58; funafuti;SSH;OK;HARD;1;SSH
OK - OpenSSH_4.3 (protocol 2.0)
Service Ok[08-15-2006 12&#58;55&#58;57]�

�ALERT&#58; funafuti;SMTP;OK;HARD;1;SMTP OK - 0.019 sec. response time
Host Up[08-15-2006 12&#58;55&#58;57] HOST ALERT&#58; funafuti;UP;HARD;1;(Host assumed
to be up)
Service Ok[08-15-2006 11&#58;43&#58;17] SERVICE ALERT&#58;
funafuti;SMTP;OK;HARD;2;SMTP OK - 0.014 sec. response time
Service Critical[08-15-2006 11&#58;40&#58;17] SERVICE ALERT&#58;
funafuti;SMTP;CRITICAL;HARD;2;Connection refused
Service Critical[08-15-2006 11&#58;39&#58;17] SERVICE ALERT&#58;
funafuti;SMTP;CRITICAL;SOFT;1;Connection refused
Service Ok[08-14-2006 20&#58;30&#58;17] SERVICE ALERT&#58;
funafuti;SMTP;OK;SOFT;2;SMTP OK - 0.006 sec. response time
Service Critical[08-14-2006 20&#58;29&#58;17] SERVICE ALERT&#58;
funafuti;SMTP;CRITICAL;SOFT;1;Connection refused
Service Ok[08-14-2006 16&#58;59&#58;17] SERVICE ALERT&#58;
funafuti;SMTP;OK;SOFT;2;SMTP OK - 0.012 sec. response time
Service Critical[08-14-2006 16&#58;58&#58;17] SERVICE ALERT&#58;
funafuti;SMTP;CRITICAL;SOFT;1;Connection refused
Service Ok[08-14-2006 16&#58;31&#58;17] SERVICE ALERT&#58;
funafuti;SMTP;OK;SOFT;2;SMTP OK - 0.019 sec. response time
Service Critical[08-14-2006 16&#58;30&#58;17] SERVICE ALERT&#58;
funafuti;SMTP;CRITICAL;SOFT;1;Connection refused
Service Ok[08-14-2006 16&#58;24&#58;17] SERVICE ALERT&#58;
funafuti;SMTP;OK;SOFT;2;SMTP OK - 0.006 sec. response time
Service Critical[08-14-2006 16&#58;23&#58;18] SERVICE ALERT&#58;
funafuti;SMTP;CRITICAL;SOFT;1;Connection refused
Service Ok[08-14-2006 15&#58;02&#58;07] SERVICE ALERT&#58;
funafuti;SMTP;OK;SOFT;2;SMTP OK - 0.013 sec. response time
Service Critical[08-14-2006 15&#58;01&#58;07] SERVICE ALERT&#58;
funafuti;SMTP;CRITICAL;SOFT;1;Connection refused
Service Ok[08-14-2006 14&#58;33&#58;59] SERVICE ALERT&#58; funafuti;SSH;OK;SOFT;2;SSH
OK - OpenSSH_4.3 (protocol 2.0)
Service Critical[08-14-2006 14&#58;32&#58;57] SERVICE ALERT&#58;
funafuti;SSH;CRITICAL;SOFT;1;Connection refused
Service Ok[08-14-2006 13&#58;53&#58;57] SERVICE ALERT&#58; funafuti;SSH;OK;SOFT;2;SSH
OK - OpenSSH_4.3 (protocol 2.0)
Service Critical[08-14-2006 13&#58;53&#58;01] SERVICE ALERT&#58;
funafuti;SSH;CRITICAL;SOFT;1;Connection refused
Service Ok[08-14-2006 13&#58;40&#58;07] SERVICE ALERT&#58;
funafuti;SMTP;OK;SOFT;2;SMTP OK - 0.008 sec. response time
Service Critical[08-14-2006 13&#58;39&#58;07] SERVICE ALERT&#58;
funafuti;SMTP;CRITICAL;SOFT;1;Connection refused
Service Ok[08-14-2006 12&#58;57&#58;07] SERVICE ALERT&#58;
funafuti;SMTP;OK;HARD;1;SMTP OK - 0.006 sec. response time
</div><script type='text/javascript'>
        $('#show_1296202785').click(function() {
            $('#detail_1296202785').slideDown("normal");
            $('#show_1296202785').hide();
            $('#hide_1296202785').show();
        });
        $('#hide_1296202785').click(function() {
            $('#detail_1296202785').slideUp();
            $('#hide_1296202785').hide();
            $('#show_1296202785').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='2289#1156342469'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T14:14:29+00:00">Aug 23, 2006 02:14 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156342469">&nbsp;</a></div><pre>Date&#58; Tue, 15 Aug 2006 16&#58;54&#58;56 -0400 (EDT)
From&#58; jrosheck@....
To&#58; &#34;Addleman, Hans C&#34; &#60;addlema@....&#62;
Subject&#58; RE&#58; IM391714&#58; funafuti.uits.indiana.edu intermetent network
problems

Hello,

I did more packet snaggin&#39; today but only one failure was recorded.  What
follows are the excerpts from the various logs.  The tcpdump command was
tcpdump -i eth0 -w tdfile
and the decomposition was done on a machine set to EDT with the command&#58;
tcpdump -n -vvv -r tdfile (or something very similiar).  I have the entire
36M raw file if you would like to take a look.

As you can see, funafuti just flat out rejects the connection.  I&#39;m
looking farther into it but I still don&#39;t see anything that can cause it.
Also, I set the packet logging to capture full packets from only the
nagios server so there will be more tomorrow.

John

The excerpts &#58;

nagios log &#58;
Service Ok[08-15-2006 11&#58;43&#58;17] SERVICE ALERT&#58; funafuti;SMTP;OK;HARD;2;SMTP
OK - 0.014 sec. response time
Service Critical[08-15-2006 11&#58;40&#58;17] SERVICE ALERT&#58;
funafuti;SMTP;CRITICAL;HARD;2;Connection refused
Service Critical[08-15-2006 11&#58;39&#58;17] SERVICE ALERT&#58;
funafuti;SMTP;CRITICAL;SOFT;1;Connection refused

kernel log&#58;
Aug 15 15&#58;39&#58;14 funafuti 129.79.4.55 REJECTED IN=eth0 OUT=
MAC=00&#58;13&#58;72&#58;5e&#58;66&#58;86&#58;00&#58;0f&#58;35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.55
<div id='show_47248883' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_47248883'>LEN=60 TOS=0x00 PREC=0x00 TTL=60 ID=1702 DF PROTO=TCP SPT=51678 DPT=25
WINDOW=5840 RES=0x00 SYN URGP=0
Aug 15 15&#58;39&#58;14 funafuti eth0 packet REJECTED IN=eth0 OUT=
MAC=00&#58;13&#58;72&#58;5e&#58;66&#58;86&#58;00&#58;0f&#58;35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.55
LEN=60 TOS=0x00 PREC=0x00 TTL=60 ID=1702 DF PROTO=TCP SPT=51678 DPT=25
WINDOW=5840 RES=0x00 SYN URGP=0
Aug 15 15&#58;39&#58;14 funafuti packet REJECTED IN=eth0 OUT=
MAC=00&#58;13&#58;72&#58;5e&#58;66&#58;86&#58;00&#58;0f&#58;35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.55
LEN=60 TOS=0x00 PREC=0x00 TTL=60 ID=1702 DF PROTO=TCP SPT=51678 DPT=25
WINDOW=5840 RES=0x00 SYN URGP=0

tcpdump log&#58;
11&#58;39&#58;14.224944 198.32.10.73.51678 &#62; 129.79.4.55.smtp&#58; S
3694178135&#58;3694178135(0) win 5840 &#60;mss 1460,sackOK,timestamp 2240719345[|tcp]&#62;
(DF) (ttl 60, id 1702, len 60)
11&#58;39&#58;14.225119 129.79.4.55 &#62; 198.32.10.73&#58; icmp&#58; 129.79.4.55 tcp port smtp
unreachable for 198.32.10.73.51678 &#62; 129.79.4.55.smtp&#58; [|tcp] (DF) (ttl 60, id
1702, len 60) [tos 0xc0]  (ttl 64, id 49584, len 88)

11&#58;39&#58;17.410287 198.32.10.73 &#62; 129.79.4.55&#58; icmp&#58; echo request (DF) (ttl 60, id
0, len 84)
11&#58;39&#58;17.410317 129.79.4.55 &#62; 198.32.10.73&#58; icmp&#58; echo reply (ttl 64, id 49585,
len 84)

11&#58;39&#58;54.181845 198.32.10.73.51731 &#62; 129.79.4.55.ssh&#58; S
3741065130&#58;3741065130(0) win 5840 &#60;mss 1460,sackOK,timestamp 2240759317[|tcp]&#62;
(DF) (ttl 60, id 22975, len 60)
11&#58;39&#58;54.181888 129.79.4.55.ssh &#62; 198.32.10.73.51731&#58; S
2681402925&#58;2681402925(0) ack 3741065131 win 5792 &#60;mss 1460,sackOK,timestamp
564428960[|tcp]&#62; (DF) (ttl 64, id 0, len 60)
11&#58;39&#58;54.183344 198.32.10.73.51731 &#62; 129.79.4.55.ssh&#58; . [tcp sum ok] 1&#58;1(0) ack
1 win 1460 &#60;nop,nop,timestamp 2240759318 564428960&#62; (DF) (ttl 60, id 22977, len
52)
11&#58;39&#58;54.189731 129.79.4.55.ssh &#62; 198.32.10.73.51731&#58; P 1&#58;21(20) ack 1 win 1448
&#60;nop,nop,timestamp 564428962 2240759318&#62; (DF) (ttl 64, id 30350, len 72)
11&#58;39&#58;54.195463 198.32.10.73.51731 &#62; 129.79.4.55.ssh&#58; . [tcp sum ok] 1&#58;1(0) ack
21 win 1460 &#60;nop,nop,timestamp 2240759331 564428962&#62; (DF) (ttl 60, id 22979,
len 52)
11&#58;39&#58;54.195588 198.32.10.73.51731 &#62; 129.79.4.55.ssh&#58; P 1&#58;25(24) ack 21 win
1460 &#60;nop,nop,timestamp 2240759331 564428962&#62; (DF) (ttl 60, id 22981, len 76)
11&#58;39&#58;54.195607 129.79.4.55.ssh &#62; 198.32.10.73.51731&#58; . [tcp sum ok] 21&#58;21(0)
ack 25 win 1448 &#60;nop,nop,timestamp 564428963 2240759331&#62; (DF) (ttl 64, id
30352, len 52)
11&#58;39&#58;54.196337 198.32.10.73.51731 &#62; 129.79.4.55.ssh&#58; F [tcp sum ok] 25&#58;25(0)
ack 21 win 1460 &#60;nop,nop,timestamp 2240759331 564428962&#62; (DF) (ttl 60, id
22983, len 52)
11&#58;39&#58;54.196409 129.79.4.55.ssh &#62; 198.32.10.73.51731&#58; P 21&#58;725(704) ack 26 win
1448 &#60;nop,nop,timestamp 564428963 2240759331&#62; (DF) (ttl 64, id 30354, len 756)
11&#58;39&#58;54.196774 129.79.4.55.ssh &#62; 198.32.10.73.51731&#58; F [tcp sum ok] 725&#58;725(0)
ack 26 win 1448 &#60;nop,nop,timestamp 564428963 2240759331&#62; (DF) (ttl 64, id
30356, len 52)
11&#58;39&#58;54.197961 198.32.10.73.51731 &#62; 129.79.4.55.ssh&#58; R [tcp sum ok]
3741065156&#58;3741065156(0) win 0 (DF) (ttl 60, id 18487, len 40)
11&#58;39&#58;54.198086 198.32.10.73.51731 &#62; 129.79.4.55.ssh&#58; R [tcp sum ok]
3741065156&#58;3741065156(0) win 0 (DF) (ttl 60, id 18488, len 40)

kernel log&#58;
Aug 15 15&#58;40&#58;14 funafuti 129.79.4.55 REJECTED IN=eth0 OUT=
MAC=00&#58;13&#58;72&#58;5e&#58;66&#58;86&#58;00&#58;0f&#58;35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.55
LEN=60 TOS=0x00 PREC=0x00 TTL=60 ID=40404 DF PROTO=TCP SPT=51767 DPT=25
WINDOW=5840 RES=0x00 SYN URGP=0
Aug 15 15&#58;40&#58;14 funafuti eth0 packet REJECTED IN=eth0 OUT=
MAC=00&#58;13&#58;72&#58;5e&#58;66&#58;86&#58;00&#58;0f&#58;35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.55
LEN=60 TOS=0x00 PREC=0x00 TTL=60 ID=40404 DF PROTO=TCP SPT=51767 DPT=25
WINDOW=5840 RES=0x00 SYN URGP=0
Aug 15 15&#58;40&#58;14 funafuti packet REJECTED IN=eth0 OUT=
MAC=00&#58;13&#58;72&#58;5e&#58;66&#58;86&#58;00&#58;0f&#58;35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.55
LEN=60 TOS=0x00 PREC=0x00 TTL=60 ID=40404 DF PROTO=TCP SPT=51767 DPT=25
WINDOW=5840 RES=0x00 SYN URGP=0

tcpdump log&#58;
11&#58;40&#58;14.829295 198.32.10.73.51767 &#62; 129.79.4.55.smtp&#58; S
3767995152&#58;3767995152(0) win 5840 &#60;mss 1460,sackOK,timestamp 2240779972[|tcp]&#62;
(DF) (ttl 60, id 40404, len 60)
11&#58;40&#58;14.829474 129.79.4.55 &#62; 198.32.10.73&#58; icmp&#58; 129.79.4.55 tcp port smtp
unreachable for 198.32.10.73.51767 &#62; 129.79.4.55.smtp&#58; [|tcp] (DF) (ttl 60, id
40404, len 60) [tos 0xc0]  (ttl 64, id 49586, len 88)

11&#58;40&#58;17.906575 198.32.10.73 &#62; 129.79.4.55&#58; icmp&#58; echo request (DF) (ttl 60, id
0, len 84)
11&#58;40&#58;17.906603 129.79.4.55 &#62; 198.32.10.73&#58; icmp&#58; echo reply (ttl 64, id 49587,
len 84)

11&#58;42&#58;54.292855 198.32.10.73.52070 &#62; 129.79.4.55.ssh&#58; S
3931474291&#58;3931474291(0) win 5840 &#60;mss 1460,sackOK,timestamp 2240939495[|tcp]&#62;
(DF) (ttl 60, id 35988, len 60)
11&#58;42&#58;54.292898 129.79.4.55.ssh &#62; 198.32.10.73.52070&#58; S
2878269517&#58;2878269517(0) ack 3931474292 win 5792 &#60;mss 1460,sackOK,timestamp
564473984[|tcp]&#62; (DF) (ttl 64, id 0, len 60)
11&#58;42&#58;54.294354 198.32.10.73.52070 &#62; 129.79.4.55.ssh&#58; . [tcp sum ok] 1&#58;1(0) ack
1 win 1460 &#60;nop,nop,timestamp 2240939496 564473984&#62; (DF) (ttl 60, id 35990, len
52)
11&#58;42&#58;54.300736 129.79.4.55.ssh &#62; 198.32.10.73.52070&#58; P 1&#58;21(20) ack 1 win 1448
&#60;nop,nop,timestamp 564473986 2240939496&#62; (DF) (ttl 64, id 55502, len 72)
11&#58;42&#58;54.302349 198.32.10.73.52070 &#62; 129.79.4.55.ssh&#58; . [tcp sum ok] 1&#58;1(0) ack
21 win 1460 &#60;nop,nop,timestamp 2240939504 564473986&#62; (DF) (ttl 60, id 35992,
len 52)
11&#58;42&#58;54.302350 198.32.10.73.52070 &#62; 129.79.4.55.ssh&#58; P 1&#58;25(24) ack 21 win
1460 &#60;nop,nop,timestamp 2240939504 564473986&#62; (DF) (ttl 60, id 35994, len 76)
11&#58;42&#58;54.302382 129.79.4.55.ssh &#62; 198.32.10.73.52070&#58; . [tcp sum ok] 21&#58;21(0)
ack 25 win 1448 &#60;nop,nop,timestamp 564473986 2240939504&#62; (DF) (ttl 64, id
55504, len 52)
11&#58;42&#58;54.303182 129.79.4.55.ssh &#62; 198.32.10.73.52070&#58; P 21&#58;725(704) ack 25 win
1448 &#60;nop,nop,timestamp 564473986 2240939504&#62; (DF) (ttl 64, id 55506, len 756)
11&#58;42&#58;54.303223 198.32.10.73.52070 &#62; 129.79.4.55.ssh&#58; F [tcp sum ok] 25&#58;25(0)
ack 21 win 1460 &#60;nop,nop,timestamp 2240939505 564473986&#62; (DF) (ttl 60, id
35996, len 52)
11&#58;42&#58;54.303622 129.79.4.55.ssh &#62; 198.32.10.73.52070&#58; F [tcp sum ok] 725&#58;725(0)
ack 26 win 1448 &#60;nop,nop,timestamp 564473986 2240939505&#62; (DF) (ttl 64, id
55508, len 52)
11&#58;42&#58;54.304723 198.32.10.73.52070 &#62; 129.79.4.55.ssh&#58; R [tcp sum ok]
3931474316&#58;3931474316(0) win 0 (DF) (ttl 60, id 18716, len 40)
11&#58;42&#58;54.305098 198.32.10.73.52070 &#62; 129.79.4.55.ssh&#58; R [tcp sum ok]
3931474317&#58;3931474317(0) win 0 (DF) (ttl 60, id 18717, len 40)

11&#58;43&#58;14.947802 198.32.10.73.52102 &#62; 129.79.4.55.smtp&#58; S
3941151802&#58;3941151802(0) win 5840 &#60;mss 1460,sackOK,timestamp 2240960157[|tcp]&#62;
(DF) (ttl 60, id 25255, len 60)
11&#58;43&#58;14.947845 129.79.4.55.smtp &#62; 198.32.10.73.52102&#58; S
2892756542&#58;2892756542(0) ack 3941151803 win 5792 &#60;mss 1460,sackOK,timestamp
564479147[|tcp]&#62; (DF) (ttl 64, id 0, len 60)
11&#58;43&#58;14.949300 198.32.10.73.52102 &#62; 129.79.4.55.smtp&#58; . [tcp sum ok] 1&#58;1(0)
ack 1 win 1460 &#60;nop,nop,timestamp 2240960159 564479147&#62; (DF) (ttl 60, id 25257,
len 52)
11&#58;43&#58;14.954048 192.168.10.31.34968 &#62; 192.168.10.255.ha-cluster&#58; udp 206 (DF)
(ttl 64, id 11358, len 234)
11&#58;43&#58;14.956736 129.79.4.55.33336 &#62; 129.79.1.1.domain&#58;  3120+[|domain] (DF)
(ttl 64, id 17581, len 71)
11&#58;43&#58;14.957296 129.79.1.1.domain &#62; 129.79.4.55.33336&#58;  3120* q&#58;[|domain] (DF)
(ttl 254, id 34653, len 238)
11&#58;43&#58;14.957453 129.79.4.55.33336 &#62; 129.79.1.1.domain&#58;  34154+[|domain] (DF)
(ttl 64, id 17581, len 70)
11&#58;43&#58;14.958046 129.79.1.1.domain &#62; 129.79.4.55.33336&#58;  34154* q&#58;[|domain] (DF)
(ttl 254, id 34654, len 259)
11&#58;43&#58;14.958354 129.79.4.55.smtp &#62; 198.32.10.73.52102&#58; P 1&#58;32(31) ack 1 win
1448 &#60;nop,nop,timestamp 564479150 2240960159&#62; (DF) (ttl 64, id 45716, len 83)
11&#58;43&#58;14.959795 198.32.10.73.52102 &#62; 129.79.4.55.smtp&#58; . [tcp sum ok] 1&#58;1(0)
ack 32 win 1460 &#60;nop,nop,timestamp 2240960169 564479150&#62; (DF) (ttl 60, id
25259, len 52)
11&#58;43&#58;14.959919 198.32.10.73.52102 &#62; 129.79.4.55.smtp&#58; P 1&#58;32(31) ack 32 win
1460 &#60;nop,nop,timestamp 2240960169 564479150&#62; (DF) (ttl 60, id 25261, len 83)
11&#58;43&#58;14.959934 129.79.4.55.smtp &#62; 198.32.10.73.52102&#58; . [tcp sum ok] 32&#58;32(0)
ack 32 win 1448 &#60;nop,nop,timestamp 564479150 2240960169&#62; (DF) (ttl 64, id
45718, len 52)
11&#58;43&#58;14.959980 129.79.4.55.smtp &#62; 198.32.10.73.52102&#58; P 32&#58;49(17) ack 32 win
1448 &#60;nop,nop,timestamp 564479150 2240960169&#62; (DF) (ttl 64, id 45720, len 69)
11&#58;43&#58;14.961418 198.32.10.73.52102 &#62; 129.79.4.55.smtp&#58; P 32&#58;38(6) ack 49 win
1460 &#60;nop,nop,timestamp 2240960171 564479150&#62; (DF) (ttl 60, id 25263, len 58)
11&#58;43&#58;14.961419 198.32.10.73.52102 &#62; 129.79.4.55.smtp&#58; F [tcp sum ok] 38&#58;38(0)
ack 49 win 1460 &#60;nop,nop,timestamp 2240960171 564479150&#62; (DF) (ttl 60, id
25265, len 52)
11&#58;43&#58;14.961467 129.79.4.55.smtp &#62; 198.32.10.73.52102&#58; P 49&#58;58(9) ack 39 win
1448 &#60;nop,nop,timestamp 564479150 2240960171&#62; (DF) (ttl 64, id 45722, len 61)
11&#58;43&#58;14.961615 129.79.4.55.smtp &#62; 198.32.10.73.52102&#58; F [tcp sum ok] 58&#58;58(0)
ack 39 win 1448 &#60;nop,nop,timestamp 564479150 2240960171&#62; (DF) (ttl 64, id
45724, len 52)
11&#58;43&#58;14.962918 198.32.10.73.52102 &#62; 129.79.4.55.smtp&#58; R [tcp sum ok]
3941151841&#58;3941151841(0) win 0 (DF) (ttl 60, id 18726, len 40)
11&#58;43&#58;14.962919 198.32.10.73.52102 &#62; 129.79.4.55.smtp&#58; R [tcp sum ok]
3941151841&#58;3941151841(0) win 0 (DF) (ttl 60, id 18727, len 40)
</div><script type='text/javascript'>
        $('#show_47248883').click(function() {
            $('#detail_47248883').slideDown("normal");
            $('#show_47248883').hide();
            $('#hide_47248883').show();
        });
        $('#hide_47248883').click(function() {
            $('#detail_47248883').slideUp();
            $('#hide_47248883').hide();
            $('#show_47248883').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='2289#1156342208'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T14:10:08+00:00">Aug 23, 2006 02:10 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156342208">&nbsp;</a></div><pre>Date&#58; Mon, 14 Aug 2006 13&#58;19&#58;25 -0400
From&#58; &#34;Addleman, Hans C&#34; &#60;addlema@....&#62;
To&#58; &#34;Rosheck Jr, John B&#34; &#60;jrosheck@....&#62;
Cc&#58; &#34;Beals, Damon G&#34; &#60;dbeals@....&#62;
Subject&#58; RE&#58; IM391714&#58; funafuti.uits.indiana.edu intermetent network
problems

John,
I don&#39;t think any extra packet capturing in this instance would help
(Perhaps tcpdump on the Nagios side) since TCPDUMP on your server will
pick up virtually the same thing as a packet sniffer on your switch
port. Can you send me any more packet captures or logs you have that
match with the logs of the Nagios server?

We are seeing a smattering of malformed packets, however, that small an
amount with no loss is not usually a cause for concern. Also we aren&#39;t
seeing any errors on the switch port your server is connected too.

How are your local nagios to your server tests going? I will talk to a
couple of people in my group that are Nagios experts and see what they
say about this as well.

I also would like to know why your IPTABLES rules seem to sometimes
block the packets coming from the Nagios servers. Do you have a test
server setup (like Funafuti) that we could turn off IPTABLES on too see
if that clears up the problem.

Also, is there anything between our switch in the MR and your server (a
switch in your rack or anything like that?).

If we want to accurately troubleshoot this problem from the network
layer you will most likely need to turn off your firewall so we can rule
that completely out as a point of failure. Unfortunately this is
problematic due to the random nature of this problem.</pre></div><div class='update_description'><i onclick="document.location='2289#1156342144'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T14:09:04+00:00">Aug 23, 2006 02:09 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156342144">&nbsp;</a></div><pre>Date&#58; Mon, 14 Aug 2006 12&#58;29&#58;52 -0400 (EDT)
From&#58; jrosheck@....
To&#58; &#34;Addleman, Hans C&#34; &#60;addlema@....&#62;
Cc&#58; Leigh Grundhoefer &#60;leighg@....&#62;
Subject&#58; RE&#58; IM391714&#58; funafuti.uits.indiana.edu intermetent network
problems

Hello,

I discussed this with my supervisor this morning and she&#39;s recommending
that we request that the link be monitored directly at our server using
one of your group&#39;s packet loggers.  This seems to be a good idea to me
since I&#39;ve logged some malformed packets and I know that there are packets
being dropped somewhere.  How do I go about getting this accomplished?
Is there someone down here I need to talk to?

Thanks,
John</pre></div><div class='update_description'><i onclick="document.location='2289#1156342089'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T14:08:09+00:00">Aug 23, 2006 02:08 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156342089">&nbsp;</a></div><pre>Date&#58; Mon, 14 Aug 2006 06&#58;56&#58;49 -0400
From&#58; &#34;Addleman, Hans C&#34; &#60;addlema@....&#62;
To&#58; &#34;Rosheck Jr, John B&#34; &#60;jrosheck@....&#62;
Subject&#58; RE&#58; IM391714&#58; funafuti.uits.indiana.edu intermetent network
problems

That dropped packet count is actually just the amount of packets TCPDump
was not able to capture. It doesn&#39;t mean they were actually dropped,
tcpdump was just to bust to capture them for one reason or another.

24 packets per second is very reasonable and shouldn&#39;t be overloading
your server.

I still see no errors in our equipment (switches and routers) between
your server and the nagios server in Indy.</pre></div><div class='update_description'><i onclick="document.location='2289#1156342014'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T14:06:54+00:00">Aug 23, 2006 02:06 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156342014">&nbsp;</a></div><pre>Date&#58; Fri, 11 Aug 2006 12&#58;22&#58;56 -0400
From&#58; &#34;Addleman, Hans C&#34; &#60;addlema@....&#62;
To&#58; &#34;Rosheck Jr, John B&#34; &#60;jrosheck@....&#62;
Subject&#58; RE&#58; IM391714&#58; funafuti.uits.indiana.edu intermetent network
problems

I checked the your switch port and I don&#39;t see anything that would cause
that bad hdr message. There are no errors on that port and it&#39;s passing
traffic nicely.

I will continue up the path looking for errors though. Can you continue
your ping, and look into the IPTables issue. It looks like iptables is
actually blocking the requests from nagios sometimes.</pre></div><div class='update_description'><i onclick="document.location='2289#1156341886'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T14:04:46+00:00">Aug 23, 2006 02:04 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156341886">&nbsp;</a></div><pre>Date&#58; Fri, 11 Aug 2006 15&#58;26&#58;38 -0400 (EDT)
From&#58; jrosheck@....
To&#58; &#34;Addleman, Hans C&#34; &#60;addlema@....&#62;
Subject&#58; RE&#58; IM391714&#58; funafuti.uits.indiana.edu intermetent network
problems

I found something interesting - the Nagios I installed down here to try to
duplicate what they&#39;re seeing - I&#39;m still learning about it.  I found that
mine has been accumulating alerts in a comparable way to theirs.  I
thought it wasn&#39;t but I wasn&#39;t looking in the right place.  Also, going
through their last weeks worth of logs, I find that only one of our
machines hasn&#39;t alarmed -- so I switched the ethernet connections between
that one (pacman.uits.indiana.edu) and funafuti in a probably vain attempt
to isolate issues.

Also, in my examination of the alerts from their nagios I&#39;ve seen a couple
of occurances where nothing shows up on my end at that time.  Our machines
are time synced to the campus ntp server and I think I can assume that
their&#39;s is too.  Even given that there will be some variability between
the issuance of the alarm and the traffic that created it, it sure does
seem like something is disappearing somewhere.

So to look into that more, I used tcpdump to capture everything on the
external ethernet.  In about 27 minutes it had captured 40001 packets and
the kernel reported that it had dropped 102.  Does this sound reasonable?
I analyzed the captured packets and the average is about 24 pkts per
second with a maximum of 326 in one second.

I&#39;m going to look into getting the dropped packet count lowered since
that must be part of the problem and it doesn&#39;t seem like it should be
happening.

Have you seen anything suspicious?

John</pre></div><div class='update_description'><i onclick="document.location='2289#1156341746'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T14:02:26+00:00">Aug 23, 2006 02:02 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156341746">&nbsp;</a></div><pre>Date&#58; Fri, 11 Aug 2006 12&#58;00&#58;54 -0400 (EDT)
From&#58; jrosheck@....
To&#58; &#34;Addleman, Hans C&#34; &#60;addlema@....&#62;
Subject&#58; RE&#58; IM391714&#58; funafuti.uits.indiana.edu intermetent network
problems

On Fri, 11 Aug 2006, Addleman, Hans C wrote&#58;

<font color='#7F7E6F'>&#62; No idea. You may want to ask ITSO. I think they have some iptables</font>
<font color='#7F7E6F'>&#62; experts over there. That was my next question perhaps the scanning is</font>
<font color='#7F7E6F'>&#62; setting off a limit in Iptables. Unfortunately I am not familiar at all</font>
<font color='#7F7E6F'>&#62; with that software.</font>
<font color='#7F7E6F'>&#62;</font>

Thats fine.  I was just curious and I&#39;ll ask someone over there.  About
the limit in iptables - as far as I can see there isn&#39;t one, but the admin
for nagios did say something about that when we first started to track
this down.  The only limit I&#39;m aware of is on logging only.

Here&#39;s another set of messages where all three source correlate &#58;

from iptables&#58;
Aug 11 03&#58;59&#58;14 funafuti 129.79.4.55 REJECTED IN=eth0 OUT=
MAC=00&#58;13&#58;72&#58;5e&#58;66&#58;86&#58;00&#58;0f&#58;35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.55
LEN=60 TOS=0x00 PREC=0x00 TTL=60 ID=62294 DF PROTO=TCP SPT=47551 DPT=25
WINDOW=5840 RES=0x00 SYN URGP=0
Aug 11 03&#58;59&#58;14 funafuti eth0 packet REJECTED IN=eth0 OUT=
MAC=00&#58;13&#58;72&#58;5e&#58;66&#58;86&#58;00&#58;0f&#58;35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.55
LEN=60 TOS=0x00 PREC=0x00 TTL=60 ID=62294 DF PROTO=TCP SPT=47551 DPT=25
WINDOW=5840 RES=0x00 SYN URGP=0
Aug 11 03&#58;59&#58;14 funafuti packet REJECTED IN=eth0 OUT=
MAC=00&#58;13&#58;72&#58;5e&#58;66&#58;86&#58;00&#58;0f&#58;35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.55
LEN=60 TOS=0x00 PREC=0x00 TTL=60 ID=62294 DF PROTO=TCP SPT=47551 DPT=25
WINDOW=5840 RES=0x00 SYN URGP=0

<div id='show_834508125' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_834508125'>from tcpdump&#58;
03&#58;59&#58;14.575076 IP (tos 0x0, ttl  60, id 62294, offset 0, flags [DF], proto&#58;
TCP (6), length&#58; 60) nocmon.abilene.ucaid.edu.47551 &#62;
funafuti.uits.indiana.edu.smtp&#58; S 2439567677&#58;2439567677(0) win 5840 &#60;mss
1460,sackOK,timestamp 1852975723[|tcp]&#62;
03&#58;59&#58;14.575331 IP (tos 0xc0, ttl  64, id 30019, offset 0, flags [none], proto&#58;
ICMP (1), length&#58; 88) funafuti.uits.indiana.edu &#62; nocmon.abilene.ucaid.edu&#58;
ICMP funafuti.uits.indiana.edu tcp port smtp unreachable, length 68
IP (tos 0x0, ttl  60, id 62294, offset 0, flags [DF], proto&#58; TCP (6),
length&#58; 60) nocmon.abilene.ucaid.edu.47551 &#62; funafuti.uits.indiana.edu.smtp&#58;
tcp 36 [bad hdr length 4 - too short, &#60; 20]
03&#58;59&#58;17.620871 IP (tos 0x0, ttl  60, id 0, offset 0, flags [DF], proto&#58; ICMP
(1), length&#58; 84) nocmon.abilene.ucaid.edu &#62; funafuti.uits.indiana.edu&#58; ICMP
echo request, id 61214, seq 0, length 64
03&#58;59&#58;17.620906 IP (tos 0x0, ttl  64, id 30020, offset 0, flags [none], proto&#58;
ICMP (1), length&#58; 84) funafuti.uits.indiana.edu &#62; nocmon.abilene.ucaid.edu&#58;
ICMP echo reply, id 61214, seq 0, length 64
03&#58;59&#58;59.534292 IP (tos 0x0, ttl  60, id 40611, offset 0, flags [DF], proto&#58;
TCP (6), length&#58; 60) nocmon.abilene.ucaid.edu.47627 &#62;
funafuti.uits.indiana.edu.ssh&#58; S 2475443384&#58;2475443384(0) win 5840 &#60;mss
1460,sackOK,timestamp 1853020699[|tcp]&#62;
03&#58;59&#58;59.534336 IP (tos 0x0, ttl  64, id 0, offset 0, flags [DF], proto&#58; TCP
(6), length&#58; 60) funafuti.uits.indiana.edu.ssh &#62;
nocmon.abilene.ucaid.edu.47627&#58; S 1417398215&#58;1417398215(0) ack 2475443385 win
5792 &#60;mss 1460,sackOK,timestamp 467538048[|tcp]&#62;
03&#58;59&#58;59.535790 IP (tos 0x0, ttl  60, id 40613, offset 0, flags [DF], proto&#58;
TCP (6), length&#58; 52) nocmon.abilene.ucaid.edu.47627 &#62;
funafuti.uits.indiana.edu.ssh&#58; ., cksum 0xf77f (correct), ack 1 win 1460
&#60;nop,nop,timestamp 1853020701 467538048&#62;
03&#58;59&#58;59.542112 IP (tos 0x0, ttl  64, id 55112, offset 0, flags [DF], proto&#58;
TCP (6), length&#58; 72) funafuti.uits.indiana.edu.ssh &#62;
nocmon.abilene.ucaid.edu.47627&#58; P 1&#58;21(20) ack 1 win 1448 &#60;nop,nop,timestamp
467538050 1853020701&#62;
03&#58;59&#58;59.543536 IP (tos 0x0, ttl  60, id 40615, offset 0, flags [DF], proto&#58;
TCP (6), length&#58; 52) nocmon.abilene.ucaid.edu.47627 &#62;
funafuti.uits.indiana.edu.ssh&#58; ., cksum 0xf761 (correct), ack 21 win 1460
&#60;nop,nop,timestamp 1853020709 467538050&#62;
03&#58;59&#58;59.543537 IP (tos 0x0, ttl  60, id 40617, offset 0, flags [DF], proto&#58;
TCP (6), length&#58; 76) nocmon.abilene.ucaid.edu.47627 &#62;
funafuti.uits.indiana.edu.ssh&#58; P 1&#58;25(24) ack 21 win 1460 &#60;nop,nop,timestamp
1853020709 467538050&#62;
03&#58;59&#58;59.543568 IP (tos 0x0, ttl  64, id 55114, offset 0, flags [DF], proto&#58;
TCP (6), length&#58; 52) funafuti.uits.indiana.edu.ssh &#62;
nocmon.abilene.ucaid.edu.47627&#58; ., cksum 0xf755 (correct), ack 25 win 1448
&#60;nop,nop,timestamp 467538050 1853020709&#62;
03&#58;59&#58;59.544160 IP (tos 0x0, ttl  60, id 40619, offset 0, flags [DF], proto&#58;
TCP (6), length&#58; 52) nocmon.abilene.ucaid.edu.47627 &#62;
funafuti.uits.indiana.edu.ssh&#58; F, cksum 0xf747 (correct), 25&#58;25(0) ack 21 win
1460 &#60;nop,nop,timestamp 1853020710 467538050&#62;
03&#58;59&#58;59.544377 IP (tos 0x0, ttl  64, id 55116, offset 0, flags [DF], proto&#58;
TCP (6), length&#58; 756) funafuti.uits.indiana.edu.ssh &#62;
nocmon.abilene.ucaid.edu.47627&#58; P 21&#58;725(704) ack 26 win 1448
&#60;nop,nop,timestamp 467538050 1853020710&#62;
03&#58;59&#58;59.544745 IP (tos 0x0, ttl  64, id 55118, offset 0, flags [DF], proto&#58;
TCP (6), length&#58; 52) funafuti.uits.indiana.edu.ssh &#62;
nocmon.abilene.ucaid.edu.47627&#58; F, cksum 0xf492 (correct), 725&#58;725(0) ack 26
win 1448 &#60;nop,nop,timestamp 467538050 1853020710&#62;
03&#58;59&#58;59.546034 IP (tos 0x0, ttl  60, id 50126, offset 0, flags [DF], proto&#58;
TCP (6), length&#58; 40) nocmon.abilene.ucaid.edu.47627 &#62;
funafuti.uits.indiana.edu.ssh&#58; R, cksum 0xc770 (correct),
2475443410&#58;2475443410(0) win 0

from nagios logs&#58;
Service Ok[08-11-2006 04&#58;00&#58;17] SERVICE ALERT&#58; funafuti;SMTP;OK;SOFT;2;SMTP
OK - 0.047 sec. response time
Service Critical[08-11-2006 03&#58;59&#58;17] SERVICE ALERT&#58;
funafuti;SMTP;CRITICAL;SOFT;1;Connection refused

So what are those bad headers about?  Any ideas?

John
</div><script type='text/javascript'>
        $('#show_834508125').click(function() {
            $('#detail_834508125').slideDown("normal");
            $('#show_834508125').hide();
            $('#hide_834508125').show();
        });
        $('#hide_834508125').click(function() {
            $('#detail_834508125').slideUp();
            $('#hide_834508125').hide();
            $('#show_834508125').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='2289#1156341584'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T13:59:44+00:00">Aug 23, 2006 01:59 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156341584">&nbsp;</a></div><pre>Date&#58; Fri, 11 Aug 2006 11&#58;22&#58;43 -0400
From&#58; &#34;Addleman, Hans C&#34; &#60;addlema@....&#62;
To&#58; &#34;Rosheck Jr, John B&#34; &#60;jrosheck@....&#62;
Subject&#58; RE&#58; IM391714&#58; funafuti.uits.indiana.edu intermetent network
problems

No idea. You may want to ask ITSO. I think they have some iptables
experts over there. That was my next question perhaps the scanning is
setting off a limit in Iptables. Unfortunately I am not familiar at all
with that software.</pre></div><div class='update_description'><i onclick="document.location='2289#1156341522'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T13:58:42+00:00">Aug 23, 2006 01:58 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156341522">&nbsp;</a></div><pre>Date&#58; Fri, 11 Aug 2006 11&#58;19&#58;45 -0400 (EDT)
From&#58; jrosheck@....
To&#58; &#34;Addleman, Hans C&#34; &#60;addlema@....&#62;
Subject&#58; RE&#58; IM391714&#58; funafuti.uits.indiana.edu intermetent network
problems

On Fri, 11 Aug 2006, Addleman, Hans C wrote&#58;

<font color='#7F7E6F'>&#62; Have you talked to the people running the Nagios server in Indy to look</font>
<font color='#7F7E6F'>&#62; at problems on their server? I&#39;ll look through the logs but generally if</font>
<font color='#7F7E6F'>&#62; the pings are working and other services monitored are fine then the</font>
<font color='#7F7E6F'>&#62; network is fine and it shouldn&#39;t have a problem (That is network</font>
<font color='#7F7E6F'>&#62; related) getting info from your box.</font>

Yes, but they monitor lots of machines with it and seem to feel confident
that it isn&#39;t on their end.  I have only a few days of experience with it
but it does look like a pretty reliable tool.

<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; I think the TCPDUMP and longer pings (especially around the times this</font>
<font color='#7F7E6F'>&#62; problem happens) will help us diagnose this further.</font>

And I did find something (still looking for more but I thought I should
pass it on) &#58;

from tcpdump&#58;
17&#58;29&#58;09.076083 IP (tos 0x0, ttl  60, id 30547, offset 0, flags [DF], proto&#58;
TCP (6), length&#58; 60) nocmon.abilene.ucaid.edu.49477 &#62;
funafuti.uits.indiana.edu.smtp&#58; S 1166303758&#58;1166303758(0) win 5840 &#60;mss
1460,sackOK,timestamp 1815156061[|tcp]&#62;
17&#58;29&#58;09.076348 IP (tos 0xc0, ttl  64, id 15315, offset 0, flags [none], proto&#58;
ICMP (1), length&#58; 88) funafuti.uits.indiana.edu &#62; nocmon.abilene.ucaid.edu&#58;
ICMP funafuti.uits.indiana.edu tcp port smtp unreachable, length 68
IP (tos 0x0, ttl  60, id 30547, offset 0, flags [DF], proto&#58; TCP (6),
length&#58; 60) nocmon.abilene.ucaid.edu.49477 &#62; funafuti.uits.indiana.edu.smtp&#58;
<div id='show_1443964204' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1443964204'>tcp 36 [bad hdr length 4 - too short, &#60; 20]
17&#58;29&#58;18.016449 IP (tos 0x0, ttl  60, id 0, offset 0, flags [DF], proto&#58; ICMP
(1), length&#58; 84) nocmon.abilene.ucaid.edu &#62; funafuti.uits.indiana.edu&#58; ICMP
echo request, id 17226, seq 0, length 64

17&#58;29&#58;18.016479 IP (tos 0x0, ttl  64, id 15316, offset 0, flags [none], proto&#58;
ICMP (1), length&#58; 84) funafuti.uits.indiana.edu &#62; nocmon.abilene.ucaid.edu&#58;
ICMP echo reply, id 17226, seq 0, length 64

from iptables&#58;
Aug 10 17&#58;29&#58;09 funafuti 129.79.4.55 REJECTED IN=eth0 OUT=
MAC=00&#58;13&#58;72&#58;5e&#58;66&#58;86&#58;00&#58;0f&#58;35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.55
LEN=60 TOS=0x00 PREC=0x00 TTL=60 ID=30547 DF PROTO=TCP SPT=49477 DPT=25
WINDOW=5840 RES=0x00 SYN URGP=0
Aug 10 17&#58;29&#58;09 funafuti eth0 packet REJECTED IN=eth0 OUT=
MAC=00&#58;13&#58;72&#58;5e&#58;66&#58;86&#58;00&#58;0f&#58;35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.55
LEN=60 TOS=0x00 PREC=0x00 TTL=60 ID=30547 DF PROTO=TCP SPT=49477 DPT=25
WINDOW=5840 RES=0x00 SYN URGP=0
Aug 10 17&#58;29&#58;09 funafuti packet REJECTED IN=eth0 OUT=
MAC=00&#58;13&#58;72&#58;5e&#58;66&#58;86&#58;00&#58;0f&#58;35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.55
LEN=60 TOS=0x00 PREC=0x00 TTL=60 ID=30547 DF PROTO=TCP SPT=49477 DPT=25
WINDOW=5840 RES=0x00 SYN URGP=0

Do you know if its possible to get iptables to record an entire bad packet
from a particular log statement?  If so, what would the command look like?

John
</div><script type='text/javascript'>
        $('#show_1443964204').click(function() {
            $('#detail_1443964204').slideDown("normal");
            $('#show_1443964204').hide();
            $('#hide_1443964204').show();
        });
        $('#hide_1443964204').click(function() {
            $('#detail_1443964204').slideUp();
            $('#hide_1443964204').hide();
            $('#show_1443964204').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='2289#1156341395'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T13:56:35+00:00">Aug 23, 2006 01:56 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156341395">&nbsp;</a></div><pre>Date&#58; Fri, 11 Aug 2006 10&#58;46&#58;21 -0400
From&#58; &#34;Addleman, Hans C&#34; &#60;addlema@....&#62;
To&#58; &#34;Rosheck Jr, John B&#34; &#60;jrosheck@....&#62;
Subject&#58; RE&#58; IM391714&#58; funafuti.uits.indiana.edu intermetent network
problems

Have you talked to the people running the Nagios server in Indy to look
at problems on their server? I&#39;ll look through the logs but generally if
the pings are working and other services monitored are fine then the
network is fine and it shouldn&#39;t have a problem (That is network
related) getting info from your box.

I think the TCPDUMP and longer pings (especially around the times this
problem happens) will help us diagnose this further.</pre></div><div class='update_description'><i onclick="document.location='2289#1156341299'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T13:54:59+00:00">Aug 23, 2006 01:54 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156341299">&nbsp;</a></div><pre>Date&#58; Thu, 10 Aug 2006 15&#58;33&#58;52 -0400
From&#58; &#34;Addleman, Hans C&#34; &#60;addlema@....&#62;
To&#58; &#34;Addleman, Hans C&#34; &#60;addlema@....&#62;, NOC &#60;noc@....&#62;,
&#34;Rosheck Jr, John B&#34; &#60;jrosheck@....&#62;
Subject&#58; RE&#58; IM391714&#58; funafuti.uits.indiana.edu intermetent network
problems

I tried to set up a ping to you from Indianapolis to start
troubleshooting and you seem to have it blocked.

One more question to add to the list I sent already. When exactly did
this problem start? That will really help me track down a root cause if
there is one network related.</pre></div><div class='update_description'><i onclick="document.location='2289#1156341224'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-23T13:53:44+00:00">Aug 23, 2006 01:53 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1156341224">&nbsp;</a></div><pre>Date&#58; Fri, 11 Aug 2006 10&#58;36&#58;47 -0400 (EDT)
From&#58; jrosheck@....
To&#58; &#34;Addleman, Hans C&#34; &#60;addlema@....&#62;
Cc&#58; NOC &#60;noc@....&#62;
Subject&#58; RE&#58; IM391714&#58; funafuti.uits.indiana.edu intermetent network
problems
Parts/Attachments&#58;
1 Shown    128 lines  Text
2   OK     ~43 KB     Text, &#34;&#34;
----------------------------------------

Hello,

On Thu, 10 Aug 2006, Addleman, Hans C wrote&#58;

<font color='#7F7E6F'>&#62; John,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; It is only showing the SSH and SMTP service down and not the whole box?</font>

Intermittantly, either of the services, but mostly SMTP on this box.

<font color='#7F7E6F'>&#62; How does nagios monitor those services?</font>

Looking at the source C code, the check_ssh command uses low level socket
handling system calls to make the connection, retrieve the contact string
(which identifies it as ssh and prints its version), return that info via
stdout.  It runs every three minutes if the service has been passing,
every minute once it fails.

<font color='#7F7E6F'>&#62; Have you tried turning IPTABLES for a few hours to see if this is the</font>
} problem?

No, all of the machines they monitor have IPTABLES on.  This box is the
one box where security is paramount so I hesitate to turn it off even for
a little while.  Due to the intermittent nature of the problem it could
<div id='show_1071564415' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1071564415'>take a long time to show anything one way or the other.

<font color='#7F7E6F'>&#62; Does Nagios monitor any other services or its alive state via ping?</font>

I think just its alive state via ping.  I set up an instance of nagios
down here to try to duplicate the problem.  And it *never* fails.  But we
do get rarer intermittant failures on other machines from their scanner.

<font color='#7F7E6F'>&#62; Have you tried a ping from your machine to the nagios box to look for loss?</font>

Yes, I just did.  0% failure for five minutes but I will run it longer.

<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; How often does Nagios lose contact with those services?</font>

I attached the record of alarms over the last week or so.

Also, I&#39;m accumulating more information.  I started tcpdump yesterday and
am going to try to correlate its output with the rejected packets I see
coming from iptables.  I&#39;ll let you know what I find.  Please let me know
what you think and where I should go from here.

Thanks,
John
</div><script type='text/javascript'>
        $('#show_1071564415').click(function() {
            $('#detail_1071564415').slideDown("normal");
            $('#show_1071564415').hide();
            $('#hide_1071564415').show();
        });
        $('#hide_1071564415').click(function() {
            $('#detail_1071564415').slideUp();
            $('#hide_1071564415').hide();
            $('#show_1071564415').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='2289#1155666399'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-15T18:26:39+00:00">Aug 15, 2006 06:26 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1155666399">&nbsp;</a></div><pre>Date&#58; Thu, 10 Aug 2006 15&#58;20&#58;49 -0400
From&#58; &#34;Addleman, Hans C&#34; &#60;addlema@....&#62;
To&#58; NOC &#60;noc@....&#62;, &#34;Rosheck Jr, John B&#34; &#60;jrosheck@....&#62;
Subject&#58; RE&#58; IM391714&#58; funafuti.uits.indiana.edu intermetent network
problems

John,

It is only showing the SSH and SMTP service down and not the whole box?
How does nagios monitor those services? Have you tried turning IPTABLES
for a few hours to see if this is the problem? Does Nagios monitor any
other services or its alive state via ping? Have you tried a ping from
your machine to the nagios box to look for loss?

How often does Nagios lose contact with those services?

Thanks,
Hans
IU Network Operations

-----Original Message-----
From&#58; Rosheck Jr, John B
Sent&#58; Thursday, August 10, 2006 2&#58;55 PM
To&#58; NOC
Subject&#58; RE&#58; network problems

Hello,

This has been an ongoing issue for quite sometime now.  We setup a new
machine, funafuti.uits.indiana.edu (129.79.4.55), and it is monitored
by the NOC up in Indy using their Nagios box on 198.32.10.73 (also .74
but I never see that on my lines) and it intermittantly given alerts
that
ssh or smtp is down.  When I look in my iptables logs, I see rejected
packets in it from that IP (which I shouldn&#39;t) and am know running
<div id='show_227959975' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_227959975'>tcpdump
to look more closely at them.  This is confounding some of our plans
since
this machine will be very important to our operation and must be
monitored and the people watching the monitors need to have faith that
an
alarm is something real.

Any ideas or help would be greatly appreciated.

Thanks,
John
</div><script type='text/javascript'>
        $('#show_227959975').click(function() {
            $('#detail_227959975').slideDown("normal");
            $('#show_227959975').hide();
            $('#hide_227959975').show();
        });
        $('#hide_227959975').click(function() {
            $('#detail_227959975').slideUp();
            $('#hide_227959975').hide();
            $('#show_227959975').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='2289#1155223684'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-10T15:28:04+00:00">Aug 10, 2006 03:28 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1155223684">&nbsp;</a></div><pre>John, any progress on diagnosing these alarms? --Tim</pre></div><div class='update_description'><i onclick="document.location='2289#1155043161'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-08T13:19:21+00:00">Aug 8, 2006 01:19 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1155043161">&nbsp;</a></div><pre>That&#39;s what I&#39;m working on today - in fact, that&#39;s all I&#39;m going to work
on till the problem is solved.  I&#39;m getting my nagios fired up now.

John</pre></div><div class='update_description'><i onclick="document.location='2289#1155041779'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-08T12:56:19+00:00">Aug 8, 2006 12:56 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1155041779">&nbsp;</a></div><pre>John, I know you&#39;re working on a lot of things, but I wanted to peg you on this ticket today and see if
you&#39;ve had a chance to sort through the log files Chris sent? And if so, did you find anything useful?
I&#39;m also still waiting on Fermilab to get back to me about the other ticket related to the email
changeover, which is identifying the opensciencegrid.org email addresses coming to Paintbird. Until
these two issues are resolved, we can&#39;t move to the new server.

Tim</pre></div><div class='update_description'><i onclick="document.location='2289#1154698687'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-04T13:38:07+00:00">Aug 4, 2006 01:38 PM UTC</time> by <b>Chris Small</b><a class="anchor" name="1154698687">&nbsp;</a></div><pre>**An update was made to this Ticket based on an update made to dynamically-linked Issue #336 in Project System Support**

I put this in Open which should never be a status for these tickets and causes them
not to apear in tickmon</pre></div><div class='update_description'><i onclick="document.location='2289#1154546990'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-02T19:29:50+00:00">Aug 2, 2006 07:29 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1154546990">&nbsp;</a></div><pre>**An update was made to this Ticket based on an update made to dynamically-linked Issue #336 in Project System Support**

Chris,

I&#39;m adding John Rosheck to the &#39;Send Email&#39; group. If you could provide more details and logs for
these tests he can look at the IPTABLE logs and see what we can do to resolve this problem.

Thanks,

Tim</pre></div><div class='update_description'><i onclick="document.location='2289#1154459224'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-01T19:07:04+00:00">Aug 1, 2006 07:07 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1154459224">&nbsp;</a></div><pre>**An update was made to this Ticket based on an update made to dynamically-linked Issue #336 in Project System Support**

Hello,

Could you please send me the nagios logs for our machines for the past
seven days? (If you have them). As I researching this problem, I&#39;ve
found clusters of IP tables log entries but they are limited in duration
-- for example, on the machine lhc.uits.indiana.edu I find a bunch of
entries for July 26 all grouped from 10&#58;42&#58;35 to 12&#58;53&#58;37 GMT and none
before or since.

Thanks,
John</pre></div><div class='update_description'><i onclick="document.location='2289#1154453290'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-01T17:28:10+00:00">Aug 1, 2006 05:28 PM UTC</time> by <b>John Rosheck</b><a class="anchor" name="1154453290">&nbsp;</a></div><pre>Hello,

Could you please send me the nagios logs for our machines for the past
seven days?  (If you have them).  As I researching this problem, I&#39;ve
found clusters of IP tables log entries but they are limited in duration
-- for example, on the machine lhc.uits.indiana.edu I find a bunch of
entries for July 26 all grouped from 10&#58;42&#58;35 to 12&#58;53&#58;37 GMT and none
before or since.

Thanks,
John

On Tue, 1 Aug 2006, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='2289#1154448101'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-01T16:01:41+00:00">Aug 1, 2006 04:01 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1154448101">&nbsp;</a></div><pre>**An update was made to this Ticket based on an update made to dynamically-linked Issue #336 in Project System Support**

What method is being used to test ssh?  telnet to port 22 or an aborted
ssh command?  If the exact command is known, please pass that along. --John Rosheck</pre></div><div class='update_description'><i onclick="document.location='2289#1154440141'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2006-08-01T13:49:01+00:00">Aug 1, 2006 01:49 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1154440141">&nbsp;</a></div><pre>**This Ticket is a copy of Issue #336 of project System Support**<br>
<br></pre></div><div class='update_description'><i onclick="document.location='2289#0'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="1970-01-01T00:00:00+00:00">Jan 1, 1970 12:00 AM UTC</time> by <b>Chris Small&#58;<br></b><a class="anchor" name="0">&nbsp;</a></div><pre>That you are seeing rejection in the pfilter logs probably means  <br>
these connections are hitting some acl/limit. The other local (and  <br>
remote) machines that we monitor SSH on don&#39;t alarm anywhere near the  <br>
number of times the iGOC ones do.<br>
<br>
The SOFT and HARD flags represent the number of times Nagios has seen  <br>
an alarm. When it first sees an error in shows the problem as<br>
a &#34;SOFT&#34; alarm and then changes to &#34;HARD&#34; if it has failed more than  <br>
a configurable number of times. These settings in Nagios affect that  <br>
control the number of times before it sends a e-mail/page but this  <br>
does not affect the display in Nagios or Alertmon to prevent waiting  <br>
for 15 minutes when there is an alarm. Even if I wanted to change  <br>
this there are no way to make this less sensitive.<br>
<br>
Chris Small<br>
IU GlobalNOC<br>
812-856-0984<br>
<br>
<font color='#7F7E6F'>&#62; On Jul 27, 2006, at 12&#58;27 PM, Footprints Systems Support Project  <br></font>
<font color='#7F7E6F'>&#62; wrote&#58;<br></font>
<font color='#7F7E6F'>&#62;<br></font>
<font color='#7F7E6F'>&#62;&#62; [Duplicate message snipped]<br></font>
<br>


Camille says that Alertmon keeps sending off alarms for iGOC machines that are failing monitoring <br>
on Nagios, but these failures are intermittent. I don&#39;t know much about Nagios, but I see that it <br>
seems to just be sending pings to the host and it should be checking port 22 and various ports on <br>
several hosts for http services. Machines that Camille mentioned specifically were&#58;<br>
<br>
grid01.uits.indiana.edu<br>
nui.uits.indiana.edu<br>
funafuti.uits.indiana.edu<br>
<br>
I looked each of them up on Nagios and something called SOFT appears in each failure in the log. <br>
<div id='show_1267378232' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1267378232'>From nui...<br>
<br>
[07-27-2006 07&#58;40&#58;04] SERVICE ALERT&#58; nui;SSH;OK;SOFT;2;SSH OK - OpenSSH_4.3 (protocol <br>
2.0)<br>
<br>
[07-27-2006 07&#58;39&#58;04] SERVICE ALERT&#58; nui;SSH;CRITICAL;SOFT;1;Connection refused<br>
<br>
[07-27-2006 07&#58;30&#58;04] SERVICE ALERT&#58; nui;SSH;OK;SOFT;2;SSH OK - OpenSSH_4.3 (protocol <br>
2.0)<br>
<br>
[07-27-2006 07&#58;29&#58;04] SERVICE ALERT&#58; nui;SSH;CRITICAL;SOFT;1;Connection refused<br>
<br>
Here is what we got out of the pfilter logs from nui....<br>
<br>
Jul 27 07&#58;28&#58;59 nui 129.79.4.56 REJECTED IN=eth0 OUT= MAC=00&#58;13&#58;72&#58;5e&#58;91&#58;b2&#58;00&#58;0f&#58;<br>
35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.56 LEN=60 TOS=0x00 PREC=0x00 TTL=60 <br>
ID=64140 DF PROTO=TCP SPT=45642 DPT=22 WINDOW=5840 RES=0x00 SYN URGP=0 <br>
Jul 27 07&#58;28&#58;59 nui eth0 packet REJECTED IN=eth0 OUT= MAC=00&#58;13&#58;72&#58;5e&#58;91&#58;b2&#58;00&#58;0f&#58;<br>
35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.56 LEN=60 TOS=0x00 PREC=0x00 TTL=60 <br>
ID=64140 DF PROTO=TCP SPT=45642 DPT=22 WINDOW=5840 RES=0x00 SYN URGP=0 <br>
Jul 27 07&#58;28&#58;59 nui packet REJECTED IN=eth0 OUT= MAC=00&#58;13&#58;72&#58;5e&#58;91&#58;b2&#58;00&#58;0f&#58;<br>
35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.56 LEN=60 TOS=0x00 PREC=0x00 TTL=60 <br>
ID=64140 DF PROTO=TCP SPT=45642 DPT=22 WINDOW=5840 RES=0x00 SYN URGP=0 <br>
Jul 27 07&#58;30&#58;01 nui cron[32092]&#58; (root) CMD (test -x /usr/sbin/run-crons &amp;&amp; /usr/sbin/run-crons )<br>
Jul 27 07&#58;39&#58;00 nui 129.79.4.56 REJECTED IN=eth0 OUT= MAC=00&#58;13&#58;72&#58;5e&#58;91&#58;b2&#58;00&#58;0f&#58;<br>
35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.56 LEN=60 TOS=0x00 PREC=0x00 TTL=60 <br>
ID=58948 DF PROTO=TCP SPT=46383 DPT=22 WINDOW=5840 RES=0x00 SYN URGP=0 <br>
Jul 27 07&#58;39&#58;00 nui eth0 packet REJECTED IN=eth0 OUT= MAC=00&#58;13&#58;72&#58;5e&#58;91&#58;b2&#58;00&#58;0f&#58;<br>
35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.56 LEN=60 TOS=0x00 PREC=0x00 TTL=60 <br>
ID=58948 DF PROTO=TCP SPT=46383 DPT=22 WINDOW=5840 RES=0x00 SYN URGP=0 <br>
Jul 27 07&#58;39&#58;00 nui packet REJECTED IN=eth0 OUT= MAC=00&#58;13&#58;72&#58;5e&#58;91&#58;b2&#58;00&#58;0f&#58;<br>
35&#58;b2&#58;b5&#58;00&#58;08&#58;00 SRC=198.32.10.73 DST=129.79.4.56 LEN=60 TOS=0x00 PREC=0x00 TTL=60 <br>
ID=58948 DF PROTO=TCP SPT=46383 DPT=22 WINDOW=5840 RES=0x00 SYN URGP=0 <br>
<br>
I&#39;m not sure what&#39;s up.  We checked iptables and the IP is accepted. <br>
</div><script type='text/javascript'>
        $('#show_1267378232').click(function() {
            $('#detail_1267378232').slideDown("normal");
            $('#show_1267378232').hide();
            $('#hide_1267378232').show();
        });
        $('#hide_1267378232').click(function() {
            $('#detail_1267378232').slideUp();
            $('#hide_1267378232').hide();
            $('#show_1267378232').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F2289">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
