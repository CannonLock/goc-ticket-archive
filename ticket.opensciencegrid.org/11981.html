<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[11981] GLOW jobs on FNAL_FERMIGRID attempting to use CVMFS</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=11981" method="post">
<div class="page-header">
    <h3><span class="muted">11981</span> / GLOW jobs on FNAL_FERMIGRID attempting to use CVMFS</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Keith Chadwick</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Associated VO</label><div class="controls">GLOW</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Keith Chadwick</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">GLOW-TECH</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Check for updates</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2012-05-28</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">OSG RA <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">GLOW-TECH <span class="muted"> / OSG Support Centers</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/11981", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/11981?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/11981?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20GLOW%20jobs%20on%20FNAL_FERMIGRID%20attempting%20to%20use%20CVMFS%20ISSUE%3D11981%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='11981#1337625846'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-21T18:44:06+00:00">May 21, 2012 06:44 PM UTC</time> by <b>GLOW-TECH</b><a class="anchor" name="1337625846">&nbsp;</a></div><pre>The throttle has been removed.

Yes, please close this ticket until we get new indications of trouble.

--Dan

On 5/18/12 2&#58;14 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='11981#1337623870'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-21T18:11:10+00:00">May 21, 2012 06:11 PM UTC</time> by <b>Keith Chadwick</b><a class="anchor" name="1337623870">&nbsp;</a></div><pre>Feel free to close out this ticket.

-Keith.

At 11&#58;30 AM +0000 5/21/12, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62;[Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='11981#1337599812'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-21T11:30:12+00:00">May 21, 2012 11:30 AM UTC</time> by <b>OSG RA</b><a class="anchor" name="1337599812">&nbsp;</a></div><pre>Keith,

Is all well from your end?  If so, can we close out this ticket?

Thanks,

-Alain</pre></div><div class='update_description'><i onclick="document.location='11981#1337368448'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-18T19:14:08+00:00">May 18, 2012 07:14 PM UTC</time> by <b>Steven Timm</b><a class="anchor" name="1337368448">&nbsp;</a></div><pre>I think we should be able to remove the throttle entirely now.

Steve

On Fri, 18 May 2012, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='11981#1337368088'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-18T19:08:08+00:00">May 18, 2012 07:08 PM UTC</time> by <b>GLOW-TECH</b><a class="anchor" name="1337368088">&nbsp;</a></div><pre>We did up the throttle to 500 when Steve suggested it.  I have seen
times in which jobs have run at this level for several hours or more.  I
haven&#39;t heard of any problems resulting from this.

--Dan

On 5/18/12 1&#58;51 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='11981#1337367110'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-18T18:51:50+00:00">May 18, 2012 06:51 PM UTC</time> by <b>OSG RA</b><a class="anchor" name="1337367110">&nbsp;</a></div><pre>Hello Dan,

Are there any updates on this issue?  Have you been able to test out
Steve&#39;s recommendation to up the throttle to 500 jobs?

Thank You,
-Alain D</pre></div><div class='update_description'><i onclick="document.location='11981#1336404727'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-07T15:32:07+00:00">May 7, 2012 03:32 PM UTC</time> by <b>Steven Timm</b><a class="anchor" name="1336404727">&nbsp;</a></div><pre>The low-memory limit problem has been fixed not only for glow but for all glideins of any sort.
Why not up the throttle to 500 jobs and see if we can handle that.

Steve Timm</pre></div><div class='update_description'><i onclick="document.location='11981#1336403851'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-07T15:17:31+00:00">May 7, 2012 03:17 PM UTC</time><a class="anchor" name="1336403851">&nbsp;</a></div><pre>We&#39;ve been running with submissions to FermiGrid throttled to 100 running jobs since April 19.  I&#39;ve not heard any complaints about GLOW jobs landing on low-memory machines or causing squid load problems.

If Steve is comfortable with us removing the 100 job throttle, we will.  Otherwise, we will just continue running in this mode.

--Dan

-- by Daniel Bradley</pre></div><div class='update_description'><i onclick="document.location='11981#1336389592'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-05-07T11:19:52+00:00">May 7, 2012 11:19 AM UTC</time> by <b>OSG RA</b><a class="anchor" name="1336389592">&nbsp;</a></div><pre>Hello Dan,

Are there any updates on this issue?  Dan we haven&#39;t seen a response back from you in this ticket.  Your assistance is greatly appreciated.

Thank You,

-Alain</pre></div><div class='update_description'><i onclick="document.location='11981#1334872714'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-04-19T21:58:34+00:00">Apr 19, 2012 09:58 PM UTC</time><a class="anchor" name="1334872714">&nbsp;</a></div><pre>Hi Dan, it is OK to try 100 jobs and see how you do this time.

-- by Steve Timm</pre></div><div class='update_description'><i onclick="document.location='11981#1334852407'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-04-19T16:20:07+00:00">Apr 19, 2012 04:20 PM UTC</time> by <b>GLOW-TECH</b><a class="anchor" name="1334852407">&nbsp;</a></div><pre><font color='#7F7E6F'>&#62; If you can work out with the glidein factories to get the rsl statement into</font>
<font color='#7F7E6F'>&#62; the glideins and also to use a concurrency limit to throttle the rate to our</font>
<font color='#7F7E6F'>&#62; site for a while, then I think you could probably try this again.</font>

The factory has been updated.  A throttle of 100 running GLOW glideins
has been configured for FermiGrid.

I&#39;ll enabled our CMS jobs to try using FermiGrid again once I get an
okay from you.

<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Note however that the cross-vo glexec is costing you.  By coming in as GLOW</font>
<font color='#7F7E6F'>&#62; VO you are winding up with priority factor of between 1 million and 1 billion</font>
<font color='#7F7E6F'>&#62; worse than normal users on the non-CMS portions of FermiGrid.  USCMS jobs are only</font>
<font color='#7F7E6F'>&#62; penalized by a priority factor of 1000 and also have an allotment of 200</font>
<font color='#7F7E6F'>&#62; non-preemptable jobs as compared to Glow&#39;s 25.</font>

I think it is appropriate that we operate under GLOW priority in this
case.  We are working on adding an opportunistic mode to the CMS VO
glidein frontend.  Once that is done, you may start getting official CMS
VO jobs as well.

--Dan

On 4/18/12 1&#58;28 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='11981#1334773680'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-04-18T18:28:00+00:00">Apr 18, 2012 06:28 PM UTC</time><a class="anchor" name="1334773680">&nbsp;</a></div><pre>FNAL_FERMIGRID is actually a frontend to a number of different clusters, each
with its own idiosyncracies, CDF, GP Grid, D0, and the CMS Tier 1.

The D0 cluster is a PBS cluster which has a memory limit of 900MB/slot.
We found out over the weekend that it is not always able to kill the jobs that go over the
memory limit, that is why we had to have you kill those jobs.  As we&#39;ve mentioned, it&#39;s also
got a non-standard python which has bit a number of VO&#39;s in the past.

The CDF cluster is a condor cluster with a memory limit of (ImageSize&#62;=2500000)

The GP Grid cluster is a condor cluster with a memory limit of (ImageSize&#62;10000000).

We have fought with the many inaccuracies of ImageSize in condor for as long
as we&#39;ve been running condor.  Finally when we get the CDF cluster upgraded to condor 7.6.6
last month we will be able to limit everything on ResidentSetSize instead.

fermigridosg1 (FNAL_FERMIGRID) supports the minmemory
parameter in RSL.  If you want to be running jobs of this sort on FermiGrid
then you should ask the glidein factory to make an entry point for FermiGrid
that has the rsl (minmemory=1000)

Don&#39;t get too greedy with the minimum memory. If you make it bigger than 3014
then your job will never match to anything.  Any level greater than 1000 will keep it off
of the memory-limited D0 cluster.

Can you follow up with the glidein factory on this, or should I independently let
them know this, since more than glow VO is affected  (hcc and engage routinely crash as well).

As you know, in an independent investigation we are working with the glideinWMS and condor
team to stop the false alarms of high memory that happen at the start of glideins.  But
in this case the real memory usage of the CMS user job is what was the problem.  On our
other two clusters it would not have caused a problem at all.

----------------------------------------------------------------------

<div id='show_1142320847' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1142320847'>As Dave said earlier in the ticket, the bulk of the usage was coming from CDF but the
glow/CMS component was still significant because each squid access was fetching
a fairly big piece of file.  We count approximately 27K authentications
of Isabel Ojalvo between Apr 10-16, dividing by 4 that would correspond to 6K
jobs, each fetching ~500MB of code on average.

If you can work out with the glidein factories to get the rsl statement into
the glideins and also to use a concurrency limit to throttle the rate to our
site for a while, then I think you could probably try this again.

Note however that the cross-vo glexec is costing you.  By coming in as GLOW
VO you are winding up with priority factor of between 1 million and 1 billion
worse than normal users on the non-CMS portions of FermiGrid.  USCMS jobs are only
penalized by a priority factor of 1000 and also have an allotment of 200
non-preemptable jobs as compared to Glow&#39;s 25.

Steve Timm

-- by Steve Timm

</div><script type='text/javascript'>
        $('#show_1142320847').click(function() {
            $('#detail_1142320847').slideDown("normal");
            $('#show_1142320847').hide();
            $('#hide_1142320847').show();
        });
        $('#hide_1142320847').click(function() {
            $('#detail_1142320847').slideUp();
            $('#hide_1142320847').hide();
            $('#show_1142320847').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='11981#1334772127'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-04-18T18:02:07+00:00">Apr 18, 2012 06:02 PM UTC</time> by <b>GLOW-TECH</b><a class="anchor" name="1334772127">&nbsp;</a></div><pre>Dave Dykstra tells me&#58;

&#34;FYI the majority of the increased squid traffic at Fermilab turned out
to not be due to AAA jobs after all, it was a problem with the
production load from CDF Frontier. One of the CDF Frontier servers was
generating errors which caused the client request load to dramatically
increase. You could inquire if it is OK to send AAA load back there again.&#34;

If everyone agrees that Fermigrid squid is no longer a concern for CMS
opportunistic jobs, then that just leaves the issue of memory usage.
Apparently some D0 nodes are a bit low on memory and were observed to
have problems when running the CMS jobs.

Currently, we just have the glideins advertise that they provide as much
memory as is configured in the glidein factory entry for the site.  For
Fermigrid, this is 2GB.  I can think of two general methods for
addressing this.

1. Make the glidein factory entry for Fermigrid a better approximation
of reality.  This could be done by reducing the advertised memory or by
somehow having the factory submit glideins in such a way that they do
not run on low memory machines.  In the latter case, access to the low
memory machines could be made possible by creating a new glidein factory
entry that somehow submits glideins to only the low memory machines.  Is
there some RSL that would work to select whether glideins run on these
machines or not?

2. The other line of attack is to not fix the factory and instead just
make the glideins advertise the amount of memory allocated to the batch
slot in which the glidein is running.  However, support for this does
not yet exist in glideinWMS.  As a workaround, we could modify the
configuration of our glideins to advertise the min of the glidein
factory entry value (2GB) and the total memory on the machine divided by
the number of cores.  One proble with this method is that we could end
up starting glideins on Fermigrid that don&#39;t match to any job, because
<div id='show_1995839623' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1995839623'>they advertise less memory than the factory entry advertises.  Therefore
#1 is the preferred route.

--Dan

On 4/16/12 5&#58;38 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_1995839623').click(function() {
            $('#detail_1995839623').slideDown("normal");
            $('#show_1995839623').hide();
            $('#hide_1995839623').show();
        });
        $('#hide_1995839623').click(function() {
            $('#detail_1995839623').slideUp();
            $('#hide_1995839623').hide();
            $('#show_1995839623').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='11981#1334615887'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-04-16T22:38:07+00:00">Apr 16, 2012 10:38 PM UTC</time> by <b>GLOW-TECH</b><a class="anchor" name="1334615887">&nbsp;</a></div><pre>Here&#39;s a summary of the activity that I see in the logs for Isobel&#39;s
jobs that ran at &#34;Fermigridosg1&#34;

Successful jobs&#58; 785
Hours spent on successful jobs&#58; 2369
Failed run attempts&#58; 581
Hours spent on failed run attempts&#58; 394

Not stellar statistics, but also not a terrifying flood of failures.
This does not seem consistent with the situation as seen from Fermilab&#39;s
side.

These are all cases where the glidein validation scripts passed and the
glidein therefore actually attempted to run jobs.  It is possible that
there were cases where the glidein validation scripts did not pass.
That could have resulted in a higher failure rate than suggested by the
numbers above.

From the glidein factory report that was sent to me this morning
(covering 24 hours), I see the following&#58;

strt fval 0job |  val idle  wst badp |  waste    time   total

(GOC factory)
HCC_US_Fermigridosg1                      42%   0%  45% |   0%   1%   1%   9% |     45    2548  |  315

(UCSD factory)
HCC_US_Fermigridosg1                      42%   0%  47% |   0%   1%   2%  14% |     41    2043  |  270

The report key defines the following&#58;

strt - % of jobs where condor failed to start
fval - % of glideins that failed to validate (hit 1000s limit)
0job - %  0 jobs/glidein

<div id='show_37012663' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_37012663'>So I think the validation step is always succeeding, but something is
definitely not healthy with these glideins at Fermigrid, because nearly
half of them never run a job.  It stands out in this respect compared to
all other sites that we used.  I will ask the glidein factory operators
why that might be.  I don&#39;t know if that is related to the problems
being discussed in this ticket.  If it caused rapid failure of the
glidein, it very well could be.

--Dan

On 4/16/12 4&#58;04 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_37012663').click(function() {
            $('#detail_37012663').slideDown("normal");
            $('#show_37012663').hide();
            $('#hide_37012663').show();
        });
        $('#hide_37012663').click(function() {
            $('#detail_37012663').slideUp();
            $('#hide_37012663').hide();
            $('#show_37012663').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='11981#1334610272'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-04-16T21:04:32+00:00">Apr 16, 2012 09:04 PM UTC</time><a class="anchor" name="1334610272">&nbsp;</a></div><pre>Adding myself to Cc

-- by Dave Dykstra</pre></div><div class='update_description'><i onclick="document.location='11981#1334594268'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-04-16T16:37:48+00:00">Apr 16, 2012 04:37 PM UTC</time><a class="anchor" name="1334594268">&nbsp;</a></div><pre>Just spoke to Dan Bradley on the phone. Each of the GLOW/CMS T3 jobs is fetching about 500MB
from cvmfs01 at UW.  Since we are using glexec the parrot cache is not shared between multiple
jobs on a single node but is held for each individual job.
When I say &#34;high&#34; memory below, what we observed on GP Grid and what Ed Simmonds also saw on
D0 Cab is between 1.6 and 2.1 GB.  Not a lot except if it is on a older node which
just has 1GB/slot, which a number of D0 nodes still do.   In that case, PBS master detects
that the job is over memory and attempts to kill it but can&#39;t contact the pbs_mom on the worker node
to do it because it is already too confused and the operating system out-of-memory process killer
is also happening.

Dan has agreed to remove the jobs of this user and has begun to do so.
I will count up the number of squid calls we saw and the number of gums mappings to this
user we did, to see if they match up.

Steve Timm

-- by Steve Timm</pre></div><div class='update_description'><i onclick="document.location='11981#1334592252'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-04-16T16:04:12+00:00">Apr 16, 2012 04:04 PM UTC</time><a class="anchor" name="1334592252">&nbsp;</a></div><pre>Dan--I just got a new report from the people that run our D0 cluster that said that a
lot of these Glow/CMS jobs were using high memory and knocking nodes offline, in addition
to killing both of our Squid servers on Sat. morning 4/14 at 12&#58;20 AM and getting our primaries
paged.   I am following up with the admin of that cluster now, will have more information
shortly. In the meantime what I need immediately
is the estimated amount of size of files per glow/CMS job that is running here at FermiGrid.
The bulk of data that you guys are fetching is unprecedented, we have never seen load
like this on our squid servers before ever since we started keeping track.

Steve

-- by Steve Timm</pre></div><div class='update_description'><i onclick="document.location='11981#1334591767'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-04-16T15:56:07+00:00">Apr 16, 2012 03:56 PM UTC</time> by <b>GLOW-TECH</b><a class="anchor" name="1334591767">&nbsp;</a></div><pre>I am continuing to look into this issue with high priority.  For the
record, here is the general explanation of these jobs that I already
sent in a separate email&#58;

We have been running an increasing number of Wisconsin CMS T3 analysis
jobs opportunistically on the OSG.  For software access, these make use
of cvmfs in user-space via parrot, which uses the site squid to avoid
downloading the same files over and over to the site.  No site support
for cvmfs is required or utilized by these jobs.

The use of GLOW VO for Wisconsin CMS T3 jobs that run opportunistically
in OSG is, as far as I understand, an expected and acceptable use, just
like usage by any other Wisconsin researcher who uses the GLOW VO.  If
you disagree, let me know.  I had not considered that the use of a CMS
VO certificate by the user when running under a GLOW VO glidein could
lead to confusion about what is going on.

We attempt to avoid extremely rapid failure of jobs to avoid the
possibility of overloading sites.  I am looking into whether this
mechanism is working and also why some jobs are failing.

--Dan

On 4/14/12 4&#58;32 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='11981#1334452528'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-04-15T01:15:28+00:00">Apr 15, 2012 01:15 AM UTC</time><a class="anchor" name="1334452528">&nbsp;</a></div><pre>Also from my examination of the log files of the jobs, it appears that these jobs are trying to use
parrot to access the cvmfs store at cms.hep.wisc.edu, as opposed to a native cvmfs client.  Is that correct?

Is there anything in these jobs that would have expected to use the first python in the PATH?  On our
D0 cluster, where many of these jobs exited very quickly, there is a /usr/local/bin/python which leads the path
which is python 2.1.  If there were any python executables in the path that could mess it up.

-- by Steve Timm</pre></div><div class='update_description'><i onclick="document.location='11981#1334447025'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-04-14T23:43:45+00:00">Apr 14, 2012 11:43 PM UTC</time><a class="anchor" name="1334447025">&nbsp;</a></div><pre>I have looked on our worker nodes that are putting some of the highest number of CVMFS calls out.
What I see is a glow glidein coming in via the GLOW frontend but bringing a CMS payload.

14 Apr 2012 02&#58;10&#58;03,380 [INFO ]&#58; GridID[/DC=org/DC=doegrids/OU=Services/CN=d0ca
bosg1.fnal.gov] - Mapped on host &#39;/DC=org/DC=doegrids/OU=Services/CN=d0cabosg1.f
nal.gov&#39; the user &#39;/DC=org/DC=doegrids/OU=People/CN=Isabel Ojalvo 258726&#39; / &#39;/cm
s/Role=NULL/Capability=NULL&#39; to &#39;uscms3624&#39;

This means that GLOW glideins are allowing cross-vo glexec to happen.  Not strictly against OSG policy
but makes it very difficult to know what is going on.  Furthermore in the case of the
Glow VO glideins that landed on our D0 cluster it appears that the CMS jobs were either finishing rapidly
or erroring out.  I counted more than 100 glexecs from this user on a single worker node over the last 24 hours
and as far as I can tell there was only a single glow glidein running at that time.  finally the glidein
matched to the abinitio.bin job of Jonathan Wedell that I refer to below and is still running that.

Please add CMS support to the mix of this ticket.

-- by Steve Timm</pre></div><div class='update_description'><i onclick="document.location='11981#1334439793'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-04-14T21:43:13+00:00">Apr 14, 2012 09:43 PM UTC</time><a class="anchor" name="1334439793">&nbsp;</a></div><pre>As far as we can tell, all of the jobs are of the form abinitio.bin and are submitted by GLOW user Jonathan Wedell.  We can correlate the
access of the cvmfs files via our squid server, with the beginning of the job on the respective user node.

-- by Steve Timm</pre></div><div class='update_description'><i onclick="document.location='11981#1334439131'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-04-14T21:32:11+00:00">Apr 14, 2012 09:32 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1334439131">&nbsp;</a></div><pre>[by Keith Chadwick]

Overnight on FNAL_FERMIGRID, we have observed a pattern of GLOW VO jobs attempting to use the FermiGrid squid servers to access cvmfs files from cvmfs servers at hep.wisc.edu.

Examples&#58;
[root@fg3x3 ~]# grep -m 10 cvmfs /usr/local/vdt/squid/var/logs/access.log
1334381006.196     30 131.225.228.37 TCP_MISS/200 941 GET <a href='http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/.cvmfspublished' target='_blank' rel='nofollow'>http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/.cvmfspublished</a> - DIRECT/144.92.180.77 application/x-cvmfs
1334381006.224     26 131.225.228.37 TCP_MISS/200 1276 GET <a href='http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/data/b5/18184a9453597204b32597fae8df4741a360dfX' target='_blank' rel='nofollow'>http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/data/b5/18184a9453597204b32597fae8df4741a360dfX</a> - DIRECT/144.92.180.77 text/plain
1334381006.257     15 131.225.228.37 TCP_MISS/200 848 GET <a href='http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/.cvmfswhitelist' target='_blank' rel='nofollow'>http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/.cvmfswhitelist</a> - DIRECT/144.92.180.77 application/x-cvmfs
1334381006.907    644 131.225.228.37 TCP_MISS/200 13070389 GET <a href='http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/data/d7/6073e6d6c5475d94bb6b5babf9f4145d0aafa4C' target='_blank' rel='nofollow'>http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/data/d7/6073e6d6c5475d94bb6b5babf9f4145d0aafa4C</a> - DIRECT/144.92.180.77 text/plain
1334381042.248      0 131.225.216.69 TCP_MEM_HIT/200 949 GET <a href='http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/.cvmfspublished' target='_blank' rel='nofollow'>http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/.cvmfspublished</a> - NONE/- application/x-cvmfs
1334381042.248      0 131.225.216.69 TCP_MEM_HIT/200 1284 GET <a href='http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/data/b5/18184a9453597204b32597fae8df4741a360dfX' target='_blank' rel='nofollow'>http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/data/b5/18184a9453597204b32597fae8df4741a360dfX</a> - NONE/- text/plain
1334381042.249      0 131.225.216.69 TCP_MEM_HIT/200 856 GET <a href='http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/.cvmfswhitelist' target='_blank' rel='nofollow'>http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/.cvmfswhitelist</a> - NONE/- application/x-cvmfs
1334381042.454    202 131.225.216.69 TCP_HIT/200 13070397 GET <a href='http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/data/d7/6073e6d6c5475d94bb6b5babf9f4145d0aafa4C' target='_blank' rel='nofollow'>http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/data/d7/6073e6d6c5475d94bb6b5babf9f4145d0aafa4C</a> - NONE/- text/plain
1334381042.482     27 131.225.216.69 TCP_MISS/200 983 GET <a href='http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/data/cc/4f9de0b1fbe7dde29c1dfc4b2aaebffc460c69' target='_blank' rel='nofollow'>http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/data/cc/4f9de0b1fbe7dde29c1dfc4b2aaebffc460c69</a> - DIRECT/144.92.180.77 text/plain
1334381044.735   2251 131.225.216.69 TCP_MISS/200 20568677 GET <a href='http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/data/bc/89d51d908b041d0a73e6e37099b9f03e577c9dC' target='_blank' rel='nofollow'>http&#58;//cvmfs01.hep.wisc.edu/cvmfs/cms.hep.wisc.edu/data/bc/89d51d908b041d0a73e6e37099b9f03e577c9dC</a> - DIRECT/144.92.180.77 text/plain

At the present time, we do not support cvmfs on the CDF, D0, and GP Grid cluster worker nodes.

This extra load on the FermiGrid squid service is interfering with our stakeholder requests.

I request that the GLOW VO wrap their cvmfs file access along the lines of the following bash shell fragment&#58;

if [ -d &#39;/cvmfs&#39; ]
then
&#60;access cvmfs&#62;
fi

If this pattern of cvmfs/squid accesses on FNAL_FERMIGRID by the GLOW VO continues, we may be forced into banning the GLOW VO from FNAL_FERMIGRID resources on a temporary or permanent basis.

-Keith.</pre></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F11981">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
