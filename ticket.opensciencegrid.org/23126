<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="/">
    <title>[23126] VOMS seems to be down</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="//netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="https://ticket.opensciencegrid.org/images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="https://ticket.opensciencegrid.org/lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=23126" method="post">
<div class="page-header">
    <h3><span class="muted">23126</span> / VOMS seems to be down</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Elizabeth Prout</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Associated VO</label><div class="controls">ATLAS</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Elizabeth Prout</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">USATLAS</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Closing</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2014-11-17</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">USATLAS (BNL Prod)&nbsp;<a target="_blank" href="https://rt.racf.bnl.gov/rt/Ticket/Display.html?id=24918">24918</a> <span class="muted"> / Ticket Exchange</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("https://ticket.opensciencegrid.org/attachment/list?id=23126", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="/23126?sort=up&"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="/23126?expandall=true&">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20VOMS%20seems%20to%20be%20down%20ISSUE%3D23126%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='23126#1416243563'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-11-17T16:59:23+00:00">Nov 17, 2014 04:59 PM UTC</time> by <b>Vince Neal</b><a class="anchor" name="1416243563">&nbsp;</a></div><pre>John,

Thank you for the update.  We are going to close this ticket and fold this issue into a larger ticket to handle multiple VOMS updates.

Thanks!
Vince</pre></div><div class='update_description'><i onclick="document.location='23126#1416229599'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-11-17T13:06:39+00:00">Nov 17, 2014 01:06 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1416229599">&nbsp;</a></div><pre>Hi Elizabeth,

Do you have the information you need?

Thanks,
~John
-- by jd at Mon Nov 17 13&#58;06&#58;14 UTC 2014

GOCTX Source&#58; BNL Ticket&#58; Queue=GridServices ID=24918</pre></div><div class='update_description'><i onclick="document.location='23126#1415651955'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-11-10T20:39:15+00:00">Nov 10, 2014 08:39 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1415651955">&nbsp;</a></div><pre>Hi,

On Nov 7, 2014, at 11&#58;32 AM, OSG GOC TX via RT &#60;RT-RACF@....&#62;
wrote&#58;
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; So in answer to your non formatting questions, we came up with these</font>
<font color='#7F7E6F'>&#62; errors during VO package testing. It sounds like we need to remove</font>
at
<font color='#7F7E6F'>&#62; least one of these VOMS. Can you test to see whether you can get an</font>
<font color='#7F7E6F'>&#62; atlas proxy?</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Thank you</font>
<font color='#7F7E6F'>&#62;  -- by Elizabeth Prout at Fri Nov 07 16&#58;31&#58;56 UTC 2014</font>

Sorry&#58; was this meant for me? I unsure whether this issue was
forwarded to the GOC by a user and then to us, and whether you���re
looking for this information from a user ���.

If desired, here���s the full output of a voms proxy initialization for
ATLAS from one of our worker nodes at BNL, which shows that the only
successful entry from the server list is &#39;voms.cern.ch&#58;15001���&#58;

$ voms-proxy-init --voms=atlas
Enter GRID pass phrase for this identity&#58;
Contacting lcg-voms2.cern.ch&#58;15001
[/DC=ch/DC=cern/OU=computers/CN=lcg-voms2.cern.ch] &#34;atlas&#34;...
Error contacting lcg-voms2.cern.ch&#58;15001 for VO atlas&#58; Connection
refused
Error contacting lcg-voms2.cern.ch&#58;15001 for VO atlas&#58; Connection
refused
Error contacting lcg-voms2.cern.ch&#58;15001 for VO atlas&#58; REST and legacy
VOMS endpoints failed.
Contacting voms2.cern.ch&#58;15001
[/DC=ch/DC=cern/OU=computers/CN=voms2.cern.ch] &#34;atlas&#34;...
Error contacting voms2.cern.ch&#58;15001 for VO atlas&#58; Connection refused
<div id='show_1439921608' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1439921608'>Error contacting voms2.cern.ch&#58;15001 for VO atlas&#58; Connection refused
Error contacting voms2.cern.ch&#58;15001 for VO atlas&#58; REST and legacy
VOMS endpoints failed.
Contacting lcg-voms.cern.ch&#58;15001 [/DC=ch/DC=cern/OU=computers/CN=lcg-
voms.cern.ch] &#34;atlas&#34;...
Error contacting lcg-voms.cern.ch&#58;15001 for VO atlas&#58; Read timed out
Error contacting lcg-voms.cern.ch&#58;15001 for VO atlas&#58; peer not
authenticated
Error contacting lcg-voms.cern.ch&#58;15001 for VO atlas&#58; REST and legacy
VOMS endpoints failed.
Contacting voms.cern.ch&#58;15001
[/DC=ch/DC=cern/OU=computers/CN=voms.cern.ch] &#34;atlas&#34;...
Remote VOMS server contacted succesfully.
Created proxy in /tmp/x509up_u9655.
Your proxy is valid until Tue Nov 11 03&#58;32&#58;34 EST 2014

Apparently the other server errors are related to a service move at
CERN, though I���m not clear on whether the move was/is to or from these
servers.

~John

-- by jd at Mon Nov 10 20&#58;38&#58;44 UTC 2014

GOCTX Source&#58; BNL Ticket&#58; Queue=GridServices ID=24918
</div><script type='text/javascript'>
        $('#show_1439921608').click(function() {
            $('#detail_1439921608').slideDown("normal");
            $('#show_1439921608').hide();
            $('#hide_1439921608').show();
        });
        $('#hide_1439921608').click(function() {
            $('#detail_1439921608').slideUp();
            $('#hide_1439921608').hide();
            $('#show_1439921608').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='23126#1415377916'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-11-07T16:31:56+00:00">Nov 7, 2014 04:31 PM UTC</time> by <b>echism</b><a class="anchor" name="1415377916">&nbsp;</a></div><pre>So in answer to your non formatting questions, we came up with these errors during VO package testing. It sounds like we need to remove at least one of these VOMS. Can you test to see whether you can get an atlas proxy?

Thank you</pre></div><div class='update_description'><i onclick="document.location='23126#1415377761'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-11-07T16:29:21+00:00">Nov 7, 2014 04:29 PM UTC</time> by <b>echism</b><a class="anchor" name="1415377761">&nbsp;</a></div><pre>I’m not sure.

Elizabeth Prout
Open Science Grid Operations
Indiana University Research Technologies

On Nov 7, 2014, at 10&#58;54 AM, Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='23126#1415375651'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-11-07T15:54:11+00:00">Nov 7, 2014 03:54 PM UTC</time><a class="anchor" name="1415375651">&nbsp;</a></div><pre>I can&#39;t help but wonder why &#34;vo.racf.bnl.gov&#34; in my response was translated to&#58;
ï¿½ï¿½ï¿½vo.racf.bnl.govï¿½ï¿½ï¿½
by the GOC interface?

~John

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John S. De Stefano Jr. 719</pre></div><div class='update_description'><i onclick="document.location='23126#1415374417'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-11-07T15:33:37+00:00">Nov 7, 2014 03:33 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1415374417">&nbsp;</a></div><pre>Hi,

On Nov 7, 2014, at 8&#58;52 AM, Yingzi (Iris) Wu via RT &#60;RT-RACF@....&#62;
wrote&#58;
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On Fri, Nov 07, 2014 at 8&#58;51&#58;08 AM EST, OSG GOC TX created the</font>
following ticket&#58;
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; We are receiving the following errors&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;  ERROR&#58; Can&#39;t contact atlas/lcg-voms2.cern.ch.</font>
<font color='#7F7E6F'>&#62;     ERROR&#58; Can&#39;t contact atlas/vo.racf.bnl.gov.</font>
<font color='#7F7E6F'>&#62;     ERROR&#58; Can&#39;t contact cms/voms2.cern.ch.</font>
<font color='#7F7E6F'>&#62;     ERROR&#58; Can&#39;t contact cms/lcg-voms2.cern.ch.</font>

Can you provide a bit more context? What action triggered these
errors? Where was it performed?

Note that ���vo.racf.bnl.gov��� is no longer an active VOMS server; the
other servers cited are hosted at CERN and are outside the domain of
the RACF.

~John

-- by jd at Fri Nov 07 15&#58;32&#58;54 UTC 2014

GOCTX Source&#58; BNL Ticket&#58; Queue=GridServices ID=24918</pre></div><div class='update_description'><i onclick="document.location='23126#1415368247'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-11-07T13:50:47+00:00">Nov 7, 2014 01:50 PM UTC</time> by <b>echism</b><a class="anchor" name="1415368247">&nbsp;</a></div><pre>We are receiving the following errors&#58;

ERROR&#58; Can&#39;t contact atlas/lcg-voms2.cern.ch.
ERROR&#58; Can&#39;t contact atlas/vo.racf.bnl.gov.
ERROR&#58; Can&#39;t contact cms/voms2.cern.ch.
ERROR&#58; Can&#39;t contact cms/lcg-voms2.cern.ch.</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F23126">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="/images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 23126});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
