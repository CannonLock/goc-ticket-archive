<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="/">
    <title>[30570] OSG VO causing outbound network issues at BNL</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="//netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="https://ticket.opensciencegrid.org/images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="https://ticket.opensciencegrid.org/lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=30570" method="post">
<div class="page-header">
    <h3><span class="muted">30570</span> / OSG VO causing outbound network issues at BNL</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Rob Quick</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Rob Quick</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ping user support on call if nothing</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2016-08-15</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
        <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("https://ticket.opensciencegrid.org/attachment/list?id=30570", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="/30570?sort=up&"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="/30570?expandall=true&">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20OSG%20VO%20causing%20outbound%20network%20issues%20at%20BNL%20ISSUE%3D30570%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='30570#1471295105'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-15T21:05:05+00:00">Aug 15, 2016 09:05 PM UTC</time> by <b>echism</b><a class="anchor" name="1471295105">&nbsp;</a></div><pre>Closing as advised.</pre></div><div class='update_description'><i onclick="document.location='30570#1471010353'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-12T13:59:13+00:00">Aug 12, 2016 01:59 PM UTC</time> by <b>Xin zhao</b><a class="anchor" name="1471010353">&nbsp;</a></div><pre>Yes, this ticket can be closed.

Thanks,

Xin

On 8/11/2016 5&#58;34 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='30570#1470951271'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-08-11T21:34:31+00:00">Aug 11, 2016 09:34 PM UTC</time> by <b>echism</b><a class="anchor" name="1470951271">&nbsp;</a></div><pre>Xin,

Should I close this?

Thank you</pre></div><div class='update_description'><i onclick="document.location='30570#1469626870'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-07-27T13:41:10+00:00">Jul 27, 2016 01:41 PM UTC</time> by <b>Xin zhao</b><a class="anchor" name="1469626870">&nbsp;</a></div><pre>From this end, we bounce the job limit for osg vo back up to 2k now, as
the traffic seems to have stabilized at an acceptable level.

Xin

On 7/26/2016 11&#58;20 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='30570#1469546421'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-07-26T15:20:21+00:00">Jul 26, 2016 03:20 PM UTC</time> by <b>echism</b><a class="anchor" name="1469546421">&nbsp;</a></div><pre>User support,

Any thoughts here?

Thank you</pre></div><div class='update_description'><i onclick="document.location='30570#1469195769'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-07-22T13:56:09+00:00">Jul 22, 2016 01:56 PM UTC</time> by <b>Xin zhao</b><a class="anchor" name="1469195769">&nbsp;</a></div><pre>Several days ago, a small number of osg vo jobs seemed to be running
some xrootd transfer tests, which saturated our firewall again. I had to
further tighten the limit, to &#60;10. Note that the limit is only on the
osg vo, other OSG VOs can still use a lot more job slots.

Looks like the behavior is really user job dependent. Not sure how much
user support can do in general to address this issue. From site point of
view, we will just have to monitor it and adjust limit accordingly.

Xin

On 7/21/2016 11&#58;40 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='30570#1469115621'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-07-21T15:40:21+00:00">Jul 21, 2016 03:40 PM UTC</time> by <b>echism</b><a class="anchor" name="1469115621">&nbsp;</a></div><pre>Is there anything further on this? What remains to be done?

Thank you</pre></div><div class='update_description'><i onclick="document.location='30570#1468869550'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-07-18T19:19:10+00:00">Jul 18, 2016 07:19 PM UTC</time> by <b>echism</b><a class="anchor" name="1468869550">&nbsp;</a></div><pre>User support,

Do you have anything further on this?

Thank you</pre></div><div class='update_description'><i onclick="document.location='30570#1468428592'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-07-13T16:49:52+00:00">Jul 13, 2016 04:49 PM UTC</time><a class="anchor" name="1468428592">&nbsp;</a></div><pre>I just add the attachment of the network traffic report to this ticket via the web interface.
Xin

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=xzhao/CN=603864/CN=Xin Zhao</pre></div><div class='update_description'><i onclick="document.location='30570#1468428429'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-07-13T16:47:09+00:00">Jul 13, 2016 04:47 PM UTC</time> by <b>Xin zhao</b><a class="anchor" name="1468428429">&nbsp;</a></div><pre>Hi Mats,

Attached is the traffic report from our network group, which shows
traffic coming into our firewall during 07/12 7AM~8AM, the column
&#34;Application IP&#34; is the source, then the protocol/port, then the data
amount.

I also take a look at a running job under osg vo, which has taken ~500M
local disk space. The real user proxy (inside glidein) is
&#34;/C=DE/O=GermanGrid/OU=KIT/CN=Benedikt Maier/CN=proxy/CN=limited proxy&#34;,
and this is the files under its &#34;work&#34; subdir&#58;

[root@acas1652 dir_20524]# ls work/
CMSSW_7_1_18           LheProd.py
monotop-nr-2100_med-2100_nev-100_seed-5916_gen.root
monotop-nr-2100_med-2100_nev-100_seed-5916_simraw.root SimRawProd.py
CMSSW_8_0_3_patch1     madgraph-monotop-nr-2100
monotop-nr-2100_med-2100_nev-100_seed-5916_gensim.root
py.py                                                   SITECONF
histProbFunction.root  MG5_aMC_v2_3_3
monotop-nr-2100_med-2100_nev-100_seed-5916.lhe          SimProd.py

Hope this helps.

Right now, with cap of 2k OSG opportunity jobs, we see 1~2Gb/s constant
traffic on our firewall. We don&#39;t want to see this traffic going higher,
so we will keep the cap at 2k for now.

Thanks,

Xin

On 7/13/2016 11&#58;04 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='30570#1468425010'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-07-13T15:50:10+00:00">Jul 13, 2016 03:50 PM UTC</time> by <b>Xin zhao</b><a class="anchor" name="1468425010">&nbsp;</a></div><pre>Hi Mats,

I will ask our network engineers for more detailed reports, but the
pattern you describe sounds about right, although the connection should
be initiated from inside jobs first, then the data came in from outside,
as we only allow outbound connections from the worker nodes. Maybe the
jobs are using stashcache ?  I should have list of outside servers that
were sending data into BNL, after the report is generated...

Thanks,

Xin

On 7/13/2016 11&#58;04 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='30570#1468422263'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-07-13T15:04:23+00:00">Jul 13, 2016 03:04 PM UTC</time><a class="anchor" name="1468422263">&nbsp;</a></div><pre>Xin,

Do you have any more details from your firewall?

We did see a large increase of glideins starting up on your site in a short amount of time. The user we are looking at would have mostly traffic coming into your site, and outbound would be considerable less.

Thanks,
Mats

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Mats Rynge 45</pre></div><div class='update_description'><i onclick="document.location='30570#1468421999'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-07-13T14:59:59+00:00">Jul 13, 2016 02:59 PM UTC</time> by <b>Scott Teige</b><a class="anchor" name="1468421999">&nbsp;</a></div><pre>The suspected user (strolog) was located using this status viewer&#58;
<a href='http&#58;//osg-flock.grid.iu.edu/overview/xd-login.php' target='_blank' rel='nofollow'>http&#58;//osg-flock.grid.iu.edu/overview/xd-login.php</a>
During the problem cell in the column &#34;Est. data rate out&#34; associated with the Username &#34;strolog&#34; was highlighted
in yellow and showed a value of 1011 Mb/s. Once the suspected username was found, the associated project
was identified.

As of this writing, this cell shows a value of 243 Kb/s and is not highlighted.</pre></div><div class='update_description'><i onclick="document.location='30570#1468420044'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-07-13T14:27:24+00:00">Jul 13, 2016 02:27 PM UTC</time> by <b>echism</b><a class="anchor" name="1468420044">&nbsp;</a></div><pre>CCing user support.</pre></div><div class='update_description'><i onclick="document.location='30570#1468419426'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-07-13T14:17:06+00:00">Jul 13, 2016 02:17 PM UTC</time> by <b>Rob Quick</b><a class="anchor" name="1468419426">&nbsp;</a></div><pre>Xin reports high outbound network traffic impacting the institutional firewall. BNL as imposed a temporary 2000 OSG VO job limit until the problem is identified or traffic levels subside. Please assign this to user support to investigate.

During the Production call there was some discussion the issue may be in the DectorDesign project.</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F30570">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="/images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 30570});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
