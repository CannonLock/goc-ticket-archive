<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[15770] bestman2 won&#39;t start with new cert</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=15770" method="post">
<div class="page-header">
    <h3><span class="muted">15770</span> / bestman2 won&#39;t start with new cert</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Steve Johnson</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Resource Name</label><div class="controls">TAMU_Calclab_SE</div></div><div class="control-group"><label class="control-label">Associated VO</label><div class="controls">SURAgrid</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Steve Johnson</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">SURAgrid GOC</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">neha to update</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2013-08-14</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">SURAgrid <span class="muted"> / OSG Support Centers</span></div><div class="assignee" style="width: 60%">Neha Sharma <span class="muted"> / OSG Storage Team</span></div><div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/15770", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/15770?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/15770?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20bestman2%20won%26%2339%3Bt%20start%20with%20new%20cert%20ISSUE%3D15770%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='15770#1384362332'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-11-13T17:05:32+00:00">Nov 13, 2013 05:05 PM UTC</time><a class="anchor" name="1384362332">&nbsp;</a></div><pre>Here&#39;s an update.  We&#39;re rolling out a new Bestman server and generated a cert for it. Sure enough, I forgot about using SL5 for the CSR instead of SL6. After generating a couple certs and failing, it appears to be that openssl.cnf in SL6 [ req ]includes req_extensions = v3_req, whereas in SL5 this is not included.  If this section is not included Bestman appears happy with the resultant key and cert.  Note, I generated the final CSR on SL5 with the [ v3_req ] section excluded.  I also generated a bad CSR under SL5 with [ v3_req ] included, so it looks like this is the offending section for Bestman use.

Related&#58; it would be nice to get subjectAltName support in all of the host certs, but that appears to only be available with v3_req, which works for gatekeeper, gridftp, etc, but not Bestman.

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Steve Johnson 666</pre></div><div class='update_description'><i onclick="document.location='15770#1376678790'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-16T18:46:30+00:00">Aug 16, 2013 06:46 PM UTC</time> by <b>echism</b><a class="anchor" name="1376678790">&nbsp;</a></div><pre>Thanks all, I will close this.

Elizabeth</pre></div><div class='update_description'><i onclick="document.location='15770#1376082651'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-09T21:10:51+00:00">Aug 9, 2013 09:10 PM UTC</time><a class="anchor" name="1376082651">&nbsp;</a></div><pre>Generating a CSR & Key from SL5 appears to have given me a certificate that&#39;s usable by Java in SL6 - not that this may be the definitive cause. I&#39;ll leave this to y&#39;all if you want to chase it further.

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Steve Johnson 666</pre></div><div class='update_description'><i onclick="document.location='15770#1375904625'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-07T19:43:45+00:00">Aug 7, 2013 07:43 PM UTC</time> by <b>echism</b><a class="anchor" name="1375904625">&nbsp;</a></div><pre>Hello all,

May I close this, or is a further root cause analysis ongoing?

Thank you,
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='15770#1375115910'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-29T16:38:30+00:00">Jul 29, 2013 04:38 PM UTC</time><a class="anchor" name="1375115910">&nbsp;</a></div><pre>This morning I revoked the existing cert for calcfs2.math.tamu.edu, whose CSR/key were generated on SL6.  I generated a new one using openssl on a SL5 system. The new cert/key pair works!  This is only a single data point, but I hope that there isn&#39;t some anomaly in SL6&#39;s openssl CSR/key generation that breaks Bestman.

// Steve

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Steve Johnson 666</pre></div><div class='update_description'><i onclick="document.location='15770#1374614898'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-23T21:28:18+00:00">Jul 23, 2013 09:28 PM UTC</time><a class="anchor" name="1374614898">&nbsp;</a></div><pre>Correct.  The SL6 generated cert worked fine for GRAM and GridFTP, just not for Bestman (Java).

// Steve

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Steve Johnson 666</pre></div><div class='update_description'><i onclick="document.location='15770#1374611856'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-23T20:37:36+00:00">Jul 23, 2013 08:37 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1374611856">&nbsp;</a></div><pre>It was generated on a SL5 node. But didn&#39;t you say that same cert (one generated on SL6 node) worked fine for the gridftp server?</pre></div><div class='update_description'><i onclick="document.location='15770#1374610346'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-23T20:12:26+00:00">Jul 23, 2013 08:12 PM UTC</time><a class="anchor" name="1374610346">&nbsp;</a></div><pre>Neha, let me check on login access.

In the meantime, on the SL6 machine on which bestman worked for you, was the original cert request and key generated on a SL5 machine or SL6?

Over the weekend I had a cert that was about to expire on a SL5 system, so I generated a new csr and key on that same SL5 system and downloaded a new cert. Bestman and the other services came up without problems.

Just seeing if SL6 may be doing something odd with the key or csr.

// Steve

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Steve Johnson 666</pre></div><div class='update_description'><i onclick="document.location='15770#1374252486'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-19T16:48:06+00:00">Jul 19, 2013 04:48 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1374252486">&nbsp;</a></div><pre>Is it possible for me to get login to calclab-ce2.math.tamu.edu?</pre></div><div class='update_description'><i onclick="document.location='15770#1374252393'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-19T16:46:33+00:00">Jul 19, 2013 04:46 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1374252393">&nbsp;</a></div><pre>It starts up and works just fine

4835 [main] INFO gov.lbl.srm.server.JettyGSIConnector7 - Loading credentials
4835 [main] INFO gov.lbl.srm.server.JettyGSIConnector7 - Server Certificate&#58; /etc/grid-security/bestman/bestmancert.pem
4835 [main] INFO gov.lbl.srm.server.JettyGSIConnector7 - Server Key&#58; /etc/grid-security/bestman/bestmankey.pem
4888 [main] INFO org.eclipse.jetty.server.AbstractConnector - Started JettyGSIConnector7@0.0.0.0&#58;8443
..............config file=/etc/bestman2/conf/bestman2.rc
BeStMan-Jetty is ready.
101571 [qtp967563977-15] INFO org.apache.axis.configuration.FileProvider - Configuration file read-only so engine configuration changes will not be saved.
### [srmPing] tid =qtp967563977-15
### [getGUMSMap] tid =qtp967563977-15

[root@fermicloud382 ~]# ls -hlt /etc/grid-security/bestman/
total 8.0K
-r--r--r-- 1 bestman bestman 2.0K Jul 19 11&#58;33 bestmancert.pem
-r-------- 1 bestman bestman 1.7K Jul 19 11&#58;32 bestmankey.pem
[root@fermicloud382 ~]#

subject= /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=Services/CN=fermicloud382.fnal.gov
issuer= /DC=com/DC=DigiCert-Grid/O=DigiCert Grid/CN=DigiCert Grid CA-1

[root@fermicloud382 ~]# openssl x509 -text -noout -in /etc/grid-security/bestman/bestmancert.pem | grep Signature
Signature Algorithm&#58; sha1WithRSAEncryption
Digital Signature, Key Encipherment, Data Encipherment
Signature Algorithm&#58; sha1WithRSAEncryption

[root@fermicloud382 ~]# openssl x509 -text -noout -in /etc/grid-security/bestman/bestmancert.pem | grep Public
Subject Public Key Info&#58;
Public Key Algorithm&#58; rsaEncryption
Public-Key&#58; (2048 bit)
[root@fermicloud382 ~]#</pre></div><div class='update_description'><i onclick="document.location='15770#1374247697'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-19T15:28:17+00:00">Jul 19, 2013 03:28 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1374247697">&nbsp;</a></div><pre>Hmm, my test node was SL5. Let me try on SL6</pre></div><div class='update_description'><i onclick="document.location='15770#1374177499'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-18T19:58:19+00:00">Jul 18, 2013 07:58 PM UTC</time><a class="anchor" name="1374177499">&nbsp;</a></div><pre>Yep, it&#39;s currently daemon, which coincides with the ownership of /var/log/
#SRM_OWNER=bestman
SRM_OWNER=daemon

I tried bringing up a bestman2 instance on calclab-ce2.math.tamu.edu, which has a recent cert from Digicert and got the same results&#58; the server starts, but fails with AlgNotSup when it tries to setup the SSL listener.  This was also a SL6.4 machine running bestman2 straight out of the box as the bestman user.

// Steve

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Steve Johnson 666</pre></div><div class='update_description'><i onclick="document.location='15770#1374175196'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-18T19:19:56+00:00">Jul 18, 2013 07:19 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1374175196">&nbsp;</a></div><pre>Hi
Yes, Bestman starts up and works just fine on my test node using a Digicert SHA1 based host certificate/key pair.

Can you post the output of

[root@fermicloud361 ~]# cat /etc/sysconfig/bestman2 | grep SRM_OWNER
SRM_OWNER=bestman
[root@fermicloud361 ~]#

In your case, it should be &#39;daemon&#39;</pre></div><div class='update_description'><i onclick="document.location='15770#1374096288'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-17T21:24:48+00:00">Jul 17, 2013 09:24 PM UTC</time> by <b>echism</b><a class="anchor" name="1374096288">&nbsp;</a></div><pre>Hi Neha,

Do you have any updates on this?

Thank you,
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='15770#1373492309'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-10T21:38:29+00:00">Jul 10, 2013 09:38 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1373492309">&nbsp;</a></div><pre>Thanks Steve.
The new jglobus libraries used by Bestman are SHA1 compatible
Let me see if I can locate a test node with a SHA1 cert issued by Digicert CA
-Neha</pre></div><div class='update_description'><i onclick="document.location='15770#1373490393'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-10T21:06:33+00:00">Jul 10, 2013 09:06 PM UTC</time><a class="anchor" name="1373490393">&nbsp;</a></div><pre>The choice of running as user daemon was in keeping with the previous installation of bestman on this machine.  Ownership of the certificates and logfiles all correspond with the user defined configuration file.  I&#39;ve already tried running/owning under bestman - still won&#39;t run.

Adding the u+w on the cert file didn&#39;t help.

host{cert,key}.pem are installed but the /etc/sysconfig/bestman2 and /etc/bestman2/conf/bestman2.rc files are not configured to use them. Rather, they use a copy of them in srm{cert,key}.pem owned by the daemon (or bestman) user.  The log files show that they are being opened, but then error out.

This same cert/key pair *works* for the gridftp server.  It&#39;s the java libraries that are throwing an error for bestman2, java.security.InvalidKeyException&#58; algNotSup.

bestman2-client-libs-2.3.0-9.osg.el6.noarch
bestman2-common-libs-2.3.0-9.osg.el6.noarch
bestman2-server-2.3.0-9.osg.el6.noarch
osg-se-bestman-3.0.0-8.osg.el6.x86_64
bestman2-server-dep-libs-2.3.0-9.osg.el6.noarch
bestman2-server-libs-2.3.0-9.osg.el6.noarch
bestman2-tester-2.3.0-9.osg.el6.noarch
bestman2-client-2.3.0-9.osg.el6.noarch
bestman2-tester-libs-2.3.0-9.osg.el6.noarch
jglobus-2.0.5-3.osg.el6.noarch
cog-jglobus-axis-1.8.0-2.osg.el6.noarch

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Steve Johnson 666</pre></div><div class='update_description'><i onclick="document.location='15770#1373487490'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-10T20:18:10+00:00">Jul 10, 2013 08:18 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1373487490">&nbsp;</a></div><pre>I am not sure why it would be running as user &#39;daemon&#39;. It should be running as user &#39;bestman&#39;. The ownership of the certs you mentioned should be changed accordingly.

The permissions on the cert should be rw-r-r

Details on the certs required and their ownership is documented here
<a href='https&#58;//www.opensciencegrid.org/bin/view/Documentation/Release3/InstallOSGBestmanSE' target='_blank' rel='nofollow'>https&#58;//www.opensciencegrid.org/bin/view/Documentation/Release3/InstallOSGBestmanSE</a>

You do have /etc/grid-security/hostcert.pem and /etc/grid-security/hostkey.pem right?

Also, can you post output of

<font color='#7F7E6F'>&#62; rpm -qa | grep bestman</font>
<font color='#7F7E6F'>&#62; rpm -qa | grep jglobus</font></pre></div><div class='update_description'><i onclick="document.location='15770#1373321703'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-08T22:15:03+00:00">Jul 8, 2013 10:15 PM UTC</time><a class="anchor" name="1373321703">&nbsp;</a></div><pre>We have a separate GUMS server.

BESTMAN_GUMSCERTPATH=/etc/grid-security/srmcert.pem
BESTMAN_GUMSKEYPATH=/etc/grid-security/srmkey.pem
BESTMAN_GUMS_ENABLED=yes

-r--r--r-- 1 daemon daemon 1.9K Jun 26 16&#58;32 /etc/grid-security/srmcert.pem
-r-------- 1 daemon daemon 1.7K Jun 27 10&#58;21 /etc/grid-security/srmkey.pem

This is the same cert/key used by bestman2 as defined in /etc/bestman2/conf/bestman2.rc&#58;
CertFileName=/etc/grid-security/srmcert.pem
KeyFileName=/etc/grid-security/srmkey.pem

bestman2 is running as user daemon.

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Steve Johnson 666</pre></div><div class='update_description'><i onclick="document.location='15770#1373317435'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-08T21:03:55+00:00">Jul 8, 2013 09:03 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1373317435">&nbsp;</a></div><pre>Hi

1) I doubt it, but by any chance, are your Bestman and GUMS servers running on same host?

2) Can you post the output of

ls -hlt /etc/grid-security/hostcert.pem
ls -hlt /etc/grid-security/hostkey.pem
cat  /etc/sysconfig/bestman2 | grep BESTMAN_GUMS

and the permissions on the values of
BESTMAN_GUMSCERTPATH
BESTMAN_GUMSKEYPATH

-Neha</pre></div><div class='update_description'><i onclick="document.location='15770#1372451766'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-06-28T20:36:06+00:00">Jun 28, 2013 08:36 PM UTC</time> by <b>echism</b><a class="anchor" name="1372451766">&nbsp;</a></div><pre>Software team,

After installing a new cert, which is working with other software, and has been checked over for permissions, ownership etc, Steve is getting a java error that mentions an unsupported algorithm. I thought this mean that he&#39;d somehow ended up with a SHA2 cert, but now that we&#39;ve ruled that out, I&#39;m not sure what algorithm could be referenced here. Please look over this ticket.

Thank you,
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='15770#1372438158'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-06-28T16:49:18+00:00">Jun 28, 2013 04:49 PM UTC</time><a class="anchor" name="1372438158">&nbsp;</a></div><pre>It doesn&#39;t appear to be&#58;

openssl x509 -in srmcert.pem -noout -text
...
Signature Algorithm&#58; sha1WithRSAEncryption
...
Public Key Algorithm&#58; rsaEncryption
Public-Key&#58; (2048 bit)

// Steve

by /DC=org/DC=doegrids/OU=People/CN=Steve Johnson 737432</pre></div><div class='update_description'><i onclick="document.location='15770#1372438013'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-06-28T16:46:53+00:00">Jun 28, 2013 04:46 PM UTC</time> by <b>echism</b><a class="anchor" name="1372438013">&nbsp;</a></div><pre>Is it a SHA2 cert?

Thank you,
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='15770#1372437528'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-06-28T16:38:48+00:00">Jun 28, 2013 04:38 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1372437528">&nbsp;</a></div><pre>I installed a new DigiCert certificate issued on June 26 on calcfs2.math.tamu.edu (TAMU_Calclab_SE).  bestman2 refuses to start with this new cert/key pair.

The first error thrown is&#58;
java.security.InvalidKeyException&#58; algNotSup
... &#60;more traceback&#62; ...
Error&#58; no host DN extracted. Can not start GUMS. Exiting.

The java process exits after this error.

If I define GUMSCurrHostDN in bestman2.rc and restart, this error is bypassed, but the SSL listener is never created due to the same errors&#58;
org.globus.gsi.CredentialException&#58; algNotSup
...
Caused by&#58; java.security.InvalidKeyException&#58; algNotSup
at org.globus.gsi.OpenSSLKey.parseKeyAlgorithm(OpenSSLKey.java&#58;220)
at org.globus.gsi.OpenSSLKey.readPEM(OpenSSLKey.java&#58;158)
at org.globus.gsi.OpenSSLKey.&#60;init&#62;(OpenSSLKey.java&#58;97)
at org.globus.gsi.bc.BouncyCastleOpenSSLKey.&#60;init&#62;(BouncyCastleOpenSSLKey.java&#58;67)
at org.globus.gsi.X509Credential.loadKey(X509Credential.java&#58;667)

The java process continues to run without providing a listener.

I verified the modulus is the same for the cert/key/csr, and the same cert/key works fine with the gridftp server (same system).  I checked the permissions and owners on the files multiple times.

OS&#58; SL6.4
Current OSG3 stack, including
bestman2-server-2.3.0-9.osg.el6.noarch
java-1.6.0-sun-compat-1.6.0.45-1.osg.el6.x86_64 (also tried java-1.7.0-openjdk-1.7.0.25-2.3.10.3.el6_4.x86_64)
bouncycastle-1.46-1.el6.noarch (also tried 1.49 jar)
jglobus-2.0.5-3.osg.el6.noarch

// Steve

by /DC=org/DC=doegrids/OU=People/CN=Steve Johnson 737432</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F15770">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
