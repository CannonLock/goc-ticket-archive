<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[4472] dCache - Unable to retrieve file (from dCache) immediately, once it has been copied successfully</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=4472" method="post">
<div class="page-header">
    <h3><span class="muted">4472</span> / dCache - Unable to retrieve file (from dCache) immediately, once it has been copied successfully</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Neha Sharma</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Wait for update in DESY ticketing system</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2008-07-09</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Kyle Gross <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">Neha Sharma <span class="muted"> / OSG Storage Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/4472", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/4472?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/4472?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20dCache%20-%20Unable%20to%20retrieve%20file%20%28from%20dCache%29%20immediately%2C%20once%20it%20has%20been%20copied%20successfully%20ISSUE%3D4472%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='4472#1214411938'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-06-25T16:38:58+00:00">Jun 25, 2008 04:38 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1214411938">&nbsp;</a></div><pre>Hi all,

I will try to get to it soon. I will first need to check
if the problem still there after the most recent dCache upgrades
at MIT.
Ilya</pre></div><div class='update_description'><i onclick="document.location='4472#1214329084'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-06-24T17:38:04+00:00">Jun 24, 2008 05:38 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1214329084">&nbsp;</a></div><pre>Any new info on this?</pre></div><div class='update_description'><i onclick="document.location='4472#1212589423'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-06-04T14:23:43+00:00">Jun 4, 2008 02:23 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1212589423">&nbsp;</a></div><pre>Hi Neha et al.

usually it&#39;s the case where local nfs cache on ftp door is not updated yet. Could you please try to add
following line into dCacheSetup file on ftpdoor host , restart the door and try again&#58;

PermissionHandlerDataSource=diskCacheV111.services.PnfsManagerFileMetaDataSource

Regards,
Tigran.</pre></div><div class='update_description'><i onclick="document.location='4472#1208892897'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-04-22T19:34:57+00:00">Apr 22, 2008 07:34 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1208892897">&nbsp;</a></div><pre>No new information on this. Will close the ticket if there is no update within a week

-Neha</pre></div><div class='update_description'><i onclick="document.location='4472#1205944242'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-03-19T16:30:42+00:00">Mar 19, 2008 04:30 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1205944242">&nbsp;</a></div><pre>No update. Asked Ted to ask Timur if he can get to this soon enough.

-Neha</pre></div><div class='update_description'><i onclick="document.location='4472#1204909245'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-03-07T17:00:45+00:00">Mar 7, 2008 05:00 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1204909245">&nbsp;</a></div><pre>No update yet</pre></div><div class='update_description'><i onclick="document.location='4472#1203524564'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-02-20T16:22:44+00:00">Feb 20, 2008 04:22 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1203524564">&nbsp;</a></div><pre>No update in DESY ticketing system. #2473</pre></div><div class='update_description'><i onclick="document.location='4472#1202837462'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-02-12T17:31:02+00:00">Feb 12, 2008 05:31 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1202837462">&nbsp;</a></div><pre>Sure.

I first copy the file to remote SE
+++++++++++++++++++++++++++
/opt/d-cache/srm/bin/srmcp  -debug=true
file&#58;////home/s1/neha/work/storage-vdt/billing-test-plan.html
<a href='srm&#58;//se01.cmsaf.mit.edu&#58;8443//pnfs/cmsaf.mit.edu/t2bat/test/billing-test-plan.html' target='_blank' rel='nofollow'>srm&#58;//se01.cmsaf.mit.edu&#58;8443//pnfs/cmsaf.mit.edu/t2bat/test/billing-test-plan.html</a>

...
...
...
GridftpClient&#58; gridFTPWrite started, destination path is
/pnfs/cmsaf.mit.edu/t2bat/test/billing-test-plan.html
GridftpClient&#58; set local data channel authentication mode to None
GridftpClient&#58; parallelism&#58; 10
GridftpClient&#58; adler32 for file java.io.RandomAccessFile@1e184cb is 40452ff5
GridftpClient&#58; waiting for completion of transfer
GridftpClient&#58; starting a transfer to
/pnfs/cmsaf.mit.edu/t2bat/test/billing-test-plan.html
GridftpClient&#58; DiskDataSink.close() called
GridftpClient&#58; gridFTPWrite() wrote 2396bytes
GridftpClient&#58; closing client &#58;
org.dcache.srm.util.GridftpClient$FnalGridFTPClient@54f9f1
GridftpClient&#58; closed client
execution of CopyJob, source =
file&#58;////home/s1/neha/work/storage-vdt/billing-test-plan.html destination =
<a href='gsiftp&#58;//SE03.CMSAF.MIT.EDU&#58;2811//pnfs/cmsaf.mit.edu/t2bat/test/billing-test-plan.html' target='_blank' rel='nofollow'>gsiftp&#58;//SE03.CMSAF.MIT.EDU&#58;2811//pnfs/cmsaf.mit.edu/t2bat/test/billing-test-plan.html</a>
completed
setting file request -2145848473 status to Done
copy_jobs is empty
stopping copier
&#60;tam01.fnal.gov&#62;

AS SOON AS this transfer succeeds, I try to get the file back. I therefore, run
following command in another terminal
<div id='show_232444427' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_232444427'>++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
/opt/d-cache/srm/bin/srmcp -debug
<a href='srm&#58;//se01.cmsaf.mit.edu&#58;8443//pnfs/cmsaf.mit.edu/t2bat/test/billing-test-plan.html' target='_blank' rel='nofollow'>srm&#58;//se01.cmsaf.mit.edu&#58;8443//pnfs/cmsaf.mit.edu/t2bat/test/billing-test-plan.html</a>
file&#58;////home/s1/neha/return-billing

It fails with file not found error

...
...
...
Tue Feb 12 11&#58;26&#58;39 CST 2008&#58; fileIDs is empty, breaking the loop
copying CopyJob, source =
<a href='gsiftp&#58;//SE03.CMSAF.MIT.EDU&#58;2811//pnfs/cmsaf.mit.edu/t2bat/test/billing-test-plan.html' target='_blank' rel='nofollow'>gsiftp&#58;//SE03.CMSAF.MIT.EDU&#58;2811//pnfs/cmsaf.mit.edu/t2bat/test/billing-test-plan.html</a>
destination = file&#58;////home/s1/neha/return-billing
GridftpClient&#58; memory buffer size is set to 131072
GridftpClient&#58; connecting to SE03.CMSAF.MIT.EDU on port 2811
GridftpClient&#58; gridFTPClient tcp buffer size is set to 0
GridftpClient&#58; gridFTPRead started
GridftpClient&#58; set local data channel authentication mode to None
GridftpClient&#58; parallelism&#58; 10
GridftpClient&#58; closing client &#58;
org.dcache.srm.util.GridftpClient$FnalGridFTPClient@1e184cb
GridftpClient&#58; closed client
copy failed with the error
org.globus.ftp.exception.ServerException&#58; Server refused performing the request.
Custom message&#58;  (error code 1) [Nested exception message&#58;  Custom message&#58;
Unexpected reply&#58; 553 Permission denied, reason&#58;
CacheException(rc=10001;msg=/pnfs/cmsaf.mit.edu/t2bat/test/billing-test-plan.html not
found)].  Nested exception is org.globus.ftp.exception.UnexpectedReplyCodeException&#58;
Custom message&#58; Unexpected reply&#58; 553 Permission denied, reason&#58;
CacheException(rc=10001;msg=/pnfs/cmsaf.mit.edu/t2bat/test/billing-test-plan.html not
found)
at org.globus.ftp.vanilla.FTPControlChannel.execute(FTPControlChannel.java&#58;333)
at org.globus.ftp.FTPClient.getSize(FTPClient.java&#58;126)
at org.dcache.srm.util.GridftpClient.gridFTPRead(GridftpClient.java&#58;456)
at org.dcache.srm.util.GridftpClient.gridFTPRead(GridftpClient.java&#58;433)
at org.dcache.srm.util.GridftpClient.gridFTPRead(GridftpClient.java&#58;406)
at gov.fnal.srm.util.Copier.javaGridFtpCopy(Copier.java&#58;601)
at gov.fnal.srm.util.Copier.copy(Copier.java&#58;495)
at gov.fnal.srm.util.Copier.run(Copier.java&#58;321)
at java.lang.Thread.run(Thread.java&#58;595)
try again
sleeping for 10000 before retrying

If I wait for about 15 seconds and run same command above, it works
...
...
GridftpClient&#58; set local data channel authentication mode to None
GridftpClient&#58; parallelism&#58; 10
GridftpClient&#58; waiting for completion of transfer
GridftpClient&#58; starting a transfer from
/pnfs/cmsaf.mit.edu/t2bat/test/billing-test-plan.html
GridftpClient&#58; DiskDataSink.close() called
GridftpClient&#58; gridFTPWrite() wrote 2396bytes
GridftpClient&#58; closing client &#58;
org.dcache.srm.util.GridftpClient$FnalGridFTPClient@1226a77
GridftpClient&#58; closed client
execution of CopyJob, source =
<a href='gsiftp&#58;//SE02.CMSAF.MIT.EDU&#58;2811//pnfs/cmsaf.mit.edu/t2bat/test/billing-test-plan.html' target='_blank' rel='nofollow'>gsiftp&#58;//SE02.CMSAF.MIT.EDU&#58;2811//pnfs/cmsaf.mit.edu/t2bat/test/billing-test-plan.html</a>
destination = file&#58;////home/s1/neha/return-billing completed
setting file request -2145848448 status to Done
copy_jobs is empty
stopping copier
&#60;tam01.fnal.gov&#62;

-Neha

On Feb 11, 2008, at 2&#58;03 PM, Timur Perelmutov via RT wrote&#58;

Hi Neha,

Could you please provide a debug output of the client invocation that
fails to read the file back?

Thanks,
Timur
</div><script type='text/javascript'>
        $('#show_232444427').click(function() {
            $('#detail_232444427').slideDown("normal");
            $('#show_232444427').hide();
            $('#hide_232444427').show();
        });
        $('#hide_232444427').click(function() {
            $('#detail_232444427').slideUp();
            $('#hide_232444427').hide();
            $('#show_232444427').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='4472#1202836904'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-02-12T17:21:44+00:00">Feb 12, 2008 05:21 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1202836904">&nbsp;</a></div><pre>DESY ticket number #2473. Sent detailed info to Timur</pre></div><div class='update_description'><i onclick="document.location='4472#1202342406'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-02-07T00:00:06+00:00">Feb 7, 2008 12:00 AM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1202342406">&nbsp;</a></div><pre>I have sent email to DESY dcache support regarding this issue. Will update this with
ticket number when I get one</pre></div><div class='update_description'><i onclick="document.location='4472#1201127713'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-01-23T22:35:13+00:00">Jan 23, 2008 10:35 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1201127713">&nbsp;</a></div><pre>I have requested help from Timur as even though Ilya
has a workaround which will work for SAM tests, but
there may be other software which may fail to run
against MIT dCache.

-Neha</pre></div><div class='update_description'><i onclick="document.location='4472#1200501513'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-01-16T16:38:33+00:00">Jan 16, 2008 04:38 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1200501513">&nbsp;</a></div><pre>I have requested help from Timur as even though Ilya has a workaround which will work
for SAM tests, but there may be other software which may fail to run against MIT dCache.

-Neha

Here is some email exchange
================

I wonder if we are talking about the same problem, though.
In my case, the file becomes available 12-15 seconds later
without any need to restart anything. Or is it the same problem?
In any case, I can certainly live until 1.8.0-11.

Ilya

On Thu, 2008-01-10 at 17&#58;19 -0600, Timur Perelmutov wrote&#58;
Yes, sometimes staging and pinning of the file gets stuck in the
PinManager, and in this case the only solution is to restart pin
manager. We are developing and already testing a new pin manager that
solves this problem, but it will be available only in 1.8.0 starting
from patch level 11.

Hi Timur,
12-15 seconds is a problem because CMS-related and other
software systems are being written all the time by people who
are not aware of this feature, and both the developers of those
systems and dCache admins will be randomly running into this
problem and fixing it on their own, wasting on this human resources.

The example in this case is SAM tests that is run on all
TierXs, if I understand right. SAM system was written with the
expectation that as soon as file is written to the Storage
Element, it is available immediately. Because of this, the MIT
Tier2 was failing in this test until this was figured out
by me, Stefano and Andrea. Now the SAM test is adjusted to have
<div id='show_1102852385' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1102852385'>an appropriate delay, but this is just one software system out
of many that we have and we will have.

Also, we do not understand the origin of these 12-15 seconds
at MIT. If the circumstances are different, perhaps this time
delay is even longer.

Ilya

On Thu, 2008-01-10 at 22&#58;24 -0600, Timur Perelmutov wrote&#58;
This is definitely not the same problem, the files were (very rarely)
stuck permanently, so no amount of wait would have helped. Why 12-15
secs is a big problem, why not to wait?
</div><script type='text/javascript'>
        $('#show_1102852385').click(function() {
            $('#detail_1102852385').slideDown("normal");
            $('#show_1102852385').hide();
            $('#hide_1102852385').show();
        });
        $('#hide_1102852385').click(function() {
            $('#detail_1102852385').slideUp();
            $('#hide_1102852385').hide();
            $('#show_1102852385').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='4472#1199911056'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-01-09T20:37:36+00:00">Jan 9, 2008 08:37 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1199911056">&nbsp;</a></div><pre>I have run into a peculiar behavior of dCache recently. After
I copy a file with srmcp into MIT dCache, it is not available
immediately, but some seconds later, even after srmcp returns
with success.

In my test, I do an srmcp of a file into dCache, and immediately
try to srmcp that file from the dCache. The first srmcp succeeds,
but the second always fails with this error&#58;

org.globus.ftp.exception.ServerException&#58; Server refused performing the
request. Custom message&#58;  (error code 1) [Nested exception message&#58;
Custom message&#58; Unexpected reply&#58; 553 Permission denied, reason&#58;
CacheException(rc=10001;msg=/pnfs/cmsaf.mit.edu/t2bat/test/ilya-
test-51.txt not found)].  Nested exception is
org.globus.ftp.exception.UnexpectedReplyCodeException&#58;  Custom message&#58;
Unexpected reply&#58; 553 Permission denied, reason&#58; CacheException
(rc=10001;msg=/pnfs/cmsaf.mit.edu/t2bat/test/ilya-test-51.txt not found)

The file is there, however, and if I insert sleep between two srmcp
(the one to copy the file into dCache, and the one that pulls it out),
it works once the sleep is over 12 to 15 seconds.

Is this an expected dCache behavior? Or is it a problem in my
installation?
I am running dCache 1.7 at the moment.

CMS SAM tests report a problem at the MIT site because of this effect,
because SAM tests do exactly that&#58; copy file in and immediately copy
the file out.

Here is an example of command that shows the problem (can be run from
anywhere by anyone with grid certificate, just change the file name)&#58;

srmcp -debug=true file&#58;////tmp/junk.txt
<a href='srm&#58;//se01.cmsaf.mit.edu&#58;8443//pnfs/cmsaf.mit.edu/t2bat/test/ilya-test-55.txt' target='_blank' rel='nofollow'>srm&#58;//se01.cmsaf.mit.edu&#58;8443//pnfs/cmsaf.mit.edu/t2bat/test/ilya-test-55.txt</a>; srmcp
<div id='show_591960225' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_591960225'>-debug=true
<a href='srm&#58;//se01.cmsaf.mit.edu&#58;8443//pnfs/cmsaf.mit.edu/t2bat/test/ilya-test-55.txt' target='_blank' rel='nofollow'>srm&#58;//se01.cmsaf.mit.edu&#58;8443//pnfs/cmsaf.mit.edu/t2bat/test/ilya-test-55.txt</a>
file&#58;////tmp/junk1.txt

Thanks,
Ilya
</div><script type='text/javascript'>
        $('#show_591960225').click(function() {
            $('#detail_591960225').slideDown("normal");
            $('#show_591960225').hide();
            $('#hide_591960225').show();
        });
        $('#hide_591960225').click(function() {
            $('#detail_591960225').slideUp();
            $('#hide_591960225').hide();
            $('#show_591960225').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F4472">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 4472});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
