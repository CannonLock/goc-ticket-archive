<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[32342] HTCondor-CE or Submit host configuration problem</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=32342" method="post">
<div class="page-header">
    <h3><span class="muted">32342</span> / HTCondor-CE or Submit host configuration problem</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Jeff Porter</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Jeff Porter</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Waiting for user action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2017-02-24</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div><div class="assignee" style="width: 60%">Brian Lin <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("https://ticket.opensciencegrid.org/attachment/list?id=32342", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="https://ticket.opensciencegrid.org/\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="https://ticket.opensciencegrid.org/\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/32342?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/32342?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20HTCondor-CE%20or%20Submit%20host%20configuration%20problem%20ISSUE%3D32342%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='32342#1489419264'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-03-13T15:34:24+00:00">Mar 13, 2017 03:34 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1489419264">&nbsp;</a></div><pre>I spoke with Jeff at All Hands and it sounded like this ticket could be closed. Jeff, if I&#39;m misremembering, please let us know and we&#39;ll re-open the ticket!</pre></div><div class='update_description'><i onclick="document.location='32342#1487363733'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-17T20:35:33+00:00">Feb 17, 2017 08:35 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1487363733">&nbsp;</a></div><pre>Hi Jeff, any update on this?

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='32342#1486396638'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-02-06T15:57:18+00:00">Feb 6, 2017 03:57 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1486396638">&nbsp;</a></div><pre>Jeff,

Have you had the chance to look at my comment below?

Thanks,
Brian</pre></div><div class='update_description'><i onclick="document.location='32342#1485530349'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-27T15:19:09+00:00">Jan 27, 2017 03:19 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1485530349">&nbsp;</a></div><pre>Jeff,

Alright, so I&#39;ve gotten to the bottom of the difference between condor_ce_run and condor_submit and you were right, the message is because the submit host did not authenticate your CE properly until you dropped in the mapfile [1]. condor_ce_run did not suffer from this issue because it sources the CE configuration which uses the CE&#39;s mapfile. Depending on how you intend to use this submit host, you probably don&#39;t need all the lines from the CE mapfile&#58; Will the submit host just accept locally submitted jobs? Does it need to accept remote submissions? Are you using it as a VO frontend to submit jobs into the OSG? Depending on your use case, we may want to adjust some of your security settings.

Cheers,
Brian

[1] Here&#39;s a quick line-by-line review of the CE&#39;s condor_mapfile (<a href='http&#58;//research.cs.wisc.edu/htcondor/manual/v8.4/3_6Security.html#SECTION00464000000000000000' target='_blank' rel='nofollow'>http&#58;//research.cs.wisc.edu/htcondor/manual/v8.4/3_6Security.html#SECTION00464000000000000000</a>).

These lines are used to authenticate hosts that are part of the OSG, RDIG, ANSP, Terena, and CERN via certificate&#58;

GSI &#34;^&#92;/DC&#92;=com&#92;/DC&#92;=DigiCert-Grid&#92;/O=Open Science Grid&#92;/OU&#92;=Services&#92;/CN&#92;=(host&#92;/)?([A-Za-z0-9.&#92;-]*)$&#34; &#92;2@....
GSI &#34;^&#92;/DC&#92;=DigiCert-Grid&#92;/DC&#92;=com&#92;/O=Open Science Grid&#92;/OU&#92;=Services&#92;/CN&#92;=(host&#92;/)?([A-Za-z0-9.&#92;-]*)$&#34; &#92;2@....
GSI &#34;^&#92;/DC&#92;=org&#92;/DC&#92;=opensciencegrid&#92;/O=Open Science Grid&#92;/OU&#92;=Services&#92;/CN&#92;=(host&#92;/)?([A-Za-z0-9.&#92;-]*)$&#34; &#92;2@....
GSI &#34;^&#92;/C&#92;=RU&#92;/O&#92;=RDIG&#92;/OU&#92;=hosts&#92;/OU=*&#92;/CN&#92;=(host&#92;/)?([A-Za-z0-9.&#92;-]*)$&#34; &#92;2@....
GSI &#34;^&#92;/C&#92;=BR&#92;/O&#92;=ANSP&#92;/OU&#92;=ANSPGrid&#92; CA&#92;/OU&#92;=Services&#92;/CN&#92;=(host&#92;/)?([A-Za-z0-9.&#92;-]*)$&#34; &#92;2@....
GSI &#34;^&#92;/DC&#92;=org&#92;/DC&#92;=terena&#92;/DC&#92;=tcs.*&#92;/CN&#92;=(host&#92;/)?([A-Za-z0-9.&#92;-]*)$&#34; &#92;2@....
GSI &#34;^&#92;/DC&#92;=ch&#92;/DC&#92;=cern&#92;/OU&#92;=computers&#92;/CN&#92;=(host&#92;/)?([A-Za-z0-9.&#92;-]*)$&#34; &#92;2@....

If the presented certificate doesn&#39;t look like a host from the above organizations, defer to an alternate mapping service (e.g., grid mapfile or GUMS)

GSI (.*) GSS_ASSIST_GRIDMAP

If the presented certificate isn&#39;t in the alternative mapping service, authenticate using the cert&#39;s comman name

GSI &#34;(/CN=[-.A-Za-z0-9/= ]+)&#34; &#92;1@....

Use what the client claims to be&#58;

CLAIMTOBE .* anonymous@claimtobe

And finally file system authentication is used&#58;

FS (.*) &#92;1</pre></div><div class='update_description'><i onclick="document.location='32342#1485459713'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-26T19:41:53+00:00">Jan 26, 2017 07:41 PM UTC</time><a class="anchor" name="1485459713">&nbsp;</a></div><pre>Hi Brian,

I just sent an email with the configs & url to the logs.

thanks,

Jeff

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Jeff Porter 226</pre></div><div class='update_description'><i onclick="document.location='32342#1485452643'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-26T17:44:03+00:00">Jan 26, 2017 05:44 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1485452643">&nbsp;</a></div><pre>Jeff,

Hrm, I think that&#39;ll be too big for e-mail. Do you have a host you could put it on so I could grab it off http? In the meantime, the config dumps should be helpful and small enough so you could e-mail those to me directly (blin AT cs.wisc.edu).

And for the defaults having the &#39;@*opensciencegrid.org&#39; suffix&#58; if we&#39;re talking about the CE, the security setup is such that only *@users.opensciencegrid.org are allowed to submit to the CE and daemons authenticate via *@daemon.opensciencegrid.org. You can look at /etc/condor-ce/config.d/01-ce-auth.conf for more details on authorization. Let me know if you have any questions!

Cheers,
Brian</pre></div><div class='update_description'><i onclick="document.location='32342#1485386573'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-25T23:22:53+00:00">Jan 25, 2017 11:22 PM UTC</time><a class="anchor" name="1485386573">&nbsp;</a></div><pre>Hi Brian,

Thanks - I agree.  The security model seems unclear to me just now.  .e.g. I don&#39;t understand the relevance of several defaults set to @opensciencegrid.org.  so your help is appreciated!

I&#39;ve attached the output from dumping the configs as txt files.  The logs are ~100MB (I had logging on FULLDEBUG) & this web form interface didn&#39;t like the *.tgz file I tried to upload.

Should I send via email instead?

thanks,

Jeff

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Jeff Porter 226</pre></div><div class='update_description'><i onclick="document.location='32342#1485384270'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-25T22:44:30+00:00">Jan 25, 2017 10:44 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1485384270">&nbsp;</a></div><pre>Jeff,

I&#39;m glad it&#39;s working but placing a condor_mapfile to resolve it doesn&#39;t quite make sense to me and since this has to do with security, I&#39;d like to get to the bottom of this before declaring it a success. Could you provide the following for me?

From the CE&#58;
- &#96;condor_ce_config_val -dump&#96;
- /var/log/condor-ce/

From the submit host&#58;
- &#96;condor_config_val -dump&#96; from the submit host
- /var/log/condor

Thanks,
Brian</pre></div><div class='update_description'><i onclick="document.location='32342#1485290377'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-24T20:39:37+00:00">Jan 24, 2017 08:39 PM UTC</time><a class="anchor" name="1485290377">&nbsp;</a></div><pre>Sorry, I forgot to answer your questions.  I ran as &#39;alicesgm&#39; and I have my cern grid cert mapped to the local alicesgm account&#58;

&#34;/DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jporter/CN=482817/CN=Jeff Porter&#34;	alicesgm

thanks,

Jeff

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Jeff Porter 226</pre></div><div class='update_description'><i onclick="document.location='32342#1485290254'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-24T20:37:34+00:00">Jan 24, 2017 08:37 PM UTC</time><a class="anchor" name="1485290254">&nbsp;</a></div><pre>Brian,

I think I just figured out the problem.  Maybe you can help explain it.   I realized that because I can run from BNL onto mpdsfgrid01, & because of the &#34;denies ip address&#34; message noted in my last email, that this must be the submit host blocking connections.  I then saw that the submit has a /etc/condor/certs/condor_mapfile that was pretty much empty&#58;

GSI (.*) anonymous
FS (.*) &#92;1

As compared with the one on the HTCondor-CE (/etc/condor-ce/condor_mapfile), which included GSI host mappings for OSG & CERN (& other) DNs.  I put this in place on the submit host and it started working.   The only place I see that defined in my submit host&#39;s configurations is in the 03_gwms_local.config.   I originally ignored that since I am not running glide-ins.   Also, it doesn&#39;t seem to exist on the older BNL submit host that did work with mpdsfgrid01.  So this must be a newer feature?

Thanks for you help,

Jeff

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Jeff Porter 226</pre></div><div class='update_description'><i onclick="document.location='32342#1485287485'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-24T19:51:25+00:00">Jan 24, 2017 07:51 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1485287485">&nbsp;</a></div><pre>Jeff,

When you ran the &#39;condor_ping&#39; WRITE command (we want to test the WRITE auth, the READ auth is very open by default), which user did you use to run the command? Does the &#39;alicesgm&#39; user have a corresponding certificate? If so, what is the DN?

Thanks,
Brian</pre></div><div class='update_description'><i onclick="document.location='32342#1485279886'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-24T17:44:46+00:00">Jan 24, 2017 05:44 PM UTC</time><a class="anchor" name="1485279886">&nbsp;</a></div><pre>Hi Edgar & Brian,

I&#39;m back to this today.  I do still see that problem so I will increase the debug level and rerun the tests.   My host certs are OSG ones.   If it matters, both certs require subjAltNames a they have names with and without an &#34;-ib&#34;, e.g.  mpdsfgrid01.nersc.gov is aka (internally) as mpdsfgrid01-ib.nersc.gov

I just realized that it perhaps this error message is coming from the client on malice01 not the server mpdsfgrid01.  As an example, when I run

condor_ping -verbose -name mpdsfgrid01.nersc.gov  -pool mpdsfgrid01.nersc.gov&#58;9619 READ

from malice01, it works.  When I swap READ for WRITE if fails with&#58;

WRITE failed!
SECMAN&#58;2009&#58;DENIED authorization of server &#39;anonymous@..../128.55.164.105&#39; (I am acting as the client)&#58; reason&#58; CLIENT authorization policy denies IP address 128.55.164.105.

I never understood the anonymous@..../128.55.164.105 part as the ipaddress is for mpdsfgrid01 - so I don&#39;t know which machine is &#34;I am ..&#34; .  In this message it&#39;s saying &#34;denies&#34; the mpdsfgrid01 ip-address.   Is that right.

Anyway, I&#39;ll up the logging on both machines and may send you what I find.

thanks,

Jeff

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Jeff Porter 226</pre></div><div class='update_description'><i onclick="document.location='32342#1484934896'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-20T17:54:56+00:00">Jan 20, 2017 05:54 PM UTC</time><a class="anchor" name="1484934896">&nbsp;</a></div><pre>Hi Jeff,

Do you still see this&#58;

&#34;Error connecting to schedd mpdsfgrid01.nersc.gov&#58; SECMAN&#58;2009&#58;DENIED authorization of server &#39;anonymous@..../128.55.164.105&#39; (I am acting as the client)&#58; reason&#58; cached result for CLIENT; see first case for the full reason.&#34;

If so we will need to increase the debug level.  is your host cert an OSG or CERN cert?

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Edgar Mauricio Fajardo Hernandez 2020</pre></div><div class='update_description'><i onclick="document.location='32342#1484791461'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-19T02:04:21+00:00">Jan 19, 2017 02:04 AM UTC</time><a class="anchor" name="1484791461">&nbsp;</a></div><pre>Hi Brian,

thanks for the info.  I did add a host cert to the malice01 submit host, but that didn&#39;t change anything.  Unfortunately, I had no time to look at it today.  I&#39;ll try again tomorrow.

thanks,

Jeff

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Jeff Porter 226</pre></div><div class='update_description'><i onclick="document.location='32342#1484765431'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-18T18:50:31+00:00">Jan 18, 2017 06:50 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1484765431">&nbsp;</a></div><pre>Jeff,

Ah, ok, looking through the logs jogged my memory and I believe it actually is a host certificate issue because the CE is failing to authorize malice01 as evidenced by the hold reason. This is because of the different paths to job submission that you&#39;re using&#58;

1) Under the hood, condor_ce_run is using &#39;condor_submit -remote mpdsfgrid01.nersc.gov -pool mpdsfgrid01.nersc.gov&#58;9619&#39;, which submits a job directly to the CE schedd, bypassing your schedd on malice01. The CE schedd authenticates the submitting user directly.

2) Your submit file + condor_submit submits a grid universe job to malice01&#39;s schedd which in turn submits it to the CE schedd. The CE schedd tries to authenticate malice01&#39;s schedd but fails because malice01 doesn&#39;t have a host certificate.

So you&#39;ve got a few options here, the easiest of which would be getting a host certificate for your submit host. Alternatively, some random ideas&#58;

1. Submit your jobs with the -remote and -pool options passed to condor_submit but if you&#39;ve got any sort of workflow, this is probably not what you want.

2. Submit your workflow directly from your CE. If you have reasons to keep a separate submit host other than managing this workflow (e.g. keeping the workflow itself on a node without a public interface), this won&#39;t work.

Cheers,
Brian

P.S. To answer your question &#34;Not sure why it started 2 jobs - do you understand that?&#34;, this is explained in the following section&#58; <a href='https&#58;//twiki.opensciencegrid.org/bin/view/Documentation/Release3/HTCondorCEOverview#On_other_batch_systems' target='_blank' rel='nofollow'>https&#58;//twiki.opensciencegrid.org/bin/view/Documentation/Release3/HTCondorCEOverview#On_other_batch_systems</a></pre></div><div class='update_description'><i onclick="document.location='32342#1484765065'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-18T18:44:25+00:00">Jan 18, 2017 06:44 PM UTC</time><a class="anchor" name="1484765065">&nbsp;</a></div><pre>Hey Brian,

My two cents here is that you do need a host cert in the submit hosts to be able to submit to an HTCondor-CE. AT least in it vanilla version.

Edgar
OSG Software Support

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Edgar Mauricio Fajardo Hernandez 2020</pre></div><div class='update_description'><i onclick="document.location='32342#1484698762'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-18T00:19:22+00:00">Jan 18, 2017 12:19 AM UTC</time><a class="anchor" name="1484698762">&nbsp;</a></div><pre>Hey Brian,

I did re-run the tests (but before your reply so I don&#39;t have D_FULLDEBUG enabled) and am including info here.   I first cleaned out the logs and will attach single text file to this ticket containing the following&#58;

$ grep -n &#34;########&#34; debugging_osg.txt
1&#58; ############   screens_condor_ce_run.txt ############  --&#62; what I observed during condor_ce_run cycle
55&#58; ############   SchedLog.condor_ce_run.works   ############ --&#62;  associated SchedLog entries
511&#58; ############   screens_condor_submit.txt ############ --&#62; what I observed during condor_submit cycle
550&#58; ############   SchedLog.condor_submit.fails   ############ --&#62; associated SchedLog entries
577&#58; ############   mpdsfgrid.sub   ############ ---&#62; submit file used (works when submitted from BNL)
601&#58; ############   test.1.log   ############ ---&#62; log file from the condor_submit cycle

Hopefully this will point to some configuration problem with my setup.

I do have &#39;use_x509userproxy&#39; in the submit file so that&#39;s not a problem.  I&#39;ll run via the D_FULLDEBUG this evening or in the morning.

thanks,

Jeff

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Jeff Porter 226</pre></div><div class='update_description'><i onclick="document.location='32342#1484694708'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-17T23:11:48+00:00">Jan 17, 2017 11:11 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1484694708">&nbsp;</a></div><pre>Jeff,

Actually, thinking it over, your submit host probably doesn&#39;t need a host certificate but your job certainly needs one. If you look at the submit file generated by condor_ce_run (it just uses condor tools under the hood), you&#39;ll see that you need to include the following line in your submit file&#58;

use_x509userproxy = true

This is because HTCondor-CE uses GSI authentication. Give that a try and if it doesn&#39;t work, save and upload the job log and CE SchedLog so I can take a look at the details (you may want to set ALL_DEBUG = D_FULLDEBUG in the CE config during the test).

Thanks,
Brian</pre></div><div class='update_description'><i onclick="document.location='32342#1484693765'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-17T22:56:05+00:00">Jan 17, 2017 10:56 PM UTC</time><a class="anchor" name="1484693765">&nbsp;</a></div><pre>Hey Brian,

Sorry for the confusion.  This one --&#62; &#34;Or are you submitting into the CE from the HTCondor submit host?&#34;
That is, in our normal operation we have services that run on a HTCondor submit host that manage what/when/how many jobs to submit.  From this system, jobs are submitted into an OSG CE and the CE then submits into the UGE cluster.   I have an old system in production that uses older version of condor on the submit host and GRAM-based OSG CE.  Now I am deploying both a new HTCondor submit host and new OSG CE based on HTCondor-CE.

We worked around the issues of the net-booted OSG CE install in the previous ticket, though the HTCondor-CE is still a bit new to me.  As noted in my original email, my tests with the command line variant condor_ce_run worked from the new submit host, malice01, while those done via condor_submit (talking to the submit host&#39;s condor daemons) failed.

I can rerun the tests and isolate the log files - but your comment on &#34;lack of a host cert&#34; may be the answer.   We don&#39;t use a host cert on the production version of the submit host - it wasn&#39;t needed.  If it&#39;s needed now, I can do that.   Let me know.  If it&#39;s not needed, I&#39;ll forward you log details of the tests.

thanks,

Jeff

PS - I am able to run my services directly on the HTCondor-CE and use condor_ce_submit (via &#39;universe = vanilla&#39; + commenting out the grid_resource entry).   I may simply move forward with that option but would like to understand why the submit host model/configuration fails.

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Jeff Porter 226</pre></div><div class='update_description'><i onclick="document.location='32342#1484684739'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-17T20:25:39+00:00">Jan 17, 2017 08:25 PM UTC</time> by <b>Brian Lin</b><a class="anchor" name="1484684739">&nbsp;</a></div><pre>Jeff,

I&#39;m a little confused about the setup here&#58; you have both a new CE and a new HTCondor submit host but how exactly are they related? Do they both submit into the UGE cluster? Or are you submitting into the CE from the HTCondor submit host? Or something else entirely?

What exactly is the submit file that you&#39;re submitting from BNL and what is it the same as? To me, the error indicates that the CE, mpdsfgrid01, doesn&#39;t like the submit host, mailce01. My guess is lack of host cert but I&#39;d have to see the error in the CE SchedLog (but it may have rolled over at this point).

Thanks,
Brian</pre></div><div class='update_description'><i onclick="document.location='32342#1484352373'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-14T00:06:13+00:00">Jan 14, 2017 12:06 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1484352373">&nbsp;</a></div><pre>Brian, I&#39;m assigning this to you as it&#39;s an HTCondor-CE issue, but feel free to re-assign as you see fit.

Carl</pre></div><div class='update_description'><i onclick="document.location='32342#1484349604'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2017-01-13T23:20:04+00:00">Jan 13, 2017 11:20 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1484349604">&nbsp;</a></div><pre>Hi

I have a new install of the HTCondor-CE on PDSF at NERSC and a new HTCondor submit host.  The CE seems to be working but not with the new submit host. It looks like a simple configuration problem, either with the CE or the submit host, that you might be able to help me resolve quickly.

The HTCondor-CE is &#39;mpdsfgrid01.nersc.gov&#39; and submits to a UGE cluster.  I have done successful submissions to this CE from a remote htcondor submit host at BNL - jobs ran on the cluster and I retrieved the results.   However, the same is not working from the local submit host, malice01.nersc.gov.  (Note&#58; In DNS it&#39;s known as malice01-ib.nersc.gov but I have the local /etc/hosts files set up to map appropriately & see the correct ip in the log files associated with malice01.nersc.gov)

From this local submit host, I can run&#58;

condor_ce_run -r mpdsfgrid01.nersc.gov mpdsfgrid01.nersc.gov&#58;9619 /bin/date

This works - the job is submitted on the cluster and the results are returned.

However if I run the job via the same condor_submit file that works from BNL, the job becomes held on the submit host with hold reason&#58;

&#34;Error connecting to schedd mpdsfgrid01.nersc.gov&#58; SECMAN&#58;2009&#58;DENIED authorization of server &#39;anonymous@..../128.55.164.105&#39; (I am acting as the client)&#58; reason&#58; cached result for CLIENT; see first case for the full reason.&#34;

While the CE SchedLog file contains multiple entries of the form&#58;

1/13/17 13&#58;16&#58;09 Command=QMGMT_WRITE_CMD, peer=&#60;128.55.160.143&#58;55447&#62;
01/13/17 13&#58;16&#58;09 AuthMethod=GSI, AuthId=/DC=gov/DC=nersc/OU=People/CN=R. (Jeff) Jefferson Porter 11349, CondorId=porter@....
01/13/17 13&#58;16&#58;14 Command=QMGMT_WRITE_CMD, peer=&#60;128.55.160.143&#58;4507&#62;
01/13/17 13&#58;16&#58;14 AuthMethod=GSI, AuthId=/DC=gov/DC=nersc/OU=People/CN=R. (Jeff) Jefferson Porter 11349, CondorId=porter@....

where &#39;porter&#39; is the correct UID mapping.  I don&#39;t see any later references to the job in the log file.

Please let me know how to identify the culprit.

Thanks in advance,

Jeff

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Jeff Porter 226</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F32342">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 32342});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
