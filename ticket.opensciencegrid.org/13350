<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[13350] Gratia Gridftp transfer probe not sending records to collector</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=13350" method="post">
<div class="page-header">
    <h3><span class="muted">13350</span> / Gratia Gridftp transfer probe not sending records to collector</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Neha Sharma</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Neha Sharma</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">GRATIA Dev</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Check for a response back from Neha</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2013-02-08</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">OSG RA <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">Neha Sharma <span class="muted"> / OSG Storage Team</span></div><div class="assignee" style="width: 60%">FNAL (Prod)&nbsp;<a target="_blank" href="https://fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000360781">INC000000360781</a> <span class="muted"> / Ticket Exchange</span></div><div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/13350", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="https://ticket.opensciencegrid.org/\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="https://ticket.opensciencegrid.org/\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/13350?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/13350?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Gratia%20Gridftp%20transfer%20probe%20not%20sending%20records%20to%20collector%20ISSUE%3D13350%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='13350#1360342088'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-02-08T16:48:08+00:00">Feb 8, 2013 04:48 PM UTC</time> by <b>amitoj@....</b><a class="anchor" name="1360342088">&nbsp;</a></div><pre>This ticket can now be closed. The last few configuration changes made
to the system now cause the gridftp gratia probe to run, collect and
upload data to the collector successfully.

Amitoj

On 02/05/2013 12&#58;41 PM, Amitoj Singh wrote&#58;
<font color='#7F7E6F'>&#62; UPDATE&#58; Since the last change committed yesterday (Feb 4, 2013) around</font>
<font color='#7F7E6F'>&#62; 3&#58;30PM the gratia gridftp probe seems to be working as expected. There</font>
<font color='#7F7E6F'>&#62; were some gridftp transfers yesterday, see log file sizes ..</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [root@cc3 ~]# ls -lth /var/log/gridftp/gridftp-auth.log-2013020* |</font>
<font color='#7F7E6F'>&#62; head -n 2</font>
<font color='#7F7E6F'>&#62; -rw-r--r-- 1 root root  30K Feb  4 18&#58;34</font>
<font color='#7F7E6F'>&#62; /var/log/gridftp/gridftp-auth.log-20130205</font>
<font color='#7F7E6F'>&#62; -rw-r--r-- 1 root root 233K Feb  4 08&#58;42</font>
<font color='#7F7E6F'>&#62; /var/log/gridftp/gridftp-auth.log-20130204</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; And the gratia probe uploaded about 77 new records ...</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [root@cc3 ~]# cat /var/log/gratia/2013-02-04.log | grep &#34;new records</font>
<font color='#7F7E6F'>&#62; sent successfully&#34;</font>
<font color='#7F7E6F'>&#62; 16&#58;03&#58;06 CST Gratia&#58; End of execution summary&#58; new records sent</font>
<font color='#7F7E6F'>&#62; successfully&#58; 77</font>
<font color='#7F7E6F'>&#62; 16&#58;42&#58;26 CST Gratia&#58; End of execution summary&#58; new records sent</font>
<font color='#7F7E6F'>&#62; successfully&#58; 0</font>
<font color='#7F7E6F'>&#62; 17&#58;19&#58;42 CST Gratia&#58; End of execution summary&#58; new records sent</font>
<font color='#7F7E6F'>&#62; successfully&#58; 0</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; and I am able to see the gridftp transfers being plotted at the</font>
<font color='#7F7E6F'>&#62; collector end at the following link (one of many reports that are</font>
<font color='#7F7E6F'>&#62; available for this machine)</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; <a href='http&#58;//gratiaweb.grid.iu.edu/gratia/xml/facility_transfer_volume?facility=FNAL_CC3_GRIDFTP&span=43200' target='_blank' rel='nofollow'>http&#58;//gratiaweb.grid.iu.edu/gratia/xml/facility_transfer_volume?facility=FNAL_CC3_GRIDFTP&span=43200</a></font>
<font color='#7F7E6F'>&#62;</font>
<div id='show_2033198088' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_2033198088'><font color='#7F7E6F'>&#62; I think this issue is now solved but I would like to keep an eye on</font>
<font color='#7F7E6F'>&#62; this for a few days before this ticket can be closed. My sincere</font>
<font color='#7F7E6F'>&#62; thanks to Neha Sharma and Stevn Timm for their support and diligence</font>
<font color='#7F7E6F'>&#62; in getting this issue solved. Kudos to both of you.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Amitoj</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On 02/04/2013 03&#58;40 PM, Amitoj Singh wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; Forgot to add the &#34;key&#34; last step..</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; [root@cc3 init.d]# ./gratia-probes-cron status</font>
<font color='#7F7E6F'>&#62;&#62; gratia probes cron is disabled.</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; [root@cc3 init.d]# ./gratia-probes-cron start</font>
<font color='#7F7E6F'>&#62;&#62; Enabling gratia probes cron&#58;                               [ OK  ]</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; [root@cc3 init.d]# ./gratia-probes-cron status</font>
<font color='#7F7E6F'>&#62;&#62; gratia probes cron is enabled.</font>
<font color='#7F7E6F'>&#62;&#62;     gridftp-transfer probe&#58; Enabled</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; Amitoj</font>
<font color='#7F7E6F'>&#62;&#62;</font>
<font color='#7F7E6F'>&#62;&#62; On 02/04/2013 03&#58;36 PM, Open Science Grid FootPrints wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62;&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_2033198088').click(function() {
            $('#detail_2033198088').slideDown("normal");
            $('#show_2033198088').hide();
            $('#hide_2033198088').show();
        });
        $('#hide_2033198088').click(function() {
            $('#detail_2033198088').slideUp();
            $('#hide_2033198088').hide();
            $('#show_2033198088').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='13350#1360094728'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-02-05T20:05:28+00:00">Feb 5, 2013 08:05 PM UTC</time> by <b>Suchandra Thapa</b><a class="anchor" name="1360094728">&nbsp;</a></div><pre>Hi Amitoj,

That&#39;s great.  I&#39;ll close this ticket on friday if no new issues come up.

Suchandra</pre></div><div class='update_description'><i onclick="document.location='13350#1360089908'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-02-05T18:45:08+00:00">Feb 5, 2013 06:45 PM UTC</time> by <b>amitoj@....</b><a class="anchor" name="1360089908">&nbsp;</a></div><pre>UPDATE&#58; Since the last change committed yesterday (Feb 4, 2013) around
3&#58;30PM the gratia gridftp probe seems to be working as expected. There
were some gridftp transfers yesterday, see log file sizes ..

[root@cc3 ~]# ls -lth /var/log/gridftp/gridftp-auth.log-2013020* | head -n 2
-rw-r--r-- 1 root root  30K Feb  4 18&#58;34
/var/log/gridftp/gridftp-auth.log-20130205
-rw-r--r-- 1 root root 233K Feb  4 08&#58;42
/var/log/gridftp/gridftp-auth.log-20130204

And the gratia probe uploaded about 77 new records ...

[root@cc3 ~]# cat /var/log/gratia/2013-02-04.log | grep &#34;new records
sent successfully&#34;
16&#58;03&#58;06 CST Gratia&#58; End of execution summary&#58; new records sent
successfully&#58; 77
16&#58;42&#58;26 CST Gratia&#58; End of execution summary&#58; new records sent
successfully&#58; 0
17&#58;19&#58;42 CST Gratia&#58; End of execution summary&#58; new records sent
successfully&#58; 0

and I am able to see the gridftp transfers being plotted at the
collector end at the following link (one of many reports that are
available for this machine)

<a href='http&#58;//gratiaweb.grid.iu.edu/gratia/xml/facility_transfer_volume?facility=FNAL_CC3_GRIDFTP&span=43200' target='_blank' rel='nofollow'>http&#58;//gratiaweb.grid.iu.edu/gratia/xml/facility_transfer_volume?facility=FNAL_CC3_GRIDFTP&span=43200</a>

I think this issue is now solved but I would like to keep an eye on this
for a few days before this ticket can be closed. My sincere thanks to
Neha Sharma and Stevn Timm for their support and diligence in getting
this issue solved. Kudos to both of you.

Amitoj

On 02/04/2013 03&#58;40 PM, Amitoj Singh wrote&#58;
<div id='show_439542092' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_439542092'><font color='#7F7E6F'>&#62; Forgot to add the &#34;key&#34; last step..</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [root@cc3 init.d]# ./gratia-probes-cron status</font>
<font color='#7F7E6F'>&#62; gratia probes cron is disabled.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [root@cc3 init.d]# ./gratia-probes-cron start</font>
<font color='#7F7E6F'>&#62; Enabling gratia probes cron&#58;                               [ OK  ]</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [root@cc3 init.d]# ./gratia-probes-cron status</font>
<font color='#7F7E6F'>&#62; gratia probes cron is enabled.</font>
<font color='#7F7E6F'>&#62;     gridftp-transfer probe&#58; Enabled</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Amitoj</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On 02/04/2013 03&#58;36 PM, Open Science Grid FootPrints wrote&#58;</font>
<font color='#7F7E6F'>&#62;&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_439542092').click(function() {
            $('#detail_439542092').slideDown("normal");
            $('#show_439542092').hide();
            $('#hide_439542092').show();
        });
        $('#hide_439542092').click(function() {
            $('#detail_439542092').slideUp();
            $('#hide_439542092').hide();
            $('#show_439542092').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='13350#1360017417'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-02-04T22:36:57+00:00">Feb 4, 2013 10:36 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1360017417">&nbsp;</a></div><pre>Thanks for looking in to this Steve.</pre></div><div class='update_description'><i onclick="document.location='13350#1360014128'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-02-04T21:42:08+00:00">Feb 4, 2013 09:42 PM UTC</time> by <b>amitoj@....</b><a class="anchor" name="1360014128">&nbsp;</a></div><pre>Forgot to add the &#34;key&#34; last step..

[root@cc3 init.d]# ./gratia-probes-cron status
gratia probes cron is disabled.

[root@cc3 init.d]# ./gratia-probes-cron start
Enabling gratia probes cron&#58;                               [  OK ]

[root@cc3 init.d]# ./gratia-probes-cron status
gratia probes cron is enabled.
gridftp-transfer probe&#58; Enabled

Amitoj

On 02/04/2013 03&#58;36 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='13350#1360013768'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-02-04T21:36:08+00:00">Feb 4, 2013 09:36 PM UTC</time> by <b>amitoj@....</b><a class="anchor" name="1360013768">&nbsp;</a></div><pre>Aha!! I hope this solves it because the gratia-probes-cron was not
enabled but it is now (see o/p from my handiwork below)

[root@cc3 init.d]# pwd
/etc/init.d

[root@cc3 init.d]# ls -l gratia-probes-cron
-rwxr-xr-x 1 root root 1885 May 21  2012 gratia-probes-cron

[root@cc3 init.d]# chkconfig --list gratia-probes-cron
service gratia-probes-cron supports chkconfig, but is not referenced in
any runlevel (run &#39;chkconfig --add gratia-probes-cron&#39;)

[root@cc3 init.d]# chkconfig --add gratia-probes-cron
[root@cc3 init.d]# chkconfig --list gratia-probes-cron

gratia-probes-cron    0&#58;off    1&#58;off    2&#58;off    3&#58;off    4&#58;off 5&#58;off
6&#58;off

[root@cc3 init.d]# chkconfig gratia-probes-cron on
[root@cc3 init.d]# chkconfig --list gratia-probes-cron
gratia-probes-cron    0&#58;off    1&#58;off    2&#58;on    3&#58;on    4&#58;on

Amitoj

On 02/04/2013 01&#58;59 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='13350#1360007947'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-02-04T19:59:07+00:00">Feb 4, 2013 07:59 PM UTC</time><a class="anchor" name="1360007947">&nbsp;</a></div><pre>There should be a service called gratia-probes-cron
on the gridftp server.
Is it chkconfig on, and started?

If not, what happens is that the gratia gridftp probe cron runs but it doesn&#39;t do anything because it is looking for
a long file that isn&#39;t there.

Steve Timm

by /DC=org/DC=doegrids/OU=People/CN=Steven Timm 74183</pre></div><div class='update_description'><i onclick="document.location='13350#1359993969'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-02-04T16:06:09+00:00">Feb 4, 2013 04:06 PM UTC</time> by <b>amitoj@....</b><a class="anchor" name="1359993969">&nbsp;</a></div><pre>Answering to Alain&#39;s with log data from the client side since I do not have access to the collector but it looks like the probe is not gathering any data from the client still. There have been several gridftp transfers on the machine cc3.fnal.gov in the past week as evidenced from the log files below.

[root@cc3 ~]# ls -lth /var/log/gridftp/gridftp.log-* | head
-rw-r--r-- 1 root root 220K Feb  4 08&#58;42 /var/log/gridftp/gridftp.log-20130204
-rw-r--r-- 1 root root    0 Feb  2 03&#58;42 /var/log/gridftp/gridftp.log-20130203
-rw-r--r-- 1 root root    0 Feb  1 03&#58;07 /var/log/gridftp/gridftp.log-20130202
-rw-r--r-- 1 root root    0 Jan 31 03&#58;13 /var/log/gridftp/gridftp.log-20130201
-rw-r--r-- 1 root root 1.9K Jan 30 13&#58;55 /var/log/gridftp/gridftp.log-20130131

But the gratia probe did not record anything beyond Jan 23rd when it was run manually.

[root@cc3 ~]# ls -lth /var/log/gratia/*
-rw-r--r-- 1 root root  56K Jan 23 13&#58;42 /var/log/gratia/2013-01-23.log
-rw-r--r-- 1 root root 284K Jan 23 13&#58;42 /var/log/gratia/gridftpTransfer.log
-rw-r--r-- 1 root root    0 Jan 23 13&#58;42 /var/log/gratia/netlogger.log
-rw-r--r-- 1 root root 2.2K Jan  7 14&#58;01 /var/log/gratia/2013-01-07.log
-rw-r--r-- 1 root root 500K Dec 10 07&#58;33 /var/log/gratia/gridftpTransfer.log.1
-rw-r--r-- 1 root root 500K Nov 21 10&#58;03 /var/log/gratia/gridftpTransfer.log.2

Cron continues to schedule the probe religiously every  half hour as evidenced by the cron log messages below ..

[root@cc3 ~]# cat /var/log/cron | grep gratia | head
Feb  3 04&#58;00&#58;01 cc3 CROND[4537]&#58; (root) CMD (/usr/share/gratia/common/cron_check  /etc/gratia/gridftp-transfer/ProbeConfig && /usr/share/gratia/gridftp-transfer/GridftpTransferProbeDriver -s 1800 &#62; /dev/null)
Feb  3 04&#58;30&#58;01 cc3 CROND[4752]&#58; (root) CMD (/usr/share/gratia/common/cron_check  /etc/gratia/gridftp-transfer/ProbeConfig && /usr/share/gratia/gridftp-transfer/GridftpTransferProbeDriver -s 1800 &#62; /dev/null)
Feb  3 05&#58;00&#58;01 cc3 CROND[4846]&#58; (root) CMD (/usr/share/gratia/common/cron_check  /etc/gratia/gridftp-transfer/ProbeConfig && /usr/share/gratia/gridftp-transfer/GridftpTransferProbeDriver -s 1800 &#62; /dev/null)
Feb  3 05&#58;30&#58;01 cc3 CROND[5063]&#58; (root) CMD (/usr/share/gratia/common/cron_check  /etc/gratia/gridftp-transfer/ProbeConfig && /usr/share/gratia/gridftp-transfer/GridftpTransferProbeDriver -s 1800 &#62; /dev/null)
Feb  3 06&#58;00&#58;01 cc3 CROND[5162]&#58; (root) CMD (/usr/share/gratia/common/cron_check  /etc/gratia/gridftp-transfer/ProbeConfig && /usr/share/gratia/gridftp-transfer/GridftpTransferProbeDriver -s 1800 &#62; /dev/null)
Feb  3 06&#58;30&#58;01 cc3 CROND[5388]&#58; (root) CMD (/usr/share/gratia/common/cron_check  /etc/gratia/gridftp-transfer/ProbeConfig && /usr/share/gratia/gridftp-transfer/GridftpTransferProbeDriver -s 1800 &#62; /dev/null)
Feb  3 07&#58;00&#58;01 cc3 CROND[5863]&#58; (root) CMD (/usr/share/gratia/common/cron_check  /etc/gratia/gridftp-transfer/ProbeConfig && /usr/share/gratia/gridftp-transfer/GridftpTransferProbeDriver -s 1800 &#62; /dev/null)
Feb  3 07&#58;30&#58;01 cc3 CROND[6078]&#58; (root) CMD (/usr/share/gratia/common/cron_check  /etc/gratia/gridftp-transfer/ProbeConfig && /usr/share/gratia/gridftp-transfer/GridftpTransferProbeDriver -s 1800 &#62; /dev/null)
Feb  3 08&#58;00&#58;01 cc3 CROND[6172]&#58; (root) CMD (/usr/share/gratia/common/cron_check  /etc/gratia/gridftp-transfer/ProbeConfig && /usr/share/gratia/gridftp-transfer/GridftpTransferProbeDriver -s 1800 &#62; /dev/null)
Feb  3 08&#58;30&#58;01 cc3 CROND[6388]&#58; (root) CMD (/usr/share/gratia/common/cron_check  /etc/gratia/gridftp-transfer/ProbeConfig && /usr/share/gratia/gridftp-transfer/GridftpTransferProbeDriver -s 1800 &#62; /dev/null)</pre></div><div class='update_description'><i onclick="document.location='13350#1359733007'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-02-01T15:36:47+00:00">Feb 1, 2013 03:36 PM UTC</time> by <b>OSG RA</b><a class="anchor" name="1359733007">&nbsp;</a></div><pre>Are there any updates for this ticket?  Are the probes sending any records tot he collector yet?

Thanks,
-Alain</pre></div><div class='update_description'><i onclick="document.location='13350#1358976069'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-01-23T21:21:09+00:00">Jan 23, 2013 09:21 PM UTC</time> by <b>amitoj@....</b><a class="anchor" name="1358976069">&nbsp;</a></div><pre>I think cron has been running the probe every half an hour (here&#39;s a snippet of the output from the cron logs)

$&#62; cat /var/log/cron | grep gratia
Jan 20 04&#58;00&#58;01 cc3 CROND[13459]&#58; (root) CMD (/usr/share/gratia/common/cron_check  /etc/gratia/gridftp-transfer/ProbeConfig && /usr/share/gratia/gridftp-transfer/GridftpTransferProbeDriver -s 1800 &#62; /dev/null)
Jan 20 04&#58;30&#58;01 cc3 CROND[13674]&#58; (root) CMD (/usr/share/gratia/common/cron_check  /etc/gratia/gridftp-transfer/ProbeConfig && /usr/share/gratia/gridftp-transfer/GridftpTransferProbeDriver -s 1800 &#62; /dev/null)
......

as for the directory permissions I changed the ownership to &#34;root&#34; instead of &#34;498&#34;.

Amitoj</pre></div><div class='update_description'><i onclick="document.location='13350#1358970739'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-01-23T19:52:19+00:00">Jan 23, 2013 07:52 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1358970739">&nbsp;</a></div><pre>Doesn&#39;t look like the probe has even ran since Jan 7 and that is probably when I ran it manually from command line.
[root@cc3 tmp]# ls -hlt /var/log/gratia/
total 6.8M
-rw-r--r-- 1 root root 2.2K Jan  7 14&#58;01 2013-01-07.log
-rw-r--r-- 1 root root 284K Jan  7 14&#58;01 gridftpTransfer.log
-rw-r--r-- 1 root root    0 Jan  7 14&#58;01 netlogger.log
-rw-r--r-- 1 root root 1.4M Dec 14 10&#58;14 2012-12-14.log

It is enabled
[root@cc3 tmp]# cat /etc/gratia/gridftp-transfer/ProbeConfig | grep Enable
EnableProbe=&#34;1&#34;
[root@cc3 tmp]#

and the cron looks fine

[root@cc3 tmp]# cat /etc/cron.d/gratia-probe-gridftp-transfer.cron
0,30 * * * * root /usr/share/gratia/common/cron_check  /etc/gratia/gridftp-transfer/ProbeConfig && /usr/share/gratia/gridftp-transfer/GridftpTransferProbeDriver -s 1800 &#62; /dev/null
[root@cc3 tmp]#

I ran it manually and log (/var/log/gratia/2013-01-23.log) indicate 63 data records  were just sent to collector. You can also see them at url you sent.

I don&#39;t know why the probe is not running via the cron - looking at the permissions on the log dir, they don&#39;t seem right

[root@cc3 log]# ls -hlt
drwxr-xr-x  2   498 gratia 4.0K Jan 23 13&#58;48 gratia</pre></div><div class='update_description'><i onclick="document.location='13350#1358969229'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-01-23T19:27:09+00:00">Jan 23, 2013 07:27 PM UTC</time> by <b>amitoj@....</b><a class="anchor" name="1358969229">&nbsp;</a></div><pre>As best as I can tell nothing is getting uploaded to the collector as evidenced by the following report ..

<a href='http&#58;//gratiaweb.grid.iu.edu/gratia/xml/facility_transfer_volume?facility=FNAL_CC3_GRIDFTP&span=43200' target='_blank' rel='nofollow'>http&#58;//gratiaweb.grid.iu.edu/gratia/xml/facility_transfer_volume?facility=FNAL_CC3_GRIDFTP&span=43200</a>

Amitoj</pre></div><div class='update_description'><i onclick="document.location='13350#1358968276'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-01-23T19:11:16+00:00">Jan 23, 2013 07:11 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1358968276">&nbsp;</a></div><pre>Picking this up today. Looking at the files from last couple of days, looks like transfers have been happening on some of them.
Amitoj can you tell me if you see records that are not making it to collector?

-rw-r--r-- 1 root root  19K Jan 23 13&#58;06 gridftp.log
-rw-r--r-- 1 root root 179K Jan 22 19&#58;13 gridftp.log-20130123
-rw-r--r-- 1 root root    0 Jan 21 03&#58;38 gridftp.log-20130122
-rw-r--r-- 1 root root    0 Jan 20 03&#58;30 gridftp.log-20130121
-rw-r--r-- 1 root root    0 Jan 19 03&#58;42 gridftp.log-20130120
-rw-r--r-- 1 root root 4.3K Jan 18 16&#58;46 gridftp.log-20130119
-rw-r--r-- 1 root root    0 Jan 17 03&#58;31 gridftp.log-20130118
-rw-r--r-- 1 root root  591 Jan 16 04&#58;54 gridftp.log-20130117
-rw-r--r-- 1 root root 543K Jan 16 04&#58;52 gridftp.log-20130116
-rw-r--r-- 1 root root  256 Jan 14 10&#58;56 gridftp.log-20130115
-rw-r--r-- 1 root root    0 Jan 13 03&#58;42 gridftp.log-20130114
-rw-r--r-- 1 root root    0 Jan 12 03&#58;11 gridftp.log-20130113
-rw-r--r-- 1 root root    0 Jan 11 03&#58;44 gridftp.log-20130112
-rw-r--r-- 1 root root  256 Jan 10 10&#58;35 gridftp.log-20130111
-rw-r--r-- 1 root root    0 Jan  9 03&#58;30 gridftp.log-20130110
-rw-r--r-- 1 root root 1.5K Jan  8 13&#58;20 gridftp.log-20130109
-rw-r--r-- 1 root root    0 Jan  7 03&#58;15 gridftp.log-20130108
-rw-r--r-- 1 root root    0 Jan  6 03&#58;09 gridftp.log-20130107
-rw-r--r-- 1 root root    0 Jan  5 03&#58;11 gridftp.log-20130106
-rw-r--r-- 1 root root    0 Jan  4 03&#58;13 gridftp.log-20130105
Thanks</pre></div><div class='update_description'><i onclick="document.location='13350#1358290932'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-01-15T23:02:12+00:00">Jan 15, 2013 11:02 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1358290932">&nbsp;</a></div><pre>Hi Amitoj
This was the last item on my list for today and I couldn&#39;t get to it. I am gone rest of the week and will work on this when I return on Tuesday.</pre></div><div class='update_description'><i onclick="document.location='13350#1357922473'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-01-11T16:41:13+00:00">Jan 11, 2013 04:41 PM UTC</time> by <b>Tim Cartwright</b><a class="anchor" name="1357922473">&nbsp;</a></div><pre>Added Software Support and Neha as assignees.</pre></div><div class='update_description'><i onclick="document.location='13350#1357921844'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-01-11T16:30:44+00:00">Jan 11, 2013 04:30 PM UTC</time> by <b>Neha Sharma</b><a class="anchor" name="1357921844">&nbsp;</a></div><pre>Hi Amitoj

Given that I am currently occupied with very high priority Bestman2 readiness/testing for upcoming release and then gone 2-3 working days next week, I am really sorry I won&#39;t be able to look in to this till end of next week.

On Jan 11, 2013, at 9&#58;16 AM, Amitoj Singh wrote&#58;

Neha

Since Jan 7th there were some grid ftp transfers on the 8th and 10th but the probe is not collecting these. I ran the probe by hand and as before it finished without any log file or output so I cannot tell what&#39;s wrong .. (I am appending log file timestamps below)

[root@cc3 gridftp]# ls -hlt gridftp.log*
rw-rr- 1 root root 0 Jan 11 03&#58;44 gridftp.log
rw-rr- 1 root root 256 Jan 10 10&#58;35 gridftp.log-20130111
rw-rr- 1 root root 0 Jan 9 03&#58;30 gridftp.log-20130110
rw-rr- 1 root root 1.5K Jan 8 13&#58;20 gridftp.log-20130109
rw-rr- 1 root root 0 Jan 7 03&#58;15 gridftp.log-20130108
rw-rr- 1 root root 0 Jan 6 03&#58;09 gridftp.log-20130107

[root@cc3 gridftp]# cd /var/log/gratia/

[root@cc3 gratia]# ls -hlt *
rw-rr- 1 root root 2.2K Jan 7 14&#58;01 2013-01-07.log
rw-rr- 1 root root 284K Jan 7 14&#58;01 gridftpTransfer.log
rw-rr- 1 root root 0 Jan 7 14&#58;01 netlogger.log
rw-rr- 1 root root 1.4M Dec 14 10&#58;14 2012-12-14.log

Can you please take a look when you have time. Thank you.

Amitoj

On 01/07/2013 02&#58;41 PM, Amitoj Singh wrote&#58;
Yes, but there were transfers in Jan (1st and 3rd) that did not get picked up at all but it&#39;s reassuring that the handshake records are at least visible now since I did not even get those this morning when running the probe manually.

Amitoj

<div id='show_1238613766' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1238613766'>On 01/07/2013 02&#58;14 PM, Neha Sharma wrote&#58;
Amitoj

The probe when run manually seems to run fine, however, doesn&#39;t look like there are any records to transfer. The file is empty for several days

[root@cc3 gridftp]# ls -hlt gridftp.log* | head -20
rw-rr- 1 root root 0 Jan 7 03&#58;15 gridftp.log
rw-rr- 1 root root 0 Jan 6 03&#58;09 gridftp.log-20130107
rw-rr- 1 root root 0 Jan 5 03&#58;11 gridftp.log-20130106
rw-rr- 1 root root 0 Jan 4 03&#58;13 gridftp.log-20130105
rw-rr- 1 root root 0 Jan 3 03&#58;40 gridftp.log-20130104
rw-rr- 1 root root 447K Jan 3 03&#58;19 gridftp.log-20130103
rw-rr- 1 root root 269 Jan 1 10&#58;23 gridftp.log-20130102
rw-rr- 1 root root 0 Dec 31 04&#58;30 gridftp.log-20130101
rw-rr- 1 root root 44K Dec 30 14&#58;49 gridftp.log-20121231
rw-rr- 1 root root 0 Dec 29 03&#58;21 gridftp.log-20121230
rw-rr- 1 root root 0 Dec 28 03&#58;26 gridftp.log-20121229
rw-rr- 1 root root 0 Dec 27 03&#58;06 gridftp.log-20121228
rw-rr- 1 root root 0 Dec 26 03&#58;19 gridftp.log-20121227
rw-rr- 1 root root 0 Dec 25 03&#58;36 gridftp.log-20121226
rw-rr- 1 root root 0 Dec 24 03&#58;07 gridftp.log-20121225
rw-rr- 1 root root 0 Dec 23 03&#58;38 gridftp.log-20121224
rw-rr- 1 root root 0 Dec 22 03&#58;13 gridftp.log-20121223
rw-rr- 1 root root 16K Dec 21 13&#58;00 gridftp.log-20121222
rw-rr- 1 root root 17K Dec 20 11&#58;16 gridftp.log-20121221
rw-rr- 1 root root 145K Dec 19 17&#58;22 gridftp.log-20121220
[root@cc3 gridftp]#
[root@cc3 gridftp]#

Looking at /var/log/gratia/2013-01-07.log , handshake is performed successfully

On Jan 7, 2013, at 10&#58;19 AM, Amitoj Singh wrote&#58;

You and Tanya have root k5login access to this node (cc3.fnal.gov)

Amitoj

On 01/07/2013 10&#58;17 AM, Neha Sharma wrote&#58;
Hi Amitoj
If I am at lab after lunch, I will look in to this today. I am not sure if I will be in rest of the week.
Fastest way would be if you give me root access on this node while I am looking in to this issue. I won&#39;t run any commands except the probe itself on the node.

On Jan 7, 2013, at 9&#58;32 AM, Amitoj Singh wrote&#58;

Hi Neha, Tanya,

I did not keep an eye on this during the holidays but the gratia gridftp probe on cc3.fnal.gov has not picked up any gridftp transfers since Dec 14th, 2012. There have been bursts of ftp transfers in late Dec 2012 and Jan 2013 but the probe did not pick any of them. I tried running the probe by hand and it finishes without any errors and does not create a log file either so I cannot tell if it is failing or not?

If you let me know, I can provide any information you guys may need for further investigation.

Regards,
Amitoj

</div><script type='text/javascript'>
        $('#show_1238613766').click(function() {
            $('#detail_1238613766').slideDown("normal");
            $('#show_1238613766').hide();
            $('#hide_1238613766').show();
        });
        $('#hide_1238613766').click(function() {
            $('#detail_1238613766').slideUp();
            $('#hide_1238613766').hide();
            $('#show_1238613766').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F13350">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 13350});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
