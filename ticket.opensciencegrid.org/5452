<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[5452] User authentication fails</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=5452" method="post">
<div class="page-header">
    <h3><span class="muted">5452</span> / User authentication fails</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Steven lee</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2008-09-04</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
        <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/5452", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="https://ticket.opensciencegrid.org/\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="https://ticket.opensciencegrid.org/\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/5452?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/5452?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20User%20authentication%20fails%20ISSUE%3D5452%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='5452#1220541910'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-09-04T15:25:10+00:00">Sep 4, 2008 03:25 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1220541910">&nbsp;</a></div><pre>Repeated efforts to obtain further information via the admin from the customer have failed. Due to
lack of customer response, this ticket is being closed.

Tim</pre></div><div class='update_description'><i onclick="document.location='5452#1219946605'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-08-28T18:03:25+00:00">Aug 28, 2008 06:03 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1219946605">&nbsp;</a></div><pre>Steve,

Have you been able to contact the user?

Tim</pre></div><div class='update_description'><i onclick="document.location='5452#1219348139'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-08-21T19:48:59+00:00">Aug 21, 2008 07:48 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1219348139">&nbsp;</a></div><pre>Steve,

We are still supporting 0.6.0, but you need to plan on upgrading before the 19th. Glad to hear you&#39;re
doing so. Who is the user? What VO are they a member of? Can they authenticate to other OSG
Resources that support their VO? I look forward to hearing from you.

Tim</pre></div><div class='update_description'><i onclick="document.location='5452#1219341070'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-08-21T17:51:10+00:00">Aug 21, 2008 05:51 PM UTC</time> by <b>Steven Lee</b><a class="anchor" name="1219341070">&nbsp;</a></div><pre>The name of the resource is nys1.cac.cornell.edu.  I thought I saw a
note on osg-sites saying OSG 0.6 sites have to upgrade to 1.0 by 9/19
(see GOC ticket #5399).  We are planning an upgrade before that date,
but didn&#39;t know we would think cut off without warnings.....

Steven Lee
shl1@....
Center for Advanced Computing
Cornell University

On Aug 21, 2008, at 1&#58;41 PM, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='5452#1219340469'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-08-21T17:41:09+00:00">Aug 21, 2008 05:41 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1219340469">&nbsp;</a></div><pre>Steven,

What is the name of this Resource? We don&#39;t support that version of the VDT/OSG software stack
anymore. You&#39;ll need to upgrade to a supported version. OSG 1.0 was just released recently. We
suggest you make plans to upgrade. There aren&#39;t available resources to support the older versions.
But you can still find the documentation here, <a href='http&#58;//vdt.cs.wisc.edu/releases/1.6.1/release.html' target='_blank' rel='nofollow'>http&#58;//vdt.cs.wisc.edu/releases/1.6.1/release.html</a>

Also, GUMS doesn&#39;t generate the grid-mapfile for the compute element. If you&#39;re using GUMS and
PRIMA, then a grid-mapfile won&#39;t provide the authentication. You will find information about the
authentication methods for OSG at <a href='https&#58;//twiki.grid.iu.edu/bin/view/ReleaseDocumentation/ComputeElementInstall#Included_topic_Fu' target='_blank' rel='nofollow'>https&#58;//twiki.grid.iu.edu/bin/view/ReleaseDocumentation/ComputeElementInstall#Included_topic_Fu</a>
ll_Priv_Pre_Con

Tim</pre></div><div class='update_description'><i onclick="document.location='5452#1219334049'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-08-21T15:54:09+00:00">Aug 21, 2008 03:54 PM UTC</time> by <b>Steven Lee</b><a class="anchor" name="1219334049">&nbsp;</a></div><pre>Tim,

We are running GUMS.  When I try to map in the GUMS web interface, I
get back NULL.  It looks like GUMS haven&#39;t been able to generate any
map file since late August 17&#58;

[shl1@nys1 ~]$ ls -l /etc/grid-security/grid-mapfile*
-rw-r--r--  1 root root 92090 Aug 17 18&#58;45 /etc/grid-security/grid-
mapfile
-rw-r--r--  1 root root     0 Aug 18 06&#58;45 /etc/grid-security/grid-
mapfile.last_checked
-rw-r--r--  1 root root     0 Aug 21 06&#58;45 /etc/grid-security/grid-
mapfile.new
[shl1@nys1 ~]$ grep 387103 /etc/grid-security/grid-mapfile
&#34;/DC=org/DC=doegrids/OU=People/CN=Tim Silvers (GridScan) 387103&#34; mis

Running &#34;vdt-version&#34; on nys1.cac.cornell.edu returns the following
version information&#58;

[shl1@nys1 ~]$ vdt-version
You have installed a subset of VDT version 1.6.1m&#58;
Apache HTTPD 2.2.3
gLite CEMon Server (INFN release from 2006-05-19, plus RAW
dialect) 1.7.1
CA Certificates v37 (includes IGTF 1.22 CAs)
Condor/Condor-G 6.8.3
EDG Make Gridmap 2.9.0
Fetch CRL 2.6.2
Generic Information Provider 1.0.15 (Iowa 15-Feb-2006)
Globus Toolkit, pre web-services, client 4.0.3
Globus Toolkit, pre web-services, server 4.0.3
Globus Toolkit, web-services, client 4.0.3
Globus Toolkit, web-services, server 4.0.3
GLUE Schema 1.2 draft 7
GPT 3.2
<div id='show_1959374015' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1959374015'>Gratia Condor Probe 0.25
Gratia PBS Probe 0.25
GUMS 1.1.0
Java SDK 1.4.2_12
Java 5 SDK 1.5.0_09
KX509 20031111
Logrotate 3.7
MonALISA 1.6.8
MyProxy 3.6
MySQL 4.1.21
MySQL JDBC Driver 5.0.4
PPDG Cert Scripts 2.4
PRIMA Authorization Module 0.5
PRIMA Authorization Module For GT4 Web Services 0.1.2
RLS, client 3.0.041021
SRM V1 Client 1.25
SRM V2 Client 2.1
Apache Tomcat 5.0.28
UberFTP 1.22
VDS Worker Package 1.4.7
Wget 1.10.2

I followed the steps in job_not_running_user.html.  From the user
perspective, everything is normal until&#58;

bash-3.2$ globus-job-run nys1.cac.cornell.edu/jobmanager-pbs /bin/
hostname
GRAM Job submission failed because authentication with the remote
server failed (error code 7)

I don&#39;t know if any of this info is helpful.

Steven Lee
shl1@....
Center for Advanced Computing
Cornell University

On Aug 21, 2008, at 11&#58;07 AM, Open Science Grid FootPrints wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_1959374015').click(function() {
            $('#detail_1959374015').slideDown("normal");
            $('#show_1959374015').hide();
            $('#hide_1959374015').show();
        });
        $('#hide_1959374015').click(function() {
            $('#detail_1959374015').slideUp();
            $('#hide_1959374015').hide();
            $('#show_1959374015').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='5452#1219331256'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-08-21T15:07:36+00:00">Aug 21, 2008 03:07 PM UTC</time> by <b>Tim Silvers</b><a class="anchor" name="1219331256">&nbsp;</a></div><pre>Hi Steven,

There could be several causes for a user&#39;s Globus authentication to fail. Are you using a grid-
mapfile or GUMS to handle authentication requests? If it is the former, the user&#39;s DN should be in
the grid-mapfile. They should also be mapped to a local user account, which should follow their DN.
So, for the GridScan DN used by the GOC to monitor Resources, you would see...

&#34;/DC=org/DC=doegrids/OU=People/CN=Tim Silvers (GridScan) 387103&#34; mis

Other issues include expired certificates or CRLs. To expedite determining the cause, I would
suggest the user go through the steps listed at&#58;

<a href='http&#58;//vdt.cs.wisc.edu/tmp/jobs_not_running_user.html' target='_blank' rel='nofollow'>http&#58;//vdt.cs.wisc.edu/tmp/jobs_not_running_user.html</a>

This should give us a lot more information to help isolate the issue.

Thank you,

Tim</pre></div><div class='update_description'><i onclick="document.location='5452#1219329686'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2008-08-21T14:41:26+00:00">Aug 21, 2008 02:41 PM UTC</time> by <b>Nizar Louly</b><a class="anchor" name="1219329686">&nbsp;</a></div><pre>From&#58; Steven Lee &#60;shl1@....&#62;
To&#58; OSG- Grid Operations Center &#60;goc@....&#62;
cc&#58; Steven Lee &#60;shl1@....&#62;
Subject&#58; gatekeeper error
Date-Sent&#58; Thursday, August 21, 2008 9&#58;58 AM -0400

Hi,

I just got a problem report from a user re&#58; not being able to authenticate.  I looked
on the gatekeeper and it has been like this since Aug 18&#58;

---

Aug 18 12&#58;17&#58;02 nys1 GRAM gatekeeper[13944]&#58; globus_gss_assist_gridmap() failed
authorization. gridmap.c&#58;globus_gss_assist_map_and_authorize&#58;1910&#58; Error invokin
g callout globus_callout.c&#58;globus_callout_handle_call_type&#58;727&#58; The callout retu
rned an error prima_module.c&#58;Globus Gridmap Callout&#58;400&#58; Gridmap lookup failure&#58;
Identity Mapping Service could not be contacted
---

Any ideas?  As far as I know nothing on the system or local network has been changed
recently. Thanks.

Steven Lee
shl1@....

Center for Advanced Computing
Cornell University</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F5452">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 5452});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
