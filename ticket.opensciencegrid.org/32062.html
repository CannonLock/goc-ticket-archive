<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[32062] OU_OSCER_ATLAS gratia probe is not reporting</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=32062" method="post">
<div class="page-header">
    <h3><span class="muted">32062</span> / OU_OSCER_ATLAS gratia probe is not reporting</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Tanya Levshina</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Resource Name</label><div class="controls">OU_OSCER_ATLAS</div></div><div class="control-group"><label class="control-label">Associated VO</label><div class="controls">ATLAS</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Tanya Levshina</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">USATLAS</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2016-12-07</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">USATLAS (BNL Prod)&nbsp;<a target="_blank" href="https://rt.racf.bnl.gov/rt/Ticket/Display.html?id=26718">26718</a> <span class="muted"> / Ticket Exchange</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/32062", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='32062#1481047618'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-06T18:06:58+00:00">Dec 6, 2016 06:06 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1481047618">&nbsp;</a></div><pre>Hi Tanya,

yeah, it&#39;s pretty weird that our problem time range doesn&#39;t completely overlap
with yours ...

I did restart the OSG services on Friday late afternoon, but I haven&#39;t done
anything since, so if the restart disrupted something, that would still not
explain why things started to work again -- unless my running the probe by hand
magically kicked it into production again, who knows ...

I&#39;m closing the ticket again from the BNL RT side, and hopefully the problem
won&#39;t come back!

Thanks,

Horst
-- by hs@.... at Tue Dec 06 18&#58;06&#58;44 UTC 2016

GOCTX Source&#58; BNL Ticket&#58; Queue=SWTier2 ID=26718</pre></div><div class='update_description'><i onclick="document.location='32062#1481047150'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-06T17:59:10+00:00">Dec 6, 2016 05:59 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1481047150">&nbsp;</a></div><pre>Hi,

It looks like you have stop sending duplicates and we are getting fresh data. Gratia collector apparently had problems over weekend and was restarted on 12/5. It still doesn&#39;t explain why OU probe has stopped reporting on 12/2 and why probe didn&#39;t recover on its own when server was restarted.

Let&#39;s close the ticket for now but we will continue to monitor the probe.

Thanks,

Tanya</pre></div><div class='update_description'><i onclick="document.location='32062#1481045714'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-06T17:35:14+00:00">Dec 6, 2016 05:35 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1481045714">&nbsp;</a></div><pre>Hi Carl,

no, I don&#39;t think that&#39;s the case, actually. The only time I&#39;ve seen
slurmdb connection errors was when I ran slurm_meter without the -c,
which I don&#39;t think I should&#39;ve ever done, right?

Whenever I ran it with -c, just like the cron job does, I&#39;ve never
gotten any error on the command line at all, and the only errors
I&#39;ve seen in the logs were connection errors to the web service,
which I presume are connection errors of the slurm_meter to the
gratia db, right? Like these&#58;

----
03&#58;52&#58;44 CST Gratia&#58; Failed to send xml to web service due to an error of type &#34;&#60;class &#39;socket.error&#39;&#62;&#34;&#58; [Errno 104] Connection reset by peer
responseString = postRequest(connection, Config.get_CollectorService(), queryString, headers)
responseString = myconnection.getresponse().read()
error&#58; [Errno 104] Connection reset by peer
----

And looking through the logs, they only appear on 12/4 and 12/5,
and have since disappeared again&#58;

----
[hs@grid1 gratia]$ grep onnection /var/log/gratia/2016-12-02.log | egrep -v &#34;SUCCESS|gratia-osg-prod&#34; | wc
5      47     354
[hs@grid1 gratia]$ grep onnection /var/log/gratia/2016-12-03.log | egrep -v &#34;SUCCESS|gratia-osg-prod&#34; | wc
0       0       0
[hs@grid1 gratia]$ grep onnection /var/log/gratia/2016-12-04.log | egrep -v &#34;SUCCESS|gratia-osg-prod&#34; | wc
130    1276   11001
[hs@grid1 gratia]$ grep onnection /var/log/gratia/2016-12-05.log | egrep -v &#34;SUCCESS|gratia-osg-prod&#34; | wc
271    2556   22748
[hs@grid1 gratia]$ grep onnection /var/log/gratia/2016-12-06.log | egrep -v &#34;SUCCESS|gratia-osg-prod&#34; | wc
0       0       0
----

<div id='show_1659434441' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1659434441'>So shall we assume that this has been &#39;macigally&#39; fixed again and close
this ticket, or wait a little longer?

Thanks,

Horst
</div><script type='text/javascript'>
        $('#show_1659434441').click(function() {
            $('#detail_1659434441').slideDown("normal");
            $('#show_1659434441').hide();
            $('#hide_1659434441').show();
        });
        $('#hide_1659434441').click(function() {
            $('#detail_1659434441').slideUp();
            $('#hide_1659434441').hide();
            $('#show_1659434441').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='32062#1481044969'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-06T17:22:49+00:00">Dec 6, 2016 05:22 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1481044969">&nbsp;</a></div><pre>I can&#39;t say I understand the problem, but my guess is still something related to timeouts for a long-running query against the slurm db, maybe due to heavy io load there?

Not sure if anyone else has other ideas.

Carl</pre></div><div class='update_description'><i onclick="document.location='32062#1481034370'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-06T14:26:10+00:00">Dec 6, 2016 02:26 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1481034370">&nbsp;</a></div><pre>Hi Tanya,

looking at our gratia page,

<a href='http&#58;//gratiaweb.grid.iu.edu/gratia/site?facility=OU_OSCER_ATLAS' target='_blank' rel='nofollow'>http&#58;//gratiaweb.grid.iu.edu/gratia/site?facility=OU_OSCER_ATLAS</a>

it seems like things are working again, since I see today&#39;s column
being filled, so that must be coming from the &#39;normal&#39; cron job,
not the additional times I ran slurm_meter manually, since I haven&#39;t
done that since yesterday.

So does anyone understand why this wasn&#39;t working for a few days,
and then &#39;magically&#39; started working again?

Thanks,

Horst</pre></div><div class='update_description'><i onclick="document.location='32062#1480975385'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-05T22:03:05+00:00">Dec 5, 2016 10:03 PM UTC</time><a class="anchor" name="1480975385">&nbsp;</a></div><pre>Hi Carl and Tanya,

hmm, so now all of a sudden we&#39;re sending data again? Why? We haven&#39;t changed anything on our end.

I did run slurm_meter without the -c a few times, so if that actually started working again, then I can imagine that you&#39;ll be getting a lot of old data, sorry! &#58;)

I still don&#39;t understand what was wrong, though, or what fixed it, or why ... any ideas?

I guess we need to wait until all the duplicates have been sent, and then we&#39;ll see if it works again for &#39;new&#39; data as well?

<a href='http&#58;//gratiaweb.grid.iu.edu/gratia/site?facility=OU_OSCER_ATLAS' target='_blank' rel='nofollow'>http&#58;//gratiaweb.grid.iu.edu/gratia/site?facility=OU_OSCER_ATLAS</a>

shows new data for today now, so that&#39;s good! Hopefully we can figure out what the problem is/was, and make sure it won&#39;t happen again!

Thanks a lot,

Horst

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Horst Severini 27</pre></div><div class='update_description'><i onclick="document.location='32062#1480974792'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-05T21:53:12+00:00">Dec 5, 2016 09:53 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1480974792">&nbsp;</a></div><pre>Currently data are from &#34;2016-11-08 03&#58;15&#58;38&#34;. [☹]

I guess we should wait and see if gratia is capable to handle so much duplicates.

Tanya

________________________________
From&#58; Tanya Levshina
Sent&#58; Monday, December 5, 2016 3&#58;50&#58;20 PM
To&#58; osg@....
Subject&#58; Re&#58; Open Science Grid&#58; OU_OSCER_ATLAS gratia probe is not reporting ISSUE=32062 PROJ=71

Oh, you are resending a lot of data now. That is why we don&#39;t see anything in the database (all goes as replica).

Tanya</pre></div><div class='update_description'><i onclick="document.location='32062#1480974790'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-05T21:53:10+00:00">Dec 5, 2016 09:53 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1480974790">&nbsp;</a></div><pre>Oh, you are resending a lot of data now. That is why we don&#39;t see anything in the database (all goes as replica).

Tanya</pre></div><div class='update_description'><i onclick="document.location='32062#1480974115'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-05T21:41:55+00:00">Dec 5, 2016 09:41 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1480974115">&nbsp;</a></div><pre><font color='#7F7E6F'>&#62; Exception _mysql_exceptions.OperationalError&#58; (2013, &#39;Lost connection to MySQL server during query&#39;) ...</font>

Off-the-cuff, it sounds like the regular runs of slurm_meter (without the &#34;-c&#34; option) are maybe timing out, and the ones from the last checkpoint (with &#34;-c&#34;) return in a reasonable amount of time

<font color='#7F7E6F'>&#62; 14&#58;46&#58;54 CST Gratia&#58; Failed to send xml to web service due to an error of type &#34;&#60;class &#39;socket.error&#39;&#62;&#34;&#58; [Errno 104] Connection reset by peer</font>

<font color='#7F7E6F'>&#62; That looks like a connectiion problem to your servers, since it mentions</font>
<font color='#7F7E6F'>&#62; &#39;xml to web service&#39;? But why/how?</font>

Yeah this message is from the gratia probe
here&#58; <a href='https&#58;//github.com/opensciencegrid/gratia-probe/blob/probes_v1.16.0-1/common/gratia/common/connect_utils.py#L392-L396' target='_blank' rel='nofollow'>https&#58;//github.com/opensciencegrid/gratia-probe/blob/probes_v1.16.0-1/common/gratia/common/connect_utils.py#L392-L396</a>
from&#58; <a href='https&#58;//github.com/opensciencegrid/gratia-probe/blob/probes_v1.16.0-1/common/gratia/common/connect_utils.py#L272' target='_blank' rel='nofollow'>https&#58;//github.com/opensciencegrid/gratia-probe/blob/probes_v1.16.0-1/common/gratia/common/connect_utils.py#L272</a>
... some kind of python socket error connecting or talking to the gratia collector ... not really sure what the problem is off hand.  A timeout can cause this to fail also, but that doesn&#39;t seem to be the case since that is handled separately.

Carl</pre></div><div class='update_description'><i onclick="document.location='32062#1480971190'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-05T20:53:10+00:00">Dec 5, 2016 08:53 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1480971190">&nbsp;</a></div><pre>Hi again,

I just noticed that I did miss some errors in the gratia log file&#58;

----
14&#58;19&#58;12 CST Gratia&#58;                           new records failed&#58; 31
14&#58;19&#58;12 CST Gratia&#58;                           records reprocessed successfully&#58; 0
14&#58;19&#58;12 CST Gratia&#58;                           reprocessed records failed&#58; 209
14&#58;19&#58;12 CST Gratia&#58;                           handshake records sent successfully&#58; 0
14&#58;19&#58;12 CST Gratia&#58;                           handshake records failed&#58; 1
14&#58;19&#58;12 CST Gratia&#58;                           bundle of records sent successfully&#58; 0
14&#58;19&#58;12 CST Gratia&#58;                           bundle of records failed&#58; 3
14&#58;19&#58;12 CST Gratia&#58;                           outstanding records&#58; 240
----
14&#58;45&#58;01 CST Gratia&#58; DEBUG&#58; Connect
14&#58;45&#58;01 CST Gratia&#58; DEBUG&#58; Connect&#58; OK
14&#58;45&#58;01 CST Gratia&#58; Connection via HTTP to&#58; gratia-osg-prod.opensciencegrid.org
&#58;80
14&#58;45&#58;01 CST Gratia&#58; DEBUG&#58; Connection SUCCESS
14&#58;45&#58;01 CST Gratia&#58; TransactionId&#58;  slurm&#58;grid1.oscer.ou.edu2016-12-05T204501Z
14&#58;45&#58;01 CST Gratia&#58; DEBUG&#58; POST
14&#58;46&#58;54 CST Gratia&#58; Failed to send xml to web service due to an error of type &#34;&#60;class &#39;socket.error&#39;&#62;&#34;&#58; [Errno 104] Connection reset by peer
14&#58;46&#58;54 CST Gratia&#58; In traceback print (0)
14&#58;46&#58;54 CST Gratia&#58; In traceback print (1)
14&#58;46&#58;54 CST Gratia&#58; Traceback (most recent call last)&#58;
File &#34;/usr/lib/python2.7/site-packages/gratia/common/connect_utils.py&#34;, line 333, in sendUsageXML
responseString = postRequest(connection, Config.get_CollectorService(), queryString, headers)
File &#34;/usr/lib/python2.7/site-packages/gratia/common/connect_utils.py&#34;, line 272, in postRequest
myconnection.request(&#39;POST&#39;, to, what, headers)
File &#34;/usr/lib64/python2.7/httplib.py&#34;, line 979, in request
self._send_request(method, url, body, headers)
File &#34;/usr/lib64/python2.7/httplib.py&#34;, line 1013, in _send_request
self.endheaders(body)
File &#34;/usr/lib64/python2.7/httplib.py&#34;, line 975, in endheaders
self._send_output(message_body)
<div id='show_92256227' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_92256227'>File &#34;/usr/lib64/python2.7/httplib.py&#34;, line 835, in _send_output
self.send(msg)
File &#34;/usr/lib64/python2.7/httplib.py&#34;, line 811, in send
self.sock.sendall(data)
File &#34;/usr/lib64/python2.7/socket.py&#34;, line 224, in meth
return getattr(self._sock,name)(*args)
error&#58; [Errno 104] Connection reset by peer

14&#58;46&#58;54 CST Gratia&#58; Response&#58; (FAILED, Server unable to receive data&#58; save for reprocessing)
14&#58;46&#58;54 CST Gratia&#58; Processing bundle Response code&#58;  1
14&#58;46&#58;54 CST Gratia&#58; Processing bundle Response message&#58;  Server unable to receive data&#58; save for reprocessing
14&#58;46&#58;54 CST Gratia&#58; Response indicates failure, the following files will not be deleted&#58;
----

That looks like a connectiion problem to your servers, since it mentions
&#39;xml to web service&#39;? But why/how?

Thanks,

Horst
</div><script type='text/javascript'>
        $('#show_92256227').click(function() {
            $('#detail_92256227').slideDown("normal");
            $('#show_92256227').hide();
            $('#hide_92256227').show();
        });
        $('#hide_92256227').click(function() {
            $('#detail_92256227').slideUp();
            $('#hide_92256227').hide();
            $('#show_92256227').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='32062#1480969670'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-05T20:27:50+00:00">Dec 5, 2016 08:27 PM UTC</time><a class="anchor" name="1480969670">&nbsp;</a></div><pre>Hi Tanya,

correct -- when I run it with &#39;-c&#39; it doesn&#39;t throw any error and seems to finish fine. But it&#39;s still not reporting anything, so I don&#39;t know what&#39;s going on.

I have attached the last 30 lines of the log. I had to add a .txt to the gzipped txt file again, in order for the ticket system to allow me to attach it, so you&#39;ll have to remove the .txt again, and then gunzip it.

I don&#39;t see obvious errors, hopefully you&#39;ll have more luck.

Thanks a lot

Horst

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Horst Severini 27</pre></div><div class='update_description'><i onclick="document.location='32062#1480969413'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-05T20:23:33+00:00">Dec 5, 2016 08:23 PM UTC</time><a class="anchor" name="1480969413">&nbsp;</a></div><pre>Adding myself as CC.

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Derek Weitzel 605</pre></div><div class='update_description'><i onclick="document.location='32062#1480968701'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-05T20:11:41+00:00">Dec 5, 2016 08:11 PM UTC</time><a class="anchor" name="1480968701">&nbsp;</a></div><pre>The &#34;-c&#34; command means &#34;continue from checkpoint&#34; (or something along those lines).  Without that command, it will scan the DB from be beginning of time, which is likely resource intensive.

For these test, only run with &#34;-c&#34; option.

So there are no errors when running with the &#34;-c&#34;?  What&#39;s the last ~30 lines in the gratia log?

by /DC=org/DC=opensciencegrid/O=Open Science Grid/OU=People/CN=Derek Weitzel 605</pre></div><div class='update_description'><i onclick="document.location='32062#1480967773'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-05T19:56:13+00:00">Dec 5, 2016 07:56 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1480967773">&nbsp;</a></div><pre>Hi Tanya,

we&#39;re running gratia-probe-slurm-1.16.0-1.osg33.el7.x86_64,
but that has been patched for the cpus_alloc problem which appeared
with the new SLURM version. And that worked perfectly fine until
a few days ago. /var/log/gratia/2016-12-05.log gets filled and doesn&#39;t
seem to show any obvious errors ...

I did restart the CE services on December 2, because condor-ce seems
to have locked up somehow, but I&#39;m not sure how that would&#39;ve affected
gratia.

I can connect to the slurmdb with &#39;telnet odin 3306&#39; just fine,
so there doesn&#39;t seem to be an obvious connection problem.
If there were, I&#39;d assume that this error should appear immediately,
and not only after several minutes?

Also, running &#39;/usr/share/gratia/slurm/slurm_meter -c&#39; finishes fine
after a few seconds, only &#39;/usr/share/gratia/slurm/slurm_meter&#39; (without -c)
sits there for several minutes, before finally giving this error.
What does that mean?

Thanks,

Horst</pre></div><div class='update_description'><i onclick="document.location='32062#1480965614'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-05T19:20:14+00:00">Dec 5, 2016 07:20 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1480965614">&nbsp;</a></div><pre>Hi Horst,

I assume that this is related to slurm and that you have checked access to slurm database. . I know nothing about gratia slurm probe but Carl and Derek should be able to help.

What version of probe are you using?

The last message we have got is from 2016-12-02 04&#58;36&#58;38 (UTC).

Thanks,

Tanya</pre></div><div class='update_description'><i onclick="document.location='32062#1480964907'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-05T19:08:27+00:00">Dec 5, 2016 07:08 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1480964907">&nbsp;</a></div><pre>Hi Tanya,

thanks for noticing that. I just tried this by hand, and after a while
slurm_meter throws a mysql python error which I don&#39;t understand&#58;

----
[hs@grid1 ~]$ sudo /usr/share/gratia/slurm/slurm_meter
Traceback (most recent call last)&#58;
File &#34;/usr/share/gratia/slurm/slurm_meter&#34;, line 234, in &#60;module&#62;
SlurmMeter().main()
File &#34;/usr/share/gratia/slurm/slurm_meter&#34;, line 217, in main
for job in self.sacct.completed_jobs(self.checkpoint.val)&#58;
File &#34;/usr/share/gratia/slurm/SlurmProbe.py&#34;, line 376, in _jobs
for r in cursor&#58;
File &#34;/usr/lib64/python2.7/site-packages/MySQLdb/cursors.py&#34;, line
421, in next
row = self.fetchone()
File &#34;/usr/lib64/python2.7/site-packages/MySQLdb/cursors.py&#34;, line
392, in fetchone
r = self._fetch_row(1)
File &#34;/usr/lib64/python2.7/site-packages/MySQLdb/cursors.py&#34;, line
289, in _fetch_row
return self._result.fetch_row(size, self._fetch_type)
_mysql_exceptions.OperationalError&#58; (2013, &#39;Lost connection to MySQL
server during query&#39;)
Exception _mysql_exceptions.OperationalError&#58; (2013, &#39;Lost connection
to MySQL server during query&#39;) in &#60;bound method SSDictCursor.__del__
of &#60;MySQLdb.cursors.SSDictCursor object at 0x2afcf1fe2c50&#62;&#62; ignored
----

And then it stops. What mysql connection is it talking about here,
the connection to the SlurmDb?

If so, then any idea why? It runs for quite a while before this error,
so could it be that there is one particular job in the SlurmDb that&#39;s
<div id='show_1183567216' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1183567216'>causing this connection error? Or maybe a corrupted SlurmDB? Or ...?

Thanks a lot,

Horst

-- by hs@.... at Mon Dec 05 19&#58;08&#58;18 UTC 2016

GOCTX Source&#58; BNL Ticket&#58; Queue=SWTier2 ID=26718
</div><script type='text/javascript'>
        $('#show_1183567216').click(function() {
            $('#detail_1183567216').slideDown("normal");
            $('#show_1183567216').hide();
            $('#hide_1183567216').show();
        });
        $('#hide_1183567216').click(function() {
            $('#detail_1183567216').slideUp();
            $('#hide_1183567216').hide();
            $('#show_1183567216').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='32062#1480955473'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2016-12-05T16:31:13+00:00">Dec 5, 2016 04:31 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1480955473">&nbsp;</a></div><pre>Hi,

slurm&#58;grid1.oscer.ou.edu  last time reported data on 2016-12-02. It is only sending heartbeats now.
Could you please check?

Thanks,
Tanya</pre></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F32062">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
