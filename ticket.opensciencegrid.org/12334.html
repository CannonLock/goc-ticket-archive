<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[12334] Request for help updating OSG 1.2-based BeStMan SE to use XACML in GSI authorization callout</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=12334" method="post">
<div class="page-header">
    <h3><span class="muted">12334</span> / Request for help updating OSG 1.2-based BeStMan SE to use XACML in GSI authorization callout</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Alan Sill</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">software team respond</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2012-07-04</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Doug Strain <span class="muted"> / OSG Storage Team</span></div><div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/12334", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/12334?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/12334?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Request%20for%20help%20updating%20OSG%201.2-based%20BeStMan%20SE%20to%20use%20XACML%20in%20GSI%20authorization%20callout%20ISSUE%3D12334%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='12334#1341842943'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-07-09T14:09:03+00:00">Jul 9, 2012 02:09 PM UTC</time><a class="anchor" name="1341842943">&nbsp;</a></div><pre>-- by Douglas Strain</pre></div><div class='update_description'><i onclick="document.location='12334#1341842760'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-07-09T14:06:00+00:00">Jul 9, 2012 02:06 PM UTC</time><a class="anchor" name="1341842760">&nbsp;</a></div><pre>Thank you for informing us that this issue has been resolved. I will close this ticket.  Please submit problems, requests, and questions at&#58; <a href='https&#58;//ticket.grid.iu.edu/goc/open' target='_blank' rel='nofollow'>https&#58;//ticket.grid.iu.edu/goc/open</a> OSG Grid Operations Center goc@...., 317-278-9699 Visit the OSG Operations Page&#58; <a href='http&#58;//osggoc.blogspot.com/' target='_blank' rel='nofollow'>http&#58;//osggoc.blogspot.com/</a>

-- by Douglas Strain</pre></div><div class='update_description'><i onclick="document.location='12334#1341759187'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-07-08T14:53:07+00:00">Jul 8, 2012 02:53 PM UTC</time> by <b>TIGRE</b><a class="anchor" name="1341759187">&nbsp;</a></div><pre>Per your advice, I have successfully used pacman to remove the BeStMan package and replace it with BeStMan2.

The procedure was basically as follows&#58;

(Back up the old version and make sure all vdt-updater updates have been run.)

cd $VDT_LOCATION

pacman -remove <a href='http&#58;//software.grid.iu.edu/osg-1.2&#58' target='_blank' rel='nofollow'>http&#58;//software.grid.iu.edu/osg-1.2&#58</a>;Bestman

pacman -get <a href='http&#58;//software.grid.iu.edu/osg-1.2&#58' target='_blank' rel='nofollow'>http&#58;//software.grid.iu.edu/osg-1.2&#58</a>;Bestman2

. setup.sh

vdt-post-install

(Set up for our conditions&#58;)
./vdt/setup/configure_bestman2  --user daemon --cert /etc/grid-security/http/httpcert.pem --key /etc/grid-security/http/httpkey.pem --http-port 49080 --https-port 49443 --server y --gums-host gums.hpcc.ttu.edu --gums-port 8443 --enable-gateway
vdt/setup/configure_prima --gums-server gums.hpcc.ttu.edu --xacml

cp post-install/gsi-authz.conf /etc/grid-security//gsi-authz.conf

(Edit gums/config/gums-client.properties to make sure it points to the GUMSXACMLAuthorizationServicePort like the gsi-authz.conf file)

(Edit bestman2/conf/bestman2.rc to make sure it points to the GUMSXACMLAuthorizationServicePort like the gsi-authz.conf file)

(Remove stray still-enabled old removed bestman service from vdt-control&#58;)
vdt-control --disable bestman

(Re-enable services that got reinstalled in installation of BeStMan2&#58;)
vdt-control --enable gsiftp gums-host-cron gratia-gridftp-transfer

Then, upon the next vdt-control --on and a manual run of gums/scripts/gums-host-cron to be sure it was current, things worked!

From a client, we now see proper mapping through GUMS using XACML by the BeStMan2 installation&#58;
<div id='show_901356458' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_901356458'>
[asill@antaeus ~]$ srm-ping <a href='srm&#58;//sigmorgh.hpcc.ttu.edu&#58;49443/srm/v2/server' target='_blank' rel='nofollow'>srm&#58;//sigmorgh.hpcc.ttu.edu&#58;49443/srm/v2/server</a>
srm-ping   2.2.1.3.19   Wed Feb 23 10&#58;09&#58;34 PST 2011
BeStMan and SRM-Clients Copyright(c) 2007-2011,
Lawrence Berkeley National Laboratory. All rights reserved.
Support at SRM@.... and documents at <a href='http&#58;//sdm.lbl.gov/bestman' target='_blank' rel='nofollow'>http&#58;//sdm.lbl.gov/bestman</a>
SRM-CLIENT&#58; Connecting to serviceurl httpg&#58;//sigmorgh.hpcc.ttu.edu&#58;49443/srm/v2/server

SRM-PING&#58; Sun Jul 08 09&#58;36&#58;51 CDT 2012  Calling SrmPing Request...
versionInfo=v2.2

Extra information (Key=Value)
backend_type=BeStMan
backend_version=2.2.2.0.14
backend_build_date=2011-06-27T16&#58;34&#58;34.000Z
gsiftpTxfServers[0]=<a href='gsiftp&#58;//sigmorgh.hpcc.ttu.edu' target='_blank' rel='nofollow'>gsiftp&#58;//sigmorgh.hpcc.ttu.edu</a>
GatewayMode=Enabled
clientDN=/DC=org/DC=doegrids/OU=People/CN=Alan Sill 503049
gumsIDMapped=asill

One small note in postscript is that the instructions at <a href='https&#58;//twiki.grid.iu.edu/bin/view/ReleaseDocumentation/BeStMan' target='_blank' rel='nofollow'>https&#58;//twiki.grid.iu.edu/bin/view/ReleaseDocumentation/BeStMan</a> still refer to vdt/setup/configure_bestman where this should be vdt/setup/configure_bestman2 instead.  Otherwise all looks good!

Thanks very much and please close the ticket!

Alan
</div><script type='text/javascript'>
        $('#show_901356458').click(function() {
            $('#detail_901356458').slideDown("normal");
            $('#show_901356458').hide();
            $('#hide_901356458').show();
        });
        $('#hide_901356458').click(function() {
            $('#detail_901356458').slideUp();
            $('#hide_901356458').hide();
            $('#show_901356458').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='12334#1341523407'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-07-05T21:23:27+00:00">Jul 5, 2012 09:23 PM UTC</time><a class="anchor" name="1341523407">&nbsp;</a></div><pre>Hi Alan,

Ah, I apologize.  I didn&#39;t at first realize that you were using BeStMan and not even BeStMan 2.  I don&#39;t think BeStMan supports XACML. This is actually quite an old version and not even supported anymore.  You should definitely upgrade to BeStMan2.  I don&#39;t think its worth trying to get this working since it is quite an old version.  You can still use a newer version without even leaving from PacMan.  I can&#39;t find any documentation on the twiki anymore, but you should be able to follow the instructions here <a href='https&#58;//twiki.grid.iu.edu/bin/view/ReleaseDocumentation/BeStMan' target='_blank' rel='nofollow'>https&#58;//twiki.grid.iu.edu/bin/view/ReleaseDocumentation/BeStMan</a> substituing this for the pacman command&#58;

pacman -get <a href='http&#58;//software.grid.iu.edu/osg-1.2&#58' target='_blank' rel='nofollow'>http&#58;//software.grid.iu.edu/osg-1.2&#58</a>;Bestman2

The directory structure will be very similar but will be in VDT_LOCATION/bestman2 and the configuration file will be named bestman2.rc instead of bestman.rc.
This version should have better support for XACML.

Thanks,

Doug Strain
OSG Software

-- by Douglas Strain</pre></div><div class='update_description'><i onclick="document.location='12334#1341521407'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-07-05T20:50:07+00:00">Jul 5, 2012 08:50 PM UTC</time> by <b>TIGRE</b><a class="anchor" name="1341521407">&nbsp;</a></div><pre>Here are our complete bestman.server and bestman.rc files&#58;

[root@sigmorgh bestman]# cat sbin/bestman.server
#!/bin/sh

if test ! &#34;$SRM_HOME&#34; ; then
SRM_HOME=/usr/local/OSG_1.2-Bestman/bestman
fi
if test &#34;$JAVA_HOME&#34; ; then
JAVA_HOME_2=/usr/local/OSG_1.2-Bestman/jdk1.6
else
JAVA_HOME=/usr/local/OSG_1.2-Bestman/jdk1.6
fi
if test ! &#34;$GLOBUS_HOSTNAME&#34; ; then
GLOBUS_HOSTNAME=
fi
if test ! &#34;$GLOBUS_TCP_PORT_RANGE&#34; ; then
GLOBUS_TCP_PORT_RANGE=
fi
if test ! &#34;$GLOBUS_TCP_SOURCE_RANGE&#34; ; then
GLOBUS_TCP_SOURCE_RANGE=
fi
if test ! &#34;$X509_CERT_DIR&#34; ; then
X509_CERT_DIR=/usr/local/OSG_1.2-Bestman/globus/TRUSTED_CA
fi
if test ! &#34;$GSI_DAEMON_TRUSTED_CA_DIR&#34; ; then
GSI_DAEMON_TRUSTED_CA_DIR=/usr/local/OSG_1.2-Bestman/globus/TRUSTED_CA
fi
if test ! &#34;$VOMSDIR&#34; ; then
VOMSDIR=
fi

MAX_JAVA_HEAP=512
GUMS_ENABLED=yes
PLUGIN=
<div id='show_1387216591' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1387216591'>EXTRALIB=&#34;&#34;

CERTPATH=/etc/grid-security/http/httpcert.pem
KEYPATH=/etc/grid-security/http/httpkey.pem
GUMSCERTPATH=/etc/grid-security/http/httpcert.pem
GUMSKEYPATH=/etc/grid-security/http/httpkey.pem

EVENT_LOG_COUNT=
EVENT_LOG_SIZE=

INPUTTOKENS=$*
HELPTOKEN=&#96;echo $INPUTTOKENS| tr &#39; &#39; &#39;&#92;n&#39; | egrep &#34;help|version&#34;&#96;

if [ ! -f &#34;$SRM_HOME/sbin/bestman.server&#34; ]; then
echo &#34;ERROR&#58; Cannot find the $SRM_HOME location,&#34;
echo &#34;ERROR&#58; Please define &#92;$SRM_HOME correctly&#34;
exit 1;
fi

echo &#34;BeStMan  &#96;cat $SRM_HOME/version&#96;&#34;
#echo &#34;BeStMan and SRM-Clients Copyright(c) 2007-2010,&#34;
#echo &#34;Lawrence Berkeley National Laboratory. All rights reserved.&#34;
#echo &#34;Support at SRM@.... and documents at <a href='http&#58;//sdm.lbl.gov/bestman&#34' target='_blank' rel='nofollow'>http&#58;//sdm.lbl.gov/bestman&#34</a>;
#echo &#34; &#34;

if test ! -f &#34;$JAVA_HOME/bin/java&#34;; then
echo &#34;ERROR&#58; Cannot find the java executable in the $JAVA_HOME/bin location,&#34;
echo &#34;ERROR&#58; Please define &#92;$JAVA_HOME correctly&#34;
exit 1;
fi

Ver_separator() {
var1=$1
var2=$2
var3=$3
if test ! &#34;$var1&#34;; then
var1=0
fi
if test ! &#34;$var2&#34; ; then
var2=0
fi
if test ! &#34;$var3&#34; ; then
var3=0
fi
}
JAVAEXE=$JAVA_HOME/bin/java
JVR=&#96;$JAVAEXE -version 2&#62;&1&#96;
JVR=&#96;echo $JVR | sed &#39;s/[^0-9. ]//g&#39;&#96;
JVR=&#96;echo $JVR | sed &#39;s/&#92;./ /g&#39;&#96;
Ver_separator $JVR
if [ 1 -eq $var1 -a 6 -eq $var2 -a 001 -le $var3 ]; then
jver=yes
else
echo &#34;ERROR&#58; Please use java version $var1 $var2 $var3 &#62;= 1.6.0_01 in &#92;$JAVA_HOME&#34;
echo &#34;WARN&#58; Using configured JAVA_HOME $JAVA_HOME_2&#34;
JAVA_HOME=$JAVA_HOME_2
#    exit 1;
fi

if test &#34;$EVENT_LOG_COUNT&#34; ; then
if test &#34;$HELPTOKEN&#34; ; then
echo &#34;EVENT_LOG_COUNT = $EVENT_LOG_COUNT&#34;
fi
EVENTLOGCOUNT=&#34;-DSRMMaxNumEventLog=${EVENT_LOG_COUNT}&#34;
fi
if test &#34;$EVENT_LOG_SIZE&#34; ; then
if test &#34;$HELPTOKEN&#34; ; then
echo &#34;EVENT_LOG_SIZE = $EVENT_LOG_SIZE&#34;
fi
EVENTLOGSIZE=&#34;-DSRMEventLogByteMax=${EVENT_LOG_SIZE}&#34;
fi

if test &#34;$GLOBUS_HOSTNAME&#34; ; then
export GLOBUS_HOSTNAME
MY_ENDHOSTNAME=&#34;-DGLOBUS_HOSTNAME=$GLOBUS_HOSTNAME&#34;
echo &#34;GLOBUS_HOSTNAME = $GLOBUS_HOSTNAME&#34;
fi

if test &#34;$GLOBUS_TCP_PORT_RANGE&#34; ; then
export GLOBUS_TCP_PORT_RANGE
MY_TCP_PORTR=&#34;-Dorg.globus.tcp.port.range=$GLOBUS_TCP_PORT_RANGE&#34;
if test &#34;$HELPTOKEN&#34; ; then
echo &#34;GLOBUS_TCP_PORT_RANGE = $GLOBUS_TCP_PORT_RANGE&#34;
fi
fi

if test &#34;$GLOBUS_TCP_SOURCE_RANGE&#34; ; then
export GLOBUS_TCP_SOURCE_RANGE
if test &#34;$HELPTOKEN&#34; ; then
echo &#34;GLOBUS_TCP_SOURCE_RANGE = $GLOBUS_TCP_SOURCE_RANGE&#34;
fi
fi

if test &#34;$X509_CERT_DIR&#34; ; then
if test -d &#34;$X509_CERT_DIR&#34; ; then
export X509_CERT_DIR
export GSI_DAEMON_TRUSTED_CA_DIR
CADIR=$X509_CERT_DIR
export CADIR
if test &#34;$HELPTOKEN&#34; ; then
echo &#34;X509_CERT_DIR = $X509_CERT_DIR&#34;
echo &#34;GSI_DAEMON_TRUSTED_CA_DIR = $GSI_DAEMON_TRUSTED_CA_DIR&#34;
echo &#34;CADIR = $X509_CERT_DIR&#34;
fi
MY_CERT_DIR=&#34;-DX509_CERT_DIR=$X509_CERT_DIR -DCADIR=$X509_CERT_DIR&#34;
else
echo &#34;Cannot find $X509_CERT_DIR&#34;
echo &#34;Please check proper certificate directory&#34;
exit 1;
fi
fi

if test &#34;$VOMSDIR&#34; ; then
if test -d &#34;$VOMSDIR&#34; ; then
export VOMSDIR
if test &#34;$HELPTOKEN&#34; ; then
echo &#34;VOMSDIR = $VOMSDIR&#34;
fi
MY_VOMS_DIR=&#34;-DVOMSDIR=$VOMSDIR&#34;
else
echo &#34;Cannot find $VOMSDIR&#34;
echo &#34;Please check proper voms directory&#34;
exit 1;
fi
fi

if test &#34;$MAX_JAVA_HEAP&#34; ; then
if test &#34;$HELPTOKEN&#34; ; then
echo &#34;MAX_JAVA_HEAP = $MAX_JAVA_HEAP&#34;
fi
MAXHEAP=&#34;-Xmx${MAX_JAVA_HEAP}m&#34;
fi

if test &#34;$CERTPATH&#34; ; then
if test -r &#34;$CERTPATH&#34; ; then
if test &#34;$HELPTOKEN&#34; ; then
echo &#34;SERVICE CERT PATH = $CERTPATH&#34;
fi
else
echo &#34;Cannot find $CERTPATH&#34;
echo &#34;Please check proper service certificate path&#34;
exit 1;
fi
fi
if test &#34;$KEYPATH&#34; ; then
if test -r &#34;$KEYPATH&#34; ; then
if test &#34;$HELPTOKEN&#34; ; then
echo &#34;SERVICE CERT KEY PATH = $KEYPATH&#34;
fi
else
echo &#34;Cannot find $KEYPATH&#34;
echo &#34;Please check proper service certificate key path&#34;
exit 1;
fi
fi
if test &#34;$GUMSCERTPATH&#34; ; then
if test -r &#34;$GUMSCERTPATH&#34; ; then
if test &#34;$HELPTOKEN&#34; ; then
echo &#34;GUMS SERVICE CERT PATH = $GUMSCERTPATH&#34;
fi
else
echo &#34;Cannot find $GUMSCERTPATH&#34;
echo &#34;Please check proper service certificate path to connect GUMS&#34;
exit 1;
fi
fi
if test &#34;$GUMSKEYPATH&#34; ; then
if test -r &#34;$GUMSKEYPATH&#34; ; then
if test &#34;$HELPTOKEN&#34; ; then
echo &#34;GUMS SERVICE CERT KEY PATH = $GUMSKEYPATH&#34;
fi
else
echo &#34;Cannot find $GUMSKEYPATH&#34;
echo &#34;Please check proper service certificate key path to connect GUMS&#34;
exit 1;
fi
fi

echo &#34;###########################################&#34;

OGSALIBS=${SRM_HOME}/lib/globus/*.jar
OGSALIBS2=${SRM_HOME}/lib/globus/server/*.jar
TMPCLASSPATH=&#34;.&#34;
TMPCLASSPATHG3=&#34;.&#34;
TMPCLASSPATHG2=&#34;.&#34;
TMPCLASSPATHG1=${SRM_HOME}/lib/gums/*.jar
TMPVOMSPATH=${SRM_HOME}/lib/voms/*.jar
TMPCLASSPATHV1=&#34;.&#34;

for j in ${TMPVOMSPATH}
do
TMPCLASSPATHV1=&#34;$TMPCLASSPATHV1&#58;$j&#34;
done

for j in ${TMPCLASSPATHG1}
do
TMPCLASSPATHG2=&#34;$TMPCLASSPATHG2&#58;$j&#34;
done
TMPCLASSPATHG3=&#34;${SRM_HOME}/lib/globus/extra.jar&#34;

if test &#34;$GUMS_ENABLED&#34; = &#34;yes&#34; ; then
if test &#34;$HELPTOKEN&#34; ; then
echo &#34;GUMS CONFIGURATION ENABLED&#34;
fi
MY_GUMS_OPT1=&#34;-Daxis.socketSecureFactory=org.glite.security.trustmanager.axis.AXISSocketFactory&#34;
MY_GUMS_OPT2=&#34;-DsslCAFiles=$X509_CERT_DIR/*.0&#34;
MY_GUMS_OPT3=&#34;-DsslCertfile=/etc/grid-security/http/httpcert.pem -DsslKey=/etc/grid-security/http/httpkey.pem&#34;
GUMSPROXY_ENABLED=
if test &#34;$GUMSPROXY_ENABLED&#34; ; then
MY_GUMS_OPT4=&#34;-DgridProxyFile=&#34;
fi
fi

TMPCLASSPATHS2=&#34;.&#34;
for i in ${OGSALIBS2}
do
TMPCLASSPATHS2=&#34;$TMPCLASSPATHS2&#58;$i&#34;
done

TMPCLASSPATH=&#34;.&#34;
for i in ${OGSALIBS}
do
TMPCLASSPATH=&#34;$TMPCLASSPATH&#58;$i&#34;
done
TMPCLASSPATH=$TMPCLASSPATH&#58;${SRM_HOME}/lib/endorsed/xalan.jar

TMPCLASSPATH2=&#34;.&#34;
if test &#34;$PLUGIN&#34; ; then
OGSALIBS2=${PLUGIN}/*.jar
for j in ${OGSALIBS2}
do
TMPCLASSPATH2=&#34;$TMPCLASSPATH2&#58;$j&#34;
done
else
OGSALIBS2=${SRM_HOME}/lib/plugin/*.jar
for j in ${OGSALIBS2}
do
TMPCLASSPATH2=&#34;$TMPCLASSPATH2&#58;$j&#34;
done
fi

CLASSPATH=${TMPCLASSPATHG3}&#58;${SRM_HOME}/lib/Berkeley.StorageResourceManager-aux.jar&#58;${SRM_HOME}/lib/Berkeley.StorageResourceManager.jar&#58;${SRM_HOME}/lib/Berkeley.StorageResourceManager-stub.jar&#58;${SRM_HOME}/lib/je-3.3.62.jar&#58;${SRM_HOME}/lib/concurrent.jar&#58;${SRM_HOME}/lib/which4j.jar&#58;${TMPCLASSPATHV1}&#58;${TMPCLASSPATHS2}&#58;${TMPCLASSPATH}&#58;${TMPCLASSPATHG2}&#58;${TMPCLASSPATH2}

export CLASSPATH

#echo $CLASSPATH

cd $SRM_HOME

if test &#34;$HELPTOKEN&#34; ; then
echo &#34;###########################################&#34;
echo &#34;SRM_HOME = $SRM_HOME&#34;
echo &#34;JAVA_HOME = $JAVA_HOME&#34;
echo &#34;Configuration file is $SRM_HOME/conf/bestman.rc&#34;
echo &#34;EXTRALIB = $EXTRALIB&#34;
echo &#34;###########################################&#34;
$JAVA_HOME/bin/java -server -Xmx256m -Daxis.ServerConfigFile=$SRM_HOME/conf/server-config.wsdd gov.lbl.srm.server.Server $*
else
$JAVA_HOME/bin/java -server ${EVENTLOGCOUNT} ${EVENTLOGSIZE} ${MAXHEAP} ${EXTRALIB} ${MY_ENDHOSTNAME} ${MY_TCP_PORTR} ${MY_CERT_DIR} ${MY_VOMS_DIR} ${MY_GUMS_OPT1} ${MY_GUMS_OPT2} ${MY_GUMS_OPT3} ${MY_GUMS_OPT4} -Daxis.ServerConfigFile=$SRM_HOME/conf/server-config.wsdd gov.lbl.srm.server.Server $SRM_HOME/conf/bestman.rc $*
fi

[root@sigmorgh grid]# cat vdt-app-data/bestman/conf/bestman.rc
###########################################################
# BeStMan server GATEWAY mode configuration
# installed on Mon Jul 26 09&#58;50&#58;54 CDT 2010
# administrative guide on <a href='http&#58;//sdm.lbl.gov/bestman' target='_blank' rel='nofollow'>http&#58;//sdm.lbl.gov/bestman</a>
###########################################################
###########################################################
EventLogLocation=/usr/local/OSG_1.2-Bestman/vdt-app-data/bestman/logs
# Modify eventLogLevel to adjust logging level (DEBUG | INFO)
eventLogLevel=INFO
###########################################################
# Provide blocking for user access to the list of the local directories
## default&#58; /;/etc;/var
## All definitions will include the default blocked list
## e.g. localPathListToBlock=/;/etc;/var
###########################################################
# Provide permission for user access to the list of the local directories
## If a path is listed on both blocked and allowed list,
##           blocked is taken priority.
## e.g. localPathListAllowed=/home;/project
###########################################################
publicPort=49080
securePort=49443
CertFileName=/etc/grid-security/http/httpcert.pem
KeyFileName=/etc/grid-security/http/httpkey.pem
###########################################################
# supportedProtocolList can be defined
##      When different from the same hostname that BeStMan runs on
##      Or, multiple transfer servers are supported
## supportedProtocolList=<a href='gsiftp&#58;//host1.domain.tld' target='_blank' rel='nofollow'>gsiftp&#58;//host1.domain.tld</a>;<a href='gsiftp&#58;//host2.domain.tld' target='_blank' rel='nofollow'>gsiftp&#58;//host2.domain.tld</a>
###########################################################
# GATEWAY mode entries
### For Xrootd, xrootdTokenCompName=oss.cgroup may be needed
############################################################
# GATEWAY MODE must have disableSpaceMgt to true
# pathForToken only works in GATEWAY MODE when supported
pathForToken=true
## checkSizeWithFS and checkSizeWithGsiftp only works in GATEWAY MODE
checkSizeWithFS=true
checkSizeWithGsiftp=false
###########################################################
# Sudo to manage file system (mkdir, rmdir, rm, mv, cp, ls)
# /etc/sudoers needs the following modifications
#              when daemon account runs bestman server
#              check proper paths for commands if needed
#    Cmnd_Alias SRM_CMD = /bin/rm, /bin/mkdir, /bin/rmdir, /bin/mv, /bin/cp, /bin/ls
#    Runas_Alias SRM_USR = ALL, !root
#    daemon   ALL=(SRM_USR) NOPASSWD&#58; SRM_CMD
#
accessFileSysViaSudo=true
noSudoOnLs=true
###########################################################
# MaxMappedIDCached limits how many mapped ids can be cached at a given time
##   LifetimeSecondsMappedIDCached limits how long mapped ids are cached
##   LifetimeSecondsMappedIDCached=0 &#58; permanently cache
##   LifetimeSecondsMappedIDCached&#60;0 &#58; never cache
##   LifetimeSecondsMappedIDCached&#62;0 &#58; cache for the duration
###########################################################
MaxMappedIDCached=1000
LifetimeSecondsMappedIDCached=1800
###########################################################
## e.g. SUMGserviceURL=<a href='https&#58;//gums.lbl.gov&#58;8443/gums/services/GUMSAuthorizationServicePort' target='_blank' rel='nofollow'>https&#58;//gums.lbl.gov&#58;8443/gums/services/GUMSAuthorizationServicePort</a>
GUMSserviceURL=<a href='https&#58;//gums.hpcc.ttu.edu&#58;8443/gums/services/GUMSAuthorizationServicePort' target='_blank' rel='nofollow'>https&#58;//gums.hpcc.ttu.edu&#58;8443/gums/services/GUMSAuthorizationServicePort</a>
# GUMSCurrHostDN=NOT_PROVIDED
##  DN gets extracted from the cert/key when running server from
##     /etc/grid-security/http/httpcert.pem
##     /etc/grid-security/http/httpkey.pem
GridMapFileName=/usr/local/OSG_1.2-Bestman/bestman/conf/grid-mapfile.empty
###########################################################
# FULL mode entries
# Do Not edit below unless you understand the entries
###########################################################
MaxNumberOfUsers=100
MaxNumberOfFileRequests=1000000
Concurrency=40
MaxConcurrentFileTransfer=10
GridFTPNumStreams=1
GridFTPBufferSizeBytes=1048576
DefaultFileSizeMB=500
DefaultVolatileFileLifeTimeInSeconds=1800
PublicTokenMaxFileLifetimeInSeconds=1800
InactiveTxfTimeOutInSeconds=300
PublicSpaceProportion=80
DefaultMBPerToken=1000
###########################################################
# Do Not edit below unless you really really understand the entries
###########################################################
## NOTE&#58; Gateway mode - useBerkeleyDB must be false
## Modify useBerkeleyDB to true for NON-GATEWAY MODE
useBerkeleyDB=false
srmcacheKeywordOn=true
FactoryID=server
uploadQueueParameter=40&#58;10
###########################################################
# GATEWAY MODE must have disableSpaceMgt to true
disableSpaceMgt=true
noEventLog=false
## NOTE&#58; Gateway mode - noCacheLog must be true
## Modify noCacheLog to false for NON-GATEWAY MODE
noCacheLog=true
CacheLogLocation=/usr/local/OSG_1.2-Bestman/vdt-app-data/bestman/logs
</div><script type='text/javascript'>
        $('#show_1387216591').click(function() {
            $('#detail_1387216591').slideDown("normal");
            $('#show_1387216591').hide();
            $('#hide_1387216591').show();
        });
        $('#hide_1387216591').click(function() {
            $('#detail_1387216591').slideUp();
            $('#hide_1387216591').hide();
            $('#show_1387216591').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='12334#1341519427'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-07-05T20:17:07+00:00">Jul 5, 2012 08:17 PM UTC</time> by <b>TIGRE</b><a class="anchor" name="1341519427">&nbsp;</a></div><pre>I&#39;ll send the requested files. Keep in mind, though, that it was already using GUMS and the only difference now is that the new GUMS server apparently does not properly support the prima access method to its mapping functions, so we are having to switch to xacml.  It is working in xacml mode for all other services on our other machines, and for all services except BeStMan on this one, so it&#39;s got to be something specific to BeStMan.</pre></div><div class='update_description'><i onclick="document.location='12334#1341512801'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-07-05T18:26:41+00:00">Jul 5, 2012 06:26 PM UTC</time><a class="anchor" name="1341512801">&nbsp;</a></div><pre>The files /etc/grid-security/gsi-authz.conf and /etc/grid-security/prima-authz.conf are used by gridFTP, and, as stated, that component is working, so its safe to ignore those for now.

Can you check VDT_LOCATION/bestman2/sbin/bestman.server and see if &#34;GUMS_ENABLED=yes&#34;?

Also, can you send your bestman2.rc so I can review?

Thanks,
Doug Strain
OSG Software

-- by Douglas Strain</pre></div><div class='update_description'><i onclick="document.location='12334#1341506830'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-07-05T16:47:10+00:00">Jul 5, 2012 04:47 PM UTC</time> by <b>TIGRE</b><a class="anchor" name="1341506830">&nbsp;</a></div><pre>I followed similar steps when setting up our Bestman server originally.  In our case, the cert files specified in bestman.server are&#58;

GUMSCERTPATH=/etc/grid-security/http/httpcert.pem
GUMSKEYPATH=/etc/grid-security/http/httpkey.pem

Making the change to the bestman.rc (which I tried before) produces a java error when I try an SRM operation&#58;

[asill@antaeus ~]$ srm-ping <a href='srm&#58;//sigmorgh.hpcc.ttu.edu&#58;49443/srm/v2/server' target='_blank' rel='nofollow'>srm&#58;//sigmorgh.hpcc.ttu.edu&#58;49443/srm/v2/server</a>
srm-ping   2.2.1.3.19   Wed Feb 23 10&#58;09&#58;34 PST 2011
BeStMan and SRM-Clients Copyright(c) 2007-2011,
Lawrence Berkeley National Laboratory. All rights reserved.
Support at SRM@.... and documents at <a href='http&#58;//sdm.lbl.gov/bestman' target='_blank' rel='nofollow'>http&#58;//sdm.lbl.gov/bestman</a>
SRM-CLIENT&#58; Connecting to serviceurl httpg&#58;//sigmorgh.hpcc.ttu.edu&#58;49443/srm/v2/server

SRM-PING&#58; Thu Jul 05 11&#58;35&#58;58 CDT 2012  Calling SrmPing Request...
SoapCallThread.Exception=; nested exception is&#58;
java.net.SocketException&#58; Connection reset

Looking in the bestman.log shows it is not using XACML, but looking for a grid map-file&#58;

## == SRM is ready ===httpg&#58;//sigmorgh.hpcc.ttu.edu&#58;49443/srm/v2/server
2012-07-05T11&#58;35&#58;53.943 CDT Log level is setting to&#58;INFO
- Thread-72&#58; Authenticated globus user&#58; /DC=org/DC=doegrids/OU=People/CN=Alan Sill 503049
- User &#39;/DC=org/DC=doegrids/OU=People/CN=Alan Sill 503049&#39; not in gridmap file.

My gsi-authz.conf file is set as&#58;

[root@sigmorgh grid]# cat /etc/grid-security/gsi-authz.conf
globus_mapping /usr/local/OSG_1.2-Bestman/prima/lib/libprima_authz_module_scas_gcc64dbg globus_gridmap_callout

and prima-authz (which probably isn&#39;t used for xacml???) is&#58;

[root@sigmorgh grid]# cat /etc/grid-security/prima-authz.conf

# PRIMA Module configuration file
<div id='show_799340348' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_799340348'># this file configures what identity mapping service the prima module should contact
# format is simply&#58;
# IMS_contact service-url

# This is the identity mapping server, it performs a mapping based on the gridmap file on the service host
imsContact <a href='https&#58;//gums.hpcc.ttu.edu&#58;8443/gums/services/GUMSAuthorizationServicePort' target='_blank' rel='nofollow'>https&#58;//gums.hpcc.ttu.edu&#58;8443/gums/services/GUMSAuthorizationServicePort</a>
xacmlContact <a href='https&#58;//gums.hpcc.ttu.edu&#58;8443/gums/services/GUMSXACMLAuthorizationServicePort' target='_blank' rel='nofollow'>https&#58;//gums.hpcc.ttu.edu&#58;8443/gums/services/GUMSXACMLAuthorizationServicePort</a>

# A directory that contains identity certificates of attribute certificate issuers (e.g., voms servers)
# optional
issuerCertDir  /etc/grid-security/vomsdir

# should the signature on received attribute certificates be verified
# (recommended, but requires issuerCertDir in most cases)
# optional, default is &#34;true&#34; if ommitted
#verifyAC true
verifyAC false

# host certs
serviceCert /etc/grid-security/hostcert.pem
serviceKey  /etc/grid-security/hostkey.pem
caCertDir   /usr/local/OSG_1.2-Bestman/globus/TRUSTED_CA

# logging levels supported are debug, info, error, none
logLevel    debug
#logLevel    info

# SAML XML schema directory
samlSchemaDir /usr/local/OSG_1.2-Bestman/prima/etc/opensaml/
</div><script type='text/javascript'>
        $('#show_799340348').click(function() {
            $('#detail_799340348').slideDown("normal");
            $('#show_799340348').hide();
            $('#hide_799340348').show();
        });
        $('#hide_799340348').click(function() {
            $('#detail_799340348').slideUp();
            $('#hide_799340348').hide();
            $('#show_799340348').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='12334#1341505139'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-07-05T16:18:59+00:00">Jul 5, 2012 04:18 PM UTC</time><a class="anchor" name="1341505139">&nbsp;</a></div><pre>Ok, I was able to connect to fermilab&#39;s XACML gums server by the following steps&#58;

1) VDT_LOCATION/vdt/setup/configure_bestman2 --gums-host gums.fnal.gov --gums-port 8443 -server y --enable-gateway --cert /etc/grid-security/bestman/bestmancert.pem --key /etc/grid-security/bestman/bestmankey.pem
(Your command may vary)  This seems to set up bestman2 in SAML by default.
2) vi VDT_LOCATION/bestman2/sbin/bestman.server.  Verify that the certs exist in the following lines (your location can vary, but must be owned by bestman user [default is daemon])&#58;
GUMSCERTPATH=/etc/grid-security/bestman/bestmancert.pem
GUMSKEYPATH=/etc/grid-security/bestman/bestmankey.pem
3) vi VDT_LOCATION/bestman2/conf/bestman2.rc.  Change
GUMSserviceURL=<a href='https&#58;//gums.fnal.gov&#58;8443/gums/services/GUMSAuthorizationServicePort' target='_blank' rel='nofollow'>https&#58;//gums.fnal.gov&#58;8443/gums/services/GUMSAuthorizationServicePort</a>
to
GUMSserviceURL=<a href='https&#58;//gums.fnal.gov&#58;8443/gums/services/GUMSXACMLAuthorizationServicePort' target='_blank' rel='nofollow'>https&#58;//gums.fnal.gov&#58;8443/gums/services/GUMSXACMLAuthorizationServicePort</a>

That seemed to fix the issue for my test install.  See if you can fix the corresponding files on your SE and see if it works for you as well.

Thanks,

Doug Strain
OSG Software

-- by Douglas Strain</pre></div><div class='update_description'><i onclick="document.location='12334#1341504036'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-07-05T16:00:36+00:00">Jul 5, 2012 04:00 PM UTC</time><a class="anchor" name="1341504036">&nbsp;</a></div><pre>Hi Alan,

I believe BeStMan 2.2.1.3.19 does work with XACML.  I don&#39;t have a Pacman install ready to test, so it may be a bit before I can give you exact instructions.  My pacman knowledge is starting to get a bit rusty, so I want to test this out before I dive in.  Stay tuned, and I&#39;ll see if I can get an update before the end of the day.

You can also upgrade to RPMs in OSG 3.0 which work easily with XACML.

Doug Strain

-- by Douglas Strain</pre></div><div class='update_description'><i onclick="document.location='12334#1341438224'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-07-04T21:43:44+00:00">Jul 4, 2012 09:43 PM UTC</time> by <b>Alain Roy</b><a class="anchor" name="1341438224">&nbsp;</a></div><pre>Assigning to Doug Strain. (Doug, if you&#39;re overloaded, feel free to reassign it to Neha.)</pre></div><div class='update_description'><i onclick="document.location='12334#1341381547'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-07-04T05:59:07+00:00">Jul 4, 2012 05:59 AM UTC</time> by <b>TIGRE</b><a class="anchor" name="1341381547">&nbsp;</a></div><pre>I am out of the office until Thursday, July 5, 2012, and will not be responding to most e-mail until then.  If you need to reach me, please leave a message at the HPCC office at 806-742-4350 or my office line at 806-834-5940.</pre></div><div class='update_description'><i onclick="document.location='12334#1341381261'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2012-07-04T05:54:21+00:00">Jul 4, 2012 05:54 AM UTC</time> by <b>Ricky Pirtle</b><a class="anchor" name="1341381261">&nbsp;</a></div><pre>From&#58; &#34;Sill, Alan&#34; &#60;alan.sill@....&#62;
To&#58; OSG GOC &#60;goc@....&#62;
cc&#58; &#34;Sill, Alan&#34; &#60;alan.sill@....&#62;
Subject&#58; Request for help updating OSG 1.2-based BeStMan SE to use XACML in GSI
authorization callout
Date-Sent&#58; Wednesday, July 04, 2012 5&#58;43 AM +0000

We are running an OSG 1.2-based SE using Bestman in gateway mode.

A recent failure of our GUMS server caused us to have to install a new instance of
GUMS at TTU.  We chose to put in an OSG 1.3 rpm-based installation of GUMS and got it
to run, but found that our services had to switch to using the XACML2-over-SAML
methods (SCAS) rather than the previous SAML (PRIMA) methods to get authorization
from the new GUMS server.  Neither we nor the GUMS developer, John Hover, knows why
exactly the new GUMS does not seem to support PRIMA methods any longer.

This worked for all of our services except Bestman on our storage element.  We made
the switch to XACML on our SE first by hand, then to double-check it, with the VDT
command suggested by Alain Roy&#58;

$VDT_LOCATION/vdt/setup/configure_prima --gums-server (Our GUMS-HOSTNAME) --xacml

which produced the same results.  We think this worked because the gridftp server and
other services on the SE (for example, gsissh, which we install and enable) all work,
but SRM on the SE does not seem to work with the XACML callout&#58;

Test of SRM from remote client&#58;
[asill@antaeus ~]$ srm-ping <a href='srm&#58;//sigmorgh.hpcc.ttu.edu&#58;49443/srm/v2/server' target='_blank' rel='nofollow'>srm&#58;//sigmorgh.hpcc.ttu.edu&#58;49443/srm/v2/server</a>
srm-ping   2.2.1.3.19   Wed Feb 23 10&#58;09&#58;34 PST 2011
BeStMan and SRM-Clients Copyright(c) 2007-2011,
Lawrence Berkeley National Laboratory. All rights reserved.
Support at SRM@.... and documents at <a href='http&#58;//sdm.lbl.gov/bestman' target='_blank' rel='nofollow'>http&#58;//sdm.lbl.gov/bestman</a>
SRM-CLIENT&#58; Connecting to serviceurl httpg&#58;//sigmorgh.hpcc.ttu.edu&#58;49443/srm/v2/server

SRM-PING&#58; Wed Jul 04 00&#58;11&#58;17 CDT 2012  Calling SrmPing Request...
<div id='show_1050143351' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1050143351'>versionInfo=v2.2

Extra information (Key=Value)
backend_type=BeStMan
backend_version=2.2.1.3.19
backend_build_date=2011-02-23T16&#58;08&#58;52.000Z
gsiftpTxfServers[0]=<a href='gsiftp&#58;//sigmorgh.hpcc.ttu.edu' target='_blank' rel='nofollow'>gsiftp&#58;//sigmorgh.hpcc.ttu.edu</a>
GatewayMode=Enabled
clientDN=/DC=org/DC=doegrids/OU=People/CN=Alan Sill 503049
gumsIDMapped=null

The &#34;null&#34; mapping meaning that GUMS mapping did not work within BeStMan is not
matched by, for example, GridFTP, which does return a good mapping on the same SE
contacted from the same remote test client&#58;

Test of GridFTP from remote client
[asill@antaeus ~]$ uberftp sigmorgh.hpcc.ttu.edu
220 sigmorgh.hpcc.ttu.edu GridFTP Server 2.8 (gcc64dbg, 1217607445-63) [VDT patched
4.0.8] ready.
230 User uscmspool1592 logged in.

Looking in the BeStMan logs, I see evidence of a missing class in the java calls&#58;

...
ts=2012-07-04T05&#58;11&#58;48.036Z level=Info  class=gov.lbl.srm.util.GUMSClientSAML
event=getMappedID dn=/DC=org/DC=doegrids/OU=People/CN=Alan Sill 503049
hostDN=/DC=org/DC=doegrids/OU=Services/CN=sigmorgh.hpcc.ttu.edu
fqan=/cms/Role=NULL/Capability=NULL acIssuer=CN=voms.cern.ch, OU=computers, DC=cern,
DC=ch tid=Thread-72
ts=2012-07-04T05&#58;11&#58;49.160Z level=Excep class=gov.lbl.srm.server.Config
java.lang.NoClassDefFoundError&#58; org/opensaml/SAMLAuthorizationDecisionStatement;
nested exception is&#58;
java.lang.NoClassDefFoundError&#58; org/opensaml/SAMLAuthorizationDecisionStatement
org.apache.axis.message.SOAPFaultBuilder.createFault(SOAPFaultBuilder.java&#58;260)
org.apache.axis.message.SOAPFaultBuilder.endElement(SOAPFaultBuilder.java&#58;169)
org.apache.axis.encoding.DeserializationContextImpl.endElement(DeserializationContextImpl.java&#58;1083)
org.apache.xerces.parsers.AbstractSAXParser.endElement(Unknown Source)
org.apache.xerces.impl.XMLNSDocumentScannerImpl.scanEndElement(Unknown Source)
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown
Source)
org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source)
org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)
org.apache.xerces.parsers.DTDConfiguration.parse(Unknown Source)
org.apache.xerces.parsers.XMLParser.parse(Unknown Source)
org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)
javax.xml.parsers.SAXParser.parse(SAXParser.java&#58;395)
org.apache.axis.encoding.DeserializationContextImpl.parse(DeserializationContextImpl.java&#58;252)
org.apache.axis.SOAPPart.getAsSOAPEnvelope(SOAPPart.java&#58;538)
org.apache.axis.Message.getSOAPEnvelope(Message.java&#58;376)
org.globus.ogsa.handlers.RoutingHandler.getRouterHeader(RoutingHandler.java&#58;31)
org.globus.ogsa.handlers.RoutingResponseHandler.invoke(RoutingResponseHandler.java&#58;26)
...

Question&#58; is there a way to get the BeStMan instance that we have, OSG 1.2.25 /
BeStMan 2.2.1.3.19, to work with the xacml authorization callout methods?

Failing that, is it possible to put in a newer version that would work better with
our new GUMS server?

Failing that, is it possible to get the old PRIMA methods working on our new GUMS server?

This is holding up data transfers for our PhEDEx system and we really need to get a
working SRM interface for our SE again as soon as possible, so any advice would be
greatly appreciated.

Thanks,
Alan

Alan Sill, Ph.D
Senior Scientist
High Performance Computing Center
TTU

====================================================================
&#58;  Alan Sill, Texas Tech University  Office&#58; Drane 162, MS 4-1167  &#58;
&#58;  e-mail&#58; Alan.Sill@....   ph. 806-834-5940  fax 806-834-4358  &#58;
====================================================================
</div><script type='text/javascript'>
        $('#show_1050143351').click(function() {
            $('#detail_1050143351').slideDown("normal");
            $('#show_1050143351').hide();
            $('#hide_1050143351').show();
        });
        $('#hide_1050143351').click(function() {
            $('#detail_1050143351').slideUp();
            $('#hide_1050143351').hide();
            $('#show_1050143351').show();
        });
        </script></pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F12334">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 12334});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
