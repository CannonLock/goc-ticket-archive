<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[15567] Gratia replication causing strange error message</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=15567" method="post">
<div class="page-header">
    <h3><span class="muted">15567</span> / Gratia replication causing strange error message</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Soichi Hayashi</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Soichi Hayashi</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">GRATIA Dev</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2013-08-09</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">FNAL (Prod)&nbsp;<a target="_blank" href="https://fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000387929">INC000000387929</a> <span class="muted"> / Ticket Exchange</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/15567", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/15567?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/15567?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Gratia%20replication%20causing%20strange%20error%20message%20ISSUE%3D15567%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='15567#1376339593'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-12T20:33:13+00:00">Aug 12, 2013 08:33 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1376339593">&nbsp;</a></div><pre>I found what the problem was. The db scheme has changed between old and new version of gratia (which is expected), and when I did the DB dump, mysqldump was not outputting the column order for each insert statement. I&#39;ve added an option to insert the columns for each insert, and I was able to correctly export / import the db content.

I am closing this ticket.</pre></div><div class='update_description'><i onclick="document.location='15567#1375717096'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-05T15:38:16+00:00">Aug 5, 2013 03:38 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1375717096">&nbsp;</a></div><pre>reply from&#58; hyunwoo@....

Hi, Soichi,

For some reason, I did not receive any email about your response
in  <a href='https&#58;//ticket.grid.iu.edu/goc/15567#1373921386.' target='_blank' rel='nofollow'>https&#58;//ticket.grid.iu.edu/goc/15567#1373921386.</a>
I just went through your answers and your new suggestion that you will rebuild
to get latest observations sounds good.
Please provide us with any helpful messages.

Actually, one idea(or suspicion) from Tanya is that your installation of gratia-service
might have not successfully completed the upgrade of DB schema.
So, if you could provide us with the entire messages from /var/log/gratia-service/gratia.log
and /var/log/tomcat/catalina.out, that would be helpful for us to know what went wrong..

Thanks,
HyunWoo

From&#58; Fermilab Service Desk &#60;fermi@....&#60;mailto&#58;fermi@....&#62;&#62;
Reply-To&#58; Fermilab Service Desk &#60;fermi@....&#60;mailto&#58;fermi@....&#62;&#62;
Date&#58; Monday, August 5, 2013 10&#58;15 AM
To&#58; Brian Mckittrick &#60;brianmck@....&#60;mailto&#58;brianmck@....&#62;&#62;, Hyunwoo Kim &#60;hyunwoo@....&#60;mailto&#58;hyunwoo@....&#62;&#62;, Tanya Levshina &#60;tlevshin@....&#60;mailto&#58;tlevshin@....&#62;&#62;
Subject&#58; Incident INC000000387929 updated -- Gratia replication causing strange error message

Incident INC000000387929&#60;<a href='https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do%3Fsys_id=01b4ff012b8e890007578f8667da15ad%26sysparm_stack=incident_list.do%3Fsysparm_query=active=true&#62' target='_blank' rel='nofollow'>https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do%3Fsys_id=01b4ff012b8e890007578f8667da15ad%26sysparm_stack=incident_list.do%3Fsysparm_query=active=true&#62</a>; comments have been updated.

Last update&#58;
2013-08-05 10&#58;14&#58;23 CDT - cd-srv-goc-ops (Additional comments)
I thought I&#39;ve answered all questions
<font color='#7F7E6F'>&#62; <a href='https&#58;//ticket.grid.iu.edu/goc/15567#1373921386' target='_blank' rel='nofollow'>https&#58;//ticket.grid.iu.edu/goc/15567#1373921386</a></font>

Is there any other question that I may have missed?

This ticket is getting bit old, so I am thinking about rebuilding rsv-itb one more time to get latest observations.
Soichi
<div id='show_113317544' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_113317544'>-- by Soichi Hayashi at Mon Aug 05 15&#58;13&#58;55 UTC 2013

________________________________
Incident State&#58; Work in Progress
Caller&#58; cd-srv-goc-ops
Assignment Group&#58; Gratia Support and Development
Assigned To&#58; Hyun Kim
Summary&#58;
I have installed the latest Gratia collector on rsv1.grid.iu.edu and rsv-itb.grid.iu.edu, and setup a replication from rsv1 to rsv-itb. When I started replication, I started seeing following error message on rsv1

2013-06-17 15&#58;04&#58;59,406 gratia.service(Thread-1742) [WARNING]&#58; ReplicationDataPump #1 (All to <a href='http&#58;//rsv-itb.grid.iu.edu&#58;8880' target='_blank' rel='nofollow'>http&#58;//rsv-itb.grid.iu.edu&#58;8880</a>)&#58; Problem encountered obtaining list of records to replicate
java.lang.ClassCastException&#58; java.lang.Integer cannot be cast to java.math.BigInteger
at net.sf.gratia.services.ReplicationDataPump.loop(ReplicationDataPump.java&#58;217)
at net.sf.gratia.services.ReplicationDataPump.run(ReplicationDataPump.java&#58;95)

rsv-itb is not receiving any records.

I had to manually copy most of records from rsv1 to rsv-itb since we truncate MetricRecord_Xml periodically to save disk space. I am not sure if above error message maybe related to how I am hacking around with Gratia DB, but I&#39;d appreciate if Gratia team can help me fix this issue.

Thanks
Soichi

</div><script type='text/javascript'>
        $('#show_113317544').click(function() {
            $('#detail_113317544').slideDown("normal");
            $('#show_113317544').hide();
            $('#hide_113317544').show();
        });
        $('#hide_113317544').click(function() {
            $('#detail_113317544').slideUp();
            $('#hide_113317544').hide();
            $('#show_113317544').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='15567#1375715635'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-05T15:13:55+00:00">Aug 5, 2013 03:13 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1375715635">&nbsp;</a></div><pre>I thought I&#39;ve answered all questions
<font color='#7F7E6F'>&#62; <a href='https&#58;//ticket.grid.iu.edu/goc/15567#1373921386' target='_blank' rel='nofollow'>https&#58;//ticket.grid.iu.edu/goc/15567#1373921386</a></font>

Is there any other question that I may have missed?

This ticket is getting bit old, so I am thinking about rebuilding rsv-itb one more time to get latest observations.
Soichi</pre></div><div class='update_description'><i onclick="document.location='15567#1375714602'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-05T14:56:42+00:00">Aug 5, 2013 02:56 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1375714602">&nbsp;</a></div><pre>reply from&#58; hyunwoo@....

I haven&#39;t heard from him since I asked a few more questions couple of weeks ago.
I will check with him again today.

HyunWoo

From&#58; Fermilab Service Desk &#60;fermi@....&#60;mailto&#58;fermi@....&#62;&#62;
Reply-To&#58; Fermilab Service Desk &#60;fermi@....&#60;mailto&#58;fermi@....&#62;&#62;
Date&#58; Monday, August 5, 2013 9&#58;27 AM
To&#58; &#34;tx+fermi_fp71@....&#60;mailto&#58;tx+fermi_fp71@....&#62;&#34; &#60;tx+fermi_fp71@....&#60;mailto&#58;tx+fermi_fp71@....&#62;&#62;, Hyunwoo Kim &#60;hyunwoo@....&#60;mailto&#58;hyunwoo@....&#62;&#62;, Tanya Levshina &#60;tlevshin@....&#60;mailto&#58;tlevshin@....&#62;&#62;
Subject&#58; Incident INC000000387929 updated -- Gratia replication causing strange error message

Incident INC000000387929&#60;<a href='https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do%3Fsys_id=01b4ff012b8e890007578f8667da15ad%26sysparm_stack=incident_list.do%3Fsysparm_query=active=true&#62' target='_blank' rel='nofollow'>https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do%3Fsys_id=01b4ff012b8e890007578f8667da15ad%26sysparm_stack=incident_list.do%3Fsysparm_query=active=true&#62</a>; comments have been updated.

Last update&#58;
2013-08-05 09&#58;26&#58;55 CDT - Brian Mckittrick (Additional comments)
Hi - Is this still an issue? Thanks
Brian

________________________________
Incident State&#58; Work in Progress
Caller&#58; cd-srv-goc-ops
Assignment Group&#58; Gratia Support and Development
Assigned To&#58; Hyun Kim
Summary&#58;
I have installed the latest Gratia collector on rsv1.grid.iu.edu and rsv-itb.grid.iu.edu, and setup a replication from rsv1 to rsv-itb. When I started replication, I started seeing following error message on rsv1

2013-06-17 15&#58;04&#58;59,406 gratia.service(Thread-1742) [WARNING]&#58; ReplicationDataPump #1 (All to <a href='http&#58;//rsv-itb.grid.iu.edu&#58;8880' target='_blank' rel='nofollow'>http&#58;//rsv-itb.grid.iu.edu&#58;8880</a>)&#58; Problem encountered obtaining list of records to replicate
java.lang.ClassCastException&#58; java.lang.Integer cannot be cast to java.math.BigInteger
at net.sf.gratia.services.ReplicationDataPump.loop(ReplicationDataPump.java&#58;217)
at net.sf.gratia.services.ReplicationDataPump.run(ReplicationDataPump.java&#58;95)

rsv-itb is not receiving any records.

<div id='show_1838477782' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1838477782'>I had to manually copy most of records from rsv1 to rsv-itb since we truncate MetricRecord_Xml periodically to save disk space. I am not sure if above error message maybe related to how I am hacking around with Gratia DB, but I&#39;d appreciate if Gratia team can help me fix this issue.

Thanks
Soichi

</div><script type='text/javascript'>
        $('#show_1838477782').click(function() {
            $('#detail_1838477782').slideDown("normal");
            $('#show_1838477782').hide();
            $('#hide_1838477782').show();
        });
        $('#hide_1838477782').click(function() {
            $('#detail_1838477782').slideUp();
            $('#hide_1838477782').hide();
            $('#show_1838477782').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='15567#1375712875'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-08-05T14:27:55+00:00">Aug 5, 2013 02:27 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1375712875">&nbsp;</a></div><pre>Hi - Is this still an issue?  Thanks
Brian
-- by brianmck at Mon Aug 05 14&#58;26&#58;55 UTC 2013

I&#39;m reassigning this to Soichi to track.

Thank you,
Elizabeth
-- by Elizabeth Prout at Thu Jul 18 20&#58;18&#58;28 UTC 2013
-- by cd-srv-goc-ops at Thu Jul 18 20&#58;18&#58;41 UTC 2013

GOCTX Source&#58; <a href='https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000387929' target='_blank' rel='nofollow'>https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000387929</a></pre></div><div class='update_description'><i onclick="document.location='15567#1374178708'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-18T20:18:28+00:00">Jul 18, 2013 08:18 PM UTC</time> by <b>echism</b><a class="anchor" name="1374178708">&nbsp;</a></div><pre>I&#39;m reassigning this to Soichi to track.

Thank you,
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='15567#1373921386'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-15T20:49:46+00:00">Jul 15, 2013 08:49 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1373921386">&nbsp;</a></div><pre>1. Yes, this is a cron job that runs a query to remote all records older than 1 month from _Xml table.
2. Yes, but this doesn&#39;t affect our replication, since I only truncate *old* records that were already replicated to other instances. In our case, this is also true - I am careful not to set the replication start DBID to be smaller than the DBID available on source instance.
3. Yes.
4. Yes. I did vimdiff of mysqldump --no-data from both databases.

<font color='#7F7E6F'>&#62; Are you getting the original error messages when you trying to do something at this point?</font>
Yes, I am still seeing following error message in /var/log/gratia-service/gratia.log

<font color='#7F7E6F'>&#62; 2013-07-15 20&#58;47&#58;47,869 gratia.service(Thread-30903) [WARNING]&#58; ReplicationDataPump #1 (All to http&#58;              //rsv-itb.grid.iu.edu&#58;8880)&#58; Problem encountered obtaining list of records to replicate</font>
<font color='#7F7E6F'>&#62; java.lang.ClassCastException&#58; java.lang.Integer cannot be cast to java.math.BigInteger</font>
<font color='#7F7E6F'>&#62;         at net.sf.gratia.services.ReplicationDataPump.loop(ReplicationDataPump.java&#58;217)</font>
<font color='#7F7E6F'>&#62;         at net.sf.gratia.services.ReplicationDataPump.run(ReplicationDataPump.java&#58;95)</font>

<font color='#7F7E6F'>&#62; Are you trying to use replication even after you did the manual dumping/loading?</font>
Yes, dump/load only copies records up to that point.. after that, I need to run replication to feed new records coming into rsv1 to rsv-itb which is what I am currently having some troubles.

Soichi</pre></div><div class='update_description'><i onclick="document.location='15567#1373920862'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-15T20:41:02+00:00">Jul 15, 2013 08:41 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1373920862">&nbsp;</a></div><pre>reply from&#58; hyunwoo@....

HI, Soichi,

Thanks for the detailed messages;

Let me understand what has been happening on your side.

1. You truncated MetricRecord_Xml(lets call this MRX) table in order to save disk space
2. You know that this truncated MRX table prevents you from using the normal replication between two collectors
3. So, you (must have) used mysqldump (maybe) to perform manual dumping in source collector DB and restoring in target collector DB.
4. You then compared the two source and target table structures to know that they are identical.
Am I correct up to this point?

Now, let me ask a couple of questions here.

Are you getting the original error messages when you trying to do something at this point?
(original error message &#58; ReplicationDataPump #1 (All to <a href='http&#58;//rsv-itb.grid.iu.edu&#58;8880' target='_blank' rel='nofollow'>http&#58;//rsv-itb.grid.iu.edu&#58;8880</a>)&#58; Problem encountered obtaining list of records to replicate)

Are you trying to use replication even after you did the manual dumping/loading?

Thanks,
HyunWoo

P.S. Additionally,  just now, Tanya could successfully replicate RSV records from one collector to  another collector.
So, we can exclude a possibility of errors when replicating RSV records.

From&#58; Fermilab Service Desk &#60;fermi@....&#60;mailto&#58;fermi@....&#62;&#62;
Reply-To&#58; Fermilab Service Desk &#60;fermi@....&#60;mailto&#58;fermi@....&#62;&#62;
Date&#58; Monday, July 15, 2013 1&#58;23 PM
To&#58; Hyunwoo Kim &#60;hyunwoo@....&#60;mailto&#58;hyunwoo@....&#62;&#62;, Tanya Levshina &#60;tlevshin@....&#60;mailto&#58;tlevshin@....&#62;&#62;
Subject&#58; Incident INC000000387929 updated -- Gratia replication causing strange error message

Incident INC000000387929&#60;<a href='https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do%3Fsys_id=01b4ff012b8e890007578f8667da15ad%26sysparm_stack=incident_list.do%3Fsysparm_query=active=true&#62' target='_blank' rel='nofollow'>https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do%3Fsys_id=01b4ff012b8e890007578f8667da15ad%26sysparm_stack=incident_list.do%3Fsysparm_query=active=true&#62</a>; comments have been updated.

<div id='show_186959586' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_186959586'>Last update&#58;
2013-07-15 13&#58;23&#58;12 CDT - cd-srv-goc-ops (Additional comments)
HyunWoo,

Thank you for looking into this issue.

I am basically trying to recreate rsv1.grid.iu.edu as rsv-itb.grid.iu.edu. rsv1.grid.iu.edu doesn&#39;t have all records necessary to replicate the entire gratia DB (MetricRecord_Xml table was truncated to remove records older than 1 month to save disk space). For replication to work, records must exist in MetricRecord_Xml. So, I am basically dumping the entire content of gratia DB and copy and loading them on to mysql server on rsv-itb.grid.iu.edu.

I have compared the table structure on rsv1.grid and rsv-itb after the SQL loading, and they are identical (except the AUTO_INCREMENT values which are expected), so I am not sure why hibernate is complaining only on rsv-itb.

Thanks!
-- by Soichi Hayashi at Mon Jul 15 18&#58;22&#58;51 UTC 2013

________________________________
Incident State&#58; Work in Progress
Caller&#58; cd-srv-goc-ops
Assignment Group&#58; Gratia Support and Development
Assigned To&#58; Hyun Kim
Summary&#58;
I have installed the latest Gratia collector on rsv1.grid.iu.edu and rsv-itb.grid.iu.edu, and setup a replication from rsv1 to rsv-itb. When I started replication, I started seeing following error message on rsv1

2013-06-17 15&#58;04&#58;59,406 gratia.service(Thread-1742) [WARNING]&#58; ReplicationDataPump #1 (All to <a href='http&#58;//rsv-itb.grid.iu.edu&#58;8880' target='_blank' rel='nofollow'>http&#58;//rsv-itb.grid.iu.edu&#58;8880</a>)&#58; Problem encountered obtaining list of records to replicate
java.lang.ClassCastException&#58; java.lang.Integer cannot be cast to java.math.BigInteger
at net.sf.gratia.services.ReplicationDataPump.loop(ReplicationDataPump.java&#58;217)
at net.sf.gratia.services.ReplicationDataPump.run(ReplicationDataPump.java&#58;95)

rsv-itb is not receiving any records.

I had to manually copy most of records from rsv1 to rsv-itb since we truncate MetricRecord_Xml periodically to save disk space. I am not sure if above error message maybe related to how I am hacking around with Gratia DB, but I&#39;d appreciate if Gratia team can help me fix this issue.

Thanks
Soichi

</div><script type='text/javascript'>
        $('#show_186959586').click(function() {
            $('#detail_186959586').slideDown("normal");
            $('#show_186959586').hide();
            $('#hide_186959586').show();
        });
        $('#hide_186959586').click(function() {
            $('#detail_186959586').slideUp();
            $('#hide_186959586').hide();
            $('#show_186959586').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='15567#1373912571'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-15T18:22:51+00:00">Jul 15, 2013 06:22 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1373912571">&nbsp;</a></div><pre>HyunWoo,

Thank you for looking into this issue.

I am basically trying to recreate rsv1.grid.iu.edu as rsv-itb.grid.iu.edu. rsv1.grid.iu.edu doesn&#39;t have all records necessary to replicate the entire gratia DB (MetricRecord_Xml table was truncated to remove records older than 1 month to save disk space). For replication to work, records must exist in MetricRecord_Xml. So, I am basically dumping the entire content of gratia DB and copy and loading them on to mysql server on rsv-itb.grid.iu.edu.

I have compared the table structure on rsv1.grid and rsv-itb after the SQL loading, and they are identical (except the AUTO_INCREMENT values which are expected), so I am not sure why hibernate is complaining only on rsv-itb.

Thanks!</pre></div><div class='update_description'><i onclick="document.location='15567#1373902944'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-15T15:42:24+00:00">Jul 15, 2013 03:42 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1373902944">&nbsp;</a></div><pre>reply from&#58; hyunwoo@....

Hi, Soichi,

I updated this ticket last Thursday.
I am not sure if an email was sent you by this ticket system.
Could you let me know your answers to my question below?

Thanks,
HyunWoo

2013-07-11 10&#58;59&#58;21  Hyun Kim

1. First, I constructed a similar configuration, i.e. source collector version 1.13.3.el6 and target collector latest version.
And the replications are working fine.

2. Let me ask the following question.
In the original email, you said &#34;I am not sure if above error message maybe related to how I am hacking around with Gratia DB, &#34;,
I am guessing you manually modified your MySQL Gratia DB for some reason.
Can you let me know what you modified?
I can try the same modification here in my collector and see if I am seeing the same error message that you are getting..

HyunWoo

From&#58; Fermilab Service Desk &#60;fermi@....&#60;mailto&#58;fermi@....&#62;&#62;
Reply-To&#58; Fermilab Service Desk &#60;fermi@....&#60;mailto&#58;fermi@....&#62;&#62;
Date&#58; Friday, July 5, 2013 9&#58;48 AM
To&#58; Hyunwoo Kim &#60;hyunwoo@....&#60;mailto&#58;hyunwoo@....&#62;&#62;
Subject&#58; Incident INC000000387929 updated -- Gratia replication causing strange error message

Incident INC000000387929&#60;<a href='https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do%3Fsys_id=01b4ff012b8e890007578f8667da15ad%26sysparm_stack=incident_list.do%3Fsysparm_query=active=true&#62' target='_blank' rel='nofollow'>https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do%3Fsys_id=01b4ff012b8e890007578f8667da15ad%26sysparm_stack=incident_list.do%3Fsysparm_query=active=true&#62</a>; comments have been updated.

Last update&#58;
2013-07-05 09&#58;47&#58;11 CDT - cd-srv-goc-ops (Additional comments)
Hi.
<div id='show_1704445675' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1704445675'>
Is there anybody who could help me troubleshoot this? I am guessing I just need to update the DB column type on the MySQL.. or something like that (Or gratia code to be updated to use BigInteger for some key)
-- by Soichi Hayashi at Fri Jul 05 14&#58;46&#58;14 UTC 2013

________________________________
Incident State&#58; Work in Progress
Caller&#58; cd-srv-goc-ops
Assignment Group&#58; Gratia Support and Development
Assigned To&#58; Hyun Kim
Summary&#58;
I have installed the latest Gratia collector on rsv1.grid.iu.edu and rsv-itb.grid.iu.edu, and setup a replication from rsv1 to rsv-itb. When I started replication, I started seeing following error message on rsv1

2013-06-17 15&#58;04&#58;59,406 gratia.service(Thread-1742) [WARNING]&#58; ReplicationDataPump #1 (All to <a href='http&#58;//rsv-itb.grid.iu.edu&#58;8880' target='_blank' rel='nofollow'>http&#58;//rsv-itb.grid.iu.edu&#58;8880</a>)&#58; Problem encountered obtaining list of records to replicate
java.lang.ClassCastException&#58; java.lang.Integer cannot be cast to java.math.BigInteger
at net.sf.gratia.services.ReplicationDataPump.loop(ReplicationDataPump.java&#58;217)
at net.sf.gratia.services.ReplicationDataPump.run(ReplicationDataPump.java&#58;95)

rsv-itb is not receiving any records.

I had to manually copy most of records from rsv1 to rsv-itb since we truncate MetricRecord_Xml periodically to save disk space. I am not sure if above error message maybe related to how I am hacking around with Gratia DB, but I&#39;d appreciate if Gratia team can help me fix this issue.

Thanks
Soichi

</div><script type='text/javascript'>
        $('#show_1704445675').click(function() {
            $('#detail_1704445675').slideDown("normal");
            $('#show_1704445675').hide();
            $('#hide_1704445675').show();
        });
        $('#hide_1704445675').click(function() {
            $('#detail_1704445675').slideUp();
            $('#hide_1704445675').hide();
            $('#show_1704445675').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='15567#1373558449'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-11T16:00:49+00:00">Jul 11, 2013 04:00 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1373558449">&nbsp;</a></div><pre>Hi,

1. First, I constructed a similar configuration, i.e. source collector version 1.13.3.el6 and target collector latest version.
And the replications are working fine.

2. Let me ask the following question.
In the original email, you said &#34;I am not sure if above error message maybe related to how I am hacking around with Gratia DB, &#34;,
I am guessing you manually modified your MySQL Gratia DB for some reason.
Can you let me know what you modified?
I can try the same modification here in my collector and see if I am seeing the same error message that you are getting..

HyunWoo

-- by hyunwoo at Thu Jul 11 15&#58;59&#58;21 UTC 2013

GOCTX Source&#58; <a href='https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000387929' target='_blank' rel='nofollow'>https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000387929</a></pre></div><div class='update_description'><i onclick="document.location='15567#1373036014'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-05T14:53:34+00:00">Jul 5, 2013 02:53 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1373036014">&nbsp;</a></div><pre>reply from&#58; hyunwoo@....

Hi,

This issue was assigned to me a couple of days ago.
I will look into this  soon.

HyunWoo

From&#58; Fermilab Service Desk &#60;fermi@....&#60;mailto&#58;fermi@....&#62;&#62;
Reply-To&#58; Fermilab Service Desk &#60;fermi@....&#60;mailto&#58;fermi@....&#62;&#62;
Date&#58; Friday, July 5, 2013 9&#58;48 AM
To&#58; Hyunwoo Kim &#60;hyunwoo@....&#60;mailto&#58;hyunwoo@....&#62;&#62;
Subject&#58; Incident INC000000387929 updated -- Gratia replication causing strange error message

Incident INC000000387929&#60;<a href='https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do%3Fsys_id=01b4ff012b8e890007578f8667da15ad%26sysparm_stack=incident_list.do%3Fsysparm_query=active=true&#62' target='_blank' rel='nofollow'>https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do%3Fsys_id=01b4ff012b8e890007578f8667da15ad%26sysparm_stack=incident_list.do%3Fsysparm_query=active=true&#62</a>; comments have been updated.

Last update&#58;
2013-07-05 09&#58;47&#58;11 CDT - cd-srv-goc-ops (Additional comments)
Hi.

Is there anybody who could help me troubleshoot this? I am guessing I just need to update the DB column type on the MySQL.. or something like that (Or gratia code to be updated to use BigInteger for some key)
-- by Soichi Hayashi at Fri Jul 05 14&#58;46&#58;14 UTC 2013

________________________________
Incident State&#58; Work in Progress
Caller&#58; cd-srv-goc-ops
Assignment Group&#58; Gratia Support and Development
Assigned To&#58; Hyun Kim
Summary&#58;
I have installed the latest Gratia collector on rsv1.grid.iu.edu and rsv-itb.grid.iu.edu, and setup a replication from rsv1 to rsv-itb. When I started replication, I started seeing following error message on rsv1

2013-06-17 15&#58;04&#58;59,406 gratia.service(Thread-1742) [WARNING]&#58; ReplicationDataPump #1 (All to <a href='http&#58;//rsv-itb.grid.iu.edu&#58;8880' target='_blank' rel='nofollow'>http&#58;//rsv-itb.grid.iu.edu&#58;8880</a>)&#58; Problem encountered obtaining list of records to replicate
java.lang.ClassCastException&#58; java.lang.Integer cannot be cast to java.math.BigInteger
at net.sf.gratia.services.ReplicationDataPump.loop(ReplicationDataPump.java&#58;217)
<div id='show_461895184' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_461895184'>at net.sf.gratia.services.ReplicationDataPump.run(ReplicationDataPump.java&#58;95)

rsv-itb is not receiving any records.

I had to manually copy most of records from rsv1 to rsv-itb since we truncate MetricRecord_Xml periodically to save disk space. I am not sure if above error message maybe related to how I am hacking around with Gratia DB, but I&#39;d appreciate if Gratia team can help me fix this issue.

Thanks
Soichi

</div><script type='text/javascript'>
        $('#show_461895184').click(function() {
            $('#detail_461895184').slideDown("normal");
            $('#show_461895184').hide();
            $('#hide_461895184').show();
        });
        $('#hide_461895184').click(function() {
            $('#detail_461895184').slideUp();
            $('#hide_461895184').hide();
            $('#show_461895184').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='15567#1373035574'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-07-05T14:46:14+00:00">Jul 5, 2013 02:46 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1373035574">&nbsp;</a></div><pre>Hi.

Is there anybody who could help me troubleshoot this? I am guessing I just need to update the DB column type on the MySQL.. or something like that (Or gratia code to be updated to use BigInteger for some key)</pre></div><div class='update_description'><i onclick="document.location='15567#1372348179'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-06-27T15:49:39+00:00">Jun 27, 2013 03:49 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1372348179">&nbsp;</a></div><pre>I am currently running gratia-service v1.13 3.osg.el6 on rsv1 (and latest on rsv-itb).

Thank you.</pre></div><div class='update_description'><i onclick="document.location='15567#1372348006'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-06-27T15:46:46+00:00">Jun 27, 2013 03:46 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1372348006">&nbsp;</a></div><pre>I have reassigned this ticket to Hyunwoo. We have not dealt with replication problems before so it will take time to understand what is going on.
Soichi, what version of collector is on  rsv1?
-- by tlevshin at Thu Jun 27 15&#58;45&#58;20 UTC 2013

GOCTX Source&#58; <a href='https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000387929' target='_blank' rel='nofollow'>https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=INC000000387929</a></pre></div><div class='update_description'><i onclick="document.location='15567#1372094868'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-06-24T17:27:48+00:00">Jun 24, 2013 05:27 PM UTC</time> by <b>echism</b><a class="anchor" name="1372094868">&nbsp;</a></div><pre>Tanya,

Please look at this ticket.

Thank you,
Elizabeth</pre></div><div class='update_description'><i onclick="document.location='15567#1371820723'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-06-21T13:18:43+00:00">Jun 21, 2013 01:18 PM UTC</time> by <b>echism</b><a class="anchor" name="1371820723">&nbsp;</a></div><pre>I&#39;ll ping Tanya on Monday. She should be back from vacation.</pre></div><div class='update_description'><i onclick="document.location='15567#1371481945'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2013-06-17T15:12:25+00:00">Jun 17, 2013 03:12 PM UTC</time> by <b>Soichi Hayashi</b><a class="anchor" name="1371481945">&nbsp;</a></div><pre>I have installed the latest Gratia collector on rsv1.grid.iu.edu and rsv-itb.grid.iu.edu, and setup a replication from rsv1 to rsv-itb. When I started replication, I started seeing following error message on rsv1

2013-06-17 15&#58;04&#58;59,406 gratia.service(Thread-1742) [WARNING]&#58; ReplicationDataPump #1 (All to <a href='http&#58;//rsv-itb.grid.iu.edu&#58;8880' target='_blank' rel='nofollow'>http&#58;//rsv-itb.grid.iu.edu&#58;8880</a>)&#58; Problem encountered obtaining list of records to replicate
java.lang.ClassCastException&#58; java.lang.Integer cannot be cast to java.math.BigInteger
at net.sf.gratia.services.ReplicationDataPump.loop(ReplicationDataPump.java&#58;217)
at net.sf.gratia.services.ReplicationDataPump.run(ReplicationDataPump.java&#58;95)

rsv-itb is not receiving any records.

I had to manually copy most of records from rsv1 to rsv-itb since we truncate MetricRecord_Xml periodically to save disk space. I am not sure if above error message maybe related to how I am hacking around with Gratia DB, but I&#39;d appreciate if Gratia team can help me fix this issue.

Thanks
Soichi</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F15567">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 15567});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
