<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[20828] /usr/share/gratia/condor/condor_meter lock errors on several OU OSG sites</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=20828" method="post">
<div class="page-header">
    <h3><span class="muted">20828</span> / /usr/share/gratia/condor/condor_meter lock errors on several OU OSG sites</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Horst Severini</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Horst Severini</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2014-05-30</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div><div class="assignee" style="width: 60%">Carl Edquist <span class="muted"> / OSG Software Team</span></div><div class="assignee" style="width: 60%">Matyas Selmeci <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/20828", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src="https://ticket.opensciencegrid.org/\&quot;&quot;+this.thumbnail_url+&quot;\&quot;/"></td>";
            html += "<td><a href="https://ticket.opensciencegrid.org/\&quot;&quot;+this.url+&quot;\&quot;" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/20828?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/20828?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20%2Fusr%2Fshare%2Fgratia%2Fcondor%2Fcondor_meter%20lock%20errors%20on%20several%20OU%20OSG%20sites%20ISSUE%3D20828%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='20828#1401313477'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-28T21:44:37+00:00">May 28, 2014 09:44 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1401313477">&nbsp;</a></div><pre>Ok, great!  I&#39;ll close this then.

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='20828#1401313330'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-28T21:42:10+00:00">May 28, 2014 09:42 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1401313330">&nbsp;</a></div><pre>Sure, that&#39;s fine!

Thanks,

Horst</pre></div><div class='update_description'><i onclick="document.location='20828#1401313054'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-28T21:37:34+00:00">May 28, 2014 09:37 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1401313054">&nbsp;</a></div><pre>Horst, I&#39;ve added you as a watcher on the JIRA ticket.  Are you ok with tracking the issue there and closing this ticket, or would you like to keep both open?

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='20828#1400707024'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-21T21:17:04+00:00">May 21, 2014 09:17 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1400707024">&nbsp;</a></div><pre>I&#39;m dropping the priority down to normal for the locking issue.

By the way, I&#39;ve added some comments to the JIRA ticket related to this&#58;
<a href='https&#58;//jira.opensciencegrid.org/browse/SOFTWARE-1476' target='_blank' rel='nofollow'>https&#58;//jira.opensciencegrid.org/browse/SOFTWARE-1476</a>

I plan to do a little more investigation and, at a minimum, improve the error message for the python probes to be clearer when a probe is simply refusing to run because a previous instance is still running.

Carl</pre></div><div class='update_description'><i onclick="document.location='20828#1400701206'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-21T19:40:06+00:00">May 21, 2014 07:40 PM UTC</time> by <b>Suchandra Thapa</b><a class="anchor" name="1400701206">&nbsp;</a></div><pre>Hi Horst,

Is the /var/lib/osg/user-vo-map file the same between the machines?    If there&#39;s an entry for rsv on the other machines, the rsv account might be mapped to a known VO by gratia and therefore the records aren&#39;t being quarantined.

Suchandra</pre></div><div class='update_description'><i onclick="document.location='20828#1400699166'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-21T19:06:06+00:00">May 21, 2014 07:06 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1400699166">&nbsp;</a></div><pre>All,

I&#39;ve created <a href='https&#58;//ticket.grid.iu.edu/21191' target='_blank' rel='nofollow'>https&#58;//ticket.grid.iu.edu/21191</a> for the issue about the quarantine files, and I&#39;ve copied the relevant comments from this ticket over to the new one.

Please use the new ticket for the quarantined files issue, and we&#39;ll finish out the issue about probe locking here.

Thanks!
Carl</pre></div><div class='update_description'><i onclick="document.location='20828#1400537356'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-19T22:09:16+00:00">May 19, 2014 10:09 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1400537356">&nbsp;</a></div><pre>Hi again,

nope, all these settings are the same in the ProbeConfig files on all
these machines&#58;

SuppressUnknownVORecords=&#34;0&#34;
SuppressNoDNRecords=&#34;0&#34;
SuppressGridLocalRecords=&#34;0&#34;
QuarantineUnknownVORecords=&#34;1&#34;

And the Gratia and RSV versions of Lucille are in between what we have
on OCHEP and on our ITB, so I can&#39;t imagine how that would could explain
the differences, either&#58;

Lucille&#58;
-------
gratia-probe-common-1.13.18-1.osg.el6.noarch
gratia-probe-condor-1.13.18-1.osg.el6.noarch
gratia-probe-gram-1.13.18-1.osg.el6.noarch
gratia-probe-gridftp-transfer-1.13.18-1.osg.el6.noarch
gratia-probe-metric-1.13.18-1.osg.el6.noarch
osg-configure-gratia-1.0.47-1.osg.el6.noarch
osg-configure-rsv-1.0.47-1.osg.el6.noarch
rsv-3.7.14-1.osg31.el6.noarch
rsv-consumers-3.7.14-1.osg31.el6.noarch
rsv-core-3.7.14-1.osg31.el6.noarch
rsv-metrics-3.7.14-1.osg31.el6.noarch

OU_OCHEP_SWT2&#58;
-------------
gratia-probe-common-1.13.15-1.osg.el6.noarch
gratia-probe-condor-1.13.15-1.osg.el6.noarch
gratia-probe-gram-1.13.15-1.osg.el6.noarch
gratia-probe-gridftp-transfer-1.13.15-1.osg.el6.noarch
gratia-probe-metric-1.13.15-1.osg.el6.noarch
<div id='show_680083066' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_680083066'>osg-configure-gratia-1.0.45-1.osg.el6.noarch
osg-configure-rsv-1.0.45-1.osg.el6.noarch
rsv-3.7.9-1.osg.el6.noarch
rsv-consumers-3.7.9-1.osg.el6.noarch
rsv-core-3.7.9-1.osg.el6.noarch
rsv-metrics-3.7.9-1.osg.el6.noarch

OUHEP_ITB&#58;
---------
gratia-probe-common-1.13.26-1.osg31.el6.noarch
gratia-probe-condor-1.13.26-1.osg31.el6.noarch
gratia-probe-gram-1.13.26-1.osg31.el6.noarch
gratia-probe-gridftp-transfer-1.13.26-1.osg31.el6.noarch
gratia-probe-metric-1.13.26-1.osg31.el6.noarch
osg-configure-gratia-1.0.54-1.osg31.el6.noarch
osg-configure-rsv-1.0.54-1.osg31.el6.noarch
rsv-3.7.16-1.osg31.el6.noarch
rsv-consumers-3.7.16-1.osg31.el6.noarch
rsv-core-3.7.16-1.osg31.el6.noarch
rsv-metrics-3.7.16-1.osg31.el6.noarch

Where else can we look why RSV records on Lucille seem to be from an
unknown VO?

And yes, please feel free to transfer all the info about these
quarantined records to a new ticket, since it&#39;s no longer related to the
original lock errors. I think the original one should stay open till we
figure out a way to prevent Gratia from starting a second instance and
throwing this lock error in the first place, though ...

Thanks,

Horst
</div><script type='text/javascript'>
        $('#show_680083066').click(function() {
            $('#detail_680083066').slideDown("normal");
            $('#show_680083066').hide();
            $('#hide_680083066').show();
        });
        $('#hide_680083066').click(function() {
            $('#detail_680083066').slideUp();
            $('#hide_680083066').hide();
            $('#show_680083066').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='20828#1400524650'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-19T18:37:30+00:00">May 19, 2014 06:37 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1400524650">&nbsp;</a></div><pre>Yeah, it looks like the ProbeConfig options for unkown VO mappings are SuppressUnknownVORecords and QuarantineUnknownVORecords ... the quarantine one in particular seems likely to be causing this.  Maybe the sites aren&#39;t configured exactly the same?  Or else maybe they are running different versions of the probes?

Also, Horst yeah, since this quarantined files issue is separate from the original locking error, I&#39;d be fine with opening a separate ticket, or else renaming this one.

<font color='#7F7E6F'>&#62; Do you know where else we can look in the VO mapping</font>
<font color='#7F7E6F'>&#62; process to figure out why this is happening?</font>

I don&#39;t know off hand -- Tanya, do you know?

Thanks!
Carl</pre></div><div class='update_description'><i onclick="document.location='20828#1400514603'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-19T15:50:03+00:00">May 19, 2014 03:50 PM UTC</time> by <b>Suchandra Thapa</b><a class="anchor" name="1400514603">&nbsp;</a></div><pre>Hi Horst,

What are the contents of the gratia configs on Lucille and your ITB hosts?  I believe there&#39;s an option in the config file to ignore records with unknown VO mappings that might be enabled on the other hosts but not on Lucille.

Suchandra
OSG Software Team</pre></div><div class='update_description'><i onclick="document.location='20828#1400260090'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-16T17:08:10+00:00">May 16, 2014 05:08 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1400260090">&nbsp;</a></div><pre>Hi Carl,

thanks for digging deeper here. I looked at that job, and it turns out
that it&#39;s an RSV job, so I&#39;m not sure why that would cause a problem
like that.

I guess I&#39;ve never looked at the VO mapping of RSV jobs, or whether they
even have one. The question is, why does this cause problems on Lucille,
while it&#39;s not causing any problems at OU, where we have very similar
&#39;default&#39; setups at OU_OCHEP_SWT2 and OUHEP_ITB, and therefore the VO
mapping of RSV jobs should be done the same way (or not at all), and
therefore Gratia should see them the same way, too.

Do you know where else we can look in the VO mapping process to figure
out why this is happening?

This &#34;Unable to acquire lock&#34; is no longer the error we&#39;re dealing with
here, by the way, so maybe we should move this issue to another ticket?

That problem was indeed what what it claimed to be, namely that there
were so many records which needed to be continually re-sent (while the
Gratia collector had its own problems) that they eventually took more
than 15 minutes, and therefore a new process was starting and couldn&#39;t
acquire that lock because it was still locked by the still running process.

We still need to figure out why a new Gratia process is even starting
while a previous is still running, though; I still think that should be
protected against earlier, such that we would never get to the lock
issue, right?

Thanks,

Horst</pre></div><div class='update_description'><i onclick="document.location='20828#1400194978'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-15T23:02:58+00:00">May 15, 2014 11:02 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1400194978">&nbsp;</a></div><pre>Thanks Chris!

Horst, looking at the attached 2014-05-09.log, I see a bunch of messages like this&#58;

12&#58;37&#58;36 CDT Gratia&#58; ***********************************************************
12&#58;37&#58;36 CDT Gratia&#58; Info&#58; suppressing record with GlobalJobId condor.lutgw1.lunet.edu#188062.0#1399656608 due to unknown or null VOName, will be quarantined in /var/lib/gratia/data/quarantine
12&#58;37&#58;36 CDT Gratia&#58; Moving transient input file&#58; /var/lib/gratia/data/history.188062.0 to quarantine in /var/lib/gratia/data/quarantine
12&#58;37&#58;36 CDT Gratia&#58; OK&#58; No unsuppressed usage records in this packet&#58; not sending
12&#58;37&#58;36 CDT Gratia&#58; ***********************************************************

So it looks like they&#39;re getting quarantined for not having a valid VOName.  I know there is a ProbeConfig option QuarantineUnknownVORecords=&#34;1&#34; which is on by default now (I don&#39;t remember off hand which version that behavior changed).

I guess you could try setting QuarantineUnknownVORecords=&#34;0&#34; if it&#39;s expected for the records not to have a valid VO.  Otherwise if they are supposed to have a valid VO, then I guess we have to find out why the probe doesn&#39;t think they do...  I&#39;m CC&#39;ing Tanya on this too as I think she is familiar with how the QuarantineUnknownVORecords option works.

As for the first question brought up in the ticket about multiple instances of probes stomping on each other -- yes, it&#39;s apparently just the next instance from cron trying to start.  Mat had actually opened a jira ticket to look into it&#58; <a href='https&#58;//jira.opensciencegrid.org/browse/SOFTWARE-1476' target='_blank' rel='nofollow'>https&#58;//jira.opensciencegrid.org/browse/SOFTWARE-1476</a> ... But after taking a closer look, the error message&#58;

File &#34;/usr/lib/python2.6/site-packages/gratia/common/GratiaWrapper.py&#34;, line 141, in ExclusiveLock
raise Exception(&#34;Unable to acquire lock&#34;)

appears to just be doing what it&#39;s supposed to -- the probe uses GratiaWrapper.py to acquire a lock to prevent other instances from running at the same time, so you get the error message when a second one tries to run at the same time.  If anything, we should probably have it print a nicer error message instead of the scary backtrace...

Carl</pre></div><div class='update_description'><i onclick="document.location='20828#1400182334'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-15T19:32:14+00:00">May 15, 2014 07:32 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1400182334">&nbsp;</a></div><pre>Hi Carl and Mat,

Is there any new information on this? I know that GRATIA is still under investigation so let me know if I can help with anything.

Thanks,
Chris</pre></div><div class='update_description'><i onclick="document.location='20828#1399660931'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-09T18:42:11+00:00">May 9, 2014 06:42 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1399660931">&nbsp;</a></div><pre>Oh wait,

I finally saw the big green button that says &#39;Attach files...&#39;! ;)

I wouldn&#39;t allow me to attach gzipped files, so I unzipped them again
and attached them.

Let me know if that helps, or if there&#39;s anything else we can do to help
figure this out.

Thanks a lot,

Horst</pre></div><div class='update_description'><i onclick="document.location='20828#1399660570'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-09T18:36:10+00:00">May 9, 2014 06:36 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1399660570">&nbsp;</a></div><pre>Well,

I can&#39;t find the attachments on the ticket web page, nor did it get
through in the email I just got, so I&#39;ve copied the two log files here&#58;

<a href='http&#58;//www.nhn.ou.edu/' target='_blank' rel='nofollow'>http&#58;//www.nhn.ou.edu/</a>~hs/tmp/

Let me know when you got them, so I can delete them again.

Thanks,

Horst</pre></div><div class='update_description'><i onclick="document.location='20828#1399660215'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-09T18:30:15+00:00">May 9, 2014 06:30 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1399660215">&nbsp;</a></div><pre>Hi Mat,

okay, I gzipped and attached the latest gratia log files
gridftpTransfer.log.gz and 2014-05-09.log to this email.

Will these attachments got through Footprints, or do I need to
specifically upload them? Looking at the ticket web page it&#39;s not
obvious to me how to do that.

Or I can just put it on my web page somewhere and you can get it from
there, whichever is easier.

Thanks,

Horst

On 05/08/2014 07&#58;14 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='20828#1399594450'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-09T00:14:10+00:00">May 9, 2014 12:14 AM UTC</time> by <b>Matyas Selmeci</b><a class="anchor" name="1399594450">&nbsp;</a></div><pre>Hi Horst,

Out of those links, I only see one that has a huge number of quarantine files&#58;
<a href='https&#58;//lutgw1.lunet.edu/rsv/lutgw1.lunet.edu.html#org.osg.gratia.condor' target='_blank' rel='nofollow'>https&#58;//lutgw1.lunet.edu/rsv/lutgw1.lunet.edu.html#org.osg.gratia.condor</a>
Can you attach the recent Gratia logs for that site? (The files in /var/log/gratia).
I&#39;ve also added Carl to the ticket; he&#39;s worked more with Gratia recently.

-Mat</pre></div><div class='update_description'><i onclick="document.location='20828#1399495150'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-07T20:39:10+00:00">May 7, 2014 08:39 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1399495150">&nbsp;</a></div><pre>Hi Edgar,

<font color='#7F7E6F'>&#62; I am pretty sure that is expected.</font>

I could see that the odd unsent record is expected, but one of our sites
has over 9000 quarantine files, which I don&#39;t think should be there. We
should figure out what&#39;s wrong with them, and either get them to send,
or delete them if they&#39;re unsendable for some reason.

<font color='#7F7E6F'>&#62; However, Mat is the expert here. Mat,</font>
<font color='#7F7E6F'>&#62; I remember you answered a similar thing in the past? Can you enlighten</font>
<font color='#7F7E6F'>&#62; us again?</font>

That&#39;d be great, thanks!

Horst</pre></div><div class='update_description'><i onclick="document.location='20828#1399491866'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-07T19:44:26+00:00">May 7, 2014 07:44 PM UTC</time><a class="anchor" name="1399491866">&nbsp;</a></div><pre>Hi Horst,

I am pretty sure that is expected. However, Mat is the expert here. Mat, I remember you answered a similar thing in the past? Can you enlighten us again?

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Edgar Mauricio Fajardo Hernandez 2020</pre></div><div class='update_description'><i onclick="document.location='20828#1399485435'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-07T17:57:15+00:00">May 7, 2014 05:57 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1399485435">&nbsp;</a></div><pre>Hi Edgar,

I think Chris was referring to my question about the unsent and
quarantined files or records here&#58;

<a href='https&#58;//lutgw1.lunet.edu/rsv/lutgw1.lunet.edu.html#org.osg.gratia.metric' target='_blank' rel='nofollow'>https&#58;//lutgw1.lunet.edu/rsv/lutgw1.lunet.edu.html#org.osg.gratia.metric</a>
<a href='https&#58;//lutgw1.lunet.edu/rsv/lutgw1.lunet.edu.html#org.osg.gratia.condor' target='_blank' rel='nofollow'>https&#58;//lutgw1.lunet.edu/rsv/lutgw1.lunet.edu.html#org.osg.gratia.condor</a>
<a href='https&#58;//grid1.oscer.ou.edu/rsv/grid1.oscer.ou.edu.html#org.osg.gratia.metric' target='_blank' rel='nofollow'>https&#58;//grid1.oscer.ou.edu/rsv/grid1.oscer.ou.edu.html#org.osg.gratia.metric</a>
<a href='https&#58;//grid1.oscer.ou.edu/rsv/grid1.oscer.ou.edu.html#org.osg.gratia.lsf' target='_blank' rel='nofollow'>https&#58;//grid1.oscer.ou.edu/rsv/grid1.oscer.ou.edu.html#org.osg.gratia.lsf</a>
<a href='https&#58;//osgitb1.nhn.ou.edu/rsv/osgitb1.nhn.ou.edu.html#org.osg.gratia.metric' target='_blank' rel='nofollow'>https&#58;//osgitb1.nhn.ou.edu/rsv/osgitb1.nhn.ou.edu.html#org.osg.gratia.metric</a>
<a href='https&#58;//osgitb1.nhn.ou.edu/rsv/osgitb1.nhn.ou.edu.html#org.osg.gratia.condor' target='_blank' rel='nofollow'>https&#58;//osgitb1.nhn.ou.edu/rsv/osgitb1.nhn.ou.edu.html#org.osg.gratia.condor</a>
<a href='https&#58;//tier2-01.ochep.ou.edu/rsv/tier2-01.ochep.ou.edu.html#org.osg.gratia.metric' target='_blank' rel='nofollow'>https&#58;//tier2-01.ochep.ou.edu/rsv/tier2-01.ochep.ou.edu.html#org.osg.gratia.metric</a>
<a href='https&#58;//tier2-01.ochep.ou.edu/rsv/tier2-01.ochep.ou.edu.html#org.osg.gratia.condor' target='_blank' rel='nofollow'>https&#58;//tier2-01.ochep.ou.edu/rsv/tier2-01.ochep.ou.edu.html#org.osg.gratia.condor</a>

Could someone please tell us if that&#39;s a problem, or to be expected, or
if there&#39;s a way to get rid of them?

Thanks a lot,

Horst</pre></div><div class='update_description'><i onclick="document.location='20828#1399484702'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-07T17:45:02+00:00">May 7, 2014 05:45 PM UTC</time><a class="anchor" name="1399484702">&nbsp;</a></div><pre>Hi Chris,

I am somehow lost regarding the ticket, since it looks fixed.

Which was the problem? and what should be looking forward to isolate?

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Edgar Mauricio Fajardo Hernandez 2020</pre></div><div class='update_description'><i onclick="document.location='20828#1399398668'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-06T17:51:08+00:00">May 6, 2014 05:51 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1399398668">&nbsp;</a></div><pre>Hello Software Team,

Could you please take a look at this and help isolate where or what the problem might be here?

Thanks,
Chris</pre></div><div class='update_description'><i onclick="document.location='20828#1399053626'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-02T18:00:26+00:00">May 2, 2014 06:00 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1399053626">&nbsp;</a></div><pre>Hi Chris,

I think it looks good! There&#39;s no more backlog anywhere.

I&#39;m still seeing some (very few) quarantined and unsent records, though,
which are probably a different issue, though. Could you please have a
look at these links and tell me why you think these may still be lying
around?

<a href='https&#58;//lutgw1.lunet.edu/rsv/lutgw1.lunet.edu.html#org.osg.gratia.metric' target='_blank' rel='nofollow'>https&#58;//lutgw1.lunet.edu/rsv/lutgw1.lunet.edu.html#org.osg.gratia.metric</a>
<a href='https&#58;//lutgw1.lunet.edu/rsv/lutgw1.lunet.edu.html#org.osg.gratia.condor' target='_blank' rel='nofollow'>https&#58;//lutgw1.lunet.edu/rsv/lutgw1.lunet.edu.html#org.osg.gratia.condor</a>
<a href='https&#58;//grid1.oscer.ou.edu/rsv/grid1.oscer.ou.edu.html#org.osg.gratia.metric' target='_blank' rel='nofollow'>https&#58;//grid1.oscer.ou.edu/rsv/grid1.oscer.ou.edu.html#org.osg.gratia.metric</a>
<a href='https&#58;//grid1.oscer.ou.edu/rsv/grid1.oscer.ou.edu.html#org.osg.gratia.lsf' target='_blank' rel='nofollow'>https&#58;//grid1.oscer.ou.edu/rsv/grid1.oscer.ou.edu.html#org.osg.gratia.lsf</a>
<a href='https&#58;//osgitb1.nhn.ou.edu/rsv/osgitb1.nhn.ou.edu.html#org.osg.gratia.metric' target='_blank' rel='nofollow'>https&#58;//osgitb1.nhn.ou.edu/rsv/osgitb1.nhn.ou.edu.html#org.osg.gratia.metric</a>
<a href='https&#58;//osgitb1.nhn.ou.edu/rsv/osgitb1.nhn.ou.edu.html#org.osg.gratia.condor' target='_blank' rel='nofollow'>https&#58;//osgitb1.nhn.ou.edu/rsv/osgitb1.nhn.ou.edu.html#org.osg.gratia.condor</a>
<a href='https&#58;//tier2-01.ochep.ou.edu/rsv/tier2-01.ochep.ou.edu.html#org.osg.gratia.metric' target='_blank' rel='nofollow'>https&#58;//tier2-01.ochep.ou.edu/rsv/tier2-01.ochep.ou.edu.html#org.osg.gratia.metric</a>
<a href='https&#58;//tier2-01.ochep.ou.edu/rsv/tier2-01.ochep.ou.edu.html#org.osg.gratia.condor' target='_blank' rel='nofollow'>https&#58;//tier2-01.ochep.ou.edu/rsv/tier2-01.ochep.ou.edu.html#org.osg.gratia.condor</a>

We may want to open a different ticket for this, though, since I&#39;m
pretty sure it&#39;s not related to the original problem.

Thanks a lot,

Horst

On 05/02/2014 12&#58;13 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='20828#1399050830'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-05-02T17:13:50+00:00">May 2, 2014 05:13 PM UTC</time> by <b>Christopher Pipes</b><a class="anchor" name="1399050830">&nbsp;</a></div><pre>Hi Horst,

How are things looking since the GRATIA fixes?

~Chris</pre></div><div class='update_description'><i onclick="document.location='20828#1398358089'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-04-24T16:48:09+00:00">Apr 24, 2014 04:48 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1398358089">&nbsp;</a></div><pre>Ah... sorry I hadn&#39;t connected the two, Horst!  Too many moving parts for me to keep track of, apparently!  At least you seem to be at the bottom of the issue at this point.</pre></div><div class='update_description'><i onclick="document.location='20828#1398355149'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-04-24T15:59:09+00:00">Apr 24, 2014 03:59 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1398355149">&nbsp;</a></div><pre>Hi Joe, and all,

ahh, I see, so this is still fallout from the failure.

I guess I misunderstood the second email I got about the problem.
I do now remember reading that you were still working on it, but I also
somehow thought that records can be uploaded again, they just wouldn&#39;t
show up in the gratia plots until everything was fixed. Apparently
that&#39;s not the case ...

So the upshot of this is that there&#39;s nothing we can do about this
right now, and we&#39;ll just have to let these records pile up until
they can be uploaded again? That&#39;s not a big deal, I just wanted
to make sure there wasn&#39;t a problem on our end!

I think we should still find a way to protect the cron job from itself,
so that a new one won&#39;t start if an old one is still running after
15 minutes, since we still keep getting these &#39;unable to acquire lock&#39;
error emails.

Is there a simple way to do this? I could probably rig something up,
but it wouldn&#39;t be pretty, so I&#39;d rather coordinate it with the experts,
so we can come up with an elegant solution. I&#39;d be happy to help, though!

Thanks,

Horst

Open Science Grid FootPrints &#60;osg@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='20828#1398353921'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-04-24T15:38:41+00:00">Apr 24, 2014 03:38 PM UTC</time><a class="anchor" name="1398353921">&nbsp;</a></div><pre>Hi,

We have had a major failure of the hardware running the main gratia database.  We have been working very hard to deploy a solution over the last day and are hoping to pick one of our several options by the end of day today.  Once we get the main gratia database and server back up these remote probes will be able to connect and send data into the database.

Apologies for these issues.  We will update again later with more info.

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=Joe Boyd 579</pre></div><div class='update_description'><i onclick="document.location='20828#1398350293'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-04-24T14:38:13+00:00">Apr 24, 2014 02:38 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1398350293">&nbsp;</a></div><pre>Hi all,

I&#39;m afraid we&#39;ll have to increase the urgency of this ticket,

<a href='https&#58;//ticket.grid.iu.edu/goc/20828' target='_blank' rel='nofollow'>https&#58;//ticket.grid.iu.edu/goc/20828</a>

since this seems to affect many sites worldwide now. Just a few we found&#58;

<a href='https&#58;//osg-ce.grid.uj.ac.za&#58;8443/rsv/osg-ce.grid.uj.ac.za.html#org.osg.gratia.condor' target='_blank' rel='nofollow'>https&#58;//osg-ce.grid.uj.ac.za&#58;8443/rsv/osg-ce.grid.uj.ac.za.html#org.osg.gratia.condor</a>
<a href='https&#58;//tier2-01.ochep.ou.edu/rsv/tier2-01.ochep.ou.edu.html#org.osg.gratia.condor' target='_blank' rel='nofollow'>https&#58;//tier2-01.ochep.ou.edu/rsv/tier2-01.ochep.ou.edu.html#org.osg.gratia.condor</a>
<a href='https&#58;//grid1.oscer.ou.edu/rsv/grid1.oscer.ou.edu.html#org.osg.gratia.lsf' target='_blank' rel='nofollow'>https&#58;//grid1.oscer.ou.edu/rsv/grid1.oscer.ou.edu.html#org.osg.gratia.lsf</a>
<a href='https&#58;//lutgw1.lunet.edu/rsv/lutgw1.lunet.edu.html#org.osg.gratia.condor' target='_blank' rel='nofollow'>https&#58;//lutgw1.lunet.edu/rsv/lutgw1.lunet.edu.html#org.osg.gratia.condor</a>

And several of them have many thousands of records backed up. Note the error

WARNING&#58; Gratia server gratia-osg-prod.opensciencegrid.org&#58;80 not responding to obtain last contact details.

Did something not come back up after the emergency maintenance,
or do we need to change some contact string somewhere, or ...?

Either way, these are production resources, so we really need to get this fixed.

Thanks a lot,

Horst

Horst Severini &#60;hs@....&#62; wrote&#58;

<font color='#7F7E6F'>&#62; Hi again,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; since we&#39;re still seeing these error emails, I dug a little deeper, and</font>
<font color='#7F7E6F'>&#62; I think I found the reason that these cron jobs keep running forever and</font>
<font color='#7F7E6F'>&#62; triggering the lock issue. Looking at RSV,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; <a href='https&#58;//tier2-01.ochep.ou.edu/rsv/tier2-01.ochep.ou.edu.html#org.osg.gratia.condor' target='_blank' rel='nofollow'>https&#58;//tier2-01.ochep.ou.edu/rsv/tier2-01.ochep.ou.edu.html#org.osg.gratia.condor</a></font>
<div id='show_1130656285' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1130656285'><font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; it seems that records aren&#39;t being uploaded successfully anymore, and</font>
<font color='#7F7E6F'>&#62; now we have almost 4000 records back logged, which would explain why</font>
<font color='#7F7E6F'>&#62; each cron job takes more than 15 minutes to complete.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Here are some log file extracts from /var/log/gratia/2014-04-23.log&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; ----</font>
<font color='#7F7E6F'>&#62; 00&#58;01&#58;57 CDT Gratia&#58; Failed to send xml to web service due to an error</font>
<font color='#7F7E6F'>&#62; of type &#34;&#60;class &#39;socket.error&#39;&#62;&#34;&#58; [Errno 104] Connection reset by peer</font>
<font color='#7F7E6F'>&#62; 00&#58;01&#58;57 CDT Gratia&#58; Traceback (most recent call last)&#58;</font>
<font color='#7F7E6F'>&#62;    File</font>
<font color='#7F7E6F'>&#62; &#34;/usr/lib/python2.6/site-packages/gratia/common/connect_utils.py&#34;, line</font>
<font color='#7F7E6F'>&#62; 333, in sendUsageXML</font>
<font color='#7F7E6F'>&#62;      responseString = postRequest(connection,</font>
<font color='#7F7E6F'>&#62; Config.get_CollectorService(), queryString, headers)</font>
<font color='#7F7E6F'>&#62;    File</font>
<font color='#7F7E6F'>&#62; &#34;/usr/lib/python2.6/site-packages/gratia/common/connect_utils.py&#34;, line</font>
<font color='#7F7E6F'>&#62; 272, in postRequest</font>
<font color='#7F7E6F'>&#62;      myconnection.request(&#39;POST&#39;, to, what, headers)</font>
<font color='#7F7E6F'>&#62;    File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 914, in request</font>
<font color='#7F7E6F'>&#62;      self._send_request(method, url, body, headers)</font>
<font color='#7F7E6F'>&#62;    File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 954, in _send_request</font>
<font color='#7F7E6F'>&#62;      self.send(body)</font>
<font color='#7F7E6F'>&#62;    File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 759, in send</font>
<font color='#7F7E6F'>&#62;      self.sock.sendall(str)</font>
<font color='#7F7E6F'>&#62;    File &#34;&#60;string&#62;&#34;, line 1, in sendall</font>
<font color='#7F7E6F'>&#62; error&#58; [Errno 104] Connection reset by peer</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [...]</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; 00&#58;01&#58;57 CDT Gratia&#58; Traceback (most recent call last)&#58;</font>
<font color='#7F7E6F'>&#62;    File</font>
<font color='#7F7E6F'>&#62; &#34;/usr/lib/python2.6/site-packages/gratia/common/connect_utils.py&#34;, line</font>
<font color='#7F7E6F'>&#62; 333, in sendUsageXML</font>
<font color='#7F7E6F'>&#62;      responseString = postRequest(connection,</font>
<font color='#7F7E6F'>&#62; Config.get_CollectorService(), queryString, headers)</font>
<font color='#7F7E6F'>&#62;    File</font>
<font color='#7F7E6F'>&#62; &#34;/usr/lib/python2.6/site-packages/gratia/common/connect_utils.py&#34;, line</font>
<font color='#7F7E6F'>&#62; 272, in postRequest</font>
<font color='#7F7E6F'>&#62;      myconnection.request(&#39;POST&#39;, to, what, headers)</font>
<font color='#7F7E6F'>&#62;    File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 914, in request</font>
<font color='#7F7E6F'>&#62;      self._send_request(method, url, body, headers)</font>
<font color='#7F7E6F'>&#62;    File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 931, in _send_request</font>
<font color='#7F7E6F'>&#62;      self.putrequest(method, url, **skips)</font>
<font color='#7F7E6F'>&#62;    File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 818, in putrequest</font>
<font color='#7F7E6F'>&#62;      raise CannotSendRequest()</font>
<font color='#7F7E6F'>&#62; CannotSendRequest</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [...]</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; 00&#58;05&#58;50 CDT Gratia&#58; Exception caught at top level&#58; [Errno 21] Is a</font>
<font color='#7F7E6F'>&#62; directory&#58;</font>
<font color='#7F7E6F'>&#62; &#39;/var/lib/gratia/data/quarantine/subdir.condor_tier2-01.ochep.ou.edu_gratia-osg-prod.opensciencegrid.org_80&#39;</font>
<font color='#7F7E6F'>&#62; 00&#58;05&#58;50 CDT Gratia&#58; End of execution summary&#58; new records sent</font>
<font color='#7F7E6F'>&#62; successfully&#58; 0</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [...]</font>
<font color='#7F7E6F'>&#62; ----</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; And looking through older log files, the errors started happening</font>
<font color='#7F7E6F'>&#62; yesterday morning, 4/22 at 9&#58;52 am CDT, with this error&#58;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; ----</font>
<font color='#7F7E6F'>&#62; 09&#58;37&#58;32 CDT Gratia&#58; Connection via HTTP to&#58;</font>
<font color='#7F7E6F'>&#62; gratia-osg-prod.opensciencegrid.org&#58;80</font>
<font color='#7F7E6F'>&#62; 09&#58;52&#58;32 CDT Gratia&#58; Failed to send xml to web service due to an error</font>
<font color='#7F7E6F'>&#62; of type &#34;&#60;type &#39;exceptions.TypeError&#39;&#62;&#34;&#58; descriptor &#39;__init__&#39; of</font>
<font color='#7F7E6F'>&#62; &#39;exceptions.Exception&#39; object needs an argument</font>
<font color='#7F7E6F'>&#62; 09&#58;52&#58;32 CDT Gratia&#58; Traceback (most recent call last)&#58;</font>
<font color='#7F7E6F'>&#62;    File</font>
<font color='#7F7E6F'>&#62; &#34;/usr/lib/python2.6/site-packages/gratia/common/connect_utils.py&#34;, line</font>
<font color='#7F7E6F'>&#62; 333, in sendUsageXML</font>
<font color='#7F7E6F'>&#62;      responseString = postRequest(connection,</font>
<font color='#7F7E6F'>&#62; Config.get_CollectorService(), queryString, headers)</font>
<font color='#7F7E6F'>&#62;    File</font>
<font color='#7F7E6F'>&#62; &#34;/usr/lib/python2.6/site-packages/gratia/common/connect_utils.py&#34;, line</font>
<font color='#7F7E6F'>&#62; 275, in postRequest</font>
<font color='#7F7E6F'>&#62;      responseString = myconnection.getresponse().read()</font>
<font color='#7F7E6F'>&#62;    File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 990, in getresponse</font>
<font color='#7F7E6F'>&#62;      response.begin()</font>
<font color='#7F7E6F'>&#62;    File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 391, in begin</font>
<font color='#7F7E6F'>&#62;      version, status, reason = self._read_status()</font>
<font color='#7F7E6F'>&#62;    File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 349, in _read_status</font>
<font color='#7F7E6F'>&#62;      line = self.fp.readline()</font>
<font color='#7F7E6F'>&#62;    File &#34;/usr/lib64/python2.6/socket.py&#34;, line 433, in readline</font>
<font color='#7F7E6F'>&#62;      data = recv(1)</font>
<font color='#7F7E6F'>&#62;    File</font>
<font color='#7F7E6F'>&#62; &#34;/usr/lib/python2.6/site-packages/gratia/common/connect_utils.py&#34;, line</font>
<font color='#7F7E6F'>&#62; 63, in __handle_timeout__</font>
<font color='#7F7E6F'>&#62;      raise GratiaTimeout(&#34;Connection to Collector lasted more than&#58;</font>
<font color='#7F7E6F'>&#62; &#34;+str(timeout)+&#34; second&#34;)</font>
<font color='#7F7E6F'>&#62;    File</font>
<font color='#7F7E6F'>&#62; &#34;/usr/lib/python2.6/site-packages/gratia/common/connect_utils.py&#34;, line</font>
<font color='#7F7E6F'>&#62; 54, in __init__</font>
<font color='#7F7E6F'>&#62;      Exception.__init__()</font>
<font color='#7F7E6F'>&#62; TypeError&#58; descriptor &#39;__init__&#39; of &#39;exceptions.Exception&#39; object needs</font>
<font color='#7F7E6F'>&#62; an argument</font>
<font color='#7F7E6F'>&#62; ----</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; That was around the time you had the collector problems, right?</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Apparently we never recovered from that, since there haven&#39;t been any</font>
<font color='#7F7E6F'>&#62; successful uploads since, and we keep getting the other two errors above.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; This &#39;[Errno 21] Is a directory&#58;&#39; happened before things started to go</font>
<font color='#7F7E6F'>&#62; bad, so that may not be a fatal error -- but shouldn&#39;t be there, either.</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Does that help? Again, this is running</font>
<font color='#7F7E6F'>&#62; gratia-probe-condor-1.13.15-1.osg.el6.noarch. Is there a known issue</font>
<font color='#7F7E6F'>&#62; with that version, like that it contains some contact string that should</font>
<font color='#7F7E6F'>&#62; no longer be used?</font>
<font color='#7F7E6F'>&#62; I don&#39;t think we ever changed the default here ...</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; That still doesn&#39;t explain why this locking error occurs in the first</font>
<font color='#7F7E6F'>&#62; place, though. I think this cron job should be protected from itself,</font>
<font color='#7F7E6F'>&#62; such that it won&#39;t start while an older one is still running, right? Or</font>
<font color='#7F7E6F'>&#62; are we seeing some kind of non-standard case which by-passes this</font>
<font color='#7F7E6F'>&#62; protection somehow?</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Thanks,</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; 	Horst</font>
</div><script type='text/javascript'>
        $('#show_1130656285').click(function() {
            $('#detail_1130656285').slideDown("normal");
            $('#show_1130656285').hide();
            $('#hide_1130656285').show();
        });
        $('#hide_1130656285').click(function() {
            $('#detail_1130656285').slideUp();
            $('#hide_1130656285').hide();
            $('#show_1130656285').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='20828#1398281176'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-04-23T19:26:16+00:00">Apr 23, 2014 07:26 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1398281176">&nbsp;</a></div><pre>Hi again,

since we&#39;re still seeing these error emails, I dug a little deeper, and
I think I found the reason that these cron jobs keep running forever and
triggering the lock issue. Looking at RSV,

<a href='https&#58;//tier2-01.ochep.ou.edu/rsv/tier2-01.ochep.ou.edu.html#org.osg.gratia.condor' target='_blank' rel='nofollow'>https&#58;//tier2-01.ochep.ou.edu/rsv/tier2-01.ochep.ou.edu.html#org.osg.gratia.condor</a>

it seems that records aren&#39;t being uploaded successfully anymore, and
now we have almost 4000 records back logged, which would explain why
each cron job takes more than 15 minutes to complete.

Here are some log file extracts from /var/log/gratia/2014-04-23.log&#58;

----
00&#58;01&#58;57 CDT Gratia&#58; Failed to send xml to web service due to an error
of type &#34;&#60;class &#39;socket.error&#39;&#62;&#34;&#58; [Errno 104] Connection reset by peer
00&#58;01&#58;57 CDT Gratia&#58; Traceback (most recent call last)&#58;
File
&#34;/usr/lib/python2.6/site-packages/gratia/common/connect_utils.py&#34;, line
333, in sendUsageXML
responseString = postRequest(connection,
Config.get_CollectorService(), queryString, headers)
File
&#34;/usr/lib/python2.6/site-packages/gratia/common/connect_utils.py&#34;, line
272, in postRequest
myconnection.request(&#39;POST&#39;, to, what, headers)
File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 914, in request
self._send_request(method, url, body, headers)
File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 954, in _send_request
self.send(body)
File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 759, in send
self.sock.sendall(str)
File &#34;&#60;string&#62;&#34;, line 1, in sendall
error&#58; [Errno 104] Connection reset by peer
<div id='show_1240582527' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1240582527'>
[...]

00&#58;01&#58;57 CDT Gratia&#58; Traceback (most recent call last)&#58;
File
&#34;/usr/lib/python2.6/site-packages/gratia/common/connect_utils.py&#34;, line
333, in sendUsageXML
responseString = postRequest(connection,
Config.get_CollectorService(), queryString, headers)
File
&#34;/usr/lib/python2.6/site-packages/gratia/common/connect_utils.py&#34;, line
272, in postRequest
myconnection.request(&#39;POST&#39;, to, what, headers)
File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 914, in request
self._send_request(method, url, body, headers)
File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 931, in _send_request
self.putrequest(method, url, **skips)
File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 818, in putrequest
raise CannotSendRequest()
CannotSendRequest

[...]

00&#58;05&#58;50 CDT Gratia&#58; Exception caught at top level&#58; [Errno 21] Is a
directory&#58;
&#39;/var/lib/gratia/data/quarantine/subdir.condor_tier2-01.ochep.ou.edu_gratia-osg-prod.opensciencegrid.org_80&#39;
00&#58;05&#58;50 CDT Gratia&#58; End of execution summary&#58; new records sent
successfully&#58; 0

[...]
----

And looking through older log files, the errors started happening
yesterday morning, 4/22 at 9&#58;52 am CDT, with this error&#58;

----
09&#58;37&#58;32 CDT Gratia&#58; Connection via HTTP to&#58;
gratia-osg-prod.opensciencegrid.org&#58;80
09&#58;52&#58;32 CDT Gratia&#58; Failed to send xml to web service due to an error
of type &#34;&#60;type &#39;exceptions.TypeError&#39;&#62;&#34;&#58; descriptor &#39;__init__&#39; of
&#39;exceptions.Exception&#39; object needs an argument
09&#58;52&#58;32 CDT Gratia&#58; Traceback (most recent call last)&#58;
File
&#34;/usr/lib/python2.6/site-packages/gratia/common/connect_utils.py&#34;, line
333, in sendUsageXML
responseString = postRequest(connection,
Config.get_CollectorService(), queryString, headers)
File
&#34;/usr/lib/python2.6/site-packages/gratia/common/connect_utils.py&#34;, line
275, in postRequest
responseString = myconnection.getresponse().read()
File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 990, in getresponse
response.begin()
File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 391, in begin
version, status, reason = self._read_status()
File &#34;/usr/lib64/python2.6/httplib.py&#34;, line 349, in _read_status
line = self.fp.readline()
File &#34;/usr/lib64/python2.6/socket.py&#34;, line 433, in readline
data = recv(1)
File
&#34;/usr/lib/python2.6/site-packages/gratia/common/connect_utils.py&#34;, line
63, in __handle_timeout__
raise GratiaTimeout(&#34;Connection to Collector lasted more than&#58;
&#34;+str(timeout)+&#34; second&#34;)
File
&#34;/usr/lib/python2.6/site-packages/gratia/common/connect_utils.py&#34;, line
54, in __init__
Exception.__init__()
TypeError&#58; descriptor &#39;__init__&#39; of &#39;exceptions.Exception&#39; object needs
an argument
----

That was around the time you had the collector problems, right?

Apparently we never recovered from that, since there haven&#39;t been any
successful uploads since, and we keep getting the other two errors above.

This &#39;[Errno 21] Is a directory&#58;&#39; happened before things started to go
bad, so that may not be a fatal error -- but shouldn&#39;t be there, either.

Does that help? Again, this is running
gratia-probe-condor-1.13.15-1.osg.el6.noarch. Is there a known issue
with that version, like that it contains some contact string that should
no longer be used?
I don&#39;t think we ever changed the default here ...

That still doesn&#39;t explain why this locking error occurs in the first
place, though. I think this cron job should be protected from itself,
such that it won&#39;t start while an older one is still running, right? Or
are we seeing some kind of non-standard case which by-passes this
protection somehow?

Thanks,

Horst
</div><script type='text/javascript'>
        $('#show_1240582527').click(function() {
            $('#detail_1240582527').slideDown("normal");
            $('#show_1240582527').hide();
            $('#hide_1240582527').show();
        });
        $('#hide_1240582527').click(function() {
            $('#detail_1240582527').slideUp();
            $('#hide_1240582527').hide();
            $('#show_1240582527').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='20828#1398200348'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-04-22T20:59:08+00:00">Apr 22, 2014 08:59 PM UTC</time> by <b>Horst Severini</b><a class="anchor" name="1398200348">&nbsp;</a></div><pre>Hi Elizabeth and Kyle,

<font color='#7F7E6F'>&#62; Elizabeth found this that might be of interest&#58;</font>
<font color='#7F7E6F'>&#62; <a href='https&#58;//jira.opensciencegrid.org/browse/GRATIA-91' target='_blank' rel='nofollow'>https&#58;//jira.opensciencegrid.org/browse/GRATIA-91</a></font>

Ah, thanks! I suppose it&#39;s possible that there are two instances of the
condor_meter stepping on each other; with
/etc/cron.d/gratia-probe-condor.cron being one -- but what&#39;s the second
one? That&#39;s not clear to me from reading through this JIRA ticket. I
always assumed this was the only instance ...

We&#39;re running gratia-probe-condor-1.13.15-1.osg.el6.noarch and
gratia-probe-condor-1.13.25-1.osg31.el6.noarch on these two clusters, by
the way, which is newer than the 1.13.6-1 the ticket was referring to.
But maybe that version fixed one of the other problems mentioned in there?

We haven&#39;t seen an error email for almost 45 minutes now, so that&#39;s a
good sign, since this runs every 15 minutes, right? But we still don&#39;t
understand where the conflict is coming from ...

Maybe John W. can elaborate on which &#39;other&#39; condor_meter invocation he
was talking about, so we can check that one, too?

Oh wait, we just got another email, and looking more closely, it seems
that the next cron job is stepping on the previous one, since the last
one is still running&#58;

----
root     24834  0.0  0.0   9228  1072 ?        Ss   15&#58;30   0&#58;00 /bin/sh
-c /usr/share/gratia/common/cron_check  /etc/gratia/condor/ProbeConfig
&& /usr/share/gratia/condor/condor_meter -s 900
root     24836  0.0  0.0 111008 13416 ?        S    15&#58;30   0&#58;00
/usr/bin/python /usr/share/gratia/condor/condor_meter -s 900
----

<div id='show_852652803' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_852652803'>And I got the email at 15&#58;46, so with the next invocation.

I thought these scripts are protected to wait for one cron instance to
finish before the next one can start? Maybe there&#39;s a subtle bug in this
protection logic which sometimes fails, and allows a second process to
start, which then understandably can&#39;t create a lock, since the old one
still has that?

So we&#39;re seeing these errors more frequently with
gratia-probe-condor-1.13.15-1.osg.el6.noarch, but we&#39;ve also gotten a
few with gratia-probe-condor-1.13.25-1.osg31.el6.noarch today. But the
latter is our ITB, so that&#39;s not seeing a lot of jobs, therefore it&#39;s
VERY unlikely that a gratia cron job would run for more than 15 minutes.

Please let me know where else I can look to figure out if there&#39;s indeed
a problem with the multiple instance protection somewhere ...

Thanks,

Horst

On 04/22/2014 03&#58;26 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_852652803').click(function() {
            $('#detail_852652803').slideDown("normal");
            $('#show_852652803').hide();
            $('#hide_852652803').show();
        });
        $('#hide_852652803').click(function() {
            $('#detail_852652803').slideUp();
            $('#hide_852652803').hide();
            $('#show_852652803').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='20828#1398198412'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-04-22T20:26:52+00:00">Apr 22, 2014 08:26 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1398198412">&nbsp;</a></div><pre>Horst,

Elizabeth found this that might be of interest&#58; <a href='https&#58;//jira.opensciencegrid.org/browse/GRATIA-91' target='_blank' rel='nofollow'>https&#58;//jira.opensciencegrid.org/browse/GRATIA-91</a>

-Kyle</pre></div><div class='update_description'><i onclick="document.location='20828#1398198352'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-04-22T20:25:52+00:00">Apr 22, 2014 08:25 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1398198352">&nbsp;</a></div><pre>Hi all,

since this morning, we&#39;ve seen several of these errors below at both OU_OCHEP_SWT2 and OUHEP_ITB. Are they related to the Gratia server issues we got these emails about today?

I&#39;ve seen these error emails before, every now and then, and they seem to go away again after a while -- or rather, we only get one or two of them at a time -- but today we&#39;ve seen quite a few of them, so I thought I&#39;d ask.

Let me know if I can help providing more info about this -- i.e., let me know what else you&#39;d like to know. &#58;)

Thanks a lot,

Horst

On 04/22/2014 12&#58;22 PM, Cron Daemon wrote&#58;
Traceback (most recent call last)&#58;
File &#34;/usr/share/gratia/condor/condor_meter&#34;, line 818, in &#60;module&#62;
main()
File &#34;/usr/share/gratia/condor/condor_meter&#34;, line 236, in main
GratiaWrapper.ExclusiveLock()
File &#34;/usr/lib/python2.6/site-packages/gratia/common/GratiaWrapper.py&#34;, line 141, in ExclusiveLock
raise Exception(&#34;Unable to acquire lock&#34;)
Exception&#58; Unable to acquire lock</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F20828">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 20828});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
