<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[9771] Resource specific issue at UColorado_HEP</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
    <script src='https://www.google.com/recaptcha/api.js'></script>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=9771" method="post">
<div class="page-header">
    <h3><span class="muted">9771</span> / Resource specific issue at UColorado_HEP</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Jeffrey Michael Dost</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Resource Name</label><div class="controls">UColorado_HEP</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/resource</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Jeffrey Michael Dost</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">Check for updates</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2011-02-21</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">OSG RA <span class="muted"> / OSG GOC Support Team</span></div><div class="assignee" style="width: 60%">USCMS_Tier3 <span class="muted"> / OSG Support Centers</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/9771", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
        <div class="btn-group">
                <a class="btn btn-small" href="https://ticket.opensciencegrid.org/9771?sort=up&amp;"><i class="icon-arrow-up"></i> Sort</a>

        
        <a class="btn btn-small" href="https://ticket.opensciencegrid.org/9771?expandall=true&amp;">Expand Descriptions</a>        <a class="btn btn-small" target="_blank" href="mailto:osg@tick.globalnoc.iu.edu?subject=Open%20Science%20Grid%3A%20Resource%20specific%20issue%20at%20UColorado_HEP%20ISSUE%3D9771%20PROJ%3D71"><i class="icon-envelope"></i> Update w/Email</a>
        </div>
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='9771#1297788249'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-02-15T16:44:09+00:00">Feb 15, 2011 04:44 PM UTC</time> by <b>doug johnson</b><a class="anchor" name="1297788249">&nbsp;</a></div><pre>Yes.

<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='9771#1297782683'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-02-15T15:11:23+00:00">Feb 15, 2011 03:11 PM UTC</time> by <b>OSG RA</b><a class="anchor" name="1297782683">&nbsp;</a></div><pre>Jeff,

May we close out this ticket?  It appears that the issue is being tracking in the VDT ticket.

Thanks,

-Alain Deximo</pre></div><div class='update_description'><i onclick="document.location='9771#1297190502'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-02-08T18:41:42+00:00">Feb 8, 2011 06:41 PM UTC</time><a class="anchor" name="1297190502">&nbsp;</a></div><pre>Hi Doug,

You can reply directly to the VDT support ticket I linked if you email vdt-support@.... and put&#58;
[vdt-support #8350] AutoReply&#58; gridmanager-sge problems

as the the subject line.  In the meantime i&#39;ll watch the behavior of the glideins at Colorado since you&#39;ve modified the script.

Thanks,
Jeff

-- by Jeffrey Michael Dost</pre></div><div class='update_description'><i onclick="document.location='9771#1297186869'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-02-08T17:41:09+00:00">Feb 8, 2011 05:41 PM UTC</time> by <b>doug johnson</b><a class="anchor" name="1297186869">&nbsp;</a></div><pre>Greetings,

I am not sure if the following fixes the issue, but as far as I can tell
in its current form sge.pm does not properly determine the current state
of an SGE job. In other words, I think there are problems with the
polling section of sge.pm. In sge.pm it even says&#58;

# FIXME&#58;
# Unfortunately, the nice single-character state field isn&#39;t printed
# if we do a lookup on a specific job with qstat, so we have to guess
# a little more that we would like.
# This is probably best fixed in SGE itself.

It is true that the multi-character (it is actually multi-character not
single-character) status field is difficult to get, but when one does&#58;

qstat | grep $job_id

the multi-character status will always be the 5th field regardless of
the job status, i.e.,

chomp(my $currentState = &#96;$qstat | /bin/grep $job_id | /usr/bin/awk &#39;{print &#92;$5}&#39;&#96;);

returns the multi-character status field. Which could be a little more
robust by using&#58;

chomp(my $currentState = &#96;$qstat | /bin/egrep &#39;^$job_id &#39; | /usr/bin/awk &#39;{print &#92;$5}&#39;&#96;);

So I think that a small modification to sge.pm can fix this problem
where one uses the above qstat command and not the last line of qstat -j
$job_id, which is less predictable. For example, the current method of
using the last line of qstat -j $job_id requires that the site have&#58;

schedd_job_info                   true

<div id='show_1714559004' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1714559004'>in the global configuration.

I have made modifications to the version of sge.pm that is currently
being used at Colorado and it seems to functioning. I don&#39;t know if this
will address the CMS GlideIn issue, so some CMS GlideIns should be sent
to Colorado to see if this helps the problem.

Below is a diff between the originally installed sge.pm and the modified
sge.pm. I am sure that there are faster ways to deduce the
multi-character status string, but I think this code will work.

Also the status value E does not necessarily mean that the job
failed. SGE jobs can be put into an error state for various reasons some
of which are recoverable by the local site by using&#58;

qmod -c $job_id

after which a job may run just fine.

NOTE&#58; Colorado runs a cron job every hour to clear SGE error states.

I imagine this information needs to be sent to the VDT team, but I&#39;m
not sure where to post it?

Thank you,
doug

833,854c833
&#60;         $self-&#62;log(&#34;   Polling status of $job_id using modified sge.pm&#34;);
&#60;         my %statusCodes = (&#34;q&#34;    =&#62; &#34;queue&#34;,
&#60; 			   &#34;d&#34;    =&#62; &#34;deletion&#34;,
&#60; 			   &#34;t&#34;    =&#62; &#34;transfering&#34;,
&#60; 			   &#34;r&#34;    =&#62; &#34;running&#34;,
&#60; 			   &#34;R&#34;    =&#62; &#34;Restarted&#34;,
&#60; 			   &#34;s&#34;    =&#62; &#34;suspended&#34;,
&#60; 			   &#34;S&#34;    =&#62; &#34;Suspended&#34;,
&#60; 			   &#34;T&#34;    =&#62; &#34;Threshold&#34;,
&#60; 			   &#34;w&#34;    =&#62; &#34;waiting&#34;,
&#60; 			   &#34;h&#34;    =&#62; &#34;hold&#34;,
&#60; 			   &#34;E&#34;    =&#62; &#34;Error&#34;);
&#60;
&#60; 	chomp(my $currentState = &#96;$qstat | /bin/grep $job_id | /usr/bin/awk &#39;{print &#92;$5}&#39;&#96;);
&#60; 	my $stateWords;
&#60; 	foreach my $key (keys %statusCodes) {
&#60; 	  $stateWords .= &#34;$statusCodes{$key} &#34; if $currentState =~ /$key/;
&#60; 	}
&#60;
&#60; #	$_ = pop @output; 	# Obtain scheduler details from output, if any.
&#60;
&#60; 	$_ = $stateWords;
---
<font color='#7F7E6F'>&#62; 	$_ = pop @output; 	# Obtain scheduler details from output, if any.</font>
867c846
&#60; 	elsif(/queue|pending/ && !(/queue instance/)) {
---
<font color='#7F7E6F'>&#62; 	elsif(/queue|pending/) {</font>
872c851
&#60; 	elsif(/hold|suspend|Suspend/) {
---
<font color='#7F7E6F'>&#62; 	elsif(/hold|suspend/) {</font>

<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_1714559004').click(function() {
            $('#detail_1714559004').slideDown("normal");
            $('#show_1714559004').hide();
            $('#hide_1714559004').show();
        });
        $('#hide_1714559004').click(function() {
            $('#detail_1714559004').slideUp();
            $('#hide_1714559004').hide();
            $('#show_1714559004').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='9771#1297175549'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-02-08T14:32:29+00:00">Feb 8, 2011 02:32 PM UTC</time> by <b>OSG RA</b><a class="anchor" name="1297175549">&nbsp;</a></div><pre>Doug,

Can we get an update status from you on your end?  Your assistance is greatly appreciated.

Thanks,

-Alain Deximo</pre></div><div class='update_description'><i onclick="document.location='9771#1295995381'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-01-25T22:43:01+00:00">Jan 25, 2011 10:43 PM UTC</time><a class="anchor" name="1295995381">&nbsp;</a></div><pre>Sorry,

If that URL doesn&#39;t work try this one&#58;

<a href='http&#58;//crt.cs.wisc.edu/Ticket/Display.html?user=guest&pass=guest&id=8350' target='_blank' rel='nofollow'>http&#58;//crt.cs.wisc.edu/Ticket/Display.html?user=guest&pass=guest&id=8350</a>

-- by Jeffrey Michael Dost</pre></div><div class='update_description'><i onclick="document.location='9771#1295990360'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-01-25T21:19:20+00:00">Jan 25, 2011 09:19 PM UTC</time><a class="anchor" name="1295990360">&nbsp;</a></div><pre>Hi Doug,

Here&#39;s an update on the problem.

We believe we have found a problem in how SGE sites communicate through GRAM.  It is not being reported back to the factory when glideins terminate.

Igor has opened a ticket with vdt-support that can be viewed here&#58;
<a href='http&#58;//crt.cs.wisc.edu/SelfService/Display.html?id=8350' target='_blank' rel='nofollow'>http&#58;//crt.cs.wisc.edu/SelfService/Display.html?id=8350</a>

-- by Jeffrey Michael Dost</pre></div><div class='update_description'><i onclick="document.location='9771#1295383797'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-01-18T20:49:57+00:00">Jan 18, 2011 08:49 PM UTC</time><a class="anchor" name="1295383797">&nbsp;</a></div><pre>Hi Doug,

We are also still at a loss as to what is going on.  That java error you posted is just a part of the glidein validation script.  On startup glideins run validation tests to see what kind of envrionment they land on, so don&#39;t worry about that error.

On our end, we observed a strange behavior where glideins kept getting held because of what looks like a problem in transferring output.

I saw hold messages like this&#58;
012 (160171.000.000) 01/18 10&#58;11&#58;26 Job was held.
Globus error 129&#58; the standard output/error size is different
Code 2 Subcode 129

It looks like the output / error sizes of the returned files on our end is different than what yours reports, so glideins keep restarting indefinitely&#58;
01/18/11 10&#58;15&#58;49 [14785] (161644.0) Requesting jobmanager restart because of GLOBUS_GRAM_PROTOCOL_ERROR_STDIO_SIZE
01/18/11 10&#58;15&#58;49 [14785] (161644.0) output_size = 4383, error_size = 51191

If these files still exist on your end and you want to see them this glidein is mapped to&#58;
GridJobId = &#34;gt2 heposg01.colorado.edu&#58;2119/jobmanager-sge <a href='https&#58;//heposg01.colorado.edu&#58;40923/25627/1295057629/&#34' target='_blank' rel='nofollow'>https&#58;//heposg01.colorado.edu&#58;40923/25627/1295057629/&#34</a>;

I just removed the glideins that got stuck in this cycle and will watch what happens and let you know if anything new comes up.  We also limited the max number of glideins running at colorado to 10 until we figure out what&#39;s going on to reduce the load we are putting on you.

Jeff

-- by Jeffrey Michael Dost</pre></div><div class='update_description'><i onclick="document.location='9771#1294691766'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-01-10T20:36:06+00:00">Jan 10, 2011 08:36 PM UTC</time> by <b>doug johnson</b><a class="anchor" name="1294691766">&nbsp;</a></div><pre>Greetings,

I am still trying to understand glideins at Colorado. I see a number of
glidein jobs arrive here, but they never seem to start a CMS job. The
only entry in StarterLog is&#58;

01/10/11 13&#58;24&#58;44 (pid&#58;21767) JavaDetect&#58; failure status 256 when executing /usr/bin/java -Xmx12002m -classpath /sge-batch/glide_C19411/main/condor/lib&#58;/sge-batch/glide_C19411/main/condor/lib/scimark2lib.jar&#58;. CondorJavaInfo old 2

Any help would be appreciated,
doug

<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='9771#1294366838'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-01-07T02:20:38+00:00">Jan 7, 2011 02:20 AM UTC</time><a class="anchor" name="1294366838">&nbsp;</a></div><pre>Hi Doug.

For the time being, you can monitor what we see from our end at
<a href='http&#58;//glidein-1.t2.ucsd.edu&#58;8319/glidefactory/monitor/glidein_Production_v3_1/factoryStatus.html?entry=CMS_T3_US_Colorado_hep01' target='_blank' rel='nofollow'>http&#58;//glidein-1.t2.ucsd.edu&#58;8319/glidefactory/monitor/glidein_Production_v3_1/factoryStatus.html?entry=CMS_T3_US_Colorado_hep01</a>
and
<a href='http&#58;//glidein-1.t2.ucsd.edu&#58;8319/glidefactory/monitor/glidein_Production_v3_1/factoryEntryStatusNow.html?entry=CMS_T3_US_Colorado_hep01' target='_blank' rel='nofollow'>http&#58;//glidein-1.t2.ucsd.edu&#58;8319/glidefactory/monitor/glidein_Production_v3_1/factoryEntryStatusNow.html?entry=CMS_T3_US_Colorado_hep01</a>

Hope this helps you at least a little.

Thanks,
Igor
for the OSG gfactory team

-- by Igor Sfiligoi</pre></div><div class='update_description'><i onclick="document.location='9771#1294365966'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-01-07T02:06:06+00:00">Jan 7, 2011 02:06 AM UTC</time> by <b>doug johnson</b><a class="anchor" name="1294365966">&nbsp;</a></div><pre>Greetings,

Sorry, but this is a rather long winded response. If you want to skip
the details, just go to the last paragraph.

I am not sure that I completely understand what went (and/or is going)
wrong, but this is what I do know&#58;

Yesterday morning we received between 4000-5000 jobs. As a result the
load level on the gatekeeper to hit over 400 at one point and stayed above
~200 for most of the day. Late in afternoon, things started to settle
down, but the load level on the machine where the grid home directories
are went up over 50 and stayed at around 16 all day. Both of these
machines are single processor, Quad cores with 8GB RAM. When I looked at
the CMS dashboard, I noticed that most of the jobs running at Colorado
were marked as DONE for the grid status, but many had UNKNOWN for the
application exit code. We are using the SGE batch scheduler and this
started to sound like a problem that has been reported by (or to) TTU
also an SGE site.

Then this morning some cleaning people in the building disconnected our
network. Again the gatekeeper load went very high to ~200. SGE has the
feature that if it is unable to open STDOUT and/or STDERR at run time,
it puts the job in an error state. After the network disconnect, there
were over 200 jobs in an error state. When I looked into why they were
in an error state it turned out the directories of form&#58;

~usmcsXXXX/.globus/job/heposg01.colorado.edu/26067.1294257283/

did not exist. I assume that these directories are made at grid submit
time and then are supposed to be cleaned up when the job finishes? One
important file that is stored in these directories is the grid proxy.  I
didn&#39;t see any way to &#34;rescue&#34; these jobs and thus chose to remove them
from the queue (qdel). There are currently more accumulating in the
queue (remember the error state is only thrown at SGE run time). Of the
<div id='show_1813090400' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1813090400'>~300 jobs queued, 100 are in an error state.

This morning, I have reconfigured the server with the grid user&#39;s home
directories. Yesterday when there were ~200 jobs running, the load level
on this machine sat at ~20. Now with ~200 jobs running, the average 1
minute load level is ~3 with only an occassional value about 6. In
additional, I no longer see NFS time outs on the clients.

What I suspect is that the gatekeeper never created the missing
directories/files. But if this is true, then I would have expected the
gatekeeper to throw an error and not submit the jobs to the queue. It
seems unlikely that something went haywire during the network outage
that resulted in the gatekeeper removing the directories/files. Also if
the time listed below is in GMT, then the error was logged before the
network problem.  Unfortunately, I don&#39;t know enough about the protocol
to understand this. I also suspect that the problems with getting the
output for the jobs is because I did qdel about 200 jobs and also
because of the issues with NFS access to the grid user&#39;s home
directories.

I suspect that the current NFS server (with the network configuration)
is sufficient to run 200-300 jobs, but will have problems scaling to a
much higher number. I believe that the gatekeeper is currently
underpowered. Last night I placed an order for replacements for both of
these machines. They should be installed early next week.

What I would like to know is can I modify the submission code (sge.pm)
such that the jobs cd to $TMP before they start executing

~uscmsXXXX/.globus/.gass_cache/local/md5/......./data

As far as I can tell, everything in the data script uses fully qualified
paths and it &#34;should&#34; be transparent to the jobs. Again, I simply don&#39;t
understand enough to know if this works or not.

In short, I&#39;m not sure if I have fixed the problem, but I am certainly
working on it. If there are ways for me to more easily monitor things on
the CMS side, I would be grateful to know how.

Thank you,
doug

<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_1813090400').click(function() {
            $('#detail_1813090400').slideDown("normal");
            $('#show_1813090400').hide();
            $('#hide_1813090400').show();
        });
        $('#hide_1813090400').click(function() {
            $('#detail_1813090400').slideUp();
            $('#hide_1813090400').hide();
            $('#show_1813090400').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='9771#1294353143'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2011-01-06T22:32:23+00:00">Jan 6, 2011 10:32 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1294353143">&nbsp;</a></div><pre>[by Jeffrey Michael Dost]

Hi,

We are seeing that not many glideins are registering user jobs at Colorado.  We are submitting as VO CMS with the following&#58;

gatekeeper=&#34;heposg01.colorado.edu&#58;2119/jobmanager-sge&#34;
gridtype=&#34;gt2&#34;
rsl=&#34;(queue=lnxfarm)(jobtype=single)&#34;

looking at our GridManager logs we see errors like this keep coming up&#58;
01/06/11 14&#58;14&#58;42 [25997] gramCallbackHandler&#58; Can&#39;t find record for globus job with contact <a href='https&#58;//heposg01.colorado.edu&#58;40938/32064/1294351172/' target='_blank' rel='nofollow'>https&#58;//heposg01.colorado.edu&#58;40938/32064/1294351172/</a> on globus state 4, errorcode 111, delaying
01/06/11 14&#58;14&#58;43 [25997] orphanCallbackHandler&#58; Can&#39;t find record for globus job with contact <a href='https&#58;//heposg01.colorado.edu&#58;40938/32064/1294351172/' target='_blank' rel='nofollow'>https&#58;//heposg01.colorado.edu&#58;40938/32064/1294351172/</a> on globus state 4, errorcode 111, ignoring

Looking up the codes,
globus state 4 = FAILED &#34;The job terminated before completion because an error, user-triggered cancel, or system-triggered cancel.&#34;
errorcode 111 = COMMIT_TIMED_OUT &#34;the job manager timed out while waiting for a commit signal&#34;

Not sure if it&#39;s related but a significant number of idle jobs on our end also have&#58;
GridJobStatus = undefined

Can you please investigate and let us know what might be happening?
Thanks,
Jeff Dost
OSG Glidein Factory Operations</pre></div><legend>Similar Recent Tickets <small>modified within the last 30 days</small></legend><div id="similar_tickets"><p class="muted">No similar tickets found.</p></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F9771">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script src="https://ticket1.grid.iu.edu:8443/socket.io/socket.io.js"></script>
<script>
var chat = io.connect('https://ticket1.grid.iu.edu:8443');
chat.on('connect', function() {
    chat.emit('authenticate', {nodekey:'', ticketid: 9771});
});
chat.on('peers', function(peers) {
    $("#peers").html("");
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('peer_disconnect', function(pid) {
    $("#peer_"+pid).hide("slow");
});
chat.on('peer_connected', function(peers) {
    //expect only 1 peer connecting, but..
    for(var pid in peers) {
        var peer = peers[pid];
        addPeer(pid, peer);
    }
});
chat.on('submit', function() {
    if(confirm("This ticket was updated. Do you want to refresh?")) {
        history.go(0);
    }
});

function addPeer(pid, peer) {
    var ipinfo = "";
    if(peer.ip != undefined) {
        ipinfo = "<span class=\"ip\">"+peer.ip+"</span>";
    }
    if(chat.io.engine.id == pid) {
        //don't display myself
        return;
    }
    var html = "<li class=\"new\" id=\"peer_"+pid+"\" class=\"peer\">"+peer.name+ipinfo+"</li>";
    $("#peers").prepend(html);
    $("#peers .new").animate({bottom: 0}, 1000, function() {$(this).removeClass("new")});
}

$(function() {
    $("#ticket_form").submit(function() {
        chat.emit('submit');
        return true;
    });
});
</script>
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-69012-13");
pageTracker._trackPageview();
} catch(err) {}
</script>

</body>
