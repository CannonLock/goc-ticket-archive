<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[25795] OSG site metric email missing data</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=25795" method="post">
<div class="page-header">
    <h3><span class="muted">25795</span> / OSG site metric email missing data</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">John Dockendorf</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">John Dockendorf</div></div><div class="control-group"><label class="control-label">Ticket Links</label><div class="controls"></div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2015-06-29</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">Scott Teige <span class="muted"> / OSG Operations Infrastructure</span></div><div class="assignee" style="width: 60%">Software Support (Triage) <span class="muted"> / OSG Software Team</span></div><div class="assignee" style="width: 60%">Carl Edquist <span class="muted"> / OSG Software Team</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/25795", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='25795#1435611012'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-29T20:50:12+00:00">Jun 29, 2015 08:50 PM UTC</time> by <b>Kyle Gross</b><a class="anchor" name="1435611012">&nbsp;</a></div><pre>Per Trey&#39;s update, I will close this ticket.

Thanks,
Kyle</pre></div><div class='update_description'><i onclick="document.location='25795#1435273661'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-25T23:07:41+00:00">Jun 25, 2015 11:07 PM UTC</time><a class="anchor" name="1435273661">&nbsp;</a></div><pre>Marco,

Thanks for the suggestion.  Right now the user who&#39;s in CMS is only running CDMS jobs.  The use of two accounts isn&#39;t possible as we map all users to their Texas A&M University username, so all usernames have to match the campus directory for password authentication purposes.  In theory we could map a non-campus username to masquerade as a campus username since the LDAP attribute that is passed to Kerberos is not the uid attribute, but that hasn&#39;t worked well in the past.  I think marking this resolved is fine, and if it becomes an issue then it can be dealt with at that time.

Thanks,
- Trey

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jdockend/CN=750323/CN=John Lloyd Iii Dockendorf</pre></div><div class='update_description'><i onclick="document.location='25795#1435273088'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-25T22:58:08+00:00">Jun 25, 2015 10:58 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1435273088">&nbsp;</a></div><pre>Hi Trey,
since the user does direct local submission for both VOs, the only alternative that I see for this user that is sometime CMS, sometime CDMS is to have 2 local accounts and use one for CMS (the one already mapped there) and the new one mapped to CDMS (you&#39;ll have to add the mapping in GUMS). The user will have to be diligent in using the appropriate account depending on the jobs.

Otherwise the user can use grid submission for CDMS jobs.

Doing and configuring the 2 accounts for the user is some work and the party involved may be OK as it is now. I think you can leave the inaccurate reporting and we can close this ticket. We can open a new ticket and you will take action if one of the 2 VOs complains.

Cheers,
Marco</pre></div><div class='update_description'><i onclick="document.location='25795#1435266050'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-25T21:00:50+00:00">Jun 25, 2015 09:00 PM UTC</time><a class="anchor" name="1435266050">&nbsp;</a></div><pre>Sorry for the delay.  Our local CMS users are using some local or maybe external patch to support submissions directly to SLURM via CRAB2.  So while they have a proxy during their job, the job itself never gets recorded on our CE.  The job only exists in the context of SLURM, and SLURM does not record information about which DN may have been used.

I found /var/lib/osg/user-vo-map is already populated on my CE, likely because gums-client-cron is enabled and my GUMS server downloads VO information, at least that&#39;s my guess.  So the CMS users who are running local jobs (direct to SLURM) are in that file with &#34;&#60;username&#62; cms&#34; on a line.

I think the only issue right now is inaccurate instead of non-existent accounting data.  The inaccurate nature I can&#39;t imagine can be resolved unless I can somehow override the VOMS server data and mark a user in GUMS as not belonging to the VO.

Thanks,
- Trey

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jdockend/CN=750323/CN=John Lloyd Iii Dockendorf</pre></div><div class='update_description'><i onclick="document.location='25795#1435261537'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-25T19:45:37+00:00">Jun 25, 2015 07:45 PM UTC</time> by <b>echism</b><a class="anchor" name="1435261537">&nbsp;</a></div><pre>Hello all,

What remains to be done on this? Trey, are you going to use GUMS to map those folks to a VO? Do we need more discussion on CRAB or was that sufficient?

Thanks</pre></div><div class='update_description'><i onclick="document.location='25795#1435010448'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-22T22:00:48+00:00">Jun 22, 2015 10:00 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1435010448">&nbsp;</a></div><pre>Trey,
if you have the users in GUMS but they are not mapped to a VO probably their jobs will not be counted for the VO.
The VOMS servers have associations between a DN and a VO, your users use no proxy to submit locally, GUMS cannot guess the association between a local user name and the VO.
You should be able to see that in the file /var/lib/osg/user-vo-map or by running &#34;/usr/bin/gums-host --gumsdebug generateOsgUserVoMap&#34; (you can omit the debug option).

The normal behavior of crab2 (unless some rare local modification has been made) is to submit jobs via the CMS infrastructure, these will run on your site or somewhere else (where firs find a free slot according to CMS scheduling and priorities).

Anyway if you map both users using DNs (out of the box w/ GUMS+VOMS) and local users (people that can run qsub - by adding them in GUMS and mapping them to a VO), then you are covered .
A caveat is that since local users use no certificate/proxy, if a user belongs to 2 VOs and submits locally for both (qsub to SLURM), he/she should have and use 2 accounts&#58; user_vo1 mapped to VO1 and user_vo2 mapped to VO2 to have a way to discriminate between the jobs for the 2 VOs.

Cheers,
Marco</pre></div><div class='update_description'><i onclick="document.location='25795#1435003342'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-22T20:02:22+00:00">Jun 22, 2015 08:02 PM UTC</time><a class="anchor" name="1435003342">&nbsp;</a></div><pre>Marco, thanks that clarifies what&#39;s happening.  The user running jobs for CDMS doesn&#39;t actually activate a proxy during her jobs.  I&#39;ve seen the job batch scripts that get submitted directly to SLURM, and they don&#39;t use proxies or any grid related mechanisms.  It&#39;s entirely local and have no interaction with our CE or grid certs.

Is there a way to verify my GUMS config is doing the &#34;correct&#34; thing when it comes to Gratia reporting?  The summary email I received today only showed 2 individuals that were not &#34;generic&#34; but we&#39;ve had many CMS users submitting grid jobs locally.  I want to be sure that somehow our GUMS server is not incorrectly doing things making everyone appear &#34;generic&#34;.  When we add users to GUMS we don&#39;t do any VO associations, though our GUMS server is configured to talk to the CMS VOMS server.

What may complicate our CMS jobs some is I don&#39;t think they are submitting to our CE.  Somehow they are submitting directly to SLURM via CRAB2.  I don&#39;t know the details of how this is done, but right now we have 100s of CMS jobs running and none are listed in condor_ce_q on our CE, they all likely submitted directly to SLURM.  Could this be why they all show up as &#34;generic&#34;?  The only individuals I see in the summary are people who I know run jobs that get routed through our CE&#39;s condor instance.

Thanks,
- Trey

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jdockend/CN=750323/CN=John Lloyd Iii Dockendorf</pre></div><div class='update_description'><i onclick="document.location='25795#1435000814'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-22T19:20:14+00:00">Jun 22, 2015 07:20 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1435000814">&nbsp;</a></div><pre>Hi Trey,
there is a missing piece ... the probe (actually a CE component coming form Gratia) saves in the Gratia data dir files that connect job ID and certificate DN. These are then used and consumed by the slurm probe. The DN if the certinfo file is present is used for the VO mapping, otherwise other mechanisms are used.

Since you have GUMS if people activate the right VO you will map them correctly.
If a user belonging to a VO is always submitting for another VO you can override her/his mapping in GUMS.
If a user belongs to 2 VOs and submits jobs for both but enables always one VO in the proxy no matter which jobs he/she is submitting, then you have no way to discriminate, tell the user to enable the correct VO/role in the proxy. Gratia now collects also project information that can be used to distinguish the jobs, but not all jobs report project information, so it&#39;s important to report the correct VO.
If the second VO does not exist and the jobs should be considered local to your site and unaccounted for the OSG VOs, then the user could use the proxy without VOMS attributes (no -voms .. option) and you should add in GUMS the mapping of the no VO DN to the local user you want to use to run the jobs. These jobs will run but not be accounted for any VO.

In your case CMS and CDMS (frtmilab/cdms) are both valid VOs and the user should belong to both (if not should register in the VOMS server or contact the VO admin) and be able to enable the proxy for either ones.

Cheers,
Marco

PS beside suppress and pass you have a 3rd option for transient or not understood problems&#58; quarantine. E.g. Instead of SuppressUnknownVORecords you can use QuarantineUnknownVORecords so records are not sent if the mapping does not work but are preserved in a quarantine directory so that you can troubleshoot and then re-process them once you fix the problem.</pre></div><div class='update_description'><i onclick="document.location='25795#1434997486'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-22T18:24:46+00:00">Jun 22, 2015 06:24 PM UTC</time><a class="anchor" name="1434997486">&nbsp;</a></div><pre>We use GUMS.  I guess where I fail to see how this would work (or be implemented on my end) is based on how the SLURM probe is collecting job data.  As far as I can tell the probe has no way to know what proxy was used, in the context of SLURM...but maybe there&#39;s a piece I&#39;m missing (like if the probe also queries job history on my CE).

For now I&#39;ve disabled local job suppression in gratia.  Already the email I received today for the weekly summary contained more data than I&#39;ve seen in weeks, but most of the CPU hours attributed to &#34;Generic cms user&#34; do not actually correspond to CMS jobs.  Most of the &#34;Generic cms user&#34; jobs are actually CDMS related jobs run locally by someone who is also a member of the CMS VO.  I&#39;m fine with our site looking like we produce more CMS CPU hours, but I&#39;m sure this is not desired by the community as a whole, and may become an issue if/when CDMS becomes a VO.

Thanks,
- Trey

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jdockend/CN=750323/CN=John Lloyd Iii Dockendorf</pre></div><div class='update_description'><i onclick="document.location='25795#1434755765'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-19T23:16:05+00:00">Jun 19, 2015 11:16 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1434755765">&nbsp;</a></div><pre>Hi Trey,
the mapping depends on what you use at your site (GUMS or Gridmap file).
With the 1st one the user can activate its proxy to specify if it&#39;s submitting jobs for a VO (CMS) or a different one (CDMS) or any VO the user belongs to. Until CDMS is a VO is difficult to exclude and not account for one use belonging to a VO
With the 2nd all the mapping is done using the user-vo mapfile that can be edited manually to associate any local user to any existing VO (see document linked).  If a local user is not in the file it is considered not to account for (i.e. the jobs are discarded from Gratia).
Cheers,
Marco</pre></div><div class='update_description'><i onclick="document.location='25795#1434754756'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-19T22:59:16+00:00">Jun 19, 2015 10:59 PM UTC</time><a class="anchor" name="1434754756">&nbsp;</a></div><pre>The issue, though not really a big problem, is that one of our users who uses lots of CPU hours is a member of the CMS VO but runs jobs primarily for the CDMS group.  This results in gratia reporting our site produces 1 million+ CPU hours a month for CMS when we produce far less than that.  It&#39;s unclear to me from that link if I can somehow tell Gratia to just ignore that one user, or somehow not associate her jobs to CMS.  This may become a bigger issue in the future if/when CDMS becomes a VO we officially support and we may have users in both CMS and CDMS that run jobs for both VOs.

Is there maybe some existing Gratia config value that would be something besides an &#34;all or nothing&#34; situation?  We also don&#39;t support GlideIns or jobs running as &#34;shared&#34; or non-human accounts, so all jobs map directly to a single person.

Thanks,
- Trey

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jdockend/CN=750323/CN=John Lloyd Iii Dockendorf</pre></div><div class='update_description'><i onclick="document.location='25795#1434744746'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-19T20:12:26+00:00">Jun 19, 2015 08:12 PM UTC</time> by <b>echism</b><a class="anchor" name="1434744746">&nbsp;</a></div><pre>Ah, thanks for the clarification!</pre></div><div class='update_description'><i onclick="document.location='25795#1434654558'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-18T19:09:18+00:00">Jun 18, 2015 07:09 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1434654558">&nbsp;</a></div><pre>Trey, Elizabeth,
all or nothing is easier to setup but you could report also only some users as long as you have a way to distinguish them.
About sending info only about some users, see&#58;
<a href='https&#58;//twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingGratiaVO#5_3_You_have_some_local_users_th' target='_blank' rel='nofollow'>https&#58;//twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingGratiaVO#5_3_You_have_some_local_users_th</a>

Cheers,
Marco</pre></div><div class='update_description'><i onclick="document.location='25795#1434557252'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-17T16:07:32+00:00">Jun 17, 2015 04:07 PM UTC</time> by <b>echism</b><a class="anchor" name="1434557252">&nbsp;</a></div><pre>Trey,

You can stop suppressing local records, but I understand it to be an all or nothing kind of deal, which doesn&#39;t fit your use case very well. Does anyone else have another idea? Tanya? Carl?

Thank you</pre></div><div class='update_description'><i onclick="document.location='25795#1434398098'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-15T19:54:58+00:00">Jun 15, 2015 07:54 PM UTC</time><a class="anchor" name="1434398098">&nbsp;</a></div><pre>So I&#39;m looking at the log files in /var/log/gratia and see the log files that correspond to each day contain summaries that show all records are being suppressed.  I looked in SLURM accounting via sacct and found a completed CMS job.  That record shows up in today&#39;s gratia log&#58;

12&#58;04&#58;21 CDT Gratia&#58; ERROR&#58; unable to find valid certinfo file for job 3419242
12&#58;04&#58;21 CDT Gratia&#58; Info&#58; suppressing record with GlobalJobId slurm&#58;db01.brazos.tamu.edu/3306/slurmdbd/brazos.3419242 due to Grid == Local
12&#58;04&#58;21 CDT Gratia&#58; OK&#58; No unsuppressed usage records in this packet&#58; not sending

The jobs being run at our site for CMS are local submissions via CRAB2, in some cases the submissions are being made directly to SLURM (not condor).

- Trey

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jdockend/CN=750323/CN=John Lloyd Iii Dockendorf</pre></div><div class='update_description'><i onclick="document.location='25795#1434392701'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-15T18:25:01+00:00">Jun 15, 2015 06:25 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1434392701">&nbsp;</a></div><pre>Hi,

The probe ONLY sending hearbeats. Last time you have reported records was on 2015-05-21.
Tanya</pre></div><div class='update_description'><i onclick="document.location='25795#1434392235'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-15T18:17:15+00:00">Jun 15, 2015 06:17 PM UTC</time><a class="anchor" name="1434392235">&nbsp;</a></div><pre>The message about the lock file occurred when the probe was running, and the &#34;ps&#34; output showed it had been running for around 70 minutes.  Currently that issue has passed and there is no lock file present in /var/log/gratia.

Have we uploaded any data newer than 2015-05-21?  My fear is that the SuppressGridLocalRecords=&#34;1&#34; in ProbeConfig is somehow causing legitimate CMS jobs to not be attributed to the correct VO and then ignored by gratia.  I am unsure how to validate this.  Right now there are 100s of CMS jobs running and many have completed since last week.

Thanks,
- Trey

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jdockend/CN=750323/CN=John Lloyd Iii Dockendorf</pre></div><div class='update_description'><i onclick="document.location='25795#1434155053'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-13T00:24:13+00:00">Jun 13, 2015 12:24 AM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1434155053">&nbsp;</a></div><pre>Trey,
the error below happened because for some reason the probe crashed or was killed and the lock file remained behind.
I doubt the probe is actually running now.
In fact the last record I see in the Gratia DB from you (slurm&#58;ce01.brazos.tamu.edu) is dated 2015-05-21 03&#58;40&#58;18

You should manually delete the file and the probe should restart&#58;
rm /var/lock/gratia/slurm&#58;ce01.brazos.tamu.edu

Probably it accumulated several records/files.
It may take some time to catch up, just let it run.
You can start it manually by using the line in the cron.d or just wait for it to start when it is time.

Cheers,
Marco</pre></div><div class='update_description'><i onclick="document.location='25795#1434153190'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-12T23:53:10+00:00">Jun 12, 2015 11:53 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1434153190">&nbsp;</a></div><pre>Ah I see.

Marco, are you familiar with how to check whether job records are being uploaded by the gratia probes?  (See Trey&#39;s comment below)

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='25795#1434147831'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-12T22:23:51+00:00">Jun 12, 2015 10:23 PM UTC</time><a class="anchor" name="1434147831">&nbsp;</a></div><pre>I&#39;m not getting errors from cron that gratia slurm probe is failing.  The only errors I&#39;m getting [1] are because the probe is taking a very long time to complete (over an hour).   Is there a way for me to see if the correct job records are being uploaded?  I see numerous CMS jobs running at the moment (and likely many have completed in last 24 hours) but the gratia accounting page in MyOSG (<a href='http&#58;//tinyurl.com/qxoahnq' target='_blank' rel='nofollow'>http&#58;//tinyurl.com/qxoahnq</a>) is returning nothing.

[1]&#58;
Traceback (most recent call last)&#58;
File &#34;/usr/share/gratia/slurm/slurm_meter&#34;, line 234, in &#60;module&#62;
SlurmMeter().main()
File &#34;/usr/share/gratia/slurm/SlurmProbe.py&#34;, line 64, in __init__
GratiaWrapper.ExclusiveLock()
File &#34;/usr/lib/python2.6/site-packages/gratia/common/GratiaWrapper.py&#34;, line 143, in ExclusiveLock
raise Exception(&#34;Unable to acquire lock (%s)&#34; % lock_location)
Exception&#58; Unable to acquire lock (/var/lock/gratia/slurm&#58;ce01.brazos.tamu.edu)

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jdockend/CN=750323/CN=John Lloyd Iii Dockendorf</pre></div><div class='update_description'><i onclick="document.location='25795#1434138824'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-12T19:53:44+00:00">Jun 12, 2015 07:53 PM UTC</time><a class="anchor" name="1434138824">&nbsp;</a></div><pre>I&#39;ve updated the installed gratia probes to 1.14.2-6 and will see if I get any more emails from cron.

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jdockend/CN=750323/CN=John Lloyd Iii Dockendorf</pre></div><div class='update_description'><i onclick="document.location='25795#1434068035'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-12T00:13:55+00:00">Jun 12, 2015 12:13 AM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1434068035">&nbsp;</a></div><pre>Hi Trey,

Sorry it looks like we introduced a bug in this week&#39;s slurm probe update ... see <a href='25834.html' target='_blank' rel='nofollow'>https&#58;//ticket.opensciencegrid.org/25834</a>

I&#39;m building a new version (gratia-probe-1.14.2-6), which should be available from osg-development shortly...

Carl</pre></div><div class='update_description'><i onclick="document.location='25795#1434055697'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-11T20:48:17+00:00">Jun 11, 2015 08:48 PM UTC</time> by <b>Carl Edquist</b><a class="anchor" name="1434055697">&nbsp;</a></div><pre>Hi Trey,

For <a href='24516.html' target='_blank' rel='nofollow'>https&#58;//ticket.opensciencegrid.org/24516</a> (the slurm probe issue with mariadb 5.5), I included a fix for this in the latest gratia-probe release, part of <a href='https&#58;//jira.opensciencegrid.org/browse/SOFTWARE-1882' target='_blank' rel='nofollow'>https&#58;//jira.opensciencegrid.org/browse/SOFTWARE-1882</a> ... This was actually released this week Tuesday.  If you are able to update to the latest version of the gratia probes (1.14.2-4), I&#39;d be interested in hearing if the errors go away.

Thanks,
Carl</pre></div><div class='update_description'><i onclick="document.location='25795#1434051600'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-11T19:40:00+00:00">Jun 11, 2015 07:40 PM UTC</time> by <b>echism</b><a class="anchor" name="1434051600">&nbsp;</a></div><pre>Software team,

Can you bring me up to speed on the SLURM probe?

Thank you</pre></div><div class='update_description'><i onclick="document.location='25795#1433781355'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-08T16:35:55+00:00">Jun 8, 2015 04:35 PM UTC</time> by <b>echism</b><a class="anchor" name="1433781355">&nbsp;</a></div><pre>Software,

Please look into this probe. Also adding Scott for reporting and Tanya for gratia expertise.

Thank you</pre></div><div class='update_description'><i onclick="document.location='25795#1433778801'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2015-06-08T15:53:21+00:00">Jun 8, 2015 03:53 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1433778801">&nbsp;</a></div><pre>The email I received with subject &#34;OSG site metrics report for TAMU_BRAZOS_CE for weeks 2015-06-01 to 2015-06-07&#34; contained no usage.  The last few emails I&#39;ve received have only contained metrics for SAM tests and CATS tests run on the cluster for CMS monitoring jobs.  The actual CMS jobs on the cluster seem to have become unreported.

This may relate to ticket <a href='24516.html' target='_blank' rel='nofollow'>https&#58;//ticket.opensciencegrid.org/24516</a> which may need to be re-opened as the SLURM probe is constantly throwing errors when trying to execute the SQL queries against the accounting database.

Attached my /etc/gratia/slurm/ProbeConfig.

It&#39;s worth noting that I believe most of the CMS jobs being run via CRAB will submit directly to SLURM and not to condor on our CE.  Some of the local users submit using CRAB to condor on the CE and none of those jobs seem to be accounted for in these emails too.

Some time ago a ticket of mine resulted in SuppressGridLocalRecords=1.  That ticket is <a href='23811.html' target='_blank' rel='nofollow'>https&#58;//ticket.opensciencegrid.org/23811.</a>  The issue in that case was that jobs run for a different VO by a user with a CMS membership were being attributed to CMS.

Thanks,
- Trey

by /DC=ch/DC=cern/OU=Organic Units/OU=Users/CN=jdockend/CN=750323/CN=John Lloyd Iii Dockendorf</pre></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F25795">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

});
</script>


</body>
