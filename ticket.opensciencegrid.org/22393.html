<!DOCTYPE html>
<html lang="en">
  <head>
  <base href="">
    <title>[22393] OSG users are mapped to atlas vo</title>    <meta charset="utf-8" />
    <meta name="verify-v1" content="na5IcAJsZVOfEkboRxuIiZ1zpZgnZiWra+nKcS7nA/o=" />
    <meta name="google-site-verification" content="DLrk3ft4s8b-S2TloLCL2LD_t6wcTjgSluf5pmiu2kA" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <link href="https://ticket.opensciencegrid.org/rss" rel="alternate" type="application/rss+xml" title="GOC Ticket Update feed" />

    <style type="text/css">
      body {
        padding-top: 50px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
     #search {
            width: 300px;
     }

    </style>

<script src="https://code.jquery.com/jquery-3.0.0.js"></script>
<script src="https://code.jquery.com/jquery-migrate-3.0.1.js"></script>

   <link href="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <link href="https://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.min.css" rel="stylesheet"/>
 <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>


    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.0-rc.2/js/select2.min.js"></script>

    <link href="css/ticket.css" rel="stylesheet" />
    <script src="lib/jquery.cookie.js"></script>

    <link href="images/tag_orange.png" rel="icon" type="image/png"/>
  </head>

  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <a class="brand" style="padding: 6px 0px 0px 6px;" href="http://opensciencegrid.org"><img src="images/osglogo.40x30.png"/></a>
            <ul class="nav">
                <li class="dropdown"><a href="https://ticket.opensciencegrid.org/#" class="dropdown-toggle" data-toggle="dropdown">GOC Ticket <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    <li><a href="https://my.opensciencegrid.org">MyOSG</a></li>
                    <li><a href="https://oim.opensciencegrid.org">OIM</a></li>
                    <li class="active"><a href="https://ticket.opensciencegrid.org/index">Ticket</a></li>
	<li class="divider"></li>
	<li><a href="http://repo.grid.iu.edu">Repo</a></li>
	<li class="divider"></li>
	<li><a href="http://blogs.grid.iu.edu">Blog</a></li>
                    <li><a href="http://display.grid.iu.edu">Display</a></li>
                    <li><a href="http://osggoc.blogspot.com/">News</a></li>
                    </ul>
                </li>
            </ul>
            <ul class="nav pull-right">
                <li><a href="https://ticket.opensciencegrid.org/sso/">Login</a></li>            </ul>

            <div class="nav-collapse">
                <ul class="nav">
			 <li id="menu_submit"><a href="https://ticket.opensciencegrid.org/submit">Submit</a></li><li id="menu_view" class="dropdown"><a href="https://ticket.opensciencegrid.org/\#" class="dropdown-toggle" data-toggle="dropdown">View <b class="caret"></b></a><ul class="dropdown-menu"><li id="submenu_listopen"><a href="https://ticket.opensciencegrid.org/list/open">Open Tickets</a></li><li id="submenu_listrecentclose"><a href="https://ticket.opensciencegrid.org/list/recentclose">Recently Closed Tickets</a></li><li class="divider"></li><li id="submenu_alltickets"><a href="https://ticket.opensciencegrid.org/search?q=&amp;sort=id">All Tickets</a></li></ul></li>                </ul>

                <form class="navbar-search pull-right" action="https://ticket.opensciencegrid.org/viewer">
                    <input id="search" type="text" name="id" class="search-query span2" placeholder="Search Ticket" value=""/>
                </form>
            </div>
        </div>
      </div>
    </div>

<script type='text/javascript' src='lib/jquery.timeago.js'></script>
<script type='text/javascript' src='lib/byte2size.js'></script>
<style>
#updates .toolbar {
position: relative;
margin-top: 0px;
top: -10px;
font-weight: normal;
}
#updates a.anchor {
position: relative;
top: -50px;
}
#updates .selected pre {
animation:selected 2s;
animation-iteration-count: 2;
animation-direction: alternate;
-webkit-animation:selected 2s; 
-webkit-animation-iteration-count: 2;
-webkit-animation-direction: alternate;
box-shadow: inset 1px 1px 20px #9ad;
border: 1px solid #9ab;
margin: 5px 0px;
padding-left: 10px;
}
@keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ab;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
@-webkit-keyframes selected {
    from  {
        box-shadow: inset 1px 1px 20px #9ad;
        border: 1px solid #9ad;
    }
    to {
        box-shadow: inset 1px 1px 20px #05c;
        border: 1px solid #05c;
    }
}
#updates pre {
background-color: inherit;
line-height: 15px;
padding: 5px;
}
#updates .header {
color: #999;
}
#updates .update_history pre {
background-color: #eee;
color: #666;
font-size: 85%;
}
#updates .clickable {
cursor: pointer;
}
#updates .clickable:hover {
color: #D98719;
}
#updates .meta_information pre {
background-color: #fed;
}
#similar_tickets {
max-height: 300px;
overflow-y: auto;
pointer-events: none;
padding: 5px;
background-color: #f4f4f4;
}
.btn-toolbar {
margin-bottom: 0;
height: 30px;
}
#peers {
position: fixed;
bottom: 0px;
right: 0px;
z-index: 100;
list-style: none;
padding: 5px 0px 0px 5px;
margin: 0px;
background-color: white;
box-shadow: 0px 0px 10px white;
}
#peers li {
background-color: #ccc;
color: #000;
display: inline-block;
padding: 5px 10px;
margin-right: 5px;
position: relative;
}
/*
#peers li:hover {
background-color: #999;
cursor: pointer;
}
*/
#peers span.ip {
padding-left: 5px;
color: #666;
}
#peers .new {
bottom: -30px;
}
/*
#peers .me {
background-color: red;
}
*/
</style>

<div class="container-fluid">
<ul id="peers"></ul>
<div class="alert alert-danger"><a class="close" href="https://ticket.opensciencegrid.org/#" data-dismiss="alert">&times;</a>By the end of May 2018, the ticketing system at https://ticket.opensciencegrid.org will be retired and support will be provided at https://support.opensciencegrid.org. Throughout this transition the support email (help@opensciencegrid.org) will be available as a point of contact.<br><br>                                                   
                                                                                                                                                                                   
Please see the service migration page for details: https://opensciencegrid.github.io/technology/policy/service-migrations-spring-2018/#ticket</div><div id="presence" class="pull-right"></div><div class="ticketgui"><script type="text/javascript" src="lib/checktab.js"></script>

<script>
var expanded = false;
function expand_description() {
    var desc = $(".description");
    if(!expanded) {
        expanded = true;
        //expand to minheight
        var min = 250;
        if(desc.height() < min) {
            desc.animate({height: min}, 200);
        }
    }
}

$(document).ready(function() {
    $("input[name='nad']").datepicker({
        dateFormat: 'yy-mm-dd'
    });
});

</script>



<style>
.form-horizontal .control-label {
padding-top: inherit;
font-size:90%;
color:#666;
}
label {
margin-bottom: 0px;
}
.controls {
line-height: 18px;
}
</style>
<form class="form-horizontal" action="https://ticket.opensciencegrid.org/viewer/updatebasic?id=22393" method="post">
<div class="page-header">
    <h3><span class="muted">22393</span> / OSG users are mapped to atlas vo</h3>
</div>

<div class="row-fluid">
<div class="span5">
    <legend>Contact</legend>
    <div class="control-group">
        <label class="control-label">Full Name</label>
        <div class="controls">Tanya Levshina</div>
    </div>
    <div class="control-group">
        <label class="control-label">Email</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">Phone</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>
    <div class="control-group">
        <label class="control-label">CC</label>
        <div class="controls">
            <i class="icon-lock"></i>        </div>
    </div>

    <legend>Details</legend>
    <div class="control-group"><label class="control-label">Resource Name</label><div class="controls">MWT2_CE_UC</div></div><div class="control-group"><label class="control-label">Associated VO</label><div class="controls">OSG</div></div><div class="control-group"><label class="control-label">Submitted Via</label><div class="controls">GOC Ticket/submit</div></div><div class="control-group"><label class="control-label">Submitter</label><div class="controls">Tanya Levshina</div></div><div class="control-group"><label class="control-label">Support Center</label><div class="controls">CSC</div></div>
    <div class="control-group">
        <label class="control-label">Ticket Type</label>
        <div class="controls">Problem/Request</div>
    </div>
    <div class="control-group">
        <label class="control-label">Priority</label>
        <div class="controls">Normal</div>
    </div>
    <div class="control-group">
        <label class="control-label">Status</label>
        <div class="controls">
Closed</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action</label>
        <div class="controls">ENG Action</div>
    </div>
    <div class="control-group">
        <label class="control-label">Next Action Deadline</label>
        <div class="controls flag_red">2014-09-19</div>
    </div>

</div><!--span-->
<div class="span7">
    <legend>Assignees</legend>
    <div class="assignee" style="width: 60%">CSC <span class="muted"> / OSG Support Centers</span></div><div class="assignee" style="width: 60%">USATLAS (BNL Prod)&nbsp;<a target="_blank" href="https://rt.racf.bnl.gov/rt/Ticket/Display.html?id=24774">24774</a> <span class="muted"> / Ticket Exchange</span></div>    <br>

    <legend>Assignees</legend>
    TODO
    <br>

    <style>
legend.noborder {
border-bottom: none;
}
</style>

<div id="attachment-list"/>
<script>
$(function () {
    var first = true;
    $.getJSON("attachment/list/22393", function (files) {
        //console.dir(files);
        var html = "<table class=\"table table-condensed\">";
        $(files).each(function() {
            if(first) {
                first = false;
                html += "<legend class=\"noborder\">Attachmenets</legend>";
            }
            html += "<tr class=\"attachment\">";
            html += "<td><img src=\""+this.thumbnail_url+"\"/></td>";
            html += "<td><a href=\""+this.url+"\" target=\"_blank\">"+this.name+"</a></td>";
            html += "<td>"+bytesToSize(this.size, 1)+"</td>";
            html += "</tr>";
        });
        html += "</table>";
        $("#attachment-list").html(html);
    });
});

function download(url) {
    window.open(url, "_blank");
}
</script>


</div><!--span-->
</div><!--row-fluid-->


</form>

</div>
<div id="updates" style="clear: both;">
    <legend>Past Updates
    <div class="btn-toolbar pull-right toolbar">
    </div><!--btn-toolbar-->
    </legend>

    <div class='update_description'><i onclick="document.location='22393#1411068292'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-18T19:24:52+00:00">Sep 18, 2014 07:24 PM UTC</time> by <b>echism</b><a class="anchor" name="1411068292">&nbsp;</a></div><pre>Thank you, Marco.</pre></div><div class='update_description'><i onclick="document.location='22393#1410986391'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-17T20:39:51+00:00">Sep 17, 2014 08:39 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1410986391">&nbsp;</a></div><pre>Corrections have been applied.
The ticket can be closed</pre></div><div class='update_description'><i onclick="document.location='22393#1410969896'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-17T16:04:56+00:00">Sep 17, 2014 04:04 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1410969896">&nbsp;</a></div><pre>I opened SNOW ticket for Gratia operations to make the changes&#58;
<a href='https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=b9ec5d946f97214032544d1fde3ee44b' target='_blank' rel='nofollow'>https&#58;//fermi.service-now.com/nav_to.do?uri=incident.do?sys_id=b9ec5d946f97214032544d1fde3ee44b</a></pre></div><div class='update_description'><i onclick="document.location='22393#1410960353'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-17T13:25:53+00:00">Sep 17, 2014 01:25 PM UTC</time><a class="anchor" name="1410960353">&nbsp;</a></div><pre>Marco,
I have uploaded the files for the 4 VOs.
Can you created the SNOW ticket and attach it to this goc ticket?
I do not have permissions to do this in SNOW.
Per Tanya, this should be assigned to Kevin Hill.
Thanks
John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22393#1410889456'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-16T17:44:16+00:00">Sep 16, 2014 05:44 PM UTC</time> by <b>ddl@....</b><a class="anchor" name="1410889456">&nbsp;</a></div><pre>John,

The changes all look correct to me.

Thanks for fixing these errors.

dave

On 9/16/2014 11&#58;40 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22393#1410885618'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-16T16:40:18+00:00">Sep 16, 2014 04:40 PM UTC</time><a class="anchor" name="1410885618">&nbsp;</a></div><pre>Dave,

Would like your concurrence on these changes that you can view here...
<a href='http&#58;//home.fnal.gov/' target='_blank' rel='nofollow'>http&#58;//home.fnal.gov/</a>~weigand/MWT2/
These are for the 4 VOs which would change all of these showing atlas to the correct one.
Once you concur, I will upload this to the ticket and have gratia-operations effect the changes.

John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22393#1410809656'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-15T19:34:16+00:00">Sep 15, 2014 07:34 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1410809656">&nbsp;</a></div><pre>Hi Elizabeth, I sent a message on the other 2 asking to close them and refer to this one. Thank you, Marco</pre></div><div class='update_description'><i onclick="document.location='22393#1410806907'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-15T18:48:27+00:00">Sep 15, 2014 06:48 PM UTC</time> by <b>echism</b><a class="anchor" name="1410806907">&nbsp;</a></div><pre>Hello everyone,

There are three tickets all open for bits and pieces of MWT2 it seems. Can we parse them all out in this ticket? The other tickets are <a href='https&#58;//ticket.grid.iu.edu/22391' target='_blank' rel='nofollow'>https&#58;//ticket.grid.iu.edu/22391</a> and <a href='https&#58;//ticket.grid.iu.edu/22392' target='_blank' rel='nofollow'>https&#58;//ticket.grid.iu.edu/22392</a> and I&#39;d like to close them.

Thank you</pre></div><div class='update_description'><i onclick="document.location='22393#1410805877'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-15T18:31:17+00:00">Sep 15, 2014 06:31 PM UTC</time> by <b>ddl@....</b><a class="anchor" name="1410805877">&nbsp;</a></div><pre>Marco,

That is strange on the LSST records.

It appears that pre 1.13.30-3 gratia had inconsistent handling of the VOOverride.

As for rccf-gk reporting all jobs as &#34;connect&#34; pre 8/6.

That was intentional at the time while rccf-gk was being setup, configured and tested.
Since all jobs run via rccf-gk are Atlas Panda jobs run at oppportunstic sites,
it was decided on 8/6 to change the reporting to &#34;atlas&#34;.

If the pre 8/6 data could also be converted to &#34;atlas&#34;, that would be a nice bonus for us.

thanks, dave

On 9/15/2014 12&#58;17 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22393#1410801430'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-15T17:17:10+00:00">Sep 15, 2014 05:17 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1410801430">&nbsp;</a></div><pre>Some other strange behavior looking at more data from MWT2 with John.
Is about LSST records&#58;
- they reported correctly until 8/20
- they started to be accounted as ATLAS on 8/29
- there is no record in-between the 2 dates

Connect records, reported by rccf-gk.mwt2.org changed to ATLAS on 8/6  and are still reported as ATLAS records.
Is that something desired?
Will you update RCC (rccf-gk...) to report back as Connect?

Thank you,
Marco</pre></div><div class='update_description'><i onclick="document.location='22393#1410798138'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-15T16:22:18+00:00">Sep 15, 2014 04:22 PM UTC</time> by <b>ddl@....</b><a class="anchor" name="1410798138">&nbsp;</a></div><pre>Marco

I cannot account for the May dates. I looked in the yum logs
and other notes and do not see any changes in May on either
uct2-gk or osg-gk (other than some downtime)

dave

On 9/15/2014 10&#58;37 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22393#1410795430'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-15T15:37:10+00:00">Sep 15, 2014 03:37 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1410795430">&nbsp;</a></div><pre>Dave,
I checked the Gratia DB and now you are reporting correctly.
I opened a Jira ticket with OSG software proposing to add local-users-vo-mapfile to the GUMS cron. I think in GUMS you can add manual mapping for local users (Manual User Group Members - will update the document) but a local-users-vo-map is definitely easier.

Records I think can be corrected.
All records that have the pilot DN (&#39;%osg-flock.grid.iu.edu&#39;) can be moved to the osg VO even if they are currently assigned to atlas.

These records stopped on 9/13 and started appearing on the following dates&#58;
7/22/2014  iut2-gk.mwt2.org
7/22/2014  mwt2-gk.campuscluster.illinois.edu
5/22/2014  osg-gk.mwt2.org
5/19/2014  uct2-gk.mwt2.org

I&#39;m investigating why VOOverride was not working.
Previously we thought it was the gratia probe update on 7/22. Can you check if the rpobe was updated in may on the other 2 hosts? or what happened on 5/19 and 5/22?

Thank you,
Marco</pre></div><div class='update_description'><i onclick="document.location='22393#1410623530'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-13T15:52:10+00:00">Sep 13, 2014 03:52 PM UTC</time> by <b>ddl@....</b><a class="anchor" name="1410623530">&nbsp;</a></div><pre>Using Marco&#39;s writeup and other ideas presented in email and a few ideas of my own,
I believe I now have MWT2 properly reporting all gratia records to OSG.

I have done the following on our four gatekeepers

Removed the configuration changes for &#34;unknown&#34; mappings from /etc/gratia/condor/ProbeConfig

MapUnknownToGroup=&#34;1&#34;
MapGroupToRole=&#34;1&#34;
VOOverride=&#34;atlas&#34;

This should have stopped the mapping of all non-Atlas VO records into &#34;atlas&#34;
which has been happening since July 22 when gratia 1.13.30-3 was installed.
This version changed the behavior of gratia when using the above configuration additions,
thus creating all the confusion and misreporting.

Could someone please verify that &#34;osg&#34;, &#34;glow&#34;, etc are now being reported properly for
MWT2, MWT2_CE_UC, MWT2_CE_IU and MWT2_CE_UIUC?

Using Marcos writeup I then added the local accounts, which are generating
gratia records without an assigned VO or DN to the user-vo-map file,
to the file /etc/osg/local-user-vo-map

ruc.uchicago    atlas
ruc.indiana     atlas
ruc.uiuc        atlas
ruc.mwt2        atlas
ruc.utexas      atlas

Unfortunately it appears that this local file is only supported if using edg-gridmap.
Since we are a GUMS site, these local additions were not being added to the user-vo-map.

I needed to modify /usr/bin/gums-host-cron to support a local-user-vo-map

[root@osg-gk ~]# diff /usr/bin/gums-host-cron /usr/bin/gums-host-cron.20140913
<div id='show_1622398260' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1622398260'>308,315d307
&#60;   # --- Add local user accounts maps
&#60;   if [ ! -e $LOCALUSERMAP ]; then
&#60;     touch $LOCALUSERMAP
&#60;   fi
&#60;
&#60;   cat $LOCALUSERMAP &#62;&#62; $INVERSEMAP_NEW.tmp
&#60;
&#60;
336,337d327
&#60; LOCALUSERMAP=$OSG_LOCATION/local-user-vo-map
&#60;

This patch looks for the local-user-vo-map file in /var/lib/osg/local-user-vo-map
where all the other GUMS files are located.

With this change, the local additions are appended to the user-vo-map file,
condor_meter then appears to handle and report the gratia records properly for
those users listed in the local-user-vo-map file (ie the records are not placed in quarantine)

Could someone can verify that MWT2 is now reporting all records to gratia properly
on all four gatekeepers.

Can someone also patch the data/reports on OSG for those mislabeled records from &#34;osg&#34;, etc,
which started on July 22?

thanks, dave

On 9/12/2014 5&#58;54 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font>
</div><script type='text/javascript'>
        $('#show_1622398260').click(function() {
            $('#detail_1622398260').slideDown("normal");
            $('#show_1622398260').hide();
            $('#hide_1622398260').show();
        });
        $('#hide_1622398260').click(function() {
            $('#detail_1622398260').slideUp();
            $('#hide_1622398260').hide();
            $('#show_1622398260').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='22393#1410562455'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-12T22:54:15+00:00">Sep 12, 2014 10:54 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1410562455">&nbsp;</a></div><pre>Dave and I had some follow-up via email.

I confirm that the current configuration maps all users to the VOOverride value, even if they come with an initial different value.
This is the desired behavior. I don&#39;t know why before was behaving differently and will investigate that.

I wrote a document explaining the mapping of jobs to VO.
<a href='https&#58;//twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingGratiaVO' target='_blank' rel='nofollow'>https&#58;//twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingGratiaVO</a>

The correct solution for MWT2 is to map the local users via user-vo-map file, allowing the regular mapping for grid jobs.
This is explained in sec 5.3 (<a href='https&#58;//twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingGratiaVO#5_3_You_some_local_users_that_yo' target='_blank' rel='nofollow'>https&#58;//twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingGratiaVO#5_3_You_some_local_users_that_yo</a>)

Please read also the note in sec 5 (<a href='https&#58;//twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingGratiaVO#5_Some_useful_procedures_and_exa' target='_blank' rel='nofollow'>https&#58;//twiki.grid.iu.edu/bin/view/Documentation/Release3/TroubleshootingGratiaVO#5_Some_useful_procedures_and_exa</a>) because it may be more appropriate to map those jobs in a different place. e.g. the BOSCO server

Cheers,
Marco</pre></div><div class='update_description'><i onclick="document.location='22393#1410457150'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-11T17:39:10+00:00">Sep 11, 2014 05:39 PM UTC</time> by <b>ddl@....</b><a class="anchor" name="1410457150">&nbsp;</a></div><pre>Marco,

This reason is the map the records for any jobs not submitted to the Tier2 via the gatekeeper.
IE jobs flocked in from Tier3.

These jobs do not have any VO associated with them, but are Atlas.

Without the mapping, the records will either go into quarantine,
or will not be counted toward Atlas.

Is there a better way to map such gratia records into the Atlas VO?

dave

On 9/11/2014 12&#58;10 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22393#1410455446'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-11T17:10:46+00:00">Sep 11, 2014 05:10 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1410455446">&nbsp;</a></div><pre>Dave,
the override option overrides all records, not only the one not mapped correctly&#58;
VOOverride=&#34;atlas&#34;

You should remove that

You should not have records going to quarantine.
I&#39;ll try to find out why you had some quarantined records.
Thank you,
Marco</pre></div><div class='update_description'><i onclick="document.location='22393#1410453021'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-11T16:30:21+00:00">Sep 11, 2014 04:30 PM UTC</time> by <b>ddl@....</b><a class="anchor" name="1410453021">&nbsp;</a></div><pre>Marco,

Attached is the ProbeConfig used on mwt2-gk.campuscluster.illinois.edu (MWT_CE_UIUC)
along with a gzip log from /var/log/gratia with LogLevel=5

dave

On 9/11/2014 10&#58;10 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22393#1410451017'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-11T15:56:57+00:00">Sep 11, 2014 03:56 PM UTC</time><a class="anchor" name="1410451017">&nbsp;</a></div><pre>Is this what is causing it?....
<a href='https&#58;//twiki.grid.iu.edu/bin/view/Accounting/ProbeConfigGlideinWMS#Unusual_Use_Cases' target='_blank' rel='nofollow'>https&#58;//twiki.grid.iu.edu/bin/view/Accounting/ProbeConfigGlideinWMS#Unusual_Use_Cases</a>
... see the paragraph &#34;Further, if you want....&#34;

This is in regard to Dave&#39;s entry and what I see int he doc...
&#34;We add the following to our ProbeConfig to map &#34;unknown&#34; VO to &#34;atlas&#34;
for a number of jobs which run on our Tier2 outside the gatekeeper.
MapUnknownToGroup=&#34;1&#34;
MapGroupToRole=&#34;1&#34;
VOOverride=&#34;atlas&#34;
&#34;

From the doc, it sounds like maybe the VOOverride=&#34;atlas&#34; is the culprit and an unintended consequence.
Just a guess.
John Weigand

by /DC=com/DC=DigiCert-Grid/O=Open Science Grid/OU=People/CN=John Weigand 144</pre></div><div class='update_description'><i onclick="document.location='22393#1410448536'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-11T15:15:36+00:00">Sep 11, 2014 03:15 PM UTC</time> by <b>ddl@....</b><a class="anchor" name="1410448536">&nbsp;</a></div><pre>Tonya,

We use GUMS.

If I look at the records being written into /var/lib/gratia/data,
the records from the OSG jobs do have the line

&#60;VO&#62;osg&#60;/VO&#62;

So I believe they are being written properly locally

I suspect the current release of gratia is not handling
our mapping of the &#34;Unknown VO&#34; properly.

The problem started when we updated to gratia to 1.13.30-3 on July 22.
Prior to that, all records without a VO got mapped to Atlas,
and all other records with a VO reported to their respective gratia VO

What we want is to map any records that do not have a VO to the Atlas VO.

If it is a configuration change needed at my end, I can do it,
but I am not certain what the setting should be?

thanks, dave

On 9/11/2014 9&#58;38 AM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22393#1410448199'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-11T15:09:59+00:00">Sep 11, 2014 03:09 PM UTC</time> by <b>Marco Mambelli</b><a class="anchor" name="1410448199">&nbsp;</a></div><pre>Hi Dave,
can you set in the config file
LogLevel = &#34;5&#34;
and attach to the ticket or send me the log file?
I&#39;d like to see why the DN is these records is not associated to a VO.

Thank you,
Marco</pre></div><div class='update_description'><i onclick="document.location='22393#1410446300'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-11T14:38:20+00:00">Sep 11, 2014 02:38 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1410446300">&nbsp;</a></div><pre>Hi Dave,
No, it didn&#39;t and I think it shouldn&#39;t really make any difference. You are still continue to send the jobs as &#34;atlas&#34;. Are you using GUMS? Do you use user-vo-map?
Thanks,
Tanya</pre></div><div class='update_description'><i onclick="document.location='22393#1410383354'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-10T21:09:14+00:00">Sep 10, 2014 09:09 PM UTC</time> by <b>ddl@....</b><a class="anchor" name="1410383354">&nbsp;</a></div><pre>Tonya,

I believe that this update gratia version added two new lines to the ProbeConfig

QuarantineUnknownVORecords=&#34;1&#34;
NoCertinfoBatchRecordsAreLocal=&#34;0&#34;

However, the update rpm put the new config in ProbeConfig.rpmnew
and did not put these lines into the active ProbeConfig.

I found a thread that seemed to indicate problems like the mapping issue
that was fixed by adding the &#34;NoCertinfoBatchRecoresAreLocal&#34; line.

I have updated our ProbeConfig files on all four gatekeeper to include the above two lines.

I also noticed that the port for reporting changed from 80 to 443

SSLHost=&#34;gratia-osg-prod.opensciencegrid.org&#58;443

I have made this change as well.

Please let me know if this is the correct fix for this mapping problem

dave

On 9/10/2014 3&#58;44 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22393#1410382273'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-10T20:51:13+00:00">Sep 10, 2014 08:51 PM UTC</time> by <b>ddl@....</b><a class="anchor" name="1410382273">&nbsp;</a></div><pre>Tonya,

It appears that this is when an update to the gratia probes rpm was installed.

We add the following to our ProbeConfig to map &#34;unknown&#34; VO to &#34;atlas&#34;
for a number of jobs which run on our Tier2 outside the gatekeeper.

MapUnknownToGroup=&#34;1&#34;
MapGroupToRole=&#34;1&#34;
VOOverride=&#34;atlas&#34;

These would be records that normally fall into quarantine.

Did something change with this gratia update which would have broken
or changed this functionality?

The osg records are being written into the data area with &#60;VO&#62;osg&#60;/VO&#62;,
but somehow must be getting changed to &#34;atlas&#34; by the above?

We have been using the above for a long time before the July update
without any problems.

dave

On 9/10/2014 3&#58;05 PM, Open Science Grid FootPrints wrote&#58;
<font color='#7F7E6F'>&#62; [Duplicate message snipped]</font></pre></div><div class='update_description'><i onclick="document.location='22393#1410381891'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-10T20:44:51+00:00">Sep 10, 2014 08:44 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1410381891">&nbsp;</a></div><pre>Hi Tanya,

That is the date and time at which we updated the gratia rpms to
1.13.30-3. I&#39;m not sure what could have gone wrong in that upgrade to
cause this behavior.  Do you know if other sites are using 1.13.30-3,
and if they&#39;re having a similar problem?

--Sarah

On 9/10/14, 4&#58;06 PM, OSG GOC TX via RT wrote&#58;
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;   *Ticket URL&#58;*</font>
<a href='https&#58;//rt.racf.bnl.gov/rt/Ticket/Display.html?id=24774' target='_blank' rel='nofollow'>https&#58;//rt.racf.bnl.gov/rt/Ticket/Display.html?id=24774</a>
<font color='#7F7E6F'>&#62;   *Requestors&#58;* tx+rtbnlprod_fp71@....</font>
<font color='#7F7E6F'>&#62;          *Ccs&#58;* lincolnb@...., support@....</font>
<font color='#7F7E6F'>&#62;        *Queue&#58;* MWTier2</font>
<font color='#7F7E6F'>&#62;        *Owner&#58;* Nobody in particular</font>
<font color='#7F7E6F'>&#62;       *Status&#58;* /open/</font>
<font color='#7F7E6F'>&#62;     *Priority&#58;* /Low/</font>
<font color='#7F7E6F'>&#62;  *Transaction&#58;* Correspondence added by osg-goc-rest</font>
<font color='#7F7E6F'>&#62;      *Subject&#58;* OSG users are mapped to atlas vo</font>
<font color='#7F7E6F'>&#62;           *OSG GOC Ticket&#58;* 22393</font>
&#60;<a href='22393.html' target='_blank' rel='nofollow'>https&#58;//ticket.grid.iu.edu/goc/viewer?id=22393&#62</a>;
<font color='#7F7E6F'>&#62;      *Resource Group Name&#58;* MWT2</font>
<font color='#7F7E6F'>&#62;                  *VO Name&#58;* OSG</font>
<font color='#7F7E6F'>&#62;            *Resource Name&#58;* MWT2_CE_UC</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
------------------------------------------------------------------------
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; This started on ALL MWT2 CEs after 2014-07-22 18&#58;47&#58;49 (before that</font>
it
<font color='#7F7E6F'>&#62; was correctly mapped to osg).  It is still going on. This is are</font>
<div id='show_1520857598' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_1520857598'>batch
<font color='#7F7E6F'>&#62; jobs started via gliedins on MWT2 worker nodes.</font>
<font color='#7F7E6F'>&#62;  -- by Tanya Levshina at Wed Sep 10 20&#58;05&#58;26 UTC 2014</font>
<font color='#7F7E6F'>&#62;</font>

-- by saewill@.... at Wed Sep 10 20&#58;44&#58;17 UTC 2014

GOCTX Source&#58; BNL Ticket&#58; Queue=MWTier2 ID=24774
</div><script type='text/javascript'>
        $('#show_1520857598').click(function() {
            $('#detail_1520857598').slideDown("normal");
            $('#show_1520857598').hide();
            $('#hide_1520857598').show();
        });
        $('#hide_1520857598').click(function() {
            $('#detail_1520857598').slideUp();
            $('#hide_1520857598').hide();
            $('#show_1520857598').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='22393#1410379526'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-10T20:05:26+00:00">Sep 10, 2014 08:05 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1410379526">&nbsp;</a></div><pre>This started on ALL MWT2 CEs after 2014-07-22 18&#58;47&#58;49 (before that it was correctly mapped to osg).  It is still going on. This is are batch jobs started via gliedins on MWT2 worker nodes.</pre></div><div class='update_description'><i onclick="document.location='22393#1410379103'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-10T19:58:23+00:00">Sep 10, 2014 07:58 PM UTC</time> by <b>OSG-GOC</b><a class="anchor" name="1410379103">&nbsp;</a></div><pre>Are these continuously appearing? I ran a few (~10) experimental
submissions via globus-jobrun against uct2-gk.mwt2.org that might
account for this. Is there any user DN associated with these jobs?

--Lincoln

On Sep 10, 2014, at 2&#58;51 PM, The RT System itself via RT wrote&#58;

<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;   Ticket URL&#58;</font>
<a href='https&#58;//rt.racf.bnl.gov/rt/Ticket/Display.html?id=24774' target='_blank' rel='nofollow'>https&#58;//rt.racf.bnl.gov/rt/Ticket/Display.html?id=24774</a>
<font color='#7F7E6F'>&#62;   Requestors&#58; tx+rtbnlprod_fp71@....</font>
<font color='#7F7E6F'>&#62;        Queue&#58; MWTier2</font>
<font color='#7F7E6F'>&#62;        Owner&#58; Nobody in particular</font>
<font color='#7F7E6F'>&#62;       Status&#58; new</font>
<font color='#7F7E6F'>&#62;     Priority&#58; Low</font>
<font color='#7F7E6F'>&#62;  Transaction&#58; Queue changed from StorageManagement to MWTier2 by</font>
RT_System
<font color='#7F7E6F'>&#62;      Subject&#58; OSG users are mapped to atlas vo</font>
<font color='#7F7E6F'>&#62;           OSG GOC Ticket&#58; 22393</font>
<font color='#7F7E6F'>&#62;      Resource Group Name&#58; MWT2</font>
<font color='#7F7E6F'>&#62;                  VO Name&#58; OSG</font>
<font color='#7F7E6F'>&#62;            Resource Name&#58; MWT2_CE_UC</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; Ticket #24774 was moved from the StorageManagement queue into the</font>
MWTier2 queue by The RT System itself.
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62;</font>
<font color='#7F7E6F'>&#62; On Wed, Sep 10, 2014 at 3&#58;51&#58;11 PM EDT, OSG GOC TX created the</font>
following ticket&#58;
-- by lincolnb@.... at Wed Sep 10 19&#58;57&#58;55 UTC 2014
<div id='show_502079534' class=''><button class="btn">Show More</button></div><div class='detail hidden' id='detail_502079534'>
GOCTX Source&#58; BNL Ticket&#58; Queue=MWTier2 ID=24774
</div><script type='text/javascript'>
        $('#show_502079534').click(function() {
            $('#detail_502079534').slideDown("normal");
            $('#show_502079534').hide();
            $('#hide_502079534').show();
        });
        $('#hide_502079534').click(function() {
            $('#detail_502079534').slideUp();
            $('#hide_502079534').hide();
            $('#show_502079534').show();
        });
        </script></pre></div><div class='update_description'><i onclick="document.location='22393#1410378645'; reset_anchor();" class="pull-right icon icon-share"></i><div class="header"><time datetime="2014-09-10T19:50:45+00:00">Sep 10, 2014 07:50 PM UTC</time> by <b>Tanya Levshina</b><a class="anchor" name="1410378645">&nbsp;</a></div><pre>Hi,

We have noticed that gratia probe (condor&#58;uct2-gk.mwt2.org) that is running on your CE nodes maps &#34;osg&#34; user with CommonName=/CN=pilot/osg-flock.grid.iu.edu to atlas VO. Could you please fix it?

+-------------+---------------------+------------------+---------------------------------+--------+------------------+-------------------------+
| LocalUserId | GlobalUsername      | MachineName      | CommonName                      | VOName | ReportableVOName | probename               |
+-------------+---------------------+------------------+---------------------------------+--------+------------------+-------------------------+
| osg         | osg@.... | uct2-gk.mwt2.org | /CN=pilot/osg-flock.grid.iu.edu | atlas  | atlas            | condor&#58;uct2-gk.mwt2.org |
| osg         | osg@.... | uct2-gk.mwt2.org | /CN=pilot/osg-flock.grid.iu.edu | atlas  | atlas            | condor&#58;uct2-gk.mwt2.org |
| osg         | osg@.... | uct2-gk.mwt2.org | /CN=pilot/osg-flock.grid.iu.edu | atlas  | atlas            | condor&#58;uct2-gk.mwt2.org |
| osg         | osg@.... | uct2-gk.mwt2.org | /CN=pilot/osg-flock.grid.iu.edu | atlas  | atlas            | condor&#58;uct2-gk.mwt2.org |
| osg         | osg@.... | uct2-gk.mwt2.org | /CN=pilot/osg-flock.grid.iu.edu | atlas  | atlas            | condor&#58;uct2-gk.mwt2.org |
| osg         | osg@.... | uct2-gk.mwt2.org | /CN=pilot/osg-flock.grid.iu.edu | atlas  | atlas            | condor&#58;uct2-gk.mwt2.org |
| osg         | osg@.... | uct2-gk.mwt2.org | /CN=pilot/osg-flock.grid.iu.edu | atlas  | atlas            | condor&#58;uct2-gk.mwt2.org |
+-------------+---------------------+------------------+---------------------------------+--------+------------------+-------------------------+</pre></div>
</div>
<script type="text/javascript">
function reset_anchor() {
    $("#updates .selected").removeClass("selected");
    var urls = document.location.toString().split('#'); 
    var anchor = urls[1];
    if(anchor) {
        $("a[name='"+anchor+"']").parents(".update_description").addClass("selected");
    }
}
function submitspam(ticket_id) {
    myret = confirm("Would you like to close this ticket as a security ticket, and submit the ticket content to akismet?");
    if(myret == true) {
        $.ajax("viewer/processspam?id="+ticket_id).done(function() {
            window.location.reload();
        });
    }
}

$(function() {
    reset_anchor();
    var ADDITIONAL_COOKIE_NAME = 'gocticket';
    var options = { path: '/', expires: 365};

    if(window.opener && window.opener.name == "gocticket_list") {
        v = $.cookie("closewindow");
        if(!v) {
            $("#closewindow").attr("checked", "checked"); //on by default
        } else {
            if(v == "checked") {
                $("#closewindow").attr("checked", "checked");
            }
        }
        $("#closewindow").click(function() {
            $.cookie("closewindow", $(this).attr('checked'), options);
        });
    } else {
        $("#closewindow_area").hide();
    }
    function updateTimeago() {
        $("time").timeago();
        setTimeout(updateTimeago, 30*1000);
    }
    updateTimeago();
    $(".description").focus(expand_description);
});
</script>
<hr/>
<footer>
<p>GOC Ticket Version 2.2 | <a href="https://ticket.opensciencegrid.org/goc/submit?app_issue_check=on&amp;app_issue_type=goc&amp;app_goc_url=https%3A%2F%2Fticket.opensciencegrid.org%3A443%2F22393">Report Bugs</a>
 | <a href="https://github.com/opensciencegrid/operations/blob/master/docs/privacy.md">Privacy Policy</a>
</p>

<p> <img align="top" src="images/tag_orange.png"/> Copyright 2018 The Trustees of Indiana University - Developed for Open Science Grid</p>
</footer>


</div><!--container-fluid-->
<script>
//used by searchbox
function parseValue(value) {
    var obj = new Object();
    var tokens = value.split("\t");
    obj.str = tokens[0];
    obj.count = tokens[1];
    return obj;
}

$(function() {
    //bootstrap-2.0.4 stuff
    $(".alert-message").alert();
    $(".dropdown-toggle").dropdown();
    $("span[rel='tooltip']").tooltip();
    $("a[rel=popover]").popover();

    //activate menu that user is currently on
    $("#menu_navigator").addClass("active"); 
    $("#submenu_").addClass("active"); 

    //translate zend validation error message to bootstrap
    $(".errors").addClass("alert").addClass("alert-error");

    //enable autocomplete for search box
    $("#search").autocomplete({
        source: function( request, response ) {
            $.ajax({
                url: "search/autocomplete",
                dataType: "text",
                data: {
                    //featureClass: "P",
                    //style: "full",
                    //maxRows: 12,
                    //name_startsWith: request.term
                    q: request.term
                },
                success: function( data ) {
                    response( $.map( data.split("\n"), function( item ) {
                        if(item == "") return null;
                        return {
                            value: item
                        }
                    }));
                }
            });
        },
        select: function(event, ui) {
            document.location = "search?q="+ui.item.value;
        }
    });
    
});
</script>


</body>
